var CSRFInjector=function(l,i,f){var h=l;var q=i;var p=f;var r=true;var g=true;var u=true;var A=true;var m=false;var n=false;this.tokenName=function(){return h;};this.tokenValue=function(){return q;};function s(E,D,C){if(E.addEventListener){E.addEventListener(D,C,false);x.add(E,D,C);}else{if(E.attachEvent){E["e"+D+C]=C;
E[D+C]=function(){E["e"+D+C](window.event);};E.attachEvent("on"+D,E[D+C]);x.add(E,D,C);}else{E["on"+D]=E["e"+D+C];}}}var x=function(){var C=[];return{listEvents:C,add:function(D,F,E){C.push(arguments);},flush:function(){var D,E;for(D=C.length-1;D>=0;D=D-1){E=C[D];if(E[0].removeEventListener){E[0].removeEventListener(E[1],E[2],E[3]);
}if(E[1].substring(0,2)!="on"){E[1]="on"+E[1];}if(E[0].detachEvent){E[0].detachEvent(E[1],E[2]);}E[0][E[1]]=null;}}};}();function y(D,C){return D.indexOf(C)===0;}function v(D,C){return D.match(C+"$")==C;}function t(D,C){return D.indexOf(C)!==-1;}function o(){XMLHttpRequest.prototype._open=XMLHttpRequest.prototype.open;
XMLHttpRequest.prototype.open=function(G,D,E,C,F){this.url=D;if(this.onopen!=null){this.onopen.apply(this,arguments);}this._open.apply(this,[G,this.url,E,C,F]);};XMLHttpRequest.prototype._send=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.send=function(C){if(this.onsend!=null){this.onsend.apply(this,C);
}this._send.apply(this,arguments);};}function w(){var C=window.XMLHttpRequest;function D(){this.base=C?new C:new window.ActiveXObject("Microsoft.XMLHTTP");}function E(){return new D;}E.prototype=D.prototype;E.UNSENT=0;E.OPENED=1;E.HEADERS_RECEIVED=2;E.LOADING=3;E.DONE=4;E.prototype.status=0;E.prototype.statusText="";
E.prototype.readyState=E.UNSENT;E.prototype.responseText="";E.prototype.responseXML=null;E.prototype.onsend=null;E.prototype.onopen=null;E.url=null;E.onreadystatechange=null;E.prototype.open=function(K,H,I,G,J){var F=this;this.url=H;if(this.onopen!=null){this.onopen.apply(this,arguments);}this.base.onreadystatechange=function(){try{F.status=F.base.status;
}catch(L){}try{F.statusText=F.base.statusText;}catch(L){}try{F.readyState=F.base.readyState;}catch(L){}try{F.responseText=F.base.responseText;}catch(L){}try{F.responseXML=F.base.responseXML;}catch(L){}if(F.onreadystatechange!=null){F.onreadystatechange.apply(this,arguments);}};this.base.open(K,this.url,I,G,J);
};E.prototype.send=function(F){if(this.onsend!=null){this.onsend.apply(this,arguments);}this.base.send(F);};E.prototype.abort=function(){this.base.abort();};E.prototype.getAllResponseHeaders=function(){return this.base.getAllResponseHeaders();};E.prototype.getResponseHeader=function(F){return this.base.getResponseHeader(F);
};E.prototype.setRequestHeader=function(F,G){return this.base.setRequestHeader(F,G);};window.XMLHttpRequest=E;}function b(E,D){var C=false;if(E==D){C=true;}else{if(r==false){if(D.charAt(0)=="."){C=v(E,D);}else{C=v(E,"."+D);}}}return C;}function z(F){var D=["demandware.static"];for(var C=0;C<D.length;
C++){var E=D[C];if(t(F,E)){return false;}}return true;}function j(I){if(I.substring(0,7)=="http://"||I.substring(0,8)=="https://"){var F="://";var D=I.indexOf(F);var C=I.substring(D+F.length);var H="";for(var E=0;E<C.length;E++){var G=C.charAt(E);if(G=="/"||G==":"||G=="#"){break;}else{H+=G;}}return b(document.domain,H)&&z(I);
}else{if(I.charAt(0)=="#"){return false;}else{if(!y(I,"//")&&(I.charAt(0)=="/"||I.indexOf(":")==-1)){return z(I);}}}return false;}function a(C){var F=false;var E=C.getAttribute("action");if(E!=null&&j(E)){if(C[h]){C[h].value=q;}else{var D=document.createElement("input");D.setAttribute("type","hidden");
D.setAttribute("name",h);D.setAttribute("value",q);C.appendChild(D);}F=true;}return F;}function c(I){var L=I;var E=L.indexOf(h);if(E!=-1){if(m){var M=(E+h.length+1);var F=L.indexOf("&",E);var H=L.indexOf("#",E);var J=L.length;if(F>-1){if(H>-1){J=Math.min(F,H);}else{J=F;}}else{if(H>-1){J=H;}}var C=L.substring(M,J);
L=L.replace(C,q);}}else{if(L.indexOf("#")!=-1){var D=L.split("#");D[0]=c(D[0]);var G=D[0];for(var K=1;K<D.length;K++){G=G+"#"+D[K];}L=G;}else{L=e(L);}}return L;}function e(D){var C=D;if(C.indexOf("?")!=-1){C=C+"&"+h+"="+q;}else{C=C+"?"+h+"="+q;}return C;}function k(E,C){var G=false;var D=E.getAttribute(C);
if(D==null||D.length==0){return false;}if(E.tagName=="IFRAME"){if(n){console.log("Skipping iframe: "+E.name);}return true;}if(E.tagName=="FORM"&&"post"!=E.getAttribute("method")){if(n){console.log("Skipping form with get method, instead add as a parameter: "+E.name);}return false;}if(D!=null&&j(D)){if(n){console.log("inject into "+C+" attribute: "+D);
}D=c(D);try{if(E.getAttribute(C)!==D){E.setAttribute(C,D);G=true;}}catch(F){}}return G;}function d(F){var G=F.all?F.all:F.getElementsByTagName("*");var C=G.length;for(var E=0;E<C;E++){var D=G[E];if(D.tagName.toLowerCase()=="form"){if(g==true){if(n){console.log("injecting into form: "+D.name);}var H=k(D,"action");
if(!H){a(D);}}}else{if(u==true){k(D,"src");k(D,"href");}}}}function B(){d(document);}this.inject=function(){if(b(document.domain,p)){if(n){console.log("valid!");}if(A==true){if(navigator.appName=="Microsoft Internet Explorer"){if(n){console.log("IE!");}w();}else{if(n){console.log("Not IE!");}o();}XMLHttpRequest.prototype.onopen=function(C){if(this.url!=null&&j(this.url)){if(n){console.log("Added to XHR: "+this.url);
}if(this.url.indexOf(h)==-1){this.url=c(this.url);}}};}s(window,"unload",x.flush);s(window,"load",function(){B();});}else{alert("CSRF Protection cannot be used in an unauthorized domain: "+p);}};this.injectInString=function(D){var C=new DOMParser().parseFromString(D,"text/xml");d(C);D=new XMLSerializer().serializeToString(C);
return D;};this.injectInDoc=function(C){return d(C);};this.injectInURL=function(C){if(j(C)){C=c(C);}return C;};this.updateToken=function(C){q=C;m=true;this.injectInDoc(document);m=false;};};