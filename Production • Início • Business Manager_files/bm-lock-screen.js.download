(function(a){if(!window.DW){window.DW={};}DW.ScreenSaver=(function(){var c={};function e(m){c.opts=m;if(!c.interval){c.interval=window.setInterval(j,c.opts.defaultTimeout);}a(document).ready(function(){a("#login #loginform form").on("submit",function(n){n.preventDefault();n.stopPropagation();b(this);
});a("#Login_Button_AM").on("click",function(r){var n=window.open(undefined,"MsgWindow","width=800, height=750");try{var o;try{o=n.document.createElement("form");}catch(r){n.close();n=window.open(undefined,"MsgWindow","width=800, height=750");o=n.document.createElement("form");}o.setAttribute("action",c.opts.amUrl);
o.setAttribute("method","post");o.style.display="none";n.document.body.appendChild(o);var s=n.document.createElement("input");s.setAttribute("type","hidden");s.setAttribute("name","source");s.setAttribute("value","login_screensaver");o.appendChild(s);o.submit();}catch(r){}var q=false;var v=false;function p(){window.removeEventListener("message",u);
if(v){window.clearInterval(v);v=false;}}function t(){if(!q){q=true;i();}}window.closeScreenSaver=function(w){if(window.BMCSRFInjector){window.BMCSRFInjector.updateToken(w);}p();t();};function u(w){if(w.source===n&&w.data==="closeScreensaver"){p();k(function(){t();d();});}}window.addEventListener("message",u);
v=window.setInterval(function(){if(n.closed){p();k(function(){t();d();});}},1000);});});}function d(m){if(window.BMCSRFInjector){a.ajax(c.opts.sessionCheckUrl,{cache:false,dataType:"json",data:{method:"RefreshCSRFToken",siteID:c.opts.domainId},type:"POST",success:function(o,n,p){if(o.success){window.BMCSRFInjector.updateToken(o.csrf_token);
}else{f();}},error:function(p,n,o){f();g(c.opts.messages.networkProblem);}});}}function k(m){a.ajax(c.opts.sessionCheckUrl,{cache:false,dataType:"json",data:{method:"GetSessionTimeout",siteID:c.opts.domainId},type:"POST",success:function(o,n,p){if(o.expirationtime>10000){m();}else{f();}},error:function(p,n,o){f();
g(c.opts.messages.networkProblem);}});}function j(){a.ajax(c.opts.sessionCheckUrl,{cache:false,dataType:"json",data:{method:"GetSessionTimeout",siteID:c.opts.domainId},type:"POST",success:function(n,m,o){if(n.expirationtime<10000){f();if(n.expirationtime===-1){g(c.opts.messages.sessionTimeout);}if(n.expirationtime===-2){l();
}}},error:function(o,m,n){if(!window.isLoginShown){f();g(c.opts.messages.networkProblem);}}});}function f(){if(!window.isLoginShown){window.isLoginShown=true;var m=a('<div id="lock-screen-veil" class="lock-screen__veil"></div>');var n=a("body>#login");a("body").append(m);a("body").append(n);n.css({zIndex:"2147483647",position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)"});
n.show();if(c.opts.isExternalUser){a("#loginform").hide();a("#amform").show();}else{a("#loginform").show();a("#amform").hide();}}}function i(){window.isLoginShown=false;a("body>#lock-screen-veil").remove();a("#login #LoginForm_Password").val("");a("body>#login").hide();a("body>#login_am").hide();}function g(m){a("#login .login_message").html(m);
}function l(){window.location.href=c.opts.logoutUrl;}function b(m){m=a(m);a.ajax(c.opts.loginFormUrl,{cache:false,dataType:"json",type:"POST",data:m.serialize(),success:function(o,n,p){if(o.success){i();if(window.BMCSRFInjector){window.BMCSRFInjector.updateToken(o.csrf_token);}}else{h(o.error);}},error:function(p,n,o){a("#login #LoginForm_Password").val("").focus();
g(c.opts.messages.networkProblem);}});}function h(m){var n=m[0].code;if(Object.keys(c.opts.messages).indexOf(n)>=0){g(c.opts.messages[n]);a("#login #LoginForm_Password").val("").focus();}else{if(n==="SessionExpired"){l();}else{g(c.opts.messages.unknownError);a("#login #LoginForm_Password").val("").focus();
}}}return{start:function(m){e(m);},logout:function(){l();}};}());}(jQuery));