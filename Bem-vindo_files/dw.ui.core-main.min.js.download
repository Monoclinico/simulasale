/**
 * @license Demandware UI Framework
 *
 * Authors: Demandware UI Framework Team
 *          Jeff Raab <jraab@demandware.com>,
 *          Steffen Eckardt <seckardt@demandware.com>
 * License: UNLICENSED
 * Version: 4.4.4 (2023/05/24)
 */
!function(a,b){function c(a){return Object.prototype.toString.call(a)}function d(a,b){return c(a)==="[object "+b+"]"}function e(a){return a===Object(a)}function f(a){return d(a,"String")}function g(a){return d(a,"Function")}function h(){function a(a,c,d){var f=b[a];if(!e(f)||!d(f))throw new Error("Invalid library: "+c);i[a]=f}a("_","Lo-Dash.js",function(a){return g(a.at)&&f(a.VERSION)});a("angular","Angular.js",function(a){return g(a.module)&&e(a.version)&&f(a.version.full)})}var i={},j=b[a];!function(){var a=b,b={};!function(a){a.CSS||(a.CSS={});var b=a.CSS;var c=function(a){this.message=a};c.prototype=new Error;c.prototype.name="InvalidCharacterError";b.escape||(b.escape=function(a){var b=String(a);var d=b.length;var e=-1;var f;var g="";var h=b.charCodeAt(0);for(;++e<d;){f=b.charCodeAt(e);if(0==f)throw new c("Invalid character: the input contains U+0000.");if(f>=1&&f<=31||127==f||0==e&&f>=48&&f<=57||1==e&&f>=48&&f<=57&&45==h){g+="\\"+f.toString(16)+" ";continue}if(0==e&&1==d&&45==f){g+="\\"+b.charAt(e);continue}if(f>=128||45==f||95==f||f>=48&&f<=57||f>=65&&f<=90||f>=97&&f<=122){g+=b.charAt(e);continue}g+="\\"+b.charAt(e)}return g})}(void 0!==b?b:this);dw$.CSS=b.CSS;b=a}();h();!function(){var c="dw.ui.core";i.marker={};i.buist=angular.module(c,["ng","ngRoute","ngSanitize"]);i.$injectorCache={};i.$injectorConstant=function(a){return function(){var b=_.toArray(arguments),c=_.first(b);i.$injectorCache[c]=_.last(b);return a.apply(this,b)}};i.buist.constant=i.$injectorConstant(i.buist.constant);i.buist.config(["$routeProvider",function(a){a.eagerInstantiationEnabled(!1)}]).config(["$qProvider",function(a){a.errorOnUnhandledRejections(!1)}]).constant("_",_).constant("angular",b.angular).constant("moment",b.moment).constant("interact",b.interact).constant("Pikaday",b.Pikaday).constant("Tether",b.Tether);i.apiType=function(b){return a+"."+b};i.type=function(b){return a+".internal."+b};i.safe$apply=function(a,b){a.$root.$$phase?b():a.$apply(b)};i.MAX_INT=9007199254740992;i.events={disclose:c+".disclose",drag:{start:c+".drag.start",end:c+".drag.end"},error:{http:c+".error.http"},generate:c+".generate",hide:c+".hide",http:{start:c+".http.requeststart",end:c+".http.requestend"},invalidate:c+".invalidate",private:{tooltip:{lock:c+".private.tooltip.lock"}},ready:c+".ready",resize:c+".resize",workspaces:{transitionstart:c+".workspaces.transitionstart",transitionend:c+".workspaces.transitionend"}};i.dataAttributeRegexp=/^(x[:\-_]|data[:\-_])/i}();!function(){function a(){function a(b,g){_.isArguments(b)&&(b=_.toPlainObject(b));if(null===b||void 0===b||!_.isObject(b))return b;(f(g)?c(g):Object.keys(g)).forEach(function(c){if(e(c))return;Array.isArray(g[c])&&f(b[c])&&(b[c]=d(b[c]));b.hasOwnProperty(c)?_.isPlainObject(g[c])||Array.isArray(g[c])?b[c]=a(b[c],g[c]):void 0!==g[c]&&(b[c]=g[c]):b[c]=g[c]});return b}function b(a){return m.test(a)}function c(a){var b=[];for(var c=0;c<a.length;c++)b.push(c.toString());return b}function d(a){var b=[];for(var c=0;c<a.length;c++)b[c]=a[c];return b}function e(a){return n.indexOf(a)>=0}function f(a){return!!a&&_.isNumber(a.length)}function g(a){if(Array.isArray(a))return a;var b=[];var c;for(;null!==(c=i.exec(a));)b.push(c[k]?c[l].replace(h,"$1"):c[j]||c[0]);b.length||(b=[""]);return b}var h=/\\(\\)?/g;var i=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g;var j=1;var k=2;var l=3;var m=/^\d+$/;var n=["__proto__","constructor"];this.defaultsDeep=function(){var a=arguments[0];var b=Array.prototype.slice.call(arguments,1);if(null===a||void 0===a)return a;var c=this;b.forEach(function(b){if(null===b||void 0===b||!_.isObject(b))return;Object.keys(b).forEach(function(d){if(e(d))return;a.hasOwnProperty(d)&&void 0!==a[d]?null!==a[d]&&_.isPlainObject(a[d])&&c.defaultsDeep(a[d],b[d]):a[d]=b[d]})});return a};this.set=function(a,c,d){if(null===a||void 0===a)return a;c=null!=a[c]?[c]:g(c);if(c.length){var f=a;for(var h=0;h<c.length-1;h++){if(e(c[h]))continue;null!==f[c[h]]&&void 0!==f[c[h]]||(f[c[h]]=b(c[h+1])?[]:{});f=f[c[h]]}f[c[c.length-1]]=d}return a};this.merge=function(){var b=arguments[0];var c=Array.prototype.slice.call(arguments,1);if(null===b||void 0===b||!_.isObject(b))return b;return c.reduce(function(b,c){return a(b,c)},b)}}i.buist.constant("ObjectUtils",new a)}();!function(){var a=/{\s*{/gm,b=/}\s*}/gm,c="&#8203;";_.mixin({isUndefinedOrNull:function(a){return _.isUndefined(a)||_.isNull(a)},isNotBlank:function(a){return _.isString(a)&&a.trim().length>0},isBlank:function(a){return!_.isString(a)||0===a.trim().length},isObjectMap:function(a){return _.isObject(a)&&!_.isArray(a)&&!_.isFunction(a)&&!_.isDate(a)&&!_.isRegExp(a)},isScope:function(a){return _.isObject(a)&&_.isFunction(a.$apply)},isPromise:function(a){return _.isObject(a)&&_.isFunction(a.then)},escapeExpression:function(d){return(_.isString(d)?d:"").replace(a,"{"+c+"{").replace(b,"}"+c+"}")},matrix:function(){function a(a){if(a.length<2)return;_.each(a,function(b){var c=_.filter(a,function(a){return a!==b});d[b]=(d[b]||[]).concat(c)})}function b(){var d=[];_.each(arguments,function(a){_.isArray(a)?b.apply(null,a):d.push(c(a))});a.call(null,_.uniq(d))}var c,d={};var e,f=_.last(arguments);if(_.isFunction(f)){c=f;e=_.initial(arguments)}else{c=_.identity;e=_.toArray(arguments)}b.apply(null,e);_.each(d,function(a,b){d[b]=_.uniq(a)});return d},keyByIndex:function(a){var b={};_.isArray(a)&&a.forEach(function(a,c){b[c]=a});return b}})}();!function(){function a(){function a(a,b,c){if(!0!==a)throw new Error(b+(_.isString(c)?": "+c:""));return a}function b(b,c){a(!_.isUndefined(b),"Undefined",c);return b}function c(b,d,e,f){a(_.isNumber(b),"Not a number",d);if(!_.isUndefined(e)){c(e,"minValue");a(b>=e,"Number less than "+e,d)}if(!_.isUndefined(f)){c(f,"maxValue");a(b<=f,"Number greater than "+f,d)}return b}function d(b,d,e,f){a(_.isString(b),"Not a string",d);if(!_.isUndefined(e)){c(e,"minLength",0);a(b.length>=e,"String shorter than "+e,d)}if(!_.isUndefined(f)){c(f,"maxLength",0);a(b.length<=f,"String longer than "+f,d)}return b}function e(b,d,e,f){a(_.isArray(b),"Not an array",d);if(!_.isUndefined(e)){c(e,"minLength",0);a(b.length>=e,"Array shorter than "+e,d)}if(!_.isUndefined(f)){c(f,"maxLength",0);a(b.length<=f,"Array longer than "+f,d)}return b}function f(b,c){a(_.isObjectMap(b),"Not an object hash",c);return b}function g(b,c){a(_.isFunction(b),"Not a function",c);return b}function h(b,c){a(_.isBoolean(b),"Not a boolean",c);return b}function j(b,c){a(_.isDate(b),"Not a date",c);return b}function k(b,c){a(_.isRegExp(b),"Not a regular expression",c);return b}function l(b,c){a(_.isElement(b),"Not a DOM element",c);return b}function m(b,c){a(_.isString(b)||b instanceof i.SafeHtml,"Not a string or SafeHtml",c);return b}function n(a){return function(){if(0===arguments.length)return;if(_.isUndefinedOrNull(arguments[0]))return arguments[0];return a.apply(a,arguments)}}var o=this,p=/^check/;this.checkArgument=function(b,c){a(b,c||"Invalid argument")};this.checkDefined=b;this.checkNotNull=function(c,d){b(c,d);a(!_.isNull(c),"Null",d);return c};this.checkNumber=c;this.checkString=d;this.checkArray=e;this.checkObject=f;this.checkFunction=g;this.checkBoolean=h;this.checkDate=j;this.checkRegExp=k;this.checkElement=l;this.checkHtml=m;this.optional={};_.each(_.filter(_.functions(this),function(a){return p.test(a)&&"checkArgument"!==a}),function(a){o.optional[a]=n(o[a])})}i.buist.constant("Preconditions",new a)}();!function(){function a(){}i.config={};a.prototype=i.config;i.buist.constant("Configuration",new a)}();!function(){var a=angular.injector;angular.injector=function(){var b,c=_.toArray(arguments),d=c[0];if(1===c.length&&_.isArray(d)&&1===_.size(d)){var e=d[0];b=((i.module&&i.module.rootElements||{})[e]||angular.element(document)).injector()}return b||a.apply(a,c)};j.invoke=function(){function a(a){var b=e.length;a.checkArgument(b<=1,"Multiple root modules found for application");a.checkFunction(c,"fn");a.checkArray(d,"deps",1)}var b=_.toArray(arguments),c=_.last(b),d=_.initial(b),e=i.module&&i.module.rootElements?_.keys(i.module.rootElements):[];var f=_.first(e),g=f&&f.name?f.name:"dw.ui.core",h=angular.injector([g]);return h.invoke(["Preconditions",function(c){a(c);return h.invoke(b,null,i.$injectorCache)}])}}();j.invoke("Preconditions",function(a){j.inject=function(){var b=_.toArray(arguments),c=_.last(b),d=_.initial(b);a.checkFunction(c,"fn");a.checkArray(d,"deps",1);return function a(){var b=j.invoke.apply(j,d.concat(function(){return _.toArray(arguments)}));var e=b.slice();e=e.concat(_.toArray(arguments));c.dw$super=a.dw$super;return c.apply(this,e)}}});j.invoke("Preconditions",function(a){function b(a){return a.charAt(Math.random()*a.length|0)}function c(b){var c=d+b;this.set=function(b,d){a.checkArgument(_.isObject(b),"Not an object: instance");b[c]=d};this.get=function(b){a.checkArgument(_.isObject(b),"Not an object: instance");return b[c]}}var d="__"+b("hH")+b("i1")+b("dD")+b("eE3")+"__";j.hide=function(b){a.checkString(b,"name",1);return new c(b)}});j.invoke("Preconditions",function(a){var b=j.hide("SafeHtml.html");i.SafeHtml=function(a){a=_.escapeExpression(a);b.set(this,a);this.length=a.length};i.SafeHtml.prototype={toString:function(){return b.get(this)},toSafeString:j.inject("$sanitize",function(a){return a(this.toString())}),concatSafe:function(a){if(a instanceof i.SafeHtml)return new i.SafeHtml(this+a);if(_.isString(a))return new i.SafeHtml(this+_.escape(a));throw new Error("Not a string or SafeHtml: html")},concatSafeHTML:function(b){a.checkString(b,"html");return new i.SafeHtml(this+b)},trimSafe:function(){return new i.SafeHtml(this.toString().trim())}};j.safe=function(a){if(a instanceof i.SafeHtml)return a;if(_.isString(a))return new i.SafeHtml(_.escape(a));throw new Error("Not a string or SafeHtml: html")};i.buist.filter("SafeHtml",["$sce",function(a){return function(b){b instanceof i.SafeHtml||(b=j.safe(i.toStringFormat(b)));return a.trustAsHtml(b.toSafeString())}}]);i.buist.filter("SafeResourceUrl",["$sce",function(a){return function(b){return _.isString(b)?a.trustAsResourceUrl(b):""}}])});j.invoke("Preconditions",function(a){function b(a){var b=a.split(".");return _.map(b,function(a){return _.camelCase(a).trim()}).join(".")}function c(){}function d(a,c,d,e){var g=d.attr("id"),h=b(g.replace(new RegExp("^"+e),"").replace(f,""));h&&a(h).assign(c,d.attr("content"))}function e(b,c){a.optional.checkString(b,"prefix",1);a.optional.checkFunction(c,"handler");c=c||j.inject("$parse","Configuration",d);return j.meta(b,c)}var f=/^[\.\-]+/;c.prototype.read=e;i.buist.constant("Meta",new c)});j.invoke("Preconditions",function(a){i.element={contains:function(b,c){a.checkArgument(!b||_.isElement(b)||_.isFunction(b.inheritedData)||document===b,"Not an element or angular.element: el1");a.checkArgument(!c||_.isElement(c)||_.isFunction(c.inheritedData)||document===c,"Not an element or angular.element: el2");if(!b||!c)return!1;b=angular.element(b);c=angular.element(c);for(;c[0];){if(c[0]===b[0])return!0;c=c.parent()}return!1},getViewSize:function(){return{width:document.documentElement.clientWidth||document.body.clientWidth,height:document.documentElement.clientHeight||document.body.clientHeight}},parent:function(b,c){a.checkArgument(!b||_.isElement(b)||_.isFunction(b.inheritedData),"Not an element or angular.element: element");a.checkArgument(_.isNotBlank(c)||_.isFunction(c),"Not a string or function: condition");if(!b)return null;if(_.isString(c)){var d=c;c=function(a){return a.hasClass(d)}}b=angular.element(b).parent();for(;b[0];){if(c(b))return b[0];b=b.parent()}return null}}});j.invoke("Preconditions",function(a){j.element=function(b,c){a.checkString(b,"selector",1);a.optional.checkBoolean(c,"all");_.isBoolean(c)||(c="#"!==b.charAt(0)||/,\s*#/g.test(b));if(c){var d=document.querySelectorAll(b),e=[];_.each(d,function(a,b){e[b]=angular.element(a)});return e}var f=document.querySelector(b);return _.isUndefinedOrNull(f)?null:angular.element(f)}});j.invoke("Preconditions",function(a){var b=/^\s*</;i.elementTemplate=function(c){a.checkString(c,"template");return b.test(c)?c:"<span>"+c+"</span>"};var c=j.hide("scope");var d=j.hide("ctrl");var e=j.hide("config");var f=j.hide("delegates");var g={config:function(){return e.get(this)}};j.interaction=j.inject("$rootScope","$timeout",function(b,h,k){a.checkObject(k,"config");a.checkArgument(_.isFunction(k.controller)||_.isString(k.controller)||_.isArray(k.controller)&&_.isFunction(_.last(k.controller)),"Not a $controller function: config.controller");a.checkArgument(_.isUndefinedOrNull(k.scope)||_.isScope(k.scope),"Not a scope: config.scope");a.optional.checkObject(k.defaults,"config.defaults");var l=j.inject("$q","$compile","$controller",function(b,g,j){var k=b.defer(),m=c.get(l);i.safe$apply(m,function(){_.each(f.get(l),function(a){a(k.promise)});var b,c=m.$new(),n=e.get(l);if(n.template){a.checkString(n.template,"config.defaults.template");b=angular.element(i.elementTemplate(n.template));angular.element(document.body).append(b)}try{j(d.get(l),{$scope:c,$config:n,$deferred:k,$element:b,$interaction:l})}catch(o){b&&b.remove();throw o}if(n.template){g(b)(c);c.$on("$destroy",function(){h(function(){b.remove()},0,!1)})}c.$on("$destroy",function(){h(function(){k.resolve()},0,!1)})})});_.extend(l,g);_.each(["then","catch","finally"],function(a){l[a]=function(){var b=arguments;f.get(l).push(function(c){c[a].apply(c,b)});return l}});e.set(l,_.assign({},k.defaults));c.set(l,k.scope||b);d.set(l,k.controller);f.set(l,[]);return l})});j.invoke("Preconditions",function(a){function b(c){a.checkFunction(b.caller.dw$super,"superclass method");return b.caller.dw$super.apply(this,c||[])}j.Object=function(){};j.Object.prototype={callParent:b}});j.invoke("Preconditions",function(a){var b={};i.classConstructors={};var c=j.hide("Class.ctor");var d=j.hide("Class.className");var e=j.hide("Class.superName");var f=j.hide("Class.mixinNames");j.Class=function(g,h,j,k){a.checkFunction(g,"ctor");a.checkString(h,"name",1);a.optional.checkString(j,"superName",1);a.optional.checkArray(k,"mixinNames");c.set(this,g);i.classConstructors[h]=g;d.set(g,h);d.set(g.prototype,h);e.set(g,j||null);f.set(g,k||[]);b[h]=this};j.Class.prototype=_.create(j.Object.prototype,{getName:function(){return d.get(c.get(this))},getSuperclass:function(){var a=e.get(c.get(this));return a?j.Class.getClass(a):null},getMixin:function(b){a.checkString(b,"name",1);var d=f.get(c.get(this));if(-1===_.indexOf(d,b))return null;return j.Class.getClass(b)},isInstance:function(a){return!!_.isObject(a)&&a instanceof c.get(this)}});_.extend(j.Class,{getClass:function(c){a.checkString(c,"name",1);return b[c]||null},getClassOf:function(b){a.checkObject(b,"object");var c=Object.getPrototypeOf(b),e=c?d.get(c):null;return e?j.Class.getClass(e):null}});new j.Class(j.Object,i.apiType("Object"));new j.Class(j.Class,i.apiType("Class"),i.apiType("Object"))});j.invoke("Preconditions","ObjectUtils",function(a,c){function d(a,b){a.dw$super=b;return a}j.define=j.inject("$parse",function(e,f,g){a.checkString(f,"name",1);a.checkObject(g,"structure");a.optional.checkString(g.extend,"structure.extend",1);a.optional.checkFunction(g.constructor,"structure.constructor");a.optional.checkArray(g.mixins,"structure.mixins",1);a.optional.checkObject(g.static,"structure.static");a.optional.checkObject(g.member,"structure.member");a.checkArgument(null===j.Class.getClass(f),"Class already defined: "+f);var h=g.extend||i.apiType("Object");a.checkArgument(null!==j.Class.getClass(h),"Superclass not defined: "+h);var k=g.hasOwnProperty("constructor")?g.constructor:function(){this.callParent(arguments)};var l=i.classConstructors[h];var m=g.member;m||(m=_.omit(g,"extend","constructor","mixins","static"));var n={constructor:d(k,l)};_.forOwn(m,function(a,b){if("constructor"!==b){_.isFunction(a)&&(a=d(a,l.prototype[b]));n[b]=a}});_.each(g.mixins,function(b){a.checkArgument(null!==j.Class.getClass(b),"Mixin not defined: "+b);_.forOwn(i.classConstructors[b].prototype,function(a,b){if(_.isUndefined(n[b])){_.isFunction(a)&&(a=d(a,l.prototype[b]));n[b]=a}})});k.prototype=_.create(l.prototype,n);var o=new j.Class(k,f,h,g.mixins);_.forOwn(g.static,function(a,b){o[b]=a;k[b]=a});var p={};e(f).assign(p,k);c.merge(b,p);return o})});j.invoke("Preconditions",function(a){j.create=function(b){function c(){d.apply(this,e)}a.checkString(b,"className",1);a.checkArgument(null!==j.Class.getClass(b),"Class not defined: "+b);var d=i.classConstructors[b],e=_.drop(arguments,1);c.prototype=_.create(d.prototype,{});return new c}});j.invoke("Preconditions","Configuration",function(a,b){function c(){function c(b){!function b(c,d){_.each(c,function(c,e){a.checkArgument(_.isString(c)||_.isPlainObject(c),"Not a string or object hash: "+e);_.isString(c)?f[d+e]=c:_.isPlainObject(c)&&b(c,d+e+".")})}(b,"")}function e(a){function b(a){return!a}function c(a){return a&&/#|!/.test(a.charAt(0))}function d(a){return!b(a)&&!c(a)}function e(a){var b=a.search(/[^\\]=/),c=a.search(/[^\\]:/),d=a.search(/[^\\]\s/),e=a.length,f=Math.min(-1===b?e:b+1,-1===c?e:c+1,-1===d?e:d+1);return f===e?-1:f}function g(a){a=a.trim();a=a.replace(/\\\$/,"$");a=a.replace(/\\#/,"#");a=a.replace(/\\!/,"!");a=a.replace(/\\=/,"=");a=a.replace(/\\:/,":");return a.replace(/\\(\s)/,"$1")}if(!a)return;var h,i=a.split(/\r\n|\r|\n/g);for(var j=0;j<i.length;j++){h=i[j]?i[j].trim():"";if(d(h)){var k=e(h),l=g(-1===k?h:h.substring(0,k)),m=-1===k?"":g(h.substring(k+1)),n="\\"===h.charAt(h.length-1);for(;n&&j<i.length-1;){d(h)&&(m=m.substring(0,m.length-1));j++;h=i[j]?i[j].trim():"";if(b(h))n=!1;else if(d(h)){m+=h;n="\\"===h.charAt(h.length-1)}}f[l]=m}}}var f={};this.load=function(b){a.checkArgument(_.isUndefinedOrNull(b)||_.isString(b)||_.isPlainObject(b),"Not a string or object hash: content");_.isPlainObject(b)?c(b):d.test(b)?c(angular.fromJson(b)):e(b)};this.get=function(b){a.checkString(b,"key",1);var c=f[b];if(_.isUndefined(c))return b;arguments.length>1&&(c=j.format.apply(j.format,[c].concat(_.drop(arguments,1))));return c};this.getSafeHtml=function(c){a.checkString(c,"key",1);var d=f[c],e=!0===b["i18n.messages.safe"];_.isUndefined(d)&&(d=c);d=e?j.safe("").concatSafeHTML(d):j.safe(d);if(arguments.length>1)return j.formatSafe.apply(j.formatSafe,[d].concat(_.tail(arguments)));return d};this.getPlural=function(b,c){a.checkString(b,"key",1);a.checkNumber(c,"count");var d=i.pluralForm(c);d&&(b+="["+d+"]");return this.get.apply(this,[b].concat(c).concat(_.drop(arguments,2)))};this.has=function(b){a.checkString(b,"key",1);return!_.isUndefinedOrNull(f[b])};this.getPluralSafeHtml=function(b,c){a.checkString(b,"key",1);a.checkNumber(c,"count");var d=i.pluralForm(c);d&&(b+="["+d+"]");return this.getSafeHtml.apply(this,[b].concat(c).concat(_.drop(arguments,2)))}}i.config["i18n.pluralRules"]={one:1};var d=/^\s*\{/;i.pluralForm=function(c){a.checkNumber(c,"count");var d=b["i18n.pluralRules"];for(var e in d)if(d.hasOwnProperty(e)){var f=d[e];var g;if(_.isNumber(f))g=c===f;else{if(!_.isFunction(f))throw new Error('Not a number or function: Plural rule "'+e+'"');g=f(c)}if(g)return e}};var e=new c;i.buist.constant("Messages",e).filter("MessagesSafe",function(){return function(b){a.checkString(b,"Messages filter value");return e.getSafeHtml.apply(e,arguments)}}).filter("Messages",["$filter",function(a){return function(){return a("MessagesSafe").apply(e,arguments).toString()}}]).filter("MessagesPluralSafe",function(){return function(b,c){a.checkString(b,"MessagesPlural filter value");a.checkNumber(c,"MessagesPlural filter count");return e.getPluralSafeHtml.apply(e,arguments)}}).filter("MessagesPlural",["$filter",function(a){return function(){return a("MessagesPluralSafe").apply(e,arguments).toString()}}])});j.invoke("Preconditions","Configuration","Messages","moment",function(a,b,c,d){function e(){var c={months:b["i18n.format.monthNames"],weekdays:b["i18n.format.dayNames"],week:{dow:b["i18n.format.weekStart"]}};a.checkArray(c.months,"i18n.format.monthNames",12,12);a.checkArray(c.weekdays,"i18n.format.dayNames",7,7);c.monthsShort=_.map(c.months,function(a){return a.substring(0,3)});c.weekdaysShort=_.map(c.weekdays,function(a){return a.substring(0,3)});return c}function f(a){switch(a){case"c":return;case"time":return"x"}var b="";for(var c=0;c<a.length;c++)switch(a.charAt(c)){case"\\":b+="["+a.charAt(++c)+"]";break;case"d":b+="DD";break;case"D":b+="ddd";break;case"j":b+="D";break;case"l":b+="dddd";break;case"N":b+="E";break;case"w":b+="d";break;case"z":b+="DDD";break;case"W":b+="WW";break;case"F":b+="MMMM";break;case"m":b+="MM";break;case"M":b+="MMM";break;case"n":b+="M";break;case"o":b+="GGGG";break;case"Y":b+="YYYY";break;case"y":b+="YY";break;case"g":b+="h";break;case"G":b+="H";break;case"h":b+="hh";break;case"H":b+="HH";break;case"i":b+="mm";break;case"s":b+="ss";break;case"u":b+="SSS";break;case"O":b+="ZZ";break;case"P":b+="Z";break;case"T":b+="z";break;case"U":b+="X";break;default:b+=a.charAt(c)}return b}function g(a,b,c){for(var d=a.length-b,e="-"===a.charAt(0)?2:1;d>=e;d-=b)a=a.substring(0,d)+c+a.substring(d);return a}function h(b,c,d,e,f,h,i,j){a.checkNumber(b,"number");var k,l,m,n="";if(f>0){n=b.toFixed(f);k=n.indexOf(".");-1!==k&&(n=n.substring(k+1));n.length>f&&(n=n.substring(0,f));for(var o=0;o<f-e;o++)"0"===n.charAt(n.length-1)&&(n=n.substring(0,n.length-1));n.length>0&&(n=h+n);l=Math.floor(b).toString()}else l=Math.round(b).toString();k=l.indexOf(".");-1!==k&&(l=l.substring(0,k));n=l+n;k=n.indexOf(h);-1===k&&(k=n.length);if(e>0){if(k===n.length){m=0;n+=h}else m=n.length-k-1;for(;m<e;){n+="0";m++}}if(i>0){var p="-"===n.charAt(0)?"-":"";n=p+g(n.substring(p.length,k),i,j)+n.substring(k)}n.substring(n.length-h.length)===h&&(n=n.substring(0,n.length-h.length));c.length>0&&(n=c+n);d.length>0&&(n+=d);return n}function k(b,c,d,e,f){a.checkString(b,"value",1);var g=b,h=!0,i=new RegExp(c,"i").exec(g);i?g=i[d]:h=!1;var j;if(h){g=g.replace(new RegExp(_.escapeRegExp(f),"g"),"");g=g.replace(e,".");j=parseFloat(g)}if(!h||_.isNaN(j))throw new Error('Invalid number: "'+b+'"');return j}function l(c,d){var e,f,g=0,i=c.length,j="",l="";for(e=0;e<c.length;e++){f=c.charAt(e);if(/[0#,\.]/.test(f)){g=e;break}if("\\"===f){e<c.length-1&&(j+=c.charAt(e+1));e++}else j+=f}for(;e<c.length;){if(!/[0#,\.]/.test(c.charAt(e))){i=e;break}e++}for(;e<c.length;){f=c.charAt(e);if("\\"===f){e<c.length-1&&(l+=c.charAt(e+1));e++}else l+=f;e++}var m=c.indexOf(",",g);-1!==m&&a.checkArgument(m===c.lastIndexOf(",",i-1),"Multiple grouping separators: "+c);var n=c.indexOf(".",g);if(-1!==n){a.checkArgument(n===c.lastIndexOf(".",i-1),"Multiple decimal separators: "+c);-1!==m&&a.checkArgument(m<n,"Grouping after decimal separator: "+c)}var o=0;-1!==m&&(o=(-1===n?i:n)-m-1);var p=0,q=0;if(-1!==n){var r;for(e=n+1;e<i;e++){r=c.charAt(e);if("0"===r){p++;q++}else"#"===r&&q++}}var s=b["i18n.format.decimalSeparator"];var t=b["i18n.format.groupSeparator"];if(d){j=j.replace("¤",d);l=l.replace("¤",d)}var u=function(a){if(!_.isNumber(a))return"";return h(a,j,l,p,q,s,o,t)};var v="^\\s*?",w=1;if(j.trim().length>0){v+="("+_.escapeRegExp(j.trim())+")?\\s*?";w=2}v+="(([\\d]";o>0&&(v+="|"+_.escapeRegExp(t));q>0&&(v+="|"+_.escapeRegExp(s));v+=")+)\\s*?";l.trim().length>0&&(v+="("+_.escapeRegExp(l.trim())+")?\\s*?");v+="$";u.parse=function(a){var b=k(a,v,w,s,t);b=h(b,j,l,p,q,s,o,t);return k(b,v,w,s,t)};return u}function m(a,b){var c,d;for(c=0;c<a.length;c++){d=a.charAt(c);if(";"===d)break;"\\"===d&&c++}var e,f;if(c===a.length){e=l(a,b);f=l("-"+a,b)}else{e=l(a.substring(0,c),b);f=l(a.substring(c+1),b)}var g=function(a){if(!_.isNumber(a))return"";return a<0?f(Math.abs(a)):e(a)};g.parse=function(a){try{return e.parse(a)}catch(b){try{return 0-f.parse(a)}catch(c){throw b}}};return g}function n(b,c,e){a.checkDate(b,"date");p(e);var g=d(b).format(f(c));d.updateLocale("Formats",{});return g}function o(b,c,e){a.checkString(b,"value",1);p(e);try{c=f(c);var g=c?d(b.trim(),c):d(new Date(b.trim()));if(!g.isValid())throw new Error('Invalid date: "'+b+'"');return g.toDate()}finally{d.updateLocale("Formats",{})}}function p(a){d.localeData("Formats")?d.updateLocale("Formats",a):d.locale("Formats",a)}function q(a){var b=e();var c=function(c){if(!_.isDate(c))return"";return n(c,a,b)};c.parse=function(c){return o(c,a,b)};return c}function r(b){a.checkArray(b,"value");var c="";_.each(b,function(a,b){b>0&&(c+=", ");c+=a});return c}function s(b){a.checkString(b,"value",1);var c=[];_.each(b.split(","),function(a){c.push(a.trim())});return c}function t(){var a=function(a){if(!_.isArray(a))return"";return r(a)};a.parse=function(a){return s(a)};return a}function u(a,b){return function(c){if(!_.isString(c))return"";c.length>b&&(c=j.format(a,c.substring(0,b)));return c}}function v(c,d,e){a.checkString(b["i18n.format.groupSeparator"],"i18n.format.groupSeparator");a.checkString(b["i18n.format.decimalSeparator"],"i18n.format.decimalSeparator");var f="n|"+c+"|"+b["i18n.format.groupSeparator"]+"|"+b["i18n.format.decimalSeparator"]+"|"+e,g=C[f];if(!g){try{g=m(c,e)}catch(h){throw new Error("Invalid format pattern: "+d)}C[f]=g}return g}function w(c){a.checkArray(b["i18n.format.dayNames"],"i18n.format.dayNames");a.checkArray(b["i18n.format.monthNames"],"i18n.format.monthNames");var d="d|"+c+"|"+b["i18n.format.dayNames"].join(",")+"|"+b["i18n.format.monthNames"].join(","),e=C[d];if(!e){e=q(c);C[d]=e}return e}function x(d,e){var f,g=b["i18n.format.currency."+d];if(!_.isString(g)&&_.isFunction(b["i18n.format.currency"])){f=b["i18n.format.currency"](d);if(_.isString(f)){g=c.get(f);a.checkArgument(g!==f,"No currency format pattern configured for: "+d)}}if(!_.isString(g))throw new Error("No currency format pattern configured for: "+d);return v(g,e,c.get(f+".symbol"))}function y(a,b,c){var d="a|"+a+"|"+c,e=C[d];if(!e){if(!_.isString(a))throw new Error("Not a string: "+b);e=u(a,c);C[d]=e}return e}function z(){var c={};this.put=function(b,d){a.checkString(b,"name",1);a.optional.checkFunction(d,"format");c[b]=d};this.get=function(b){a.checkString(b,"name",1);return c[b]||null};this.number=function(b){a.checkString(b,"pattern",1);return v(b,b)};this.date=function(b){a.checkString(b,"pattern",1);return w(b,b)};this.currency=function(b){a.checkString(b,"code",3,3);return x(b,b)};this.object=j.inject("$parse",function(b){var c=_.tail(arguments),d=_.initial(c),e=_.last(c),f=[];a.checkArray(d,"paths",1);a.checkFunction(e,"renderer");_.each(d,function(a,c){f[c]=b(a)});return function(b){a.checkObject(b,"object");var c=[];_.each(f,function(a,d){c[d]=a(b)});return e.apply(this,c)}});this.abbrev=function(c){a.checkNumber(c,"length",1);return y(b["i18n.format.abbreviation"],"i18n.format.abbreviation",c)}}function A(a,c){var d=function(d){return c(b[a],a)(d)};d.parse=function(d){return c(b[a],a).parse(d)};return d}function B(){var a=function(a,b){return D.currency(b)(a)};a.parse=function(a,b){return D.currency(b).parse(a)};return a}i.identityFormat=function(a){return a};i.identityFormat.parse=i.identityFormat;i.toStringFormat=function(a){if(_.isUndefinedOrNull(a))return"";a=a.toString();if(!_.isString(a))throw new Error("Not a string: toString return value");return a};i.safeHtmlFormat=function(a){if(a instanceof i.SafeHtml)return a;if(_.isUndefinedOrNull(a))a="";else{a=a.toString();if(!_.isString(a))throw new Error("Not a string: toString return value")}return j.safe(a)};i.intFormat=function(b){a.optional.checkNumber(b,"value");return i.toStringFormat(b)};i.intFormat.parse=function(a){if(/^-?[0-9]+$/.test(a))return Math.floor(parseFloat(a));throw new Error("Not a number")};i.decimalFormat=function(a){return i.intFormat(a)};i.decimalFormat.parse=function(a){if(/^-?([0-9]|\.)+$/.test(a))return parseFloat(a);throw new Error("Not a number")};i.booleanFormat=function(b){a.optional.checkBoolean(b,"value");return i.toStringFormat(b)};i.booleanFormat.parse=function(b){a.checkArgument("true"===b||"false"===b,"Not a boolean");return"true"===b};i.config["i18n.format.groupSeparator"]=",";i.config["i18n.format.decimalSeparator"]=".";i.config["i18n.format.integer"]="0";i.config["i18n.format.decimal"]="0.##########";i.config["i18n.format.dayNames"]=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];i.config["i18n.format.monthNames"]=["January","February","March","April","May","June","July","August","September","October","November","December"];i.config["i18n.format.weekStart"]=0;i.config["i18n.format.date"]="n/j/Y";i.config["i18n.format.time"]="g:i a";i.config["i18n.format.datetime"]="n/j/Y g:i a";i.config["i18n.format.monthyear"]="F Y";i.config["i18n.format.currency.USD"]="$ 0,000.00;$ -0,000.00";i.config["i18n.format.abbreviation"]="{0}...";var C={};var D=new z;i.buist.constant("Formats",D);D.put("integer",A("i18n.format.integer",v));D.put("decimal",A("i18n.format.decimal",v));D.put("date",A("i18n.format.date",w));D.put("time",A("i18n.format.time",w));D.put("datetime",A("i18n.format.datetime",w));D.put("monthyear",A("i18n.format.monthyear",w));D.put("iso8601",D.date("c"));D.put("millistimestamp",D.date("time"));D.put("array",t());D.put("currency",B());_.each([5,10,20,40],function(a){D.put("abbrev"+a,A("i18n.format.abbreviation",function(b,c){return y(b,c,a)}))});i.buist.filter("FormatsSafe",function(){return function(b,c){a.checkString(c,"Formats filter name");var d=D.get(c);a.checkArgument(_.isFunction(d),'Unknown format: "'+c+'"');b=d.apply(d,[b].concat(_.drop(arguments,2)));return i.safeHtmlFormat(b)}}).filter("Formats",["$filter",function(a){return function(){var b=a("FormatsSafe");return b.apply(b,arguments).toString()}}])});j.invoke("Preconditions","Formats",function(a,b){function c(a){try{return i.intFormat.parse(a)}catch(b){throw new Error("Not a number: Message parameter "+a)}}function d(a){return a}function e(c,d,e,f){var g,h,i,j,k,l,m=c.match(/{[^}]*}/g);if(!m)return c;g="";for(l=0;l<m.length;l++){i=c.indexOf(m[l]);g+=c.substring(0,i)+"{"+l+"}";c=c.substring(i+m[l].length)}g+=c;for(l=0;l<m.length;l++){h=m[l].indexOf(":");if(-1===h){i=m[l].substring(1,m[l].length-1);j=f}else{i=m[l].substring(1,h);j=b.get(m[l].substring(h+1,m[l].length-1));a.checkArgument(_.isFunction(j),"Unknown format: "+m[l].substring(h+1,m[l].length-1))}k=j(d[e(i)]);j!==f&&(k=f(k));g=g.replace(new RegExp("\\{"+l+"\\}","g"),k)}return g}j.format=function(){var b=_.head(arguments),d=_.tail(arguments);a.checkString(b,"template");return e(b,d,c,i.toStringFormat)};j.formatSafe=function(){var b=_.head(arguments),d=_.tail(arguments);a.checkHtml(b,"template");return j.safe("").concatSafeHTML(e(j.safe(b).toString(),d,c,i.safeHtmlFormat))};j.formatNamed=function(b,c){a.checkString(b,"template");a.checkObject(c,"parameters");return e(b,c,d,i.toStringFormat)};j.formatNamedSafe=function(b,c){a.checkHtml(b,"template");a.checkObject(c,"parameters");return j.safe("").concatSafeHTML(e(j.safe(b).toString(),c,d,i.safeHtmlFormat))}});j.invoke("Messages","Configuration",function(a,b){i.config["i18n.locale"]="default";define("i18n",function(){return{load:function(c,d,e){function f(a,b){return a.replace(/\{locale}/g,b)}function g(b,c,d){if(i&&!_.includes(i,c)){d();return}var e="text!"+f(b,c);require([e],function(b){a.load(b);d()},function(){d()})}function h(){0===m.length?e(!0):g(c,m.shift(),h)}var i=b["i18n.locales"];i&&i.push("default");var j=b["i18n.locale"];var k=j.split("-"),l=k.length,m=["default"];for(var n=0;n<l;n++)m.push(k.slice(0,n+1).join("-"));if(!0===b["i18n.oneRequest"])if(i){m.reverse();m=[_.find(m,function(a){return _.includes(i,a)})||"default"]}else m=m.slice(m.length-1);g(c,m.shift(),h)}}})});j.invoke("Preconditions",function(a){function b(a,b,c,d){var e=a.indexOf(b+"-");c[d]=-1!==e;if(-1===e)return a;return a.substring(0,e)+a.substring(e+b.length+1)}var c="shift",d="ctrl",e="alt",f="home",g="end",h="pgup",k="pgdn",l="up",m="down",n="left",o="right",p="enter",q="esc",r="tab";i.keyCodes={};var s;for(var t="A".charCodeAt(0),u="Z".charCodeAt(0);t<=u;t++)i.keyCodes[String.fromCharCode(t).toLowerCase()]=t
;for(var v="0".charCodeAt(0),w="9".charCodeAt(0);v<=w;v++)i.keyCodes[String.fromCharCode(v)]=v;for(var x=1;x<=12;x++){s="f"+x;i.keyCodes[s]=111+x}i.keyCodes[f]=36;i.keyCodes[g]=35;i.keyCodes[h]=33;i.keyCodes[k]=34;i.keyCodes[l]=38;i.keyCodes[m]=40;i.keyCodes[n]=37;i.keyCodes[o]=39;i.keyCodes[p]=13;i.keyCodes[q]=27;i.keyCodes[r]=9;j.KeyBinding=function(f,g){a.checkString(f,"keyStroke",1);a.checkFunction(g,"keyHandler");var h=b(f.toLowerCase(),c.toLowerCase(),this,"shift");h=b(h,d.toLowerCase(),this,"ctrl");h=b(h,e.toLowerCase(),this,"alt");a.checkArgument(void 0!==i.keyCodes[h],"Key stroke not valid: "+f);this.key=h;this.handler=g};_.extend(j.KeyBinding,{CTRL:d,SHIFT:c,ALT:e,HOME:f,END:g,PAGE_UP:h,PAGE_DOWN:k,UP:l,DOWN:m,LEFT:n,RIGHT:o,ENTER:p,ESC:q,TAB:r})});j.invoke("Preconditions",function(a){function b(a,b){var c=function(b){function d(){if(b.keyCode!==i.keyCodes[a.key])return!1;if(a.shift&&!b.shiftKey)return!1;if(a.ctrl&&!b.ctrlKey)return!1;if(a.alt&&!b.altKey)return!1;return!0}if(d()&&!1!==a.handler(b)){c.dw$preventDefault&&b.preventDefault&&b.preventDefault();c.dw$stopPropagation&&b.stopPropagation&&b.stopPropagation()}};c.dw$binding=a;c.dw$target=b;return c}function c(a,b){return function(c){return c.dw$binding===a&&c.dw$target===b}}function d(){this.add=function(f,g){a.checkObject(f,"keyBinding");a.checkArgument(f instanceof j.KeyBinding,"Not a KeyBinding: keyBinding");a.optional.checkElement(g,"target");g||(g=document);if(-1!==_.findIndex(e,c(f,g)))return new d.HandlerModifier(function(){});var h=b(f,g);e.push(h);angular.element(g).on("keydown",h);return new d.HandlerModifier(h)};this.remove=function(b,d){a.checkObject(b,"keyBinding");a.checkArgument(b instanceof j.KeyBinding,"Not a KeyBinding: keyBinding");a.optional.checkElement(d,"target");d||(d=document);var f=_.remove(e,c(b,d));_.each(f,function(a){angular.element(d).off("keydown",a)})}}var e=[];d.HandlerModifier=function(b){this.preventDefault=function(c){a.checkBoolean(c,"preventDefault");b.dw$preventDefault=c;return this};this.stopPropagation=function(c){a.checkBoolean(c,"stopPropagation");b.dw$stopPropagation=c;return this};this.preventDefault(!0).stopPropagation(!0)};i.buist.constant("Keys",new d)});j.invoke("Preconditions","Configuration",function(a,b){function c(){var c,d=navigator.userAgent,e=navigator.vendor,f=/Edge\//.test(d),g=!!window.chrome&&/google/i.test(e),h="InstallTrigger"in window,i=/( MSIE)|(Trident.)/.test(d),k=/Safari\//.test(d);try{f?c=parseInt(/Edge\/(\d+)\./.exec(d)[1],10):g?c=parseInt(/Chrome\/(\d+)\./.exec(d)[1],10):h?c=parseInt(/Firefox\/(\d+)\./.exec(d)[1],10):k?c=parseInt(/Version\/(\d+)\./.exec(d)[1],10):i?/rv:11/.test(d)?c=11:/MSIE 10/.test(d)||/Trident\/6/.test(d)?c=10:/MSIE 9/.test(d)||/Trident\/5/.test(d)?c=9:(/MSIE 8/.test(d)||/Trident\/4/.test(d))&&(c=8):c=0}catch(l){c=0}this.title=function(c){a.checkString(c,"title");var d=b["i18n.default.titlePattern"];a.checkString(d,"Configuration i18n.default.titlePattern");document.title=j.format(d,c)};this.isChrome=function(){return g};this.isFF=function(){return h};this.isIE=function(){return i};this.isEdge=function(){return f};this.isSafari=function(){return k};this.version=function(){return c}}i.config["i18n.default.titlePattern"]="{0}";var d=new c;if(d.isIE()){var e=d.version(),f=angular.element(document.body);9===e&&f.addClass("dw-ie9");10===e&&f.addClass("dw-ie10");e<=10&&f.addClass("dw-ie-legacy")}i.buist.constant("Browser",d)});j.invoke("Preconditions",function(a){function b(b,c){b=a.checkNotNull(b,"type");_.extend(this,{type:b,timeStamp:(new Date).getTime()},c)}function c(b){a.checkObject(b,"configuration");var c=this;return _.extend(c,{from:function(a){if(_.isUndefined(a))return b.target;b.target=a;return c}})}function d(){function d(b){a.checkNotNull(b,"type");g[b]=g[b]||{};return g[b]}function e(a,b){var c=d(a),e=_.keys(c);if(0===e.length)return{};var f={};_.each(e,function(a){var d=c[a],e=d.s;e&&!_.isEqual(b,e)||(f[a]=d)});return f}var f=this,g={},h=-1;return _.extend(f,{on:function(b,c,e,f){function g(){delete i[j]}a.checkFunction(c,"handler");a.checkArgument(_.isUndefinedOrNull(f)||_.isScope(f),"Not a scope: scope");var i=d(b),j=++h;i[j]={h:c,s:_.isUndefinedOrNull(e)?void 0:e};_.isScope(e)&&e.$on("$destroy",g);_.isScope(f)&&f.$on("$destroy",g);return g},trigger:j.inject("$rootScope",function(d,f,g){function h(){var a=e(f,j.from()),c=_.clone(g),h=new b(f,{target:j.from(),data:g});c.unshift(h);_.each(a,function(a){d.$evalAsync(function(){a.h.apply({event:h},c)})})}a.checkNotNull(f,"type");var i={},j=new c(i),k=_.toArray(arguments);g=_.drop(k,2);d.$evalAsync(h);return j}),size:function(a,b){return _.size(e(a,b))}})}function e(){return _.extend(this,{$new:function(){return new d}})}i.buist.constant("EventBusFactory",new e).constant("EventBus",new d)});j.invoke("Preconditions","Configuration",function(a,b){function c(d,f){function g(a){a.match(/^http(s)?:\/\//)||(a=b.rootPath+a);return a}function h(a){var b="";switch(a){case"css":case"i18n":b=a+"!"}var c=f[a];c=_.isString(c)?[c]:c;c=_.isArray(c)?c:[];_.each(c,function(a){_.isArray(a)?d.push(_.invokeMap(a,function(){return b+g(this)})):_.isString(a)&&d.push([b+g(a)])})}if(f.packages){a.checkArgument(_.isString(f.packages)||_.isArray(f.packages),"Not a string or array: packages");_.each(_.isString(f.packages)?[f.packages]:f.packages,function(a){if(!e[a])throw new Error("Unknown package: "+a);c(d,e[a])})}h("css");h("i18n");h("js");return d}function d(){this.define=function(b,c){if(_.isObject(b))_.each(b,function(a,b){this.define(b,a)}.bind(this));else{a.checkString(b,"name",1);a.checkArgument(!e[b],"Package already defined: "+b);a.checkObject(c,"config");a.checkArgument(_.isUndefined(c.js)||_.isArray(c.js)||_.isString(c.js),"Expected string or array: config.js");a.checkArgument(_.isUndefined(c.css)||_.isArray(c.css)||_.isString(c.css),"Expected string or array: config.css");a.checkArgument(_.isUndefined(c.i18n)||_.isArray(c.i18n)||_.isString(c.i18n),"Expected string or array: config.i18n");a.checkArgument(_.isUndefined(c.packages)||_.isArray(c.packages)||_.isString(c.packages),"Expected string or array: config.packages");e[b]=_.cloneDeep(_.pick(c,["js","css","i18n","packages"]))}};this.resolve=j.inject("$q",function(b,c){function d(){if(_.isString(this)){a.checkString(this,"name",1);if(!e[this])throw new Error("Unknown package: "+this);return f(e[this])}if(_.isObject(this))return f(this);throw new Error("Unsupported package type: "+typeof oneArg)}if(_.isArray(c)){a.checkArray(c,"packages",1);return b.all(_.invokeMap(c,d))}return d.call(c)})}var e={};var f=j.inject("$q","$timeout",function(a,b,d){function e(a){var b=a.requireModules&&a.requireModules[0];g.reject("Failed to resolve: "+b)}function f(b,c){function d(){require(b,function(){f.resolve();c===i-1&&g.resolve()},e)}var f=a.defer();j?j.then(d):d();j=f.promise}var g=a.defer(),h=c([],d),i=h.length,j=null;if(0===i){g.resolve();return g.promise}_.each(h,f);return g.promise});i.buist.constant("Package",new d)});j.invoke("Preconditions",function(a){function b(){this.parse=function(b){function c(a,b){var c=k;k=!0===b;if(c)j.push(a);else{var d=parseInt(a,10);_.isNaN(d)?j.push(a):j.push(d)}}a.checkString(b,"path");var d,e,f,g,h=b.length,i=0,j=[],k=!1;for(;i<h;){d=b.indexOf(".",i);e=b.indexOf("[",i);if(-1===d&&-1===e){c(b.slice(i,h));i=h}else if(-1===e||-1!==d&&d<e){c(b.slice(i,d),!0);i=d+1}else{if(e>i){c(b.slice(i,e));i=e}f=b.slice(e+1,e+2);if('"'!==f&&"'"!==f){g=b.indexOf("]",e);-1===g&&(g=h);c(b.slice(i+1,g));i="."===b.slice(g+1,g+2)?g+2:g+1}else{g=b.indexOf(f+"]",e);-1===g&&(g=h);for(;"\\"===b.slice(g-1,g)&&e<h;){e++;g=b.indexOf(f+"]",e)}var l=b.slice(i+2,g).replace(new RegExp("\\"+f,"g"),f);c('"'===f?l.replace(/'/g,"\\'"):l);i="."===b.slice(g+2,g+3)?g+3:g+2}}}return j};this.format=function(b){a.checkArray(b,"parts");var d="'";return _.map(b,function(b,e){a.checkArgument(_.isString(b)||_.isNumber(b),"Not a string or number: path part");var f=0===e;if(_.isNumber(b))return f?b:"["+b+"]";var g=c.test(b),h=b.replace(/'/g,"'");if(g)return"["+d+h+d+"]";return(f?"":".")+h}).join("")}}var c=/[\-\.'"\uD800-\uDFFF]/;i.buist.constant("ObjectPath",new b)});j.invoke("Preconditions","EventBus","ObjectPath","ObjectUtils",function(b,c,d,e){function f(a){return a instanceof q}function g(a){return a instanceof p}function h(a){return f(a)||g(a)}function k(a,c){b.checkArgument(this===v,"Invalid invocation: Use Validator.config() to create a new ValidatorConfig instance");b.checkBoolean(a,"external flag");b.optional.checkObject(c,"configuration");var d=function(){};d.prototype=k.prototype;var e=new d;c=c?_.clone(c):{};return _.extend(e,{clone:function(){var a=this!==v;return k.call(v,a,c)},property:function(d){if(0===arguments.length)return c.property;b.checkString(d,"model property");b.checkArgument(!a,"Invalid access: The modification of this value is forbidden");c.property=d;return e},context:function(a){if(0===arguments.length)return _.clone(c.ctx);b.checkObject(a,"context information");c.ctx=_.omit(a,"property","verbose");return e},verbose:function(a){if(0===arguments.length)return c.verbose||!1;b.checkBoolean(a,"flag");c.verbose=a;return e}})}function l(a){return a instanceof k?a:k.call(v,!1)}function m(a,c,d,e,f,g){b.checkString(a,"type",1);b.checkObject(c,"args");b.checkString(e,"property");b.checkArray(f,"types");b.checkObject(g,"config");var h=g.context();h&&_.extend(this,_.omit(h,"type","types","args","value","property"));_.extend(this,{type:a,args:c,value:d,property:e,types:f,verbose:g.verbose()});Object.freeze&&Object.freeze(this)}function n(c,e,f,g,k){function l(c,d,e,f){if(_.isArray(c)){var g=0,h=[],i=[];_.each(c,function(c,k){var l=c instanceof j.ValidatorStatus;b.checkArgument(l||_.isBoolean(c)||_.isString(c),"Not an instance of Boolean, String or "+a+".ValidatorStatus: err["+k+"]");if(!0===c){++g;i.push(q(d,e))}else if(l)if(!0===c.success){++g;i.push(s(c,f))}else h.push(s(c,f));else _.isString(c)?h.push(r(d,e,c)):h.push(r(d,e))});return{success:g===_.size(c),errors:h,successes:i}}return!1}function n(a,b,c,d,e){var f=l(a,b,c,d);if(f)return f;if(a instanceof j.ValidatorStatus)return!0===a.success||[a];if(e&&!1!==a)return!0;return!1}function o(a,b,c,d){return function(e){var f=n(e,a,b,d,!0);f&&_.isBoolean(f.success)?f.success?c.resolve(f.successes):c.reject(f.errors):_.isArray(f)?c.reject(f):!0!==f?c.reject([r(a,b)]):c.resolve(q(a,b))}}function p(a,b,c,d){return function(e){var f=n(e,a,b,d);f&&f.errors?c.reject(f.errors):_.isArray(f)?c.reject(f):c.reject([r(a,b)])}}function q(a,b){return new j.ValidatorStatus(!0,c,b,a,e)}function r(a,b,d){return new j.ValidatorStatus(!1,c,b,a,e,d)}function s(a,b){if(b){var c=_.isNotBlank(a.property)?d.format(d.parse(e+'["'+a.property.replace(/"/g,'"')+'"]')):e;return new j.ValidatorStatus(a.success,a.type,a.args,a.value,c,a.reason)}return a}function t(a,b){var d=[];_.every(f,function(f){var i=_.clone(f),n=new m(c,i,b,e,g,k);var s=u.call(n,b,i);var t=a.defer();d.push(t.promise);if(!0===s){t.resolve(q(b,i));return!0}if(_.isString(s)){t.reject([r(b,i,s)]);return!1}if(s instanceof j.ValidatorStatus){if(!0===s.success){t.resolve(s);return!0}t.reject([s]);return!1}if(_.isPromise(s)){var w=s.dw$validator,x=p(b,i,t,w),y=o(b,i,t,w);s.then(y,x);return!0}if(h(s)){var z=k.clone.call(v);s.validate(b,z).then(t.resolve,t.reject);return!0}var A=l(s,b,i,!1);if(A&&!A.success){t.reject(A.errors);return!1}if(A||!1!==s){t.resolve(q(b,i));return!0}t.reject([r(b,i)]);return!1});return a.all(d)}b.checkString(c,"type",1);var u=i.v8n.v.a[c];b.checkFunction(u,'method "'+c+'"');b.checkArray(f,"invocations",1);return j.inject("$q",function(a,b){return t(a,b)})}function o(a){if(_.isBlank(a))return[];return d.parse(a)}function p(){function a(){return _.clone(x.get(e))}function c(a,c,f){f=l(f);var g=x.get(e);b.checkObject(g,"sequence data");var h=[],i=d.format(o(f.property())),j=_.keys(g);_.each(g,function(a,b){var d=new n(b,i,a,j,f);h.push(d(c))});var k=a.all(h).then(function(a){return _.flattenDeep(a)});k.dw$validator=!0;return k}var e=this;x.set(e,{});return _.extend(e,{$sequence:a,validate:j.inject("$q",c)})}function q(a){function c(){var c=new p;_.each(a,function(a,d){var e=d+1;b.checkObject(a,"configuration "+e);b.checkString(a.type,"configuration.type "+e,1);c[a.type](_.omit(a,"type"))});return c}function g(){return _.clone(w.get(t))}function i(){return _.clone(u)}function k(a,c,e){function f(a){return function(c){b.checkArray(c,"statuses");m.push.apply(m,c);a.resolve()}}function g(a){return function(c){if(k){b.checkArray(c,"errors");p.push.apply(p,c);a.resolve()}else a.reject(c)}}function h(a){a=_.isArray(a)?a:[a];a=_.compact(a);k?0===_.size(p)?q.resolve(_.flattenDeep(m)):q.reject(p):_.isEmpty(a)?q.resolve(_.flattenDeep(m)):q.reject(a)}function i(){var b=[];_.each(t.$config(),function(h,i){var j=_.clone(r);j.push(i);var k=a.defer(),l=_.get(c,i.replace(/\\'/g,"'")),m=e.clone.call(v);m.property(d.format(j));h.validate(l,m).then(f(k),g(k));b.push(k.promise)});a.all(b).then(h,h)}var j=w.get(t);b.checkObject(j,"rule data");e=l(e);var k=e.verbose(),m=[],p=[],q=a.defer(),r=o(e.property()),s=d.format(r);var u=[],x=_.keys(j);_.each(j,function(b,d){var h=a.defer();new n(d,s,b,x,e)(c).then(f(h),g(h));u.push(h.promise)});_.isEmpty(u)?i():a.all(u).then(function(){_.isEmpty(p)?i():h()},h);var y=q.promise;y.dw$validator=!0;return y}function m(a,c){b.checkString(a,"property",1);b.checkArgument(_.isUndefinedOrNull(c)||h(c),"Not a ValidatorRule or ValidatorRuleSequence: newRuleOrSequence");u=_.clone(u);var g=d.parse(a);if(1===_.size(g)){c?u[g[0]]=c:delete u[g[0]];return}var i=g[0],j=u[i];g.shift();var k=d.format(g);if(j&&f(j))j.update(k,c);else{if(!c)return;var l={};e.set(l,k,c);u[i]=r.rule(l)}}function s(a){b.checkString(a,"property",1);var c=d.parse(a);if(1===_.size(c)){var e,g=u[c[0]];if(g instanceof q){e=new q(g.$config());w.set(e,g.$sequence())}else if(g instanceof p){e=new p;x.set(e,g.$sequence())}return e}var h=u[c[0]];if(h&&f(h)){c.shift();return h.get(d.format(c))}}b.checkArgument(_.isPlainObject(a)||_.isArray(a),"No object hash or array: configuration");if(_.isArray(a))return c(a);var t=this;_.each(a,function(c,d){if(-1!==d.indexOf("'")){delete a[d];d=d.replace(/'/g,"\\'");a[d]=c}(_.isPlainObject(c)||_.isArray(c))&&(c=a[d]=new q(c));b.checkArgument(h(c),"Not a ValidatorRule or ValidatorRuleSequence: "+d)});var u=_.clone(a);w.set(t,{});return _.extend(t,{$sequence:g,$config:i,validate:j.inject("$q",k),update:m,get:s})}function r(a){function d(a){b.checkArray(a,"rules",1);_.each(a,function(c,d){_.isPlainObject(c)&&(c=a[d]=new q(c));b.checkArgument(h(c),"Not a ValidatorRule or ValidatorRuleSequence: argument "+ ++d)})}function g(){return _.clone(o)}function k(a,c,d){function e(a){return function(c){b.checkArray(c,"statuses");i.push.apply(i,c);a.resolve()}}function f(a){return function(c){b.checkArray(c,"errors");j.push.apply(j,c);h?a.resolve():a.reject()}}function g(){_.isEmpty(j)?m.resolve(_.flattenDeep(i)):m.reject(j)}d=l(d);var h=d.verbose(),i=[],j=[],k=[],m=a.defer();_.each(o,function(b){var g=a.defer();b.validate(c,d.clone.call(v)).then(e(g),f(g));k.push(g.promise)});a.all(k).then(g,g);return m.promise}function m(a){function g(a,c){var d=!1;_.each(o,function(b){if(f(b))if(d)b.update(a);else{b.update(a,c);d=!0}});if(!d){b.checkString(a,"property",1);var g={};e.set(g,a,c);o.push(r.rule(g))}}if(_.includes([2,3],arguments.length)&&_.isString(arguments[1])){arguments[2]&&d([arguments[2]]);g(arguments[1],arguments[2])}else{var h=_.drop(arguments,1);d(h);o=_.clone(h)}t&&a.cancel(t);t=a(function(){t=null;c.trigger(i.events.invalidate).from(s)})}function n(a){b.checkString(a,"property",1);var c=[];_.each(o,function(b){if(f(b)){var d=b.get(a);d&&c.push(d)}});return c}b.checkArgument(this===v,"Invalid invocation: Use Validator.of() to create a new Validator instance");d(a);var o=_.clone(a);var p=function(){};p.prototype=r.prototype;var s=new p;var t=null;return _.extend(s,{rules:g,validate:j.inject("$q",k),update:j.inject("$timeout",m),get:n})}function s(a,c,d){function e(a){b.checkObject(a,"configurator");return function(){b.checkNumber(arguments.length,"arguments.length",0,1);b.optional.checkObject(arguments[0],"arguments[0]");var c=this,e=a.get(c);(e[d]||(e[d]=[])).push(arguments[0]||{});return c}}var f="validator type",g="Invalid "+f+": ",h="Reserved "+f+": ",j="Existing "+f+": ";b.checkString(a,f,1);b.checkArgument(u.test(a),g+a);b.optional.checkString(d,"type alias",1);d=d||a;var k=i.v8n,l=k.v,m=_.keys(l.i).concat(["validate"]);b.checkArgument(!_.includes(m,a),h+a);b.checkFunction(c,"validator");b.checkArgument(!_.includes(_.keys(l.a),a),j+a);if(d!==a){b.checkArgument(u.test(d),g+d);b.checkArgument(!_.includes(m,d),h+d);b.checkArgument(!_.includes(_.keys(l.a),d),j+d)}l.a[d]=c;l.aka[a]=d;this===i.marker&&(l.i[d]=c);var n=k.c;n.r[a]=e(w);n.s[a]=e(x);return r}function t(a){var c="validator type",d="Reserved "+c+": ";b.checkString(a,c,1);var e=i.v8n,f=e.v,g=f.aka[a]||a;b.checkArgument(!_.includes(_.keys(f.i),g),d+g);var h=e.c;delete f.a[g];delete f.aka[a];delete h.r[a];delete h.s[a];return r}var u=/^[a-z][a-zA-Z0-9\$]*$/;i.v8n={isRule:f,isRuleOrSequence:h,v:{i:{},a:{},aka:{}},c:{r:{},s:{}}};var v=i.marker,w=j.hide("ValidatorRule.data"),x=j.hide("ValidatorRuleSequence.data");j.ValidatorStatus=function(a,c,d,e,f,g){b.checkBoolean(a,"success");b.checkString(c,"type",1);b.checkArgument(_.isObjectMap(d)||_.isArray(d),"Not an array or object hash: args");b.checkString(f,"property");b.optional.checkString(g,"reason");var h=_.isArray(d)?_.keyByIndex(d):_.clone(d);h.value=e;_.extend(this,{success:a,type:c,args:h,value:e,property:f,reason:g});Object.freeze&&Object.freeze(this)};p.prototype=i.v8n.c.s;q.prototype=i.v8n.c.r;r.of=function(){var a=_.toArray(arguments);return r.call(v,a)};r.define=s;r.undef=t;r.rule=function(a){if(0===arguments.length)return new p;return new q(a)};r.config=function(){var a=this!==i.marker;return k.call(v,a)};i.buist.constant("Validator",r)});j.invoke("Preconditions","Validator","Formats","ObjectUtils",function(b,c,d,e){function f(d){function e(d,e){b.checkFunction(d,"validation function");b.checkString(e,"type",1);c.define.call(i.marker,e,d,a+e)}_.each(d,e)}function g(c,d){b.checkObject(c,"ctx");d=_.isNotBlank(d)?a+d:c.type;return function(a,b){b=_.pick(b,"args","property");c=e.defaultsDeep({},b,c);return new j.ValidatorStatus(!1,c.type,c.args,c.value,c.property,d+(a?"."+a:""))}}function h(a){return a&&_.isObjectMap(a.fieldModelCtrl)}function k(a,c,d){b.checkFunction(c,"validation function");b.optional.checkBoolean(d,"condition");return a===a&&(_.isUndefinedOrNull(a)||!0===d)||c()}function l(a,c){function d(a){return"Invalid: "+a+" bound"}function e(b,c){if(!0===b&&!a(c))return!1;return _.isUndefinedOrNull(c)||a(c)}b.checkFunction(a,"verificator");b.optional.checkFunction(c,"converter");c=c||angular.identity;var f=".exclusive";return function(i,j){var l=g(this),m=c(j.min),n=c(j.max),o=!0===j.minExclusive,p=!0===j.maxExclusive;b.checkArgument(e(o,m),d("lower"));b.checkArgument(e(p,n),d("upper"));b.checkArgument(_.isUndefinedOrNull(m)||_.isUndefinedOrNull(n)||n>=m,d("upper"));var q=a(m),r=a(n),s=h(this);return k(i,function(){if(i!==i||!1===a(i,!0))return l(B);var b=o?i<=m:i<m,c=p?i>=n:i>n,d="";if(q&&r&&!_.isEqual(n,m)&&(b||c)){o&&p?d=f+"both":o?d=f+"min":p&&(d=f+"max");return l("range"+d)}if(q&&b)return l("min"+(o?f:""));if(r&&c)return l("max"+(p?f:""));return!0},s&&""===i)}}function m(a){return _.isNumber(a)&&a%1==0}function n(a){if(_.isString(a))try{return E.parse(a)}catch(b){return}return a}function o(a,b){return b?_.isDate(a):_.isDate(n(a))}function p(a,b){var c=b.condition;if(_.isFunction(c)&&!c(a,b))return!0;return a===a&&!_.isUndefinedOrNull(a)&&""!==a}function q(a){if(_.isBlank(a))return a;try{return unescape(encodeURIComponent(a))}catch(b){return a}}function r(c){b.optional.checkFunction(c,"converter");c=c||angular.identity;return function(d,e){var f=g(this,"string"),h=e.min,i=e.max;b.optional.checkNumber(h,"minimum length",1);b.optional.checkNumber(i,"maximum length",h||1);b.checkArgument(!_.isNumber(h)||m(h),"Not a whole number: minimum length");b.checkArgument(!_.isNumber(i)||m(i),"Not a whole number: maximum length");var j=_.includes(this.types,a+"required"),l=!0===e.whitespace,n=!1!==e.whitespace;return k(d,function(){if(!_.isString(d))return f(B);if((j&&!l||!j&&!n)&&_.isBlank(d))return f("whitespace");var a=c(d).length,b=d.length,e=_.isNumber(h),g=_.isNumber(i),k=e&&g&&(a<h||a>i),m=g&&a>i,o=m&&b<=i?".bytes":"";if(k&&i===h)return f("length"+o);if(k&&i!==h)return f("range"+o);if(e&&a<h)return f("min");if(m)return f("max"+o);return!0},""===d)}}function s(a,c){b.checkRegExp(a,"expression");var d=g(this,"string");return k(c,function(){if(!_.isString(c))return d(B);return a.test(c)},""===c)}function t(a,c){var d=c.expression;if(_.isString(d)){var e=c.options;b.optional.checkString(e,"options",1);d=new RegExp(d,e)}return s.call(this,d,a)}function u(a){return s.call(this,C,a)}function v(a){return s.call(this,D,a)}function w(a){if(_.isUndefinedOrNull(a))return _.constant(!0);var d;d=_.isPlainObject(a)||_.isArray(a)?c.rule(a):a;b.checkArgument(i.v8n.isRuleOrSequence(d),"Not a ValidatorRule or ValidatorRuleSequence: elements");return j.inject("$q",function(a,b){function e(){if(h===g){_.isEmpty(l)?f.resolve():f.reject(l);return}var a=b[h++],m=(_.isNotBlank(j.property)?j.property:"")+"["+ ++k+"]",n=c.config.call(i.marker).property(m).verbose(j.verbose).context(j);d.validate(a,n).then(function(){e()},function(a){if(j.verbose){Array.prototype.push.apply(l,a);e()}else f.reject(a)})}var f=a.defer(),g=_.size(b),h=0,j=this,k=-1,l=[];e();return f.promise})}function x(a){function b(a){return _.filter(a,function(a,b,c){return _.includes(c,a,b+1)})}var c=w.call(this,a),d=this.args,e=this.property;d.unique=!1!==d.unique;return function(a){if(d.unique){var f=_(a);if(f.uniq().size()!==f.size()){var h=b(a),i=_.first(h),j=_.lastIndexOf(a,i);-1!==j&&(e=_.isBlank(e)?String(j):e+"["+j+"]");return g(this)("duplicate",{property:e,args:{duplicate:i}})}}return c.call(this,a)}}function y(c,d){b.checkFunction(c,"verificator");b.optional.checkFunction(d,"type verificator");return function(e,f){var h=g(this),i=g(this,"required"),j=f.min,l=f.max;b.optional.checkNumber(j,"minimum size",0);b.optional.checkNumber(l,"maximum size",j||0);b.checkArgument(!_.isNumber(j)||m(j),"Not a whole number: minimum size");b.checkArgument(!_.isNumber(l)||m(l),"Not a whole number: maximum size");var n,o=_.includes(this.types,a+"required");if(d){n=d.call(this,f.elements);b.optional.checkFunction(n,"type verificator")}return k(e,function(){if(!c(e))return h(B);var a=_.size(e),b=_.isNumber(j),d=_.isNumber(l),f=b&&d&&(a<j||a>l);if(f&&l===j)return h(_.isArray(e)?"length":"size");if(f&&l!==j)return h("range");if(b&&a<j)return h("min");if(d&&a>l)return h("max");if(o&&a<1)return i();return!n||n.call(this,e)}.bind(this))}}function z(a){function c(a,b){var c=_.isNaN(b);return _.some(a,function(a){return _.isEqual(b,a)||c&&_.isNaN(a)})}b.optional.checkArray(a,"valid values",1);return function(d,e){var f=g(this);return k(d,function(){var g=a||e.values;b.optional.checkArray(g,"valid values",1);if(!c(g,d))return!!a&&f(B);return!0})}}function A(a){var b=g(this,"string");return k(a,function(){if(!_.isString(a))return b(B);try{d.currency(a);return!0}catch(c){return!1}},""===a)}var B="type",C=/^[a-z0-9!#$%&'*+\/=?^_`{|}~.-]+@[a-z0-9-]+(\.[a-z0-9-]+)*$/i,D=/^[A-Za-z][A-Za-z\d.+-]*:\/*(?:\w+(?::\w+)?@)?[^\s\/]+(?::\d+)?(?:\/[\w#!:.?+=&%@\-\/]*)?$/,E=d.get("iso8601");f({required:p,string:r(),byte:r(q),regexp:t,email:u,url:v,number:l(_.isNumber),integer:l(m),date:l(o,n),array:y(_.isArray,x),object:y(_.isObjectMap),enumeration:z(),boolean:z([!0,!1]),currency:A})});j.invoke("Preconditions",function(a){var b=j.hide("Request.scope");j.define(i.apiType("Request"),{constructor:function(){b.set(this,null)},member:{scope:function(c){if(0===arguments.length)return b.get(this);a.checkArgument(_.isScope(c),"Not a scope: scope");b.set(this,c);return this}}})});j.invoke("Preconditions",function(a){var b=j.hide("SearchAttribute.id");var c=j.hide("SearchAttribute.label");var d=j.hide("SearchAttribute.type");var e=j.hide("SearchAttribute.attribute");var f=j.hide("SearchAttribute.attributes");j.SearchAttribute=function(g,h,i,k){a.checkString(g,"id",1);a.checkHtml(h,"label");a.checkString(i,"type",1);a.checkArgument(_.isUndefined(k)||_.isNotBlank(k)||_.isArray(k)&&!_.isEmpty(k),"Not a string or array: attributes");b.set(this,g);c.set(this,j.safe(h));d.set(this,i);if(k){var l=_.isString(k);e.set(this,l?k:_.first(k));f.set(this,l?[k]:_.clone(k))}else{e.set(this,g);f.set(this,[g])}};j.SearchAttribute.prototype={id:function(){return b.get(this)},label:function(){return c.get(this)},type:function(){return d.get(this)},attribute:function(){return e.get(this)},attributes:function(){return f.get(this)}}});j.invoke("Preconditions",function(a){var b=j.hide("SearchFilter.id");var c=j.hide("SearchFilter.attribute");j.SearchFilter=function(d,e){a.checkArgument(d instanceof j.SearchAttribute,"Not a SearchAttribute: attribute");b.set(this,_.uniqueId("searchfilter-"));c.set(this,d);this.value=e};j.SearchFilter.prototype={id:function(){return b.get(this)},attribute:function(){return c.get(this)}}});j.invoke("Preconditions",function(a){var b=j.hide("SearchModel.filters");j.SearchModel=function(){b.set(this,[]);this.text=null};j.SearchModel.prototype={filters:function(c){if(0===arguments.length)return b.get(this);a.checkArray(c,"filters");b.set(this,c);return this}}});j.invoke("Preconditions",function(a){var b=j.hide("SearchRequest.index");var c=j.hide("SearchRequest.count");var d=j.hide("SearchRequest.fields");var e=j.hide("SearchRequest.asyncFields");var f=j.hide("SearchRequest.sort");var g=j.hide("SearchRequest.asc");var h=j.hide("SearchRequest.group");var k=j.hide("SearchRequest.groupAsc");var l=j.hide("SearchRequest.searchModel");var m=j.hide("SearchRequest.parent");j.define(i.apiType("SearchRequest"),{extend:i.apiType("Request"),constructor:function(){this.callParent(arguments);b.set(this,0);c.set(this,25);d.set(this,null);e.set(this,null);f.set(this,null);g.set(this,!1);l.set(this,null);h.set(this,null);k.set(this,!1)},member:{index:function(c){if(0===arguments.length)return b.get(this);a.checkNumber(c,"index",0);b.set(this,c);return this},count:function(b){if(0===arguments.length)return c.get(this);a.checkNumber(b,"count",1);c.set(this,b);return this},fields:function(b){if(0===arguments.length)return d.get(this);a.optional.checkArray(b,"fields",1);d.set(this,b?b.slice(0):null);return this},asyncFields:function(b){if(0===arguments.length)return e.get(this);a.optional.checkArray(b,"asyncFields",1);e.set(this,b?b.slice(0):null);return this},sort:function(b){if(0===arguments.length)return f.get(this);a.optional.checkString(b,"sort",1);f.set(this,b||null);return this},ascending:function(b){if(0===arguments.length)return g.get(this);a.checkBoolean(b,"ascending");g.set(this,b);return this},searchModel:function(b){if(0===arguments.length)return l.get(this);a.checkArgument(_.isUndefinedOrNull(b)||b instanceof j.SearchModel,"Not a SearchModel: searchModel");l.set(this,b||null);return this},group:function(b){if(0===arguments.length)return h.get(this);a.optional.checkString(b,"group",1);h.set(this,b||null);return this},groupAscending:function(b){if(0===arguments.length)return k.get(this);a.checkBoolean(b,"groupAscending");k.set(this,b);return this},parent:function(b){if(0===arguments.length)return m.get(this);a.optional.checkString(b,"parent");m.set(this,b);return this}}})});j.invoke("Preconditions",function(a){var b=j.hide("SearchResponse.data");var c=j.hide("SearchResponse.count");j.SearchResponse=function(d,e){a.checkArray(d,"data");a.checkNumber(e,"total",0);b.set(this,d.slice(0));c.set(this,e)};j.SearchResponse.prototype={data:function(){return b.get(this).slice(0)},total:function(){return c.get(this)}}});j.invoke("Preconditions","ObjectPath",function(a,b){function c(a){return _.isString(a)?b.format(b.parse(a)):a}j.HttpStatus=function(b,d,e,f){a.checkObject(b,"response");a.checkArgument(_.isScope(d),"Not a scope: scope");a.optional.checkString(e,"message",1);a.optional.checkFunction(f,"formatter");a.checkArgument(!_.isUndefinedOrNull(e)||!_.isUndefinedOrNull(f),"a message or formatter must be provided");var g=!1,h=new Error(e),i=[],j=[];h.name="HttpStatus";this.message=h.message;this.stack=h.stack;this.response=_.constant(b);this.scope=_.constant(d);this.message=_.constant(e);this.formatter=_.constant(f);this.validatorStatuses=function(b){if(0===arguments.length)return i.slice();if(_.isString(b)){var d=c(b);return _.filter(i,function(a){return c(a.property)===d})}a.checkArray(b,"statuses");i=b.slice();j=_.filter(i,function(a){return!0!==a.success})};this.validatorErrors=function(b){a.optional.checkString(b,"property",1);if(b){var d=c(b);return _.filter(j,function(a){return c(a.property)===d})}return j.slice()};this.defaultPrevented=function(){return g};this.preventDefault=function(){g=!0}};j.HttpStatus.prototype=new Error;j.HttpStatus.prototype.name="HttpStatus"});j.invoke("Preconditions","Formats","ObjectUtils",function(a,b,c){var d=j.inject("ObjectPath",function(d,e,f,g,h){a.checkObject(e,"obj");if(_.isArray(f)){var i={};_.each(f,function(a){i[a]="iso8601"});f=i}a.checkArgument(_.isObject(f),"Not an object hash or array: pathFormatMap");_.each(f,function(f,i){a.checkDefined(f,"pathFormatMap value");if(_.isString(f)){var j=b.get(f);a.checkArgument(_.isFunction(j),"Unknown format: "+f);f=h(j);a.checkFunction(f,g)}a.checkFunction(f,"pathFormatMap value");var k=d.format(d.parse(i));var l=_.get(e,k);_.isUndefinedOrNull(l)||c.set(e,k,f(l))});return e});var e=j.hide("idFields");j.define(i.apiType("DataSource"),{member:{idFields:function(b){if(0===arguments.length){var c=e.get(this);return c?c.slice():[]}a.checkArray(b,"idFields");e.set(this,b)},search:function(){throw new Error("Not implemented: search")},readJSON:function(a,b){return d(a,b,"format.parse",function(a){return a.parse})},writeJSON:function(a,b){return d(a,b,"format",function(a){return a})}}})});j.invoke("Preconditions",function(a){var b=j.hide("data");j.define(i.apiType("ArrayDataSource"),{extend:i.apiType("DataSource"),constructor:function(a){this.callParent();this.data(a);this.searchers=[];this.filterers={};this.accessors={}},member:{data:function(c){if(0===arguments.length)return b.get(this);a.checkArray(c,"data");b.set(this,c)},addSearcher:function(b){a.checkFunction(b,"searcher");this.searchers.push(b)},addPropertySearcher:j.inject("$parse",function(b,c){a.checkString(c,"name",1);var d=this;this.addSearcher(function(e,f){a.checkObject(e,"obj");a.checkString(f,"text");var g=d.accessors[c]||b(c),h=g(e);a.optional.checkString(h,'Searched property "'+c+'"');return _.isString(h)&&0===h.toLowerCase().indexOf(f.toLowerCase())})}),addFilterer:function(b,c){a.checkString(b,"id",1);a.checkFunction(c,"filterer");this.filterers[b]=c},addPropertyFilterer:j.inject("$parse",function(b,c){a.checkString(c,"name",1);var d=this;this.addFilterer(c,function(e,f){a.checkObject(e,"obj");a.checkArgument(f instanceof j.SearchFilter,"Not a SearchFilter: filter");var g=d.accessors[c]||b(c),h=g(e);if(_.isString(f.value))return _.isString(h)&&h.toLowerCase()===f.value.toLowerCase();return h===f.value})}),accessor:function(b,c){a.checkFunction(c,"accessor");this.accessors[b]=c},search:j.inject("$q","$timeout",function(a,b,c){var d=this,e=a.defer();b(function(){var a=d.filterAll(c);var b=a.length;a=d.order(a,c);a=d.page(a,c);e.resolve(new j.SearchResponse(a,b))});return e.promise}),filterAll:function(a){function b(b){var e;if(d.text){e=!1;for(var h=0;!e&&h<c.searchers.length;h++)e=c.searchers[h](b,a.searchModel().text)}else e=!0;e&&_.size(g)>0&&_.each(g,function(a,d){var f=!1;c.filterers[d]&&_.each(a,function(a){f=f||c.filterers[d](b,a)});e=e&&f});e&&f.push(b)}var c=this,d=a.searchModel(),e=this.data();if(!d||!d.text&&0===d.filters().length)return e.slice(0)
;var f=[],g=_.groupBy(d.filters(),function(a){return a.attribute().id()});for(var h=0;h<e.length;h++)b(e[h]);return f},order:j.inject("$parse",function(a,b,c){var d;if(c.sort()&&c.group()){d=this.accessors[c.group()]||a(c.group());var e=_.groupBy(b,function(a){return d(a)}),f=_.keys(e);f.sort();c.groupAscending()||f.reverse();b=[];d=this.accessors[c.sort()]||a(c.sort());_.each(f,function(a){e[a]=_.sortBy(e[a],function(a){return d(a)});c.ascending()||(e[a]=e[a].reverse());b=b.concat(e[a])})}else if(c.sort()!==c.group()){var g=c.sort()||c.group(),h=c.sort()?c.ascending():c.groupAscending();d=this.accessors[g]||a(g);b=_.sortBy(b,function(a){return d(a)});h||b.reverse()}return b}),page:function(a,b){(b.index()>0||b.count()<a.length)&&(a=a.slice(b.index(),b.index()+b.count()));return a}}})});!function(){j.define(i.apiType("TreeAdapter"),{member:{id:function(){throw new Error("Not implemented: id")},parent:function(){throw new Error("Not implemented: parent")},leaf:function(){throw new Error("Not implemented: leaf")}}})}();j.invoke("Preconditions",function(a){j.define(i.apiType("TreeArrayDataSource"),{extend:i.apiType("ArrayDataSource"),constructor:function(b,c){a.checkArgument(c instanceof j.TreeAdapter,"Not a TreeAdapter: adapter");this.callParent([b]);this.adapter=c},member:{filterAll:function(a){var b,c=this.callParent(arguments),d=a.parent();if(_.isUndefined(d))return c;var e=[];for(var f=0;f<c.length;f++){b=this.adapter.parent(c[f]);(d===b||!0===_.isUndefinedOrNull(d)&&!0===_.isUndefinedOrNull(b))&&e.push(c[f])}return e},page:function(a){return a}}})});j.invoke("Preconditions",function(a){function b(a,b,e,f,g){c=a;_.extend(d,{animation:g.register,constant:i.$injectorConstant(a.constant),controller:b.register,directive:function(){e.directive.apply(this,arguments);_.isString(arguments[0])?i.restrictDirective(arguments[0]):_.each(arguments[0],function(a,b){i.restrictDirective(b)})},factory:a.factory,filter:f.register,provider:a.provider,service:a.service,value:a.value})}i.module={};i.module.Api=["animation","constant","controller","directive","factory","filter","provider","service","value"];i.unrestrictedDirectives=[];var c,d={},e=function(b){a.checkString(b,"method name",1);var c=i.buist;a.checkFunction(c[b],'method "'+b+'"');return c[b]},f={};i.restrictDirective=function(b){function d(a,b,c){return function(d){if(!0===d.inheritedData(i.RESTRICTED_KEY)){d.html("");throw new Error("Directive "+a+" is restricted from use in this context")}b&&(c=b.apply(this,arguments));return c}}function e(a,b){b.compile=d(a,b.compile,b.link);delete b.link}a.checkArgument(!_.isUndefined(c),"Attempt to restrict directive before initialization");if(f[b]||_.includes(i.unrestrictedDirectives,b))return;c.decorator(b+"Directive",["$delegate",function(a){_.each(a,function(a){e(b,a)});return a}]);f[b]=!0};_.each(i.module.Api,function(a){d[a]=e(a)});i.module.Registry={init:function(c){a.checkObject(c,"module");a.checkFunction(c.config,"config()");c.config(["$provide","$controllerProvider","$compileProvider","$filterProvider","$animateProvider",b])},get:function(b){a.checkString(b,"method name",1);return d[b]}}});j.invoke("Preconditions","Package",function(a,b){function c(b){a.optional.checkArray(b,"callbacks");b&&_.each(b,function(b){a.checkFunction(b,"RouteResolver callback");b()})}function d(a,d){return["$q","$rootScope",function(e,f){var g=e.defer();e.all(_.invokeMap(a,function(){return b.resolve(this)})).then(function(){f.$evalAsync(function(){try{c(d);g.resolve()}catch(a){g.reject(a.message)}})},function(a){g.reject(a)});return g.promise}]}i.module.RouteResolver={resolve:function(b,e,f){if(b){b.packages&&(e=(e||[]).concat(b.packages));(b.js||b.css||b.i18n)&&(e=(e||[]).concat([{js:b.js,css:b.css,i18n:b.i18n}]))}if(!_.isArray(e)||e.length<1){c(f);return b}a.checkObject(b,"route configuration");var g={};_.isObjectMap(b.resolve)&&_.extend(g,b.resolve);g["dw.ui.core"]=d(e,f);g.dw$title=function(){return b.title};return _.extend({},b,{resolve:g})}}});j.invoke("Preconditions",function(a){function c(b){a.checkObject(b,"module");var d=b.name;a.checkString(d,"module name",1);a.checkArray(b.requires,"module dependencies");a.checkObject(h[d],"module configuration");var e=h[d];a.checkObject(e,"module configuration");a.checkObject(e.m,"sub-module configurations");_.each(e.m,function(a,b){c(j.module(b))});var f=b.requires.concat(_.keys(e.m));e.p||f.unshift("dw.ui.core");var g=angular.module(d,f);_.each(e.fn,function(a){g[a.n].apply(g,a.a)});return g}function d(b,c){function d(b){_.isEmpty(b[c])||(e=b[c].concat(e));if(_.isObject(b.p)){a.checkObject(h[b.p.name],"parent module configuration");d(h[b.p.name])}}a.checkObject(b,"module configuration");var e=[];d(b);return e}function e(a){var b=_.union([a.name],a.requires,[i.buist.name],i.buist.requires),c=[];_.each(b,function(a){_.each(angular.module(a)._invokeQueue,function(a){"directive"===a[1]&&c.push(a[2][0])})});_.each(_.uniq(c),i.restrictDirective)}function f(c){function d(d,f,g,h,j,k,l){j.$on("$routeChangeStart",function(){var c="Modified library: ",d=b._,e=b.angular;a.checkArgument(d===i._,c+"Lo-Dash.js");a.checkArgument(e===i.angular,c+"Angular.js")});j.dw$errors=h;var m=k("current.locals.dw$title");j.$on("$routeChangeSuccess",function(){b.scrollTo(0,0);var a=m(l);_.isString(a)&&f.title(g.get(a))});e(c);d.trigger(i.events.ready,c)}function f(){var a=angular.element(n);if(!a.injector()){delete j.config;delete j.run;i.module.rootElements[c.name]=a;angular.bootstrap(n,[c.name],{strictDi:!0});j.invoke("EventBus","Browser","Messages","ErrorMessages","$rootScope","$parse","$route",d)}}function g(){0==--o&&f()}function k(a){setTimeout(function(){a(g)},0)}var l=h[c.name],m=l.bc,n=m&&m.element()||document,o=m&&_.isArray(m.before())?_.size(m.before()):0;var p=document.getElementsByTagName("html")[0],q=angular.element(p);q.attr("xmlns:ng","http://www.angularjs.org");q.attr("xmlns:dw","http://www.demandware.com");o>0?_.each(m.before(),k):f()}function g(a){function b(a){var b="/";_.each(j.rt,function(c,e){var f=h[e],g=d(f,"js"),j=d(f,"css"),k=d(f,"i18n"),l=d(f,"packages"),m=d(f,"c");(g.length>0||j.length>0||k.length>0)&&l.push({js:g.length>0?g:void 0,css:j.length>0?j:void 0,i18n:k.length>0?k:void 0});_.each(c,function(c){0===c.i&&(b=c.p[0]);var d=i.module.RouteResolver.resolve(c.r,l,m);_.each(c.p,function(b){a.when(b,d)})})});a.otherwise({redirectTo:b})}function e(a,b){a.debugInfoEnabled(!1);b.useApplyAsync(!0)}var g=c(a),j=h[a.name];i.module.Registry.init(g);g.config(["$routeProvider",b]).config(["$compileProvider","$httpProvider",e]);angular.element(document).ready(function(){f(a)})}var h=i.module.cfgs={};i.module.rootElements={};i.RESTRICTED_KEY="dw$restricted";i.module.Bootstrapper={run:g}});j.invoke("Preconditions","Configuration",function(a,b){function c(a,b){if(_.isNotBlank(a))return;if(_.isArray(a)&&!_.isEmpty(a)&&_.every(a,_.isNotBlank))return;throw new Error("Invalid argument: "+b)}function d(b){a.checkObject(b,"module");a.checkString(b.name,"module name",1);var c=this,d=i.module.cfgs[b.name],e={};return _.extend(c,{element:function(b){if(0===arguments.length)return e.e;_.isNotBlank(b)&&(b=document.querySelector(b));a.checkArgument(b&&_.includes([1,9],b.nodeType),"Invalid DOM element for bootstrap: element");e.e=b;return c},before:function(b){if(0===arguments.length)return _.clone(e.fn);a.checkFunction(b,"condition function");d.ba=!1;e.fn=e.fn||[];e.fn.push(b);return c}})}function e(e,g,h){function j(){if(p.b)throw new Error("bootstrap() may only be called once.")}function k(){var a=p.bc;if(arguments.length>0){var b=_.toArray(arguments),c=_.first(b);if(_.includes([1,9],c.nodeType)||_.isString(c)){a.element(c);b.shift()}_.each(b,function(b){a.before(b)})}setTimeout(function(){if(p.b)return;i.module.Bootstrapper.run(n);!function a(b){_.each(b.m,function(b){a(b)});b.b=!0}(p)},0);return a}function l(a,b){j();c(a,"required resources");a=_.isString(a)?[a]:a;"packages"!==b&&(a=_.map(a,function(a){var b=a.lastIndexOf("!");return b>0?a.substr(b+1):a}));p[b]=p[b].concat(a);return n}function m(b){function c(c){b[c]=function(){var d=_.toArray(arguments);if(p.b){var e=i.module.Registry.get(c);a.checkDefined(e,"method "+c);e.apply(e,d)}else{"constant"===c&&i.$injectorConstant(angular.noop).apply(null,d);p.fn.push({n:c,a:d})}return b}}var d=i.module.Api.concat(["config","run"]);_.each(d,c)}a.checkString(e,"module name",1);a.checkArray(g,"module dependencies");a.optional.checkObject(h,"parent module");var n=this;n.name=e;n.requires=g;var o=-1,p=i.module.cfgs[e]={p:h,js:[],i18n:[],css:[],packages:[],m:{},b:!1,ba:!0,fn:[],rt:{},c:[]};h||(p.bc=new d(n));n.module=function(a,b){j();var c=f(a,b,n);p.m[a]=i.module.cfgs[a];return c};n.route=function(c,d){function e(a){a.match(/^http(s)?:\/\//)||(a=b.rootPath+a);return a}j();a.checkObject(d,"route configuration");if(_.isArray(c)){a.checkArray(c,"paths",1);_.each(c,function(b){a.checkString(b,"path",1)})}else{a.checkString(c,"path",1);c=[c]}if(h){var f={origin:this.origin||n};h.route.apply(f,[c,d])}else{d.templateUrl&&(d.templateUrl=e(d.templateUrl));var g=this.origin||n;p.rt[g.name]=p.rt[g.name]||[];p.rt[g.name].push({i:++o,p:c,r:d})}return n};n.js=function(a){return l(a,"js")};n.css=function(a){return l(a,"css")};n.i18n=function(a){return l(a,"i18n")};n.packages=function(a){return l(a,"packages")};n.tag=function(b,c){a.checkString(b,"name",1);return n.directive(b,i.customTag(c))};n.component=function(b,c){a.checkString(b,"name",1);return n.directive(b,i.component(c))};n.ready=function(b){a.checkFunction(b,"fn");p.c.push(_.once(b));return n};m(n);if(!h){n.bootstrap=k;i.module.apps.push(n);angular.element(document).ready(function(){setTimeout(function(){p.ba&&k()},0)})}}function f(b,c,d){a.optional.checkArray(c,"dependencies");!_.isArray(c)&&h[b]||(h[b]=new e(b,c||[],d));return h[b]}function g(b,c){var d=i.module.apps,e=d.length;a.checkArgument(1===e,(0===e?"No":"Multiple")+" root modules found for application");var f=d[0];f[b].apply(f,c)}var h={};i.module.apps=[];i.config.rootPath="";j.module=function(a,b){return f(a,b)};i.module.wrap=function(a){j[a]=function(){g(a,_.toArray(arguments));return j}};_.each(i.module.Api.concat(["bootstrap","component","config","css","i18n","js","packages","route","run","tag"]),function(a){i.module.wrap(a)})});j.invoke("Preconditions",function(a){function b(a){var b=a?a.highest()+2e4:0,c=100,d=101,e=1e3,f=1e4;this.base=function(){return b};this.highest=function(){return b+f};this.palette=function(){return b+c};this.pinned=function(){return b+d};this.floating=function(){e++;return b+e};this.tooltip=function(){f++;return b+f}}function c(){function c(){return _.last(e)}var d=this,e=[];this.push=function(){e.push(new b(_.last(e)))};this.pop=function(){a.checkArgument(e.length>1,"Undefined: ZIndex frame to pop");e.pop()};this.push();_.each(_.functions(c()),function(a){d[a]=function(){return c()[a]()}})}i.buist.constant("ZIndex",new c)});j.invoke("Preconditions",function(a){function b(b,c,e){a.checkString(b,"type",1);a.checkString(c,"key",1);a.optional.checkFunction(e,"formatter");this.type=b;d.set(this,{key:c,formatter:e})}function c(b,c,e,f,g){a.checkFunction(b,"statusMatcher");a.optional.checkFunction(c,"urlMatcher");a.optional.checkFunction(e,"bodyMatcher");a.optional.checkString(f,"key",1);a.optional.checkFunction(g,"formatter");a.checkArgument(!_.isUndefinedOrNull(f)||!_.isUndefinedOrNull(g),"a key or formatter must be provided");this.statusMatcher=b;this.urlMatcher=c;this.bodyMatcher=e;d.set(this,{key:f,formatter:g})}var d=j.hide("Entry.data");b.prototype={matches:function(a){if(this.type!==a)return!1;return!0},data:function(){return _.clone(d.get(this))}};c.prototype={matches:function(a,b,c){if(!this.statusMatcher(a))return!1;if(this.urlMatcher&&!this.urlMatcher(b))return!1;if(this.bodyMatcher&&!this.bodyMatcher(c))return!1;return!0},data:function(){return _.clone(d.get(this))}};var e=j.hide("ErrorMessages.types");var f=j.hide("ErrorMessages.validation");var g=j.hide("ErrorMessages.http");var h=j.hide("ErrorMessages.parent");i.ErrorMessages=function(){function d(c,d,e){a.checkString(c,"type",1);a.checkString(d,"key",1);f.get(n).push(new b(c,d,e))}function j(b){a.checkObject(b,"map");_.each(b,function(a,b){d(b,a)})}function k(b){a.checkString(b,"type",1);var c=_.find(f.get(n),function(a){return a.matches(b)});if(!c&&h.get(n))return h.get(n).validation(b);return c?c.data():null}function l(b,d,e,f,h){function i(a){if(!a)return null;return _.isFunction(a)?a:function(b){return a===b}}function j(a){if(!a)return null;return _.isFunction(a)?a:function(b){return _.isString(b)&&a.test(b)}}a.checkArgument(_.isNumber(b)&&b>=100&&b<=999||_.isFunction(b),"Not a function or number between 100 and 999: statusMatcher");a.checkArgument(_.isUndefinedOrNull(d)||_.isRegExp(d)||_.isFunction(d),"Not a function or regular expression: urlMatcher");a.checkArgument(_.isUndefinedOrNull(e)||_.isRegExp(e)||_.isFunction(e),"Not a function or regular expression: bodyMatcher");a.optional.checkFunction(h,"formatter");g.get(n).push(new c(i(b),j(d),j(e),f,h))}function m(b,c,d){a.checkNumber(b,"status");a.checkString(c,"url");var e=_.find(g.get(n),function(a){return a.matches(b,c,d)});if(!e&&h.get(n))return h.get(n).http(b,c,d);return e?e.data():null}var n=this;e.set(this,[]);f.set(this,[]);g.set(this,[]);this.$new=function(){var a=new i.ErrorMessages;h.set(a,n);return a};this.types=function(b){if(0===arguments.length){b=e.get(n).slice(0);h.get(n)&&(b=b.concat(_.difference(h.get(n).types(),b)));return b.concat(_.difference(_.map(f.get(n),"type"),b))}a.checkArray(b,"types");e.set(n,b)};this.key=function(a,b){if(1===arguments.length){var c=k(a);return c?c.key:null}d(a,b)};this.keys=function(a){j(a)};this.validation=function(a,b,c){if(1===arguments.length){if(_.isObject(a))return j(a);return k(a)}return d(a,b,c)};this.http=function(a,b,c,d,e){if(3===arguments.length)return m(a,b,c);return l(a,b,c,d,e)}};i.buist.constant("ErrorMessages",new i.ErrorMessages)});j.invoke("Preconditions","Configuration","Messages",function(a,b,c){function d(){}i.interactionParam=j.inject("$parse",function(b,d,e,f,g,h){if(!_.isUndefined(d[g])){a.checkString(d[g],"Interactions config."+g,1);var i=b(d[g])(e);a.checkHtml(i,"Interactions config."+g);return j.safe(i)}if(!0===h&&_.isUndefinedOrNull(d[f]))return null;a.checkString(d[f],"Interactions config."+f,1);return c.getSafeHtml(d[f])});i.buist.constant("Interactions",new d)});j.invoke("Preconditions","Configuration","Interactions",function(a,b,c){function d(a,b,c,d){var e='<dw:window class="'+a+'" dw-visible="dw$visible" dw-draggable="false"><div class="dw-content"><div class="dw-body"><div class="dw-left"><div class="dw-icon dw-glyph" role="img"></div></div><div class="dw-right"><div class="dw-title" ng-show="!!dw$title" ng-bind-html="dw$title"></div><div class="dw-msg" ng-show="!!dw$message" ng-bind-html="dw$message"></div></div></div><div class="dw-buttons">';if(c){e+='<ccbm><button class="slds-button slds-button_neutral" ng-click="dw$reject()"><span class="dw-label" ng-bind-html="dw$rejectLabel | SafeHtml"></span></button></ccbm>';b&&(e+=d?'<ccbm><button class="slds-button slds-button_destructive" ng-click="dw$accept()"><span class="dw-label" ng-bind-html="dw$acceptLabel | SafeHtml"></span></button></ccbm>':'<ccbm><button class="slds-button slds-button_brand" ng-click="dw$accept()"><span class="dw-label" ng-bind-html="dw$acceptLabel | SafeHtml"></span></button></ccbm>')}else{e+='<button class="dw-button" ng-click="dw$reject()"><span class="dw-label" ng-bind-html="dw$rejectLabel | SafeHtml"></span></button>';b&&(e+='<button class="dw-button dw-button-primary" ng-click="dw$accept()"><span class="dw-label" ng-bind-html="dw$acceptLabel | SafeHtml"></span></button>')}return e+"</div></div></dw:window>"}function e(b,c,d,e,f){a.checkString(d.type,"Alert config.type",1);var g=i.interactionParam(d,c,"title","titleText",!0),h=i.interactionParam(d,c,"message","messageText");_.isUndefinedOrNull(g)||(c.dw$title=b.trustAsHtml(g.toSafeString()));c.dw$message=b.trustAsHtml(h.toSafeString());c.dw$rejectLabel=i.interactionParam(d,c,"dismissLabel","dismissLabelText");c.dw$visible=!0;c.dw$reject=function(){e.resolve();c.$destroy()};f.addClass("dw-alert-"+d.type)}function f(a,b,c,d,e){function f(a){a?d.resolve():d.reject(!1);b.$destroy()}var g=i.interactionParam(c,b,"title","titleText",!0),h=i.interactionParam(c,b,"message","messageText");_.isUndefinedOrNull(g)||(b.dw$title=a.trustAsHtml(g.toSafeString()));b.dw$message=a.trustAsHtml(h.toSafeString());b.dw$acceptLabel=i.interactionParam(c,b,"acceptLabel","acceptLabelText");b.dw$rejectLabel=i.interactionParam(c,b,"rejectLabel","rejectLabelText");b.dw$visible=!0;b.dw$accept=function(){f(!0)};b.dw$reject=function(){f(!1)};_.isUndefinedOrNull(c.type)||e.addClass("dw-confirm-"+c.type)}var g=d("dw-alert",!1,!1,!1),h=d("dw-alert",!1,!0,!1),k=d("dw-confirm",!0,!1,!1),l=d("dw-confirm",!0,!0,!1),m=d("dw-confirm",!0,!0,!0);c.alert=function(c){a.optional.checkObject(c,"config");var d={type:"error",title:b["i18n.default.alert.title"],dismissLabel:b["i18n.default.alert.dismissLabel"]};c&&c.defaults&&_.assign(d,c.defaults);c&&c.defaults&&c.defaults.isRefreshedScreen?d.template=h:d.template=g;return j.interaction(_.assign(_.clone(c||{}),{controller:["$sce","$scope","$config","$deferred","$element",e],defaults:d}))};c.confirm=function(c){a.optional.checkObject(c,"config");var d={message:b["i18n.default.confirm.message"],title:b["i18n.default.confirm.title"],acceptLabel:b["i18n.default.confirm.acceptLabel"],rejectLabel:b["i18n.default.confirm.rejectLabel"]};c&&c.defaults&&_.assign(d,c.defaults);c&&c.defaults&&c.defaults.isRefreshedScreen?c.defaults.isDeleteButton?d.template=m:d.template=l:d.template=k;return j.interaction(_.assign(_.clone(c||{}),{controller:["$sce","$scope","$config","$deferred","$element",f],defaults:d}))}});j.invoke("Preconditions","Interactions",function(a,b){b.httpError=j.inject("$q","$rootScope",function(c,d,e){a.checkObject(e,"config");a.checkObject(e.defaults,"config.defaults");a.checkHtml(e.defaults.messageText,"config.defaults.messageText");var f=d.$new();f.dw$messageText=e.defaults.messageText;return b.alert({scope:f,defaults:{messageText:"dw$messageText"}}).finally(function(){f.$destroy()})})});j.invoke("Preconditions","Configuration","Interactions","ZIndex",function(a,b,c,d){function e(b,c,e,m,n){a.checkDefined(e.target,"Mask config.target");a.optional.checkString(e.type,"Mask config.type",1);var o,p,q=this,r=[],s=i.interactionParam(e,c,"message","messageText",!0),t="Infinity"===e.timeoutMillis?1/0:i.intFormat.parse(e.timeoutMillis);a.checkNumber(t,"Mask config.timeoutMillis number",1);if(_.isString(e.target)){a.checkElement(document.getElementById(e.target),'Mask config.target element with id "'+e.target+'"');o=angular.element(document.getElementById(e.target))}else{a.checkElement(e.target,"Mask config.target");o=angular.element(e.target)}o.addClass(g);"static"===getComputedStyle(o[0]).position&&o.addClass(g+"-static");p=angular.element(k);p.css("z-index",(d.highest()+1).toString());if(!_.isUndefinedOrNull(s)){p.html(l);angular.element(p[0].querySelector(".dw-text")).html(j.safe(s).toSafeString())}e.type&&p.addClass(h+"-"+e.type);o.append(p);this.unmask=function(){_.each(r,function(a){b.cancel(a)});_.each(f,function(a){p.removeClass(h+"-"+a.toString())});p.remove();o.removeClass(g+"-static");o.removeClass(g);c.$destroy()};n.cancel=function(){m.resolve();q.unmask()};n.dw$element=p;_.each(f,function(a){r.push(b(function(){p.addClass(h+"-"+a.toString())},a,!1))});t!==1/0&&r.push(b(function(){m.reject();q.unmask()},t,!1))}var f=[250,500,750,1e3];var g="dw-masked";var h="dw-mask";var k='<div class="dw-mask dw-mask-instant"></div>';var l='<div class="dw-mask-message"><div class="dw-inner"><i class="dw-icon dw-glyph dw-glyph-spinner dw-glyph-spin dw-glyph-2x" role="img"></i><div class="dw-text"></div></div></div>';i.config["i18n.default.mask.timeoutMillis"]="90000";c.mask=function(c){a.optional.checkObject(c,"config");var d={timeoutMillis:b["i18n.default.mask.timeoutMillis"]};c&&c.defaults&&_.assign(d,c.defaults);return j.interaction(_.assign(_.clone(c||{}),{controller:["$timeout","$scope","$config","$deferred","$interaction",e],defaults:d}))}});j.invoke("Preconditions","Configuration","Interactions","ZIndex",function(a,c,d,e){function f(){var a=l,c=0;_.each(m,function(a){c=Math.max(c,a[0].offsetWidth)});var d=Math.floor((b.innerWidth-c)/2);_.each(m,function(b){b.css({top:a+"px",left:d+"px",visibility:"visible"});a+=b[0].offsetHeight})}function g(b,c,d,g,h,j,l){function n(a){b.cancel(r);_.remove(m,l);l.css("opacity","0");j.resolve(a);f();b(function(){g.$destroy()},k)}a.checkString(h.type,"Notify config.type",1);a.checkString(h.timeoutMillis,"Notify config.timeoutMillis",1);var o=i.interactionParam(h,g,"title","titleText",!0),p=i.interactionParam(h,g,"message","messageText",!0),q="Infinity"===h.timeoutMillis?1/0:i.intFormat.parse(h.timeoutMillis);a.checkArgument(!_.isUndefinedOrNull(o)||!_.isUndefinedOrNull(p),"Undefined: Notify config title and message");a.checkNumber(q,"Notify config.timeoutMillis number",1);var r;_.isUndefinedOrNull(o)||(g.dw$title=c.trustAsHtml(o.toSafeString()));_.isUndefinedOrNull(p)||(g.dw$message=c.trustAsHtml(p.toSafeString()));g.dw$close=function(){n(!0)};l.css({visibility:"hidden","z-index":e.floating().toString()});l.addClass("dw-notify-"+h.type);m.push(l);b(function(){if(h.footer){var a=angular.element(l[0].querySelector(".dw-footer"));a.html(h.footer);d(a.contents())(g);a.removeClass("dw-transclude-position")}f()});if(q!==1/0){l.addClass("dw-temporary");r=b(function(){n(!1)},q)}}var h='<div class="dw-notify"><div class="dw-body"><div class="dw-icon dw-glyph" role="img"></div><div class="dw-close dw-glyph-times-circle" role="button" ng-click="dw$close()"></div><div class="dw-title" ng-show="!!dw$title" ng-bind-html="dw$title"></div><div class="dw-msg" ng-show="!!dw$message" ng-bind-html="dw$message"></div></div><div class="dw-footer dw-transclude-position"></div></div>';var k=100;var l=25;i.config["i18n.default.notify.timeoutMillis"]="5000";var m=[];d.notify=function(b){a.optional.checkObject(b,"config");var d={type:"success",timeoutMillis:c["i18n.default.notify.timeoutMillis"]};b&&b.defaults&&_.assign(d,b.defaults);d.template=h;return j.interaction(_.assign(_.clone(b||{}),{controller:["$timeout","$sce","$compile","$scope","$config","$deferred","$element",g],defaults:d}))}});j.invoke("Preconditions","Interactions","Browser",function(a,b,c){function d(a,b,c){var d='<dw:window dw-ready="onReady" dw-x="0" dw-y="0" class="dw-tooltip-window';b&&(d+=" "+b);d+='" id="'+a+'" dw-modal="false" dw-z-index-type="tooltip" dw-draggable="false" style="opacity:0">';d+='<div class="dw-tooltip">';d+='<div class="dw-body">';d+='<span class="dw-lock dw-glyph" role="img" ng-click="toggleLocked()"></span>';d+=c;d+="</div>";d+='<div class="dw-arrow">';d+='<span class="dw-image" role="img"></span>';d+="</div>";d+="</div>";return d+"</dw:window>"}function e(a){var b=i.element.parent(a,"dw-scroller");return b?angular.element(b):angular.element(window)}function f(b,c,f,k,l,m,n){function o(a){if(!r.body||!r.arrow)return;b.$emit(i.events.private.tooltip.lock,y||i.element.contains(r.body,a.target)||i.element.contains(r.arrow,a.target))}var p,q,r=this,s=_.uniqueId("dw-tooltip-window-"),t=document.getElementById(c.target),u=angular.element(window),v=angular.element(document.body),w=function(a){i.element.contains(r.body,a.target)||i.element.contains(r.arrow,a.target)||m(function(){r.close()})},x=function(){r.updatePosition()},y=!1;a.checkElement(t,"Tooltip config.target");this.target=angular.element(t);p=e(this.target);this.close=function(){b.$emit(i.events.private.tooltip.lock,!1);this.element&&this.element.removeClass("dw-locked");f.resolve();b.$destroy();g===r&&(g=null)};k.html(d(s,c.className||"",k.html()));l.cancel=function(){r.close()};b.toggleLocked=function(){y=!y;b.$emit(i.events.private.tooltip.lock,y);r.element.toggleClass("dw-locked",y)};b.onReady=function(a){r.window=a.controller};b.$on("$destroy",function(){v.off("click",w);v.off("contextmenu",w);v.off("mouseover",o);u.off("resize",x);p.off("scroll",x);n.cancel(q);r.element=null;r.body=null;r.arrow=null;r.target=null;r.window=null});m(function(){r.element=j.element("#"+s+"-window");if(!r.element)return;r.body=r.element[0].querySelector(".dw-body");r.arrow=r.element[0].querySelector(".dw-arrow .dw-image");v.on("click",w);v.on("contextmenu",w);v.on("mouseover",o);u.on("resize",x);p.on("scroll",x);b.$on(i.events.invalidate,x);q=n(x,h);r.window.show();m(function(){if(!r.element)return;x();r.element.css("opacity","1")},0,!1)},0,!1);g&&g.close();g=this}var g;var h=250;f.prototype={updatePosition:function(){if(!this.element)return;var a=this.element[0].getBoundingClientRect(),b=this.target[0].getBoundingClientRect(),d=b.top>a.height,e=b.left+b.width>a.width,f=d?b.top-a.height:b.top+b.height,g=e?b.left+b.width-a.width:b.left,h=document.querySelector(c.isIE()||c.isFF()?"html":"body");this.window.x(Math.floor(g+h.scrollLeft));this.window.y(Math.floor(f+h.scrollTop));this.element.toggleClass("dw-tooltip-above",d);this.element.toggleClass("dw-tooltip-below",!d);this.element.toggleClass("dw-tooltip-left",e);this.element.toggleClass("dw-tooltip-right",!e)}};b.tooltip=function(b){a.optional.checkObject(b,"config");var c={};b&&b.defaults&&_.assign(c,b.defaults);return j.interaction(_.assign(_.clone(b||{}),{controller:["$scope","$config","$deferred","$element","$interaction","$timeout","$interval",f],defaults:c}))}});j.invoke("Preconditions",function(a){function b(b,c,d){a.optional.checkString(b,"type",1);a.optional.checkString(c,"id",1);a.checkObject(d,"implementation");this.type=b;this.id=c;this.implementation=d}b.prototype={matches:function(a){if(this.type&&this.type!==a.type())return!1;if(this.id&&this.id!==a.id())return!1;return!0}};var c=j.hide("SearchFilters.entries");var d=j.hide("SearchFilters.parent");i.SearchFilters=function(){var e=this;c.set(this,[]);this.$new=function(){var a=new i.SearchFilters;d.set(a,e);return a};this.type=function(f,g){a.checkString(f,"type",1);if(1===arguments.length){var h=_.find(c.get(e),function(a){return a.type===f});if(!h&&d.get(e))return d.get(e).type(f);return h?h.implementation:null}a.checkObject(g,"implementation");c.get(e).push(new b(f,null,g))};this.attribute=function(f,g){a.checkString(f,"id",1);if(1===arguments.length){var h=_.find(c.get(e),function(a){return a.id===f});if(!h&&d.get(e))return d.get(e).attribute(f);return h?h.implementation:null}a.checkObject(g,"implementation");c.get(e).push(new b(null,f,g))};this.configure=function(b,c){a.checkObject(b,"implementation");a.checkObject(c,"config");var d=_.clone(b.defaults||{});_.assign(d,c);return _.assign(_.clone(b),{defaults:d})};this.get=function(b){a.checkArgument(b instanceof j.SearchAttribute,"Not a SearchAttribute: attribute");var f=_.find(c.get(e),function(a){return a.matches(b)});if(!f&&d.get(e))return d.get(e).get(b);return f?f.implementation:null}};i.buist.constant("SearchFilters",new i.SearchFilters)});j.invoke("Preconditions",function(a){function b(b){var c=_.isObjectMap(b);a.checkArgument(c||_.isString(b),"Not a String or Map: urlOrHttpRequest");a.checkArgument(!c||_.isNotBlank(b.url),"Not a String: urlOrHttpRequest.url");var d=g.get(this);if(_.isFunction(d))return!0===d(b);var e=c?b.url:b;return d.test(e)}function c(a){return h.get(this)(a)}function d(a){return k.get(this)(a)}function e(b,c,d){a.checkArgument(_.isRegExp(b)||_.isFunction(b),"Not a RegExp or Function: matcher");a.checkFunction(c,"requestHandler");a.checkFunction(d,"responseHandler");g.set(this,b);h.set(this,c);k.set(this,d)}function f(){function a(a){return _.find(d,function(b){return b.matches(a)})}function b(a,b,g){function h(){delete d[i]}var i=++c;d[i]=new e(a,b,g);!_.isUndefined(f[a])&&f[a]();f[a]=h;return h}var c=-1,d={},f={};this.entry=function(){if(1===arguments.length)return a.call(this,arguments[0]);return b.apply(this,_.toArray(arguments))};this.size=function(){return _.size(d)}}var g=j.hide("AuthHandlerEntry.matcher"),h=j.hide("AuthHandlerEntry.request"),k=j.hide("AuthHandlerEntry.response");e.prototype.matches=b;e.prototype.request=c;e.prototype.response=d;i.buist.constant("AuthHandlers",new f)});j.invoke("Preconditions","ObjectUtils",function(a,b){function c(c){function d(a){return j.invoke(a,_.identity)}function f(a){return d("$http")(a)}function g(){return d("$q").defer()}function h(){if(_.isFunction(c)){var b=c();a.checkObject(b,"authRequestCfg");return b}return c}function i(){if(t)return t;var c=g();t=c.promise;var d=_.defaults({},h(),{method:"POST",responseType:"json"});_.get(d,"headers.Authorization")||b.set(d,"headers.Authorization","");f(d).then(function(b){var d=_.get(b,"data")||{};a.checkObject(d,"data");var e=d.expires_in,f=d.token_type,g=d.access_token;a.optional.checkNumber(e,"expires_in");a.optional.checkString(f,"token_type",1);a.optional.checkString(g,"access_token",1);w=_.isNumber(e)?Date.now()+1e3*e:-1;s=f+" "+g;c.resolve()},function(){p();c.reject()}).finally(function(){t=null});return t}function k(){var a=g();Date.now()<w?a.resolve():i().then(a.resolve,a.reject);return a.promise}function l(a){!_.get(a,e)&&b.set(a,e,s);u&&u(a)}function m(b){a.checkObject(b,"request config");var c=g();k().then(function(){l(b);c.resolve(b)},function(){c.reject(b)});return c.promise}function n(a){var c=g();b.set(a,e,null);i().then(function(){l(a);return f(a)},c.reject).then(c.resolve,c.reject);return c.promise}function o(b){a.checkObject(b,"response");a.checkObject(b.config,"response.config");var c=b.status,d=g();v&&v(b)?n(b.config).then(d.resolve,function(){d.reject()}):c>=400?d.reject():d.resolve(b);return d.promise}function p(){w=-1;s=null}function q(b){a.optional.checkFunction(b,"handler");u=b;return this}function r(b){a.optional.checkFunction(b,"handler");v=b;return this}a.checkArgument(_.isObjectMap(c)||_.isFunction(c),"No Hash Map or Function: authRequestCfg");var s,t,u,v,w=-1;this.request=m;this.response=o;this.invalidate=p;this.prepareRequest=q;this.requiresReauthentication=r}function d(){this.$new=function(a){return new c(a)}}var e="headers.Authorization";i.buist.constant("AuthHandlerOAuth2",new d)});j.invoke("AuthHandlers",function(a){i.buist.factory("AuthHttpInterceptor",["$q",function(b){function c(c){if(!_.isObjectMap(c))return c;var d=a.entry(c);if(!d)return c;var e=d.request(c);if(!_.isPromise(e))return c;var f=b.defer();e.then(function(){f.resolve(c)},function(){f.reject(c)});return f.promise}function d(c){function d(a){return c?b.reject(a):a}return function(e){if(!_.isObjectMap(e)||!_.isObjectMap(e.config)||e instanceof Error)return d(e);var f=a.entry(e.config);if(!f)return d(e);var g=f.response(e);if(!_.isPromise(g))return d(e);var h=b.defer();g.then(function(a){_.isUndefinedOrNull(a)||a===e?c?h.reject(e):h.resolve(e):h.resolve(a)},function(){h.reject(e)});return h.promise}}return{request:c,response:d(!1),responseError:d(!0)}}])});j.invoke("Preconditions","ErrorMessages","Messages","Interactions",function(a,b,c,d){i.buist.factory("HttpErrorInteractionHttpInterceptor",["$rootScope","$q","$timeout",function(e,f,g){function h(a,b){e.$broadcast(i.events.http.start,{dw$scope:a,config:b})}function k(a,b){g(function(){e.$broadcast(i.events.http.end,{dw$scope:a,config:b&&b.config,status:b&&b.status})})}function l(a){h(a&&a.dw$scope||e,a);return a}function m(h){return function(l){if(!_.isObjectMap(l)||l instanceof Error||!_.isObjectMap(l.config)){k(e,l);return h?f.reject(l):l}var m=_.get(l,"config.dw$scope")||e,n=_.get(l,"config.dw$errors")||m.dw$errors||b,o=n.http(l.status,_.get(l,"config.url")||"",l.data||"");if(!o){k(m,l);return h?f.reject(l):l}var p=new j.HttpStatus(l,m,o.key,o.formatter);g(function(){e.$broadcast(i.events.error.http,p);if(p.defaultPrevented())return;var b;if(p.formatter()){b=p.formatter()(p);a.optional.checkHtml(b,"$http error formatted message");b=j.safe(b||"")}else b=c.getSafeHtml(p.message());d.httpError({defaults:{
messageText:b}})()});k(m,l);return f.reject(p)}}return{request:l,response:m(!1),responseError:m(!0)}}])});i.buist.provider("NullingUndefinedHttpInterceptor",function(){function a(){}function b(a){(a&&_.isPlainObject(a.data)&&"PATCH"===a.method||d(a))&&(a.data=_.transform(a.data,function(a,b,c){a[c]=_.isUndefined(b)?null:b}));e.once=[];return a}function c(a){return function(b){_.isFunction(b)&&a.push(b);return this}}function d(a){var b=e.always.concat(e.once);return _.some(b,function(b){return b(a)})}var e={always:[],once:[]};a.prototype.request=b;this.always=c(e.always);this.once=c(e.once);this.$get=function(){return new a}});i.buist.config(["$httpProvider",function(a){function b(a){return _.isUndefinedOrNull(a)?null:a}a.defaults.transformRequest.unshift(b);a.interceptors.push("HttpErrorInteractionHttpInterceptor","NullingUndefinedHttpInterceptor","AuthHttpInterceptor")}]);j.invoke("Preconditions","Keys",function(a,b){function c(a){_.each(e,function(b){if(b&&b.func&&b.scope){var c=b.scope.$root.$$phase?"$evalAsync":"$apply";b.scope[c](b.func(a))}})}function d(){this.on=j.inject("$rootScope",function(b,c,d){a.checkFunction(c,"callback");a.optional.checkObject(d,"scope");e.push(f(c,d))});this.off=function(b,c){a.checkFunction(b,"callback");a.optional.checkObject(c,"scope");var d=f(b,c);_.remove(e,function(a){return a.func===d.func&&a.scope===d.scope})}}var e=[];b.add(new j.KeyBinding(j.KeyBinding.ESC,function(){c(document)})).preventDefault(!1).stopPropagation(!1);i.buist.run(_.once(function(){document.documentElement.addEventListener("click",function(a){c(a.target)})}));var f=j.inject("$rootScope",function(a,b,c){return{func:b,scope:c||a}});i.buist.constant("AutoHide",new d)});j.invoke("Preconditions","Messages","Browser","Configuration","Interactions","Package",function(a,b,c,d,e,f){function g(a){a=a.replace(J,F);a=a.replace(L,G);a=a.replace(N,H);a=a.replace(P,I);return a.replace(/[\*'\(\);:@=\+\$,\?%\[\]]/g,function(a){return"%"+a.charCodeAt(0).toString(16)})}function h(a){a=a.replace(Q,D);a=a.replace(O,C);a=a.replace(M,B);a=a.replace(K,E);_.each(["*","'","(",")",";",":","@","=","+","$",",","?","%","[","]"],function(b){a=a.replace(new RegExp("%"+b.charCodeAt(0).toString(16),"g"),b)});return a}function k(a,b,c){for(var d=c;d<a.length;d++)switch(a.charAt(d)){case E:d++;break;case b:return d}return-1}function l(a,b){var c=[],d=0,e=k(a,b,d);for(;-1!==e;){c.push(a.substring(d,e));d=e+1;e=k(a,b,d)}d!==a.length&&c.push(a.substring(d,a.length));return c}function m(a){return"$"+a}function n(a){if(a===$)return T;return U}function o(a){return ba[a]?a:V}function p(a){if(a===$)return W;return X}function q(a){a.dirty=!1;a.invalid=!1}function r(a){da.set(a,null);ea.set(a,null);fa.set(a,null);ga.set(a,null)}function s(a){return ca[a]?a:S}function t(a,b,c,d){ea.set(a,s(b));ha.set(a,c);ia.set(a,_.clone(d));_.each(ka.get(a),function(a){r(a)});ka.set(a,[]);_.each(ja.get(a),function(a){r(a)});ja.set(a,{});fa.set(a,ca[a.type()])}function u(c,d,e){a.checkString(d,"route");a.checkObject(e,"state");var f=c.definition().route[d];if(!f){d="";f=c.definition().route[d]}ha.set(c,d);ia.set(c,_.clone(e));f.title&&c.title(b.getSafeHtml(f.title));f.browserTitle&&c.browserTitle(b.get(f.browserTitle));la.set(c,f.layout);a.checkArgument(!_.isUndefined(i.spaceLayoutFunctions[f.layout.type]),'Unknown layout in "'+c.type()+'" route "'+d+'": "'+f.layout.type+'"');_.each(c.apps(),function(a){q(a)});var g=_.values(c.apps());ja.set(c,{});var h=ka.get(c);_.each(f.apps,function(a){var b=_.remove(g,function(b){return b.type()===a});var d;if(b.length>0)d=b[0];else{b=_.remove(h,function(b){return b.type()===a});d=b.length>0?b[0]:new i.App(_.uniqueId("dw-app-"),a)}ja.get(c)[d.id()]=d});h.push.apply(h,g);ka.set(c,h)}function v(a){ja.get(a)&&_.each(ja.get(a),function(a){r(a)});ka.get(a)&&_.each(ka.get(a),function(a){r(a)});da.set(a,null);ea.set(a,null);ha.set(a,null);fa.set(a,null);ia.set(a,null);ja.set(a,null);ka.set(a,null);la.set(a,null);oa.set(a,null);ma.set(a,null);na.set(a,null);ga.set(a,null)}function w(a,b){return a.type()===b.type()&&a.route()===b.route()&&_.isEqual(a.state(),b.state())}function x(a,b){e.confirm({defaults:{title:d["i18n.workspace.confirm.title"],message:d["i18n.workspace.confirm.message"]}}).then(a,b)()}function y(a){return{type:a.type(),route:a.route(),state:_.clone(a.state()),browserTitle:a.browserTitle(),title:a.title()}}function z(a,b){na.set(a,[]);ma.get(a).push(b)}function A(){function d(a){var b=g(a.type());_.isBlank(a.route())||(b+=C+g(a.route()));if(_.keys(a.state()).length>0){b+=D;var c=0;_.each(a.state(),function(a,d){if(!_.isUndefinedOrNull(a)){c>0&&(b+=D);b+=g(d)+D+g(a.toString());c++}})}return b}function e(){if(1===F.length)q=d(r[F[0]]);else{q="";_.each(F,function(a,b){q.length>0&&(q+=B);q+=m(b)+"="+d(r[a])});if(A){q.length>0&&(q+=B);q+=Z+"="+_.indexOf(F,A)}}}function f(){var a=!1;_.each(r,function(b){a=a||b.dirty()});if(a)return b.get("message.areYouSureUnsavedChanges")}function k(a){var b=r[a];if(b)return b;throw new Error('Unknown space "'+a+'" in current workspaces')}var o=this,p=null,q=null,r={},A=null,E=0,F=[],G=[];var H=j.inject("$q","$timeout","$rootScope",function(a,b,c,d){var f=a.defer();b(function(){function g(a){u(a,a.route(),a.state())}function h(){var b=[];_.each(D,function(a){b.push(aa(a.definition()).then(function(){g(a)},function(b){t(a,n(b),"",{});g(a)}))});a.all(b).then(j,function(){f.resolve()})}function j(){_.each(H,function(a){_.each(a.apps(),function(a){a.dirty=!1})});_.each(G,function(a,d){if(J[a])return;var e=D[a],f=!1,g=_.remove(I,function(a){if(!f&&e.type()===H[a].type()){f=!0;return!0}return!1});if(f){q=H[g[0]];delete H[q.id()];var h=y(q);c.$broadcast(i.events.workspaces.transitionstart,q);u(q,e.route(),e.state());z(q,h);delete D[a];D[q.id()]=q;G[d]=q.id();b(function(){c.$broadcast(i.events.workspaces.transitionend,q)},0,!1)}});_.each(H,function(a){v(a)});E++;r=D;F=G;A=null;if(k[Z]){var d;try{d=parseInt(k[Z],10)}catch(g){}d>=0&&d<F.length&&(A=F[d])}null===A&&(A=F[0]);e();f.resolve();!p&&(p=a.defer());p.resolve()}var k={},o=l(d,B);if(_.isBlank(d)||1!==o.length)_.each(o,function(a){var b=a.indexOf("=");b>0&&(k[a.substring(0,b)]=a.substring(b+1))});else{k[m(0)]=d;k[Z]="0"}var q,s=0,C=k[m(s)],D={},G=[],H=_.clone(r),I=F.slice();for(;!_.isUndefined(C);){q=new i.Space(C);D[q.id()]=q;G.push(q.id());C=k[m(++s)]}if(0===G.length){q=new i.Space(R);D[q.id()]=q;G.push(q.id())}var J={};_.each(G,function(a,b){var c=D[a],d=!1,e=_.remove(I,function(a){if(!d&&w(c,H[a])){d=!0;return!0}return!1});if(d){q=H[e[0]];delete H[q.id()];delete D[a];D[q.id()]=q;G[b]=q.id();J[q.id()]=!0}});var K=!1;_.each(H,function(a){K=K||a.dirty()});K?x(h,function(){f.resolve()}):h()});return f.promise});o.app=function(b,c){a.checkString(b,"type",1);a.checkObject(c,"definition");ba[b]=_.clone(c)};o.initialized=j.inject("$q",function(a){!p&&(p=a.defer());return p.promise});o.space=function(b,c){a.checkString(b,"type",1);a.checkObject(c,"definition");ca[b]=_.clone(c)};o.on=j.inject("$window","$location","$rootScope",function(b,d,e,g){function h(){var a=d.url(),b=a.indexOf(k);return-1===b?"":a.substring(b+k.length)}function i(){l();decodeURIComponent(h())!==decodeURIComponent(q)&&d.url(g+"?"+q)}function j(a){var b=decodeURIComponent(h());b!==q&&H(b).then(function(){i(a)})}a.checkString(g,"baseRoute",1);var k=g+"?";var l=_.once(function(){G.push(e.$watch(function(){return q},i))});j(!0);G.push(e.$on("$routeUpdate",j));G.push(e.$watch(function(){var a=r[A];return a?a.browserTitle():""},function(a){c.title(a||"")}));angular.element(b).on("beforeunload",f)});o.off=j.inject("$window",function(a){_.each(r,function(a){v(a)});_.each(G,function(a){a()});q=null;r={};F=[];A=null;E=0;G=[];angular.element(a).off("beforeunload",f)});o.spaces=function(b){if(0===arguments.length)return _.values(r);a.checkString(b,"id",1);return r[b]||null};o.active=function(){return A};o.routeCounter=function(){return E};o.open=j.inject("$q",function(b,c,d,f,g){function h(){u(k,k.route(),k.state());g&&o.activate(k.id());e();E++;l.resolve(k)}var j;arguments.length>2&&(j=c);if(2===arguments.length)if(_.isBoolean(c))g=c;else{j=c;g=!0}else 5!==arguments.length&&(g=!0);a.checkBoolean(g,"activate");var k;if(_.isUndefined(j))k=new i.Space(R);else{a.checkString(j,"type");a.optional.checkString(d,"route");a.optional.checkObject(f,"state");k=new i.Space(j,d||"",f||{})}r[k.id()]=k;F.push(k.id());var l=b.defer();aa(k.definition()).then(h,function(a){t(k,n(a),"",{});h()});return l.promise});o.activate=function(b){a.checkString(b,"id",1);k(b);if(A!==b){A=b;e();E++}};o.navigate=j.inject("$q","$timeout","$rootScope",function(b,c,d,f,g,h,j){function l(a){a instanceof Error?v.reject(a.message):v.reject(a)}function m(){t(q,g,h||"",j||{});u(q,q.route(),q.state());e();E++;z(q,r);v.resolve();c(function(){d.$broadcast(i.events.workspaces.transitionend,q)},0,!1)}function p(){d.$broadcast(i.events.workspaces.transitionstart,q);return aa(ca[g]).then(m,function(a){g=n(a);h=null;j=null;m()})}a.checkString(f,"id",1);a.checkString(g,"type",1);a.optional.checkString(h,"route");a.optional.checkObject(j,"state");var q=k(f);if(!(q.type()!==g||_.isUndefinedOrNull(h)&&_.isUndefinedOrNull(j)))return o.transition(f,h,j);g=s(g);var r=y(q);var v=b.defer();c(function(){if(q.dirty())x(p,function(){v.reject()});else try{p().catch(l)}catch(a){l(a)}});return v.promise});o.transition=j.inject("$q","$timeout","$rootScope",function(b,c,d,f,g,h){function j(a){a instanceof Error?o.reject(a.message):o.reject(a)}function l(){d.$broadcast(i.events.workspaces.transitionstart,m);return c(function(){u(m,g||"",h||r[f].state());e();E++;z(m,n);o.resolve();c(function(){d.$broadcast(i.events.workspaces.transitionend,m)},0,!1)})}a.checkString(f,"id",1);a.optional.checkString(g,"route");a.optional.checkObject(h,"state");var m=k(f);var n=y(m);var o=b.defer();c(function(){if(m.dirty())x(l,function(){o.reject()});else try{l().catch(j)}catch(a){j(a)}});return o.promise});o.state=j.inject("$q","$timeout",function(b,c,d){function f(){c(function(){i.Space.prototype.state.apply(g,j);e();h.resolve()})}a.checkString(d,"id",1);var g=k(d),h=b.defer(),j=_.drop(arguments,3);c(function(){if(g.dirty())x(f,function(){h.reject()});else try{f()}catch(a){h.reject()}});return h.promise});o.back=j.inject("$q",function(b,c){function d(){var a=f.pop();na.set(e,h.concat(a));i.resolve()}a.checkString(c,"id",1);var e=k(c);var f=ma.get(e);if(0===f.length)throw new Error('History empty for space "'+c+'"');var g=f.pop();var h=na.get(e);var i=b.defer();o.navigate(c,g.type,g.route,g.state).then(d,function(){f.push(g);i.reject()});return i.promise});o.forward=j.inject("$q",function(b,c){function d(){na.set(e,f);h.resolve()}a.checkString(c,"id",1);var e=k(c);var f=na.get(e);if(0===f.length)throw new Error('Future empty for space "'+c+'"');var g=f.pop();var h=b.defer();o.navigate(c,g.type,g.route,g.state).then(d,function(){f.push(g);h.reject()});return h.promise});o.close=j.inject("$q","$timeout",function(b,c,d){function f(){c(function(){v(g);delete r[d];F=_.without(F,d);A===d&&(A=0===F.length?null:F[0]);e();E++;h.resolve()})}a.checkString(d,"id",1);var g=r[d];if(!g)throw new Error('Unknown space "'+d+'" in current workspaces');var h=b.defer();c(function(){g.dirty()?x(f,function(){h.reject()}):f()});return h.promise});o.escapeSpaceComponent=g;o.unescapeSpaceComponent=h}i.config["i18n.workspace.confirm.title"]="title.unsavedChanges";i.config["i18n.workspace.confirm.message"]="message.areYouSureUnsavedChanges";var B="&";var C="#";var D="!";var E="/";var F=E+E;var G=E+B;var H=E+C;var I=E+D;var J=new RegExp(_.escapeRegExp(E),"g");var K=new RegExp(_.escapeRegExp(F),"g");var L=new RegExp(_.escapeRegExp(B),"g");var M=new RegExp(_.escapeRegExp(G),"g");var N=new RegExp(_.escapeRegExp(C),"g");var O=new RegExp(_.escapeRegExp(H),"g");var P=new RegExp(_.escapeRegExp(D),"g");var Q=new RegExp(_.escapeRegExp(I),"g");var R="empty";var S="unknown";var T="unauthorized";var U="error";var V="unknownApp";var W="unauthorizedApp";var X="errorApp";var Y={template:"",controller:angular.noop};var Z="$a";var $=new Error("Unauthorized");var aa=j.inject("$q","$timeout","$controller",function(b,c,d,e){function g(b){if(!0===b){var c=[];if(e.packages){a.checkArray(e.packages,"packages");c.push.apply(c,e.packages)}(e.js||e.css||e.i18n||e.packages)&&c.push(_.cloneDeep(_.pick(e,["js","css","i18n","packages"])));0===c.length?i.resolve():f.resolve(c).then(function(){i.resolve()},function(a){i.reject(a)})}else i.reject($)}a.checkArgument(_.isUndefinedOrNull(e.authorize)||_.isFunction(e.authorize)||_.isArray(e.authorize)&&_.isFunction(_.last(e.authorize)),"Incompatible with $controller: authorize");var h,i=b.defer();h=!e.authorize||(_.isFunction(e.authorize)?e.authorize():d(e.authorize));a.checkArgument(_.isBoolean(h)||_.isPromise(h),"Not a boolean or promise: return of authorize()");_.isBoolean(h)?c(function(){g(h)}):h.then(function(a){g(a)},function(a){g(a)});return i.promise});var ba={};var ca={};i.spaceLayoutFunctions={};var da=j.hide("id"),ea=j.hide("type"),fa=j.hide("definition"),ga=j.hide("scope");i.App=function(b,c){a.checkString(b,"id",1);a.checkString(c,"type",1);var d=this;da.set(d,b);ea.set(d,o(c));d.dirty=!1;d.invalid=!1;fa.set(d,ba[d.type()])};i.App.prototype={id:function(){return da.get(this)},type:function(){return ea.get(this)},definition:function(){return _.clone(fa.get(this))},scope:function(){return ga.get(this)||null}};i.resolveApp=j.inject("$q","$timeout","$http","$sce","$templateCache",function(b,c,d,e,f,g){function h(){var a=b.defer();aa(k).then(function(){a.resolve(g)},function(b){a.reject(b)});return a.promise}function i(){var a=b.defer();k.template?c(function(){a.resolve(k.template)}):k.templateUrl?d.get(e.getTrustedResourceUrl(k.templateUrl),{cache:f}).then(function(b){a.resolve(_.get(b,"data"))}).catch(function(){a.reject()}):c(function(){a.reject()});return a.promise}var j=g.type(),k=g.definition();var l=b.defer();h().then(i).then(function(a){l.resolve(_.assign(_.clone(k),{type:j,template:a}))},function(b){var c=p(b),d=ba[c]||Y;a.checkArgument(_.isUndefined(d.templateUrl),"Not supported: templateUrl in error app");l.resolve(_.defaults(_.clone(d),{type:c,template:""}))});return l.promise});i.setScope=function(a,b){ga.set(a,b)};var ha=j.hide("route"),ia=j.hide("state"),ja=j.hide("apps"),ka=j.hide("appCache"),la=j.hide("layout"),ma=j.hide("history"),na=j.hide("future"),oa=j.hide("title"),pa=j.hide("browserTitle");i.Space=function(b,c,d){da.set(this,_.uniqueId("dw-space-"));oa.set(this,j.safe(""));pa.set(this,null);ja.set(this,{});ka.set(this,[]);la.set(this,null);ma.set(this,[]);na.set(this,[]);var e;if(1===arguments.length){a.checkString(b,"token");c="";d={};var f=k(b,C,0),g=k(b,D,0),i=-1===f?g:f;if(-1===i)e=h(b);else{e=h(b.substring(0,i));i===f&&(c=h(-1===g?b.substring(i+C.length):b.substring(i+C.length,g)));if(-1!==g){var m=l(b.substring(g+D.length),D);for(var n=0;n<m.length-1;n+=2)d[h(m[n])]=h(m[n+1])}}}else e=arguments[0];t(this,e,c,d);u(this,this.route(),this.state())};i.Space.prototype={id:function(){return da.get(this)},type:function(){return ea.get(this)},definition:function(){return _.clone(fa.get(this))},route:function(){return ha.get(this)},apps:function(){return _.clone(ja.get(this))},orderedApps:function(){var a,b=_.values(this.apps()),c=[];_.each(this.definition().route[this.route()].apps,function(d,e){d=o(d);a=_.find(b,function(a){return a.type()===d});if(a){c[e]=a;_.remove(c[e],b)}});return c},layout:function(){var a=la.get(this);return a?_.clone(a):null},title:function(b){if(0===arguments.length)return oa.get(this);a.optional.checkHtml(b,"title");oa.set(this,j.safe(b||""))},browserTitle:function(b){if(0===arguments.length)return pa.get(this);a.optional.checkString(b,"browserTitle");pa.set(this,b)},state:function(){function b(b,d){var e=ia.get(c);if(_.isUndefinedOrNull(b))delete e[d];else{a.checkString(arguments[1],"state value");e[d]=b}}var c=this;if(0===arguments.length)return _.clone(ia.get(this));if(1===arguments.length){a.checkObject(arguments[0],"state");_.forEach(arguments[0],b)}else{a.checkString(arguments[0],"name",1);a.optional.checkString(arguments[1],"value");b(arguments[1],arguments[0])}},dirty:function(){var a=!1;_.each(this.apps(),function(b){a=a||b.dirty});return a},invalid:function(){var a=!1;_.each(this.apps(),function(b){a=a||b.invalid});return a},history:function(){var a=[];_.each(ma.get(this),function(b){a.push(_.clone(b))});return a},future:function(){var a=[];_.eachRight(na.get(this),function(b){a.push(_.clone(b))});return a},scope:function(){return ga.get(this)||null}};i.buist.constant("Workspaces",new A)});j.invoke("Preconditions",function(a){j.define(i.type("widget.GridStore"),{constructor:function(b,c,d,e,f,g){a.checkObject(b,"service");a.checkArgument(_.isScope(c),"Not a scope: scope");a.optional.checkObject(d,"searchModel");a.optional.checkNumber(e,"pageSize",1,1e3);a.optional.checkArray(f,"fields");a.optional.checkArray(g,"asyncFields");this.service=b;this.scope=c;this.searchModel=d;this.pageSize=e||i.config["grid.config.default.page.size"]||25;this.callbacks={beforeLoad:[],load:[],loadError:[]};this.index=0;this.currentPage=1;this.sort={};this.fields=f;this.asyncFields=g},on:function(a){_.each(a,function(a,b){this.callbacks[b]&&this.callbacks[b].push(a)}.bind(this))},onBeforeLoad:function(){_.each(this.callbacks.beforeLoad,function(a){a()})},onLoad:function(){_.each(this.callbacks.load,function(a){a()})},onLoadError:function(a){_.each(this.callbacks.loadError,function(b){b(a)})},getOverallCount:function(){return this.searchResult?this.searchResult.total():0},setCurrentPage:function(a){this.currentPage=a;this.index=(a-1)*this.pageSize},load:function(){var a=this;if(this.service){this.onBeforeLoad();var b=new j.SearchRequest;this.searchModel&&b.searchModel(this.searchModel);if(_.isObject(this.sort)&&!_.isEmpty(this.sort)){b.sort(this.sort.field);b.ascending(this.sort.asc)}_.size(this.fields)>0&&b.fields(this.fields);_.size(this.asyncFields)>0&&b.asyncFields(this.asyncFields);b.scope(this.scope);b.count(this.pageSize);b.index(this.index);this.service.search(b).then(function(b){a.data=b.data();a.searchResult=b;a.onLoad()},function(b){a.onLoadError(b)})}},clear:function(a){this.data=[];this.searchResult=null;a&&this.onLoad()}})});j.invoke("Preconditions","Interactions","interact",function(a,b,c){j.define(i.type("widget.StickyTooltip"),{constructor:function(b){a.checkObject(b,"config");a.checkDefined(b.target,"config.target");a.checkElement(b.target[0],"config.target");a.checkObject(b.scope,"config.scope");a.checkString(b.template,"config.template",1);a.optional.checkBoolean(b.enabled,"config.enabled");this.scope=b.scope;this.showTimerOnEvents=b.showTimerOnEvents||["mouseover"];this.showTimerOffEvents=b.showTimerOffEvents||["mouseout"];this.hideTimerOnEvents=b.hideTimerOnEvents||["mouseout"];this.hideTimerOffEvents=b.hideTimerOffEvents||["mouseover"];this.showEvents=b.showEvents||["hold"];this.showDelayMillis=b.delayMillis||500;this.hideDelayMillis=b.hideDelayMillis||200;this.setTemplate(b.template);this.setTarget(b.target);this.setEnabled(!_.isBoolean(b.enabled)||b.enabled);this.setClassName(b.className||null);this.setVisible(!1);var c=this;this.scope.$on(i.events.private.tooltip.lock,function(a,b){c.setLocked(b);a.stopPropagation()});this.callParent([b])},setTarget:function(b){function d(a,c){_.each(a,function(a){if("hold"===a){e.targetInteractable.on("hold",c);e.targetUnhandlers.push(function(){e.targetInteractable.off(a,c)})}else{b.on(a,c);e.targetUnhandlers.push(function(){b.off(a,c)})}})}a.checkElement(b[0],"target");this.removeTarget();this.destroyTargetInteractable();this.target=b;this.targetInteractable=c(b[0]);""===b[0].id&&(b[0].id=_.uniqueId("dw-tooltip-target-"));b.addClass("dw-tooltip-target");var e=this;this.targetUnhandlers=[];d(this.showTimerOnEvents,function(){e.onShowTimerOnEvent()});d(this.showTimerOffEvents,function(){e.onShowTimerOffEvent()});d(this.showEvents,function(){e.onShowEvent()});d(this.hideTimerOnEvents,function(){e.onHideTimerOnEvent()});d(this.hideTimerOffEvents,function(){e.onHideTimerOffEvent()})},setEnabled:function(b){a.checkBoolean(b,"enabled");this.enabled=b;if(!b){this.cancelInteraction();this.setVisible(!1);this.cancelTimers()}},setVisible:function(c){a.checkBoolean(c,"visible");if(this.visible&&c)return;this.visible=c;if(c){var d=this;this.currentInteraction=b.tooltip({scope:this.scope,defaults:{target:this.target[0].id,template:this.template,className:this.className}}).then(function(){d.setVisible(!1)});this.currentInteraction()}else{this.cancelInteraction();this.cancelTimers()}},setLocked:function(b){a.checkBoolean(b,"locked");this.locked=b;b?this.cancelHideTimer():this.onHideTimerOnEvent()},setTemplate:function(b){a.checkString(b,"template");this.template=b},setClassName:function(b){a.optional.checkString(b,"className",1);this.className=b},cancelShowTimer:j.inject("$timeout",function(a){this.showTimer&&a.cancel(this.showTimer);this.showTimer=null;this.showDefer&&a.cancel(this.showDefer);this.showDefer=null}),cancelHideTimer:j.inject("$timeout",function(a){this.hideTimer&&a.cancel(this.hideTimer);this.hideTimer=null;this.hideDefer&&a.cancel(this.hideDefer);this.hideDefer=null}),cancelTimers:function(){this.cancelShowTimer();this.cancelHideTimer()},cancelInteraction:function(){this.currentInteraction&&this.currentInteraction.cancel();this.currentInteraction=null},onShowTimerOnEvent:j.inject("$timeout",function(a){var b=this;if(!this.enabled||this.visible||this.showTimer)return;this.showTimer=a(function(){b.onShowEvent()},this.showDelayMillis,!1)}),onShowTimerOffEvent:function(){this.cancelShowTimer()},onShowEvent:j.inject("$timeout",function(a){var b=this;this.cancelShowTimer();if(!this.enabled||this.visible)return;this.showDefer=a(function(){b.setVisible(!0)},0,!1)}),onHideTimerOnEvent:j.inject("$timeout",function(a){var b=this;if(!this.enabled||this.locked||!this.visible||this.hideTimer)return;this.hideTimer=a(function(){b.onHideEvent()},this.hideDelayMillis,!1)}),onHideTimerOffEvent:function(){this.cancelHideTimer()},onHideEvent:j.inject("$timeout",function(a){var b=this;this.cancelHideTimer();if(!this.enabled||!this.visible)return;this.hideDefer=a(function(){b.setVisible(!1)},0,!1)}),removeTarget:function(){_.each(this.targetUnhandlers,function(a){a()});this.targetUnhandlers=null;this.target&&this.target.removeClass("dw-tooltip-target");this.target=null},destroyTargetInteractable:function(){this.targetInteractable&&this.targetInteractable.unset();this.targetInteractable=null},destroy:function(){this.cancelTimers();this.cancelInteraction();this.removeTarget();this.destroyTargetInteractable();this.template=null;this.scope=null;this.showTimerOnEvents=null;this.showTimerOffEvents=null;this.showEvents=null;this.showDelayMillis=null;this.hideDelayMillis=null;this.className=null;this.visible=null;this.enabled=null;this.locked=null}})});j.invoke("Preconditions",function(a){function b(){var b={};this.put=function(c,d){a.checkString(c,"name",1);a.optional.checkFunction(d,"factory");b[c]=d};this.get=function(c){a.checkString(c,"name",1);return b[c]||null}}i.buist.constant("Layouts",new b)});!function(){j.define(i.apiType("Layout"),{member:{layout:void 0,destroy:function(){}}})}();j.invoke("Preconditions",function(a){function b(a){return function(b){return angular.element(b).data("dw$position")===a}}var c=["north","south","west","east","center","undefined"];var d=j.hide("BorderLayout.styleId");var e=j.hide("BorderLayout.draggables");j.define(i.apiType("BorderLayout"),{extend:i.apiType("Layout"),constructor:function(){this.callParent();var a=_.uniqueId("dw-layout-border-style-");d.set(this,a);e.set(this,[]);var b=document.createElement("style");b.id=a;document.getElementsByTagName("head")[0].appendChild(b)},member:{layout:function(f){function g(a,c,d){var e=interact(a[0]);e.dw$invert="south"===c||"east"===c;return e.draggable({onstart:function(b){e.dw$resize=a.data("dw$resize");e.dw$startX=b.clientX;e.dw$startY=b.clientY;e.dw$startParentBounds=m.getBoundingClientRect();e.dw$startResizeBounds=e.dw$resize[0].getBoundingClientRect()},onmove:function(b){d?a.css("left",Math.floor(b.clientX-e.dw$startParentBounds.left)+"px"):a.css("top",Math.floor(b.clientY-e.dw$startParentBounds.top)+"px")},onend:function(a){var b;if(d){b=e.dw$invert?e.dw$startX-a.clientX:a.clientX-e.dw$startX;e.dw$resize.css("width",Math.floor(e.dw$startResizeBounds.width+b)+"px")}else{b=e.dw$invert?e.dw$startY-a.clientY:a.clientY-e.dw$startY;e.dw$resize.css("height",Math.floor(e.dw$startResizeBounds.height+b)+"px")}l.layout(f)},axis:d?"x":"y",restrict:{restriction:function(){var e=m.getBoundingClientRect();e={top:e.top,bottom:e.bottom-(d?0:a[0].offsetHeight),left:e.left,right:e.right-(d?a[0].offsetWidth:0)};var g;switch(c){case"north":g=_.find(f.children(),b("south"));g&&(e.bottom=Math.min(e.bottom,g.getBoundingClientRect().top-a[0].offsetHeight));break;case"south":g=_.find(f.children(),b("north"));g&&(e.top=Math.max(e.top,g.getBoundingClientRect().bottom));break;case"west":g=_.find(f.children(),b("east"));g&&(e.right=Math.min(e.right,g.getBoundingClientRect().left-a[0].offsetWidth));break;case"east":g=_.find(f.children(),b("west"));g&&(e.left=Math.max(e.left,g.getBoundingClientRect().right))}return e}}})}function h(a,b){var c,d,h;if(v[a]&&v[a].length>0)h=angular.element(_.first(v[a]));else{c="west"===a||"east"===a;d=c?"vertical":"horizontal";h=angular.element('<div class="dw-layout-border-bar dw-'+d+'"></div>');f.append(h);e.get(l).push(g(h,a,c))}h.data("dw$position",a);h.data("dw$resize",b);return h}var j,k,l=this,m=f[0],n=m.id,o=d.get(this),p="";var q;if(m.getAttribute("dw-layout-border-min-width")){try{q=i.intFormat.parse(m.getAttribute("dw-layout-border-min-width"))}catch(C){throw new Error("Not a number: dw-layout-border-min-width")}a.checkNumber(q,"dw-layout-border-min-width",1)}var r;if(m.getAttribute("dw-layout-border-min-height")){try{r=i.intFormat.parse(m.getAttribute("dw-layout-border-min-height"))}catch(C){throw new Error("Not a number: dw-layout-border-min-height")}a.checkNumber(r,"dw-layout-border-min-height",1)}var s=_.groupBy(f.children(),function(a){return(a.getAttribute("dw-layout-border-position")||"undefined").toLowerCase()});var t=_.difference(_.keys(s),c);if(0!==t.length){var u="";for(k=0;k<t.length;k++){k>0&&(u+=", ");u+=t[k]}throw new Error("Unknown dw-layout-border-position: "+u)}switch(f.css("position")){case"relative":case"absolute":case"fixed":break;default:p+=" #"+n+" {position:relative;top:0px;right:0px;}"}var v=_.groupBy(f.children(),function(a){return angular.element(a).data("dw$position")||"undefined"});if(q||r){p+=" @media only screen";q&&(p+=" and (min-width : "+q+"px)");r&&(p+=" and (min-height : "+r+"px)");p+=" {"}var w,x=0;if(s.north)for(k=0;k<s.north.length;k++){w=angular.element(s.north[k]);j=_.uniqueId(o+"-");p+=" #"+n+" ."+j+" {top:"+x+"px}";w.addClass("dw-layout-border-child dw-vertical "+j);w.removeClass("dw-heightmanaged");x+=s.north[k].offsetHeight}var y=0;if(s.south)for(k=s.south.length-1;k>=0;k--){w=angular.element(s.south[k]);j=_.uniqueId(o+"-");p+=" #"+n+" ."+j+" {bottom:"+y+"px}";w.addClass("dw-layout-border-child dw-vertical "+j);w.removeClass("dw-heightmanaged");y+=s.south[k].offsetHeight}var z;if("true"===f.attr("dw-layout-border-resize-horizontal")){if(s.north){z=h("north",angular.element(_.last(s.north)));z.css({top:x+"px",bottom:""});x+=z[0].offsetHeight}if(s.south){z=h("south",angular.element(_.first(s.south)));z.css({top:"",bottom:y+"px"});y+=z[0].offsetHeight}}(s.west||s.east)&&(p+=" #"+n+" .dw-layout-border-child.dw-horizontal {top:"+x+"px;bottom:"+y+"px}");var A=0;if(s.west)for(k=0;k<s.west.length;k++){w=angular.element(s.west[k]);j=_.uniqueId(o+"-");p+=" #"+n+" ."+j+" {left:"+A+"px}";w.addClass("dw-layout-border-child dw-horizontal dw-heightmanaged "+j);A+=s.west[k].offsetWidth}var B=0;if(s.east)for(k=s.east.length-1;k>=0;k--){w=angular.element(s.east[k]);j=_.uniqueId(o+"-");p+=" #"+n+" ."+j+" {right:"+B+"px}";w.addClass("dw-layout-border-child dw-horizontal dw-heightmanaged "+j);B+=s.east[k].offsetWidth}if("true"===f.attr("dw-layout-border-resize-vertical")){p+=" #"+n+" .dw-layout-border-bar.dw-vertical {top:"+x+"px;bottom:"+y+"px}";if(s.west){z=h("west",angular.element(_.last(s.west)));z.css({left:A+"px",right:""});A+=z[0].offsetWidth}if(s.east){z=h("east",angular.element(_.first(s.east)));z.css({left:"",right:B+"px"});B+=z[0].offsetWidth}}if(s.center){p+=" #"+n+" .dw-layout-border-child.dw-center {top:"+x+"px;bottom:"+y+"px;left:"+A+"px;right:"+B+"px}";for(k=0;k<s.center.length;k++)angular.element(s.center[k]).addClass("dw-layout-border-child dw-center dw-heightmanaged")}(q||r)&&(p+="}");document.getElementById(o).innerHTML=p},destroy:function(){_.each(e.get(this),function(a){a.unset()});e.set(this,null);var a=d.get(this),b=document.getElementById(a);b&&angular.element(b).remove();d.set(this,null)}}});j.invoke("Layouts",function(a){a.put("border",function(){return j.create(i.apiType("BorderLayout"))})})});j.invoke("Preconditions",function(a){var b=j.hide("DragSource.group");j.define(i.apiType("DragSource"),{constructor:function(c){a.checkString(c,"group",1);b.set(this,c)},member:{group:function(){return b.get(this)},allowed:function(){return!0},data:function(a){return a}}})});j.invoke("Preconditions",function(a){var b=j.hide("DropTarget.group");j.define(i.apiType("DropTarget"),{constructor:function(c){a.checkString(c,"group",1);b.set(this,c)},member:{group:function(){return b.get(this)},allowed:function(){return!0},drop:void 0}})});j.invoke("Preconditions",function(a){i.hasPlaceholder=function(){var b={};return function(c){a.checkString(c,"element type",1);c=c.toLowerCase();if(!b[c]){var d=document.createElement(c);b[c]=!!("placeholder"in d)}return b[c]}}();i.buist.directive("placeholder",["Messages","$timeout",function(a,b){return{restrict:"A",require:"ngModel",link:function(a,c,d,e){function f(){var a=c[0];if(a.createTextRange){var b=a.createTextRange();b.move("character",0);try{b.select()}catch(d){}}else{document.activeElement!==a&&a.focus();a.setSelectionRange(0,0)}}function g(){c.val(j)}function h(){c.val("")}if(i.hasPlaceholder(c[0].nodeName))return;var j=null;d.$observe("placeholder",function(a){_.isString(j)&&c.val()===j&&c.val(a);j=a||""});c.on("focus",function(){c.val()===j&&setTimeout(f,1)});c.on("click",function(){c.val()===j&&setTimeout(f,1)});c.on("keydown",function(a){c.val()!==j||37!==a.keyCode&&39!==a.keyCode||a.preventDefault()});c.on("keypress",function(){c.val()===j&&h()});c.on("blur",function(){""===c.val()&&g()});e.$formatters.unshift(function(a){a||b(function(){g();return j},0,!1);return a})}}}])});j.invoke("Preconditions",function(a){i.buist.config(["$provide",function(a){a.decorator("$rootScope",["$delegate",function(a){var b=Object.getPrototypeOf(a),c=b.$new;b.$new=function(){var a=c.apply(this,_.toArray(arguments));a.dw$parent=this;return a};return a}])}]);i.enclosingScope=function(a){var b=a.dw$parent;for(;b&&b.hasOwnProperty("$$transcluded")&&!b.hasOwnProperty("$index");)b=b.dw$parent;return b||a.$root};i.customTag=function(b){a.checkObject(b,"config");a.checkArgument(!_.isUndefined(b.template||b.templateUrl),"Undefined: config.template or config.templateUrl");a.optional.checkArray(b.scope,"config.scope",1);a.optional.checkFunction(b.preLink,"config.preLink");a.optional.checkFunction(b.link,"config.link");a.optional.checkString(b.template,"config.template");a.optional.checkString(b.templateUrl,"config.templateUrl");return j.inject("$parse",function(c){function d(d){_.each(b.scope,function(b){e[b]=_.isUndefined(d[b])?b:d[b];f[b]=c(b);a.checkArgument(_.isFunction(f[b].assign),"Not an assignable expression: "+b);g[b]=c(e[b]);a.checkArgument(_.isFunction(g[b].assign),"Not an assignable expression: "+b)})}var e={},f={},g={};return _.extend({restrict:"E",replace:!1,scope:!0,link:{pre:function(a,c,h){var j;if(b.scope){j=i.enclosingScope(a);d(h);_.each(b.scope,function(b){f[b].assign(a,g[b](j));j.$watch(e[b],function(c){
f[b].assign(a,c)});a.$watch(b,function(a){g[b].assign(j,a)})})}if(b.preLink){b.preLink(a,angular.element(c[0]),h);b.scope&&_.each(b.scope,function(b){g[b].assign(j,f[b](a))})}},post:function(a,c,d){b.link&&b.link(a,angular.element(c[0]),d);if(b.scope){var e=i.enclosingScope(a);_.each(b.scope,function(b){g[b].assign(e,f[b](a))})}}}},_.pick(b,"template","templateUrl"))})}});j.invoke("Preconditions","Messages","Formats","Interactions","ObjectUtils",function(a,b,c,d,e){function f(a,b){return function(c){c=_.isFunction(b)?b(c):c;e.set(this.scope,a,c)}.bind(this)}function g(a,c,d){var e=_.get(this.attrs,c),f=null;_.isNotBlank(e)?b.has(e)?a(b.getSafeHtml(e).toString()||d):this.scope.$watch(e,function(b){f&&f();_.isFunction(b)?f=this.scope.$watch(b,function(b){a(j.safe(b||d||"").toString())}):a(j.safe(b||d||"").toString())}.bind(this)):a(d||"")}function h(a,b,c){var d=_.get(this.attrs,b),e=null;c=!_.isBoolean(c)||c;_.isBoolean(d)||"true"===d||"false"===d?a(_.isBoolean(d)?d:"true"===d):_.isNotBlank(d)?this.scope.$watch(d,function(b){e&&e();_.isFunction(b)?e=this.scope.$watch(b,function(b){a(_.isBoolean(b)?b:c)}):a(_.isBoolean(b)?b:c)}.bind(this)):a(c)}function k(a,b,c){var d,e=_.get(this.attrs,b),f=null;if(_.isNotBlank(e)||_.isNumber(e)){d=parseFloat(e);_.isNumber(d)&&!_.isNaN(d)?a(d):this.scope.$watch(e,function(b){f&&f();if(_.isFunction(b))f=this.scope.$watch(b,function(b){d=parseFloat(b);a(_.isNumber(d)&&!_.isNaN(d)?d:c)});else{d=parseFloat(b);a(_.isNumber(d)&&!_.isNaN(d)?d:c)}}.bind(this))}else a(c)}i.encodeAttr=function(b){a.optional.checkString(b,"value");return b?b.replace(/"/g,"&quot;"):""};j.define(i.type("directives.Directive"),{constructor:function(a,b,c){this.scope=a;this.element=b;this.attrs=c;this.enclosingScope=i.enclosingScope(a);this.unwatchers=[];var d=this;a.$on("$destroy",function(){d.destroy()})},ensureId:function(b){a.checkString(b,"prefix",1);""===this.element[0].id&&(this.element[0].id=_.uniqueId(b))},replaceElement:function(b){a.checkString(b,"nodeName",1);var c=document.createElement(b);var d=this.element[0];this.copyElementAttributes(d,c);this.element.replaceWith(c);this.element=angular.element(c)},replaceElementWith:function(a){this.copyElementAttributes(this.element[0],a[0]);this.element.replaceWith(a[0]);this.element=a},copyElementAttributes:function(a,b){if(a.id){var c=a.id;a.id="dw-aka-"+c;b.id=c}this.copyHTMLAttributes(a,b,function(a){return"id"!==a});var d=angular.element(a),e=angular.element(b),f=d.data();_.each(_.keys(f),function(a){e.data(a,f[a])})},copyHTMLAttributes:function(a,b,c){for(var d=0;d<a.attributes.length;d++){var e=a.attributes.item(d);c&&!c(e.nodeName)||b.setAttribute(e.nodeName,e.nodeValue)}},copyHTMLDataAttributes:function(a,b){this.copyHTMLAttributes(a,b,function(a){return 0===a.indexOf("data-")||0===a.indexOf("x-")})},setVisible:function(b){a.optional.checkBoolean(b,"visible");this.visible=!_.isBoolean(b)||b;this.element&&this.element.toggleClass("ng-hide",!this.visible)},setTooltip:function(b){a.optional.checkHtml(b,"safeHtml");_.isUndefinedOrNull(b)||0===b.length?this.destroyMember("tooltip"):this.tooltip?this.tooltip.setTemplate(j.safe(b).toString()):this.tooltip=this.createTooltip(b)},createTooltip:function(b){a.checkHtml(b,"safeHtml");return j.create(i.type("widget.StickyTooltip"),{target:this.element,template:j.safe(b).toString(),scope:this.scope})},setReadyCallback:function(b){a.optional.checkFunction(b,"readyCallback");this.readyCallback=b},setModelProcessor:function(b){a.optional.checkObject(b,"processor");if(b){a.optional.checkFunction(b.post,"post");a.optional.checkFunction(b.pre,"pre")}this.modelProcessor=b},bind:j.inject("$parse",function(b,c,d,e){a.checkString(c,"localName",1);a.checkObject(d,"scope");a.checkString(e,"name",1);var f=this,g=b(c),h=b(e);a.checkArgument(_.isFunction(g.assign),"Not an assignable expression: "+c);a.checkArgument(_.isFunction(h.assign),"Not an assignable expression: "+e);this.scope.$evalAsync(function(){f.scope.$watch(c,function(a){h.assign(d,a)})});d.$evalAsync(function(){f.unwatchers.push(d.$watch(e,function(a){g.assign(f.scope,a)}))})}),linkText:function(c,d,e){a.checkString(c,"keyName",1);a.checkString(d,"textName",1);a.checkString(e,"funcName",1);var f=this;if(_.isUndefined(this.attrs[c]))if(_.isUndefined(this.attrs[d])){if(!_.isUndefined(this.attrs[e])){var g=null;this.scope.$watch(this.attrs[e],function(b){var c=f.attrs.$attr[e];a.optional.checkFunction(b,c);g&&g();b?g=f.scope.$watch(b,function(b){a.optional.checkHtml(b,c);f.setText(j.safe(b||""))}):f.setText(j.safe(""))})}}else this.scope.$watch(this.attrs[d],function(b){a.optional.checkHtml(b,f.attrs.$attr[d]);f.setText(j.safe(b||""))});else{a.checkString(this.attrs[c],this.attrs.$attr[c],1);this.setText(b.getSafeHtml(this.attrs[c]))}},linkTextExpression:function(a){g.call(this,this.setText,a)},linkEnabled:function(b){a.checkString(b,"name",1);if(!_.isUndefined(this.attrs[b])){var c=this;this.scope.$watch(this.attrs[b],function(d){a.optional.checkBoolean(d,c.attrs.$attr[b]);c.setEnabled(!_.isBoolean(d)||d)})}},linkEnabledExpression:function(a){h.call(this,this.setEnabled,a)},linkVisible:function(b){a.checkString(b,"name",1);if(!_.isUndefined(this.attrs[b])){var c=this;this.scope.$watch(this.attrs[b],function(d){a.optional.checkBoolean(d,c.attrs.$attr[b]);c.setVisible(!_.isBoolean(d)||d)})}},linkVisibleExpression:function(a){h.call(this,this.setVisible,a)},linkPlaceholder:function(c,d){a.checkString(c,"keyName",1);a.checkString(d,"textName",1);if(_.isUndefined(this.attrs[c])){if(!_.isUndefined(this.attrs[d])){var e=this;this.scope.$watch(e.attrs[d],function(b){a.optional.checkHtml(b,e.attrs.$attr[d]);e.setPlaceholder(j.safe(b||""))})}}else{a.checkString(this.attrs[c],this.attrs.$attr[c],1);this.setPlaceholder(b.getSafeHtml(this.attrs[c]).toString())}},linkPlaceholderExpression:function(a){g.call(this,this.setPlaceholder,a)},linkFormat:function(b,d){a.checkString(b,"nameName",1);a.checkString(d,"fnName",1);if(_.isUndefined(this.attrs[b]))_.isUndefined(this.attrs[d])||this.scope.$watch(this.attrs[d],function(b){a.optional.checkFunction(b,this.attrs.$attr[d]);this.setFormat(b)}.bind(this));else{a.checkString(this.attrs[b],this.attrs.$attr[b],1);var e=c.get(this.attrs[b]);a.checkArgument(_.isFunction(e),"Unknown format: "+this.attrs[b]);this.setFormat(e)}},linkFormatExpression:function(a){var b=this.attrs[a];if(_.isBlank(b))return;var d=c.get(b);if(d){this.setFormat(d);return}this.scope.$watch(b,function(a){if(_.isFunction(a))this.setFormat(a);else{var b=c.get(a);b&&this.setFormat(b)}}.bind(this))},linkModelProcessor:function(b){a.checkString(b,"processorName");if(!_.isUndefined(this.attrs[b])){a.checkString(this.attrs[b],this.attrs.$attr[b],1);this.setModelProcessor(this.scope[this.attrs[b]])}},linkInputStateHandler:function(b){a.checkObject(b,"ngModelCtrl");this.scope.$watch(function(){var a=!1!==b.$valid?4:0;a+=!1!==b.$pristine?2:0;return a+(!1!==b.$untouched?1:0)},function(){this.updateValidStyle(this.element,!1!==b.$valid);this.updatePristineStyle(this.element,!1!==b.$pristine);this.updateUntouchedStyle(this.element,!1!==b.$untouched)}.bind(this))},linkReadyCallback:function(b){a.checkString(b,"name",1);if(!_.isUndefined(this.attrs[b])){var c=this.scope.$eval(this.attrs[b]);a.optional.checkFunction(c,this.attrs.$attr[b]);this.setReadyCallback(c)}},linkStringExpression:function(a,b,c){g.call(this,f.call(this,a,c),a,b)},linkBooleanExpression:function(a,b,c){h.call(this,f.call(this,a,c),a,b)},linkNumberExpression:function(a,b,c){k.call(this,f.call(this,a,c),a,b)},createIdClass:function(b){a.checkString(b,"id",1);return"dw-id-"+b},createMask:function(b,c){a.checkDefined(b,"target");a.optional.checkHtml(c,"message");var e=this.scope.$new();e.dw$message=c;var f=d.mask({scope:e,defaults:{target:b,messageText:_.isUndefinedOrNull(c)?void 0:"dw$message"}}).finally(function(){e.$destroy()});f();return f},parseIntegerAttribute:function(a){try{return i.intFormat.parse(this.attrs[a])}catch(b){throw new Error("Not a number: "+this.attrs.$attr[a])}},parseDecimalAttribute:function(a){try{return i.decimalFormat.parse(this.attrs[a])}catch(b){throw new Error("Not a number: "+this.attrs.$attr[a])}},parseBooleanAttribute:function(a){try{return i.booleanFormat.parse(this.attrs[a])}catch(b){throw new Error("Not a boolean: "+this.attrs.$attr[a])}},updateValidStyle:function(b,c){a.checkNotNull(b,"element");a.optional.checkBoolean(c,"valid");c=_.isUndefinedOrNull(c)||c;b.toggleClass("dw-valid",c);b.toggleClass("dw-invalid",!c);b.toggleClass("is-valid",c);b.toggleClass("is-invalid",!c)},updatePristineStyle:function(b,c){a.checkNotNull(b,"element");a.checkBoolean(c,"pristine");b.toggleClass("dw-pristine",c);b.toggleClass("dw-dirty",!c);b.toggleClass("is-unchanged",c);b.toggleClass("is-changed",!c)},updateUntouchedStyle:function(b,c){a.checkNotNull(b,"element");a.checkBoolean(c,"untouched");b.toggleClass("is-untouched",c);b.toggleClass("is-touched",!c)},runModelProcessor:j.inject("$q",function(a,b,c){if(this.modelProcessor&&this.modelProcessor[c]){this.element&&this.element.toggleClass("is-processing",!0);var d=[b].concat(_.drop(arguments,3)),e=this.modelProcessor[c];return a.resolve(e.apply(e,d)).finally(_.bind(function(){this.element&&this.element.toggleClass("is-processing",!1)},this))}return a.resolve(b)}),isForbidden:function(){if(this.element)return this.element.hasClass("is-forbidden")||_.isElement(i.element.parent(this.element,"is-forbidden"));return!0},linkEventHandler:j.inject("$parse",function(b,c,d){a.checkString(c,"handlerName",1);a.optional.checkString(d,"scopeName",1);d=d||c;var e=this,f=b(d);a.checkArgument(_.isFunction(f.assign),"Not an assignable expression: "+d);f.assign(this.scope,function(){return e[c].apply(e,arguments)})}),destroy:function(){this.destroyMember("tooltip");_.each(this.unwatchers,function(a){a()});this.unwatchers=null;this.scope=null;this.element=null;this.attrs=null;this.enclosingScope=null;this.visible=null;this.readyCallback=null;this.modelProcessor=null},destroyMember:function(b){a.checkString(b,"name",1);this[b]&&this[b].destroy();this[b]=null}})});j.invoke("Preconditions",function(a){j.define(i.type("directives.ElementDirective"),{extend:i.type("directives.Directive"),constructor:function(a,b,c){this.callParent([a,b,c])},setText:function(b){a.optional.checkHtml(b,"safeHtml");this.element.html(j.safe(b||"").toSafeString())},setEnabled:function(b){if(_.isUndefinedOrNull(b))this.scope.disabled=!1;else{a.checkBoolean(b,"dw-enabled");this.scope.disabled=!b}},mask:function(a){return this.createMask(this.element[0],a)}})});j.invoke("Preconditions",function(a){j.define(i.type("directives.ExpanderDirective"),{extend:i.type("directives.ElementDirective"),constructor:function(b,c,d,e,f){a.checkFunction(e,"transcludeFn");a.checkFunction(f,"cloneAttachFn");this.callParent([b,c,d]);this.setExpanded(!1,!0);this.transcludeScope=b.$new();this.linkVisible("dwVisible");this.linkExpanded();this.linkEventHandler("onClick","dw$onClick");this.linkEventHandler("onKey","dw$onKey");e(this.transcludeScope,f)},setExpanded:function(b,c){a.optional.checkBoolean(b,"expanded");a.optional.checkBoolean(c,"suppressEvents");b=!!_.isBoolean(b)&&b;if(b===this.expanded)return;b&&this.isForbidden()&&(b=!1);this.expanded=b;this.updateView();if(!0!==c){this.expanded&&this.transcludeScope.$broadcast(i.events.disclose);this.scope.$emit(i.events.invalidate)}},linkExpanded:j.inject("$parse",function(b){if(!_.isUndefined(this.attrs.dwExpanded)){a.checkString(this.attrs.dwExpanded,this.attrs.$attr.dwExpanded,1);this.expandedAccessor=b(this.attrs.dwExpanded);a.checkArgument(_.isFunction(this.expandedAccessor.assign),"Not an assignable expression: "+this.attrs.dwExpanded);var c=this;this.scope.$watch(this.attrs.dwExpanded,function(b){a.optional.checkBoolean(b,c.attrs.$attr.dwExpanded);c.setExpanded(b)})}}),toggleExpanded:function(){this.setExpanded(!this.expanded);this.expandedAccessor&&this.expandedAccessor.assign(this.enclosingScope,this.expanded)},onKey:function(a){a.preventDefault();a.stopPropagation();this.toggleExpanded()},updateView:function(){this.element&&this.element.toggleClass("dw-expanded",this.expanded)},destroy:function(){this.transcludeScope=null;this.expanded=null;this.expandedAccessor=null;this.callParent()}})});j.invoke("Preconditions",function(a){function b(a,b){if(!a.element)return;var c=a.ngModelCtrl;if(c&&(c.$dirty||b)){var d=c.$formatters,e=d.length,f=c.$viewValue;for(;e--;){var g=d[e];!g.dw$id&&(f=g(f))}if(c.$viewValue!==f){c.$viewValue=f;c.$render()}}}function c(a){return!a||!a.$error||!a.$error.parse}j.define(i.type("directives.TextDirective"),{extend:i.type("directives.ElementDirective"),constructor:function(b,c,d,e,f,g){a.checkString(e,"model",1);a.checkString(f,"idPrefix",1);this.callParent([b,c,d]);this.accessor=j.invoke("$parse",function(a){return a(e)});a.checkArgument(_.isFunction(this.accessor.assign),"Not an assignable expression: "+e);this.focused=!1;this.format=i.identityFormat;this.ensureId(f);this.linkEnabled("dwEnabled");this.linkVisible("dwVisible");this.linkPlaceholder("dwPlaceholder","dwPlaceholderText");this.linkEventHandler("onChange","dw$onChange");this.linkEventHandler("onFocus","dw$onFocus");this.linkEventHandler("onBlur","dw$onBlur");!1!==g&&this.linkFormat("dwFormat","dwFormatFunction");var h=this;this.enclosingScope.$watch(e,function(a){a!==h.value&&h.onModelChange(a)})},setPlaceholder:function(c){a.optional.checkHtml(c,"text");this.scope.placeholder=c?c.toString():"";b(this);this.updateView()},setFormat:function(c){a.checkFunction(c,"format");this.format=c;b(this,!0)},link:function(a){this.ngModelCtrl=a;var b=this;a.$parsers.unshift(function(a){try{b.value=a?b.format.parse(a):void 0}catch(c){delete b.value;return}return _.isUndefined(b.value)?null:b.value});a.$formatters.push(function(d){var e=a.$viewValue;if(c(a)){if(_.isUndefinedOrNull(a.$modelValue))return"";if(_.isUndefinedOrNull(b.value))return a.$valid?b.format(d):e;return b.format(b.value)}return e});b.linkInputStateHandler(a);b.onModelChange(this.accessor(this.enclosingScope))},onChange:function(){this.updateModel()},onFocus:function(){this.focused=!0;b(this);this.updateView()},onBlur:function(){this.focused=!1;b(this);this.updateView()},onModelChange:function(a){this.value=a;this.ngModelCtrl&&this.ngModelCtrl.$setValidity("parse",!0);this.updateView()},updateModel:function(){this.accessor&&this.accessor.assign(this.enclosingScope,this.value)},updateView:function(){if(!this.element)return;var a=this.ngModelCtrl?this.ngModelCtrl.$viewValue:null;if(!this.focused&&_.isUndefinedOrNull(this.value)&&_.isUndefinedOrNull(a)){this.element.addClass("dw-empty");this.scope.model=null}else{this.element.removeClass("dw-empty");this.scope.model=c(this.ngModelCtrl)?this.value:null}},destroy:function(){this.accessor=null;this.format=null;this.value=null;this.callParent()}})});!function(){function a(a){var b="<dw:id>header</dw:id>";if(!1!==a.header){b+='<div class="dw-header" dw-id="header" dw-transclude>';b+='<div class="dw-icon" role="img"></div>';b+='<div class="dw-title dw-transclude-position"></div>';b+='<div class="dw-tools dw-transclude-position"></div>';b+='<div style="clear:both;"></div>';b+="</div>"}return b+'<div class="dw-body">'+a.template+"</div>"}function b(b,c,d,e){this.link=function(f,g,h){function j(j){c.addClass("dw-app-"+j.type);c.toggleClass("dw-noheader",!1===j.header);var k=b.$new(!0);k.dw$space=f;k.dw$app=h;i.setScope(h,k);e(j.controller,{$space:f,$spaceScope:g,$app:h,$appElement:c,$scope:k});c.html(a(j));d(c.contents())(k)}i.resolveApp(h).then(j)};c.addClass("dw-app")}i.buist.directive("dwApp",function(){return{restrict:"E",replace:!1,template:"",scope:{space:"=",spaceScope:"=",app:"="},controller:["$scope","$element","$compile","$controller",b],link:function(a,b,c,d){d.link(a.space,a.spaceScope,a.app)}}})}();i.buist.directive("dwAutoHide",["Keys","$document","$timeout",function(a,b,c){return{restrict:"A",link:function(d,e,f){function g(a){a.preventDefault();a.stopPropagation();if("click"===a.type&&i.element.contains(e[0],a.target))return;e.toggleClass("ng-hide",!0);d.$emit(i.events.hide,e)}function h(){k();b.on("click",g);a.add(l).preventDefault(!1).stopPropagation(!1);m=d.$on("$destroy",k);e.on("$destroy",k)}function k(){b.off("click",g);a.remove(l);m&&m();m=null}var l=new j.KeyBinding(j.KeyBinding.ESC,g),m=null;f.dwAutoHideEnabled?d.$watch(f.dwAutoHideEnabled,function(a){a?c(h,0,!1):k()}):h()}}}]);i.buist.directive("dwBlur",["$document","$parse","$rootScope","$timeout",function(a,b,c,d){return{restrict:"A",link:function(e,f,g){function h(a){if(i.element.contains(f[0],a.target))return;var d=b(g.dwBlur,null,!0),h=c.$$phase?"$evalAsync":"$apply";e[h](function(){d(e,{$event:a})})}function j(){k();a.on("click",h);l=e.$on("$destroy",k);f.on("$destroy",k)}function k(){a.off("click",h);l&&l();l=null}var l=null;g.dwBlurEnabled?e.$watch(g.dwBlurEnabled,function(a){a?d(j,0,!1):k()}):j()}}}]);!function(){function a(a){return"button"===a[0].nodeName.toLowerCase()}j.define(i.type("directives.dwButton"),{extend:i.type("directives.Directive"),constructor:function(b,c,d){if(!a(c))return;this.callParent([b,c,d]);this.linkEventHandler("onKey","dw$onKey");_.isBlank(d.type)&&c.attr("type","button")},onKey:j.inject("$rootScope","$timeout",function(a,b,c){c.preventDefault();c.stopPropagation();b(_.bind(function(){this.element.triggerHandler("click")},this))})});i.buist.directive("dwButton",function(){return{restrict:"C",replace:!1,transclude:!0,scope:!0,controller:["$scope","$element","$attrs",j.internal.directives.dwButton],template:function(a,b){if(!_.isUndefined(b.dwKeyStroke)&&_.isUndefined(b.dwKey)){a.removeAttr(b.$attr.dwKeyStroke);return'<span class="ng-hide" dw-key="dw$onKey($event)" dw-key-stroke="'+b.dwKeyStroke+'"></span>'}},link:function(b,c,d,e,f){a(c)&&f(b.$parent.$new(),function(a,b){b.$$transcluded=!0;c.append(a)})}}})}();j.invoke("Preconditions",function(a){function b(b,c){function d(){var a=["dw-button"];b.hasClass("dw-primary")&&a.push("dw-button-primary");(b.hasClass("dw-linkbutton")||j)&&a.push("dw-button-link");(b.hasClass("dw-size-mini")||b.hasClass("dw-size-small"))&&a.push("dw-button-small");b.hasClass("dw-size-large")&&a.push("dw-button-large");if(b.hasClass("slds-delete")){a=[];a.push("slds-button slds-button_text-destructive action-element")}if(b.hasClass("slds-primary")){a=[];a.push("slds-button slds-button_brand")}if(b.hasClass("slds-neutral")){a=[];a.push("slds-button slds-button_neutral")}return a.join(" ")}function e(){return["dw-icon"].concat(n).join(" ")}function f(b){a.checkArgument(_.isUndefined(c.dwLabel)&&_.isUndefined(c.dwLabelText),b+": No dw-label or dw-label-text not permitted")}var g=b.attr("class"),h=_.isNotBlank(g)?g.split(/\s+/):[],i=b.hasClass("dw-icononly"),j=b.hasClass("dw-iconbutton"),k=b.hasClass("dw-iconleft"),l=b.hasClass("dw-iconright"),m=i||j||k||l,n=_.transform(h,function(a,c){if(_.startsWith(c,"dw-glyph-")){a.push(c);b.removeClass(c)}},[]),o=!_.isEmpty(n),p=!_.isUndefined(c.dwLabel),q=!_.isUndefined(c.dwLabelText);var r='<button class="'+d()+'" ng-click="dw$onClick()"';_.isUndefined(c.type)||(r+=' type="'+c.type+'"');_.isUndefined(c.dwEnabled)||(r+=' ng-disabled="disabled"');_.isUndefined(c.dwTooltip)||(r+=' dw-tooltip="'+c.dwTooltip+'"');_.isUndefined(c.dwKeyStroke)||(r+=' dw-key="dw$onClick()" dw-key-stroke="'+c.dwKeyStroke+'"');_.isUndefined(c.autofocus)||(r+=' autofocus="'+c.autofocus+'"');r+=">";var s="";(p||q)&&(s+='<span class="dw-label" ng-bind-html="dw$label | SafeHtml"></span>');if(m||o){var t='<span role="img" class="'+e(),u='"></span>';if(i){f("dw-icononly");r+=t+u}else if(j){f("dw-iconbutton");r+=t+u}else r+=l?s+t+" dw-icon-pull-right"+u:k?t+" dw-icon-pull-left"+u+s:t+u+s}else r+=s;return r+"</button>"}j.define(i.type("directives.Button"),{extend:i.type("directives.ElementDirective"),constructor:function(b,c,d){this.getHandler=j.invoke("$parse",function(a){return a(d.dwHandler)});a.checkFunction(this.getHandler(b),"dw-handler");this.callParent([b,c,d]);this.ensureId("dw-button-");this.linkText("dwLabel","dwLabelText","dwLabelFunction");this.linkEnabled("dwEnabled");this.linkVisible("dwVisible");this.linkEventHandler("onClick","dw$onClick")},setText:function(b){a.optional.checkHtml(b,"text");this.scope.dw$label=b},onClick:function(){var b=this.element.find("button");if(b.prop("disabled")||b.attr("disabled")||b.hasClass("is-forbidden")||this.isForbidden())return;var c=this.getHandler(this.scope);a.checkFunction(c,"dw-handler");c()}});i.buist.directive("dwButton",function(){return{restrict:"E",replace:!1,template:b,scope:!0,controller:["$scope","$element","$attrs",j.internal.directives.Button]}})});j.invoke("Preconditions",function(a){function b(a){var b=a?i.element.parent(a,"dw-cell-editor"):null;if(b===d)return;angular.element(d).addClass("dw-inactive");angular.element(b).removeClass("dw-inactive");d=b}function c(a,b){var c="<form";_.isUndefined(b.dwValidate)||(c+=" "+b.$attr.dwValidate+'="'+b.dwValidate+'"');c+=">";c+='<div class="dw-cell-editor-input">';c+=a.html();c+="</div>";c+='<dw:valid-indicator class="dw-indicator dw-icononly" name="'+i.encodeAttr(b.name)+'" dw-tooltip-visible="true"';_.isUndefined(b.dwErrorMessages)||(c+=" "+b.$attr.dwErrorMessages+'="'+i.encodeAttr(b.dwErrorMessages)+'"');c+="></dw:valid-indicator>";return c+"</form>"}var d=null;i.buist.run(["$rootScope",function(a){a.$watch(function(){return document.activeElement},b)}]);j.define(i.type("directives.CellEditor"),{extend:i.type("directives.ElementDirective"),constructor:function(b,c,d){a.checkString(d.name,"name",1);this.callParent([b,c,d]);this.ensureId("dw-cell-editor-");c.addClass("dw-cell-editor");c.addClass("dw-inactive")}});i.buist.directive("dwCellEditor",function(){return{restrict:"E",replace:!1,template:c,scope:!0,controller:["$scope","$element","$attrs",j.internal.directives.CellEditor]}})});j.invoke("Preconditions","ObjectUtils",function(a,b){function c(a){if("input"!==a[0].nodeName.toLowerCase())return!1;var b=a.attr("type");return _.isBlank(b)||"checkbox"===b.toLowerCase()}j.define(i.type("directives.dwCheckbox"),{extend:i.type("directives.ElementDirective"),constructor:function(a,d,e){if(!c(d))return;this.callParent([a,d,e]);this.linkTriState("dwTriState");_.isBlank(e.type)&&d.attr("type","checkbox");var f=this;this.handleTriStateClick=function(a){a.preventDefault();a.stopPropagation();f.scope&&f.scope.$evalAsync(function(){var a;if(d.prop("indeterminate")){d.prop("checked",!0);a=!0}else if(d.prop("checked")){d.prop("checked",!1);a=!1}else a=null;var c=null===a;d.prop("indeterminate",c);d.toggleClass("is-indeterminate",c);if(c)f.scope&&b.set(f.scope,f.attrs.ngModel,a);else if(f.ngModelCtrl){f.ngModelCtrl.$setViewValue(a,"click");f.ngModelCtrl.$commitViewValue()}})}},link:function(a){this.ngModelCtrl=a;a&&this.linkInputStateHandler(a)},linkTriState:function(b){a.checkString(b,"name",1);var c=this.attrs[b];if(_.isNotBlank(c)){var d=this;this.scope.$watch(c,function(c){a.optional.checkBoolean(c,d.attrs.$attr[b]);d.setTriState(!!_.isBoolean(c)&&c)})}},setTriState:function(a){var b=this.element;if(a){b.on("click",this.handleTriStateClick);this.deregisterModelWatcher();this.ngModelCtrl&&(this.unregisterModelWatcher=this.scope.$watch(this.attrs.ngModel,function(a){var c=_.isUndefinedOrNull(a);b.toggleClass("is-indeterminate",c);b.prop("indeterminate",c)}))}else{this.deregisterModelWatcher();b.off("click",this.handleTriStateClick);b.removeClass("is-indeterminate");b.prop("indeterminate",!1)}},deregisterModelWatcher:function(){if(this.unregisterModelWatcher){this.unregisterModelWatcher();this.unregisterModelWatcher=null}},destroy:function(){this.element.off("click",this.handleTriStateClick);this.ngModelCtrl=null;this.handleTriStateClick=null;this.deregisterModelWatcher();this.callParent()}});i.buist.directive("dwCheckbox",function(){return{restrict:"C",replace:!1,scope:!1,require:["dwCheckbox","?ngModel"],controller:["$scope","$element","$attrs",j.internal.directives.dwCheckbox],link:function(a,b,c,d){d[0].link(d[1])}}})});j.invoke("Preconditions",function(a){function b(a,b){var c='<input type="checkbox" class="dw-checkbox" ng-model="model"';_.isUndefined(b.name)||(c+=' name="'+i.encodeAttr(b.name)+'"');_.isUndefined(b.dwEnabled)||(c+=' ng-disabled="disabled"');_.isUndefined(b.dwTooltip)||(c+=' dw-tooltip="'+b.dwTooltip+'"');_.isUndefined(b.dwTriState)||(c+=' dw-tri-state="'+b.dwTriState+'"');c+=" />";return c}j.define(i.type("directives.Checkbox"),{extend:i.type("directives.ElementDirective"),constructor:function(b,c,d){a.checkString(d.dwModel,"dw-model",1);this.callParent([b,c,d]);this.ensureId("dw-checkbox-");this.linkEnabled("dwEnabled");this.linkVisible("dwVisible");this.bind("model",this.enclosingScope,d.dwModel);c.addClass("dw-validate-input")},link:function(){var a=this.element,b=a.find("input");b.attr("id",a.attr("id")+"-input");this.linkInputStateHandler(b.controller("ngModel"));this.scope.$watch(function(){return b.prop("indeterminate")},function(b){a.toggleClass("dw-indeterminate",b);a.toggleClass("is-indeterminate",b)})}});i.buist.directive("dwCheckbox",function(){return{restrict:"E",replace:!1,template:b,scope:!0,controller:["$scope","$element","$attrs",j.internal.directives.Checkbox],link:function(a,b,c,d){d.link()}}})});j.invoke("Preconditions","Keys","ObjectUtils",function(a,b,c){function d(a,b){var c='<div class="dw-controls">';c+='<dw:text-field class="dw-newvalue" dw-model="dw$newvalue" dw-enabled="dw$enabled" dw-format-function="dw$format" name="'+_.uniqueId("dw$newvalue-")+'"';_.isUndefined(b.dwPlaceholder)?_.isUndefined(b.dwPlaceholderText)||(c+=' dw-placeholder-text="'+i.encodeAttr(b.dwPlaceholderText)+'"'):c+=' dw-placeholder="'+i.encodeAttr(b.dwPlaceholder)+'"';c+="></dw:text-field>";c+='<dw:button class="dw-add" dw-handler="dw$onAdd" dw-enabled="dw$enabled && dw$addValid"';_.isUndefined(b.dwLabel)?_.isUndefined(b.dwLabelText)?_.isUndefined(b.dwLabelFunction)||(c+=' dw-label-function="'+i.encodeAttr(b.dwLabelFunction)+'"'):c+=' dw-label-text="'+i.encodeAttr(b.dwLabelText)+'"':c+=' dw-label="'+i.encodeAttr(b.dwLabel)+'"';c+="></dw:button>";c+="</div>";c+='<div class="dw-values">';c+='<div class="dw-value" ng-repeat="value in dw$collection">';c+='<span class="dw-text" ng-bind-html="dw$format(value) | SafeHtml"></span>';c+='<span class="dw-remove dw-glyph-times-circle dw-glyph-sm" role="button" ng-click="dw$onRemoveValue($index)">';c+="</div>";c+="</div>";c+='<input type="hidden" ng-model="'+i.encodeAttr(b.dwModel)+'"';_.isUndefined(b.name)||(c+=' name="'+i.encodeAttr(b.name)+'"');return c+" />"}var e=function(a){return i.toStringFormat(a)};e.parse=i.identityFormat.parse;j.define(i.type("directives.CollectionField"),{extend:i.type("directives.ElementDirective"),constructor:function(b,c,d){a.checkString(d.dwModel,"dw-model",1);this.callParent([b,c,d]);this.accessor=j.invoke("$parse",function(a){return a(d.dwModel)});a.checkArgument(_.isFunction(this.accessor.assign),"Not an assignable expression: "+d.dwModel);this.setEnabled(!0);this.setFormat(e);this.scope.dw$addValid=!1;this.ensureId("dw-collection-field-");this.linkEnabled("dwEnabled");this.linkVisible("dwVisible");this.linkFormat("dwFormat","dwFormatFunction");this.linkModelProcessor("dwModelProcessor");this.linkEventHandler("onAdd","dw$onAdd");this.linkEventHandler("onRemoveValue","dw$onRemoveValue");var f=this;this.scope.$watch("dw$newvalue",function(a,b){a!==b&&f.onNewValueChange()});this.enclosingScope.$watch(d.dwModel,function(a,b){f.onModelChange(a===b||a===f.getCollection())});c.addClass("dw-collection-field");c.addClass("dw-validate-input")},setEnabled:function(b){a.checkBoolean(b,"enabled");this.scope.dw$enabled=b;this.element.toggleClass("dw-disabled",!b)},setFormat:function(b){a.checkFunction(b,"format");this.scope.dw$format=b},getCollection:function(){return this.scope.dw$collection||[]},link:function(a){this.validateCtrl=a;var c=this,d=angular.element(c.element.children()[0]),e=angular.element(d.children()[0]),f=e.find("input"),g=angular.element(c.element.children()[2]),h=f.controller("ngModel"),i=g.controller("ngModel");c.newValueNgModelCtrl=h;c.ngModelCtrl=i;var k=new j.KeyBinding(j.KeyBinding.ENTER,function(){c.scope.$apply(function(){c.onEnter()})});b.add(k,f[0]);c.deregisterEnter=function(){b.remove(k,f[0])};c.linkInputStateHandler(this.ngModelCtrl);c.scope.$watch(function(){return h.$touched},function(a){a?i.$setTouched():i.$setUntouched()});c.scope.$watch(function(){return h.$viewValue},function(){i.$setValidity("parse",!h.$error||!h.$error.parse)})},validateNewValue:function(){function a(){return!_.isUndefinedOrNull(_.get(b,"dw$newvalue"))}var b=this.scope,d=this.ngModelCtrl,e=b.dw$newvalue,f=this.getCollection(),g=_.isUndefined(e)?f:f.concat(e);b.dw$addValid=!1;this.runModelProcessor(g,"post","dw$validate",e).then(function(e){function f(a){if(1!==_.size(a)||"dw$array"!==a[0].type||!_.includes(["dw$array.min","dw$array.range","dw$array.length"],a[0].reason))return!1;var b=_.get(a[0],"args.max",i.MAX_INT);return _.size(g)<=b}function h(){_.forEach(b.dw$validatorerrors,function(a){d.dw$error&&delete d.dw$error[a.type];d.$setValidity(a.type,!0)});b.dw$validatorerrors=null}function j(a){h();b.dw$validatorerrors=_.map(a,function(a){d.$setValidity(a.type,!1);c.set(d,'dw$error["'+a.type+'"]',a);return a})}var k=this.validateCtrl?this.validateCtrl.get(this.attrs.dwModel):null;if(!k){b.dw$addValid=a();h();return}k.validate(e).then(function(){b.dw$addValid=a();h()},function(c){if(f(c)){b.dw$addValid=a();h()}else{b.dw$addValid=!1;j(c)}})}.bind(this),function(){b.dw$addValid=a()})},onNewValueChange:function(){this.validateNewValue()},onModelChange:j.inject("$timeout",function(a,b){var c=this.accessor(this.enclosingScope)||[],d=this;this.runModelProcessor(c,"pre","dw$change").then(function(c){if(!d.scope)return;d.scope.dw$collection=c;!b&&a(function(){d.scope&&d.scope.$emit(i.events.invalidate)},0,!1)})}),onAdd:j.inject("$timeout",function(a){if(!this.scope.dw$enabled||!this.scope.dw$addValid)return;var b=this.getCollection().concat([this.scope.dw$newvalue]),c=this.scope.dw$enabled,d=this;this.setEnabled(!1);this.runModelProcessor(b,"post","dw$add",this.scope.dw$newvalue).then(function(c){if(!d.scope)return;d.scope.dw$collection=b;d.accessor.assign(d.enclosingScope,c);angular.element(d.element.children()[2]).controller("ngModel").$setDirty();delete d.scope.dw$newvalue;return a(function(){d.scope&&d.scope.$emit(i.events.invalidate);var a=angular.element(d.element.children()[0]);angular.element(a.children()[0]).find("input")[0].focus()},0,!1)}).finally(function(){d.scope&&!d.scope.dw$enabled&&d.setEnabled(c)})}),onEnter:function(){this.onAdd()},onRemoveValue:j.inject("$timeout",function(a,b){if(!this.scope.dw$enabled)return;var c=this.getCollection().slice(),d=c.splice(b,1),e=this;angular.element(e.element.children()[2]).controller("ngModel").$setDirty();this.scope.dw$collection=c;this.runModelProcessor(c,"post","dw$remove",_.first(d)).then(function(b){if(!e.scope)return;e.accessor.assign(e.enclosingScope,b);e.validateNewValue();a(function(){e.scope&&e.scope.$emit(i.events.invalidate)},0,!1)})}),destroy:function(){this.deregisterEnter&&this.deregisterEnter();this.deregisterEnter=null;this.accessor=null;this.newValueNgModelCtrl=null;this.ngModelCtrl=null;this.validateCtrl=null;this.callParent()}});i.buist.directive("dwCollectionField",function(){return{restrict:"E",replace:!1,template:d,require:["dwCollectionField","?^dwValidate"],controller:["$scope","$element","$attrs",j.internal.directives.CollectionField],scope:!0,link:function(a,b,c,d){d[0].link(d[1])}}})});j.invoke("Preconditions",function(a){j.define(i.type("directives.Configure"),{extend:i.type("directives.Directive"),constructor:function(a,b,c){this.callParent([a,b,c]);this.linkObject()},setObject:function(b){a.checkArgument(_.isObject(b),"object");this.object=b},put:j.inject("$parse",function(b,c,d){a.checkString(c,"name",1);var e=b(c)
;a.checkArgument(_.isFunction(e.assign),"Not an assignable expression: "+c);e.assign(this.object,d)}),linkObject:j.inject("$parse",function(b){a.checkString(this.attrs.dwObject,this.attrs.$attr.dwObject||"dw-object",1);var c=b(this.attrs.dwObject)(this.scope);a.checkArgument(_.isObject(c),"Not an object: "+this.attrs.$attr.dwObject);this.setObject(c)})});i.buist.directive("dwConfigure",function(){return{restrict:"E",replace:!1,scope:!0,controller:["$scope","$element","$attrs",j.internal.directives.Configure],link:function(a,b){b.remove()}}})});j.invoke("Preconditions","Formats","Configuration","AutoHide","ZIndex","Pikaday",function(a,b,c,d,e,f){function g(){a.checkNumber(c["i18n.format.weekStart"],"i18n.format.weekStart",0,6);a.checkArray(c["i18n.format.dayNames"],"i18n.format.dayNames",7,7);a.checkArray(c["i18n.format.monthNames"],"i18n.format.monthNames",12,12);var b={previousMonth:c["i18n.calendarPopup.tooltip.previous"],nextMonth:c["i18n.calendarPopup.tooltip.next"],months:c["i18n.format.monthNames"],weekdays:c["i18n.format.dayNames"],weekdaysShort:[]};_.each(b.weekdays,function(a){b.weekdaysShort.push(a.substring(0,3))});return b}function h(a,b){var c='<input type="text" class="dw-text" ng-change="dw$onChange()" ng-model="model" ng-focus="dw$onFocus()" ng-blur="dw$onBlur()"';_.isUndefined(b.name)||(c+=' name="'+i.encodeAttr(b.name)+'"');_.isUndefined(b.autocomplete)||(c+=' autocomplete="'+i.encodeAttr(b.autocomplete)+'"');_.isUndefined(b.dwPlaceholder)&&_.isUndefined(b.dwPlaceholderText)||(c+=' ng-attr-placeholder="{{placeholder}}"');_.isUndefined(b.dwEnabled)||(c+=' ng-disabled="disabled"');c+=" />";c+='<dw:button class="dw-trigger dw-icononly dw-glyphicon dw-glyph-calendar" dw-handler="dw$onTriggerClick"';_.isUndefined(b.dwEnabled)||(c+=' dw-enabled="!$parent.disabled"');return c+'></dw:button><div class="dw-calendar-popup"></div>'}i.config["i18n.calendarPopup.tooltip.next"]="Go to next month.";i.config["i18n.calendarPopup.tooltip.previous"]="Go to previous month.";j.define(i.type("directives.DateField"),{extend:i.type("directives.TextDirective"),constructor:function(b,d,e){a.checkString(e.dwModel,"dw-model",1);this.callParent([b,d,e,e.dwModel,"dw-date-field-",!0]);this.linkEventHandler("onTriggerClick","dw$onTriggerClick");var h=this;this.autoHideHandler=function(a){h.picker&&h.picker.isVisible()&&!i.element.contains(h.picker.el,a)&&h.setPickerVisible(!1)};a.checkArgument(_.isFunction(f),"Missing required buist dependency: Pikaday");var k={firstDay:c["i18n.format.weekStart"],i18n:g(),onSelect:function(){b.$apply(function(){h.picker&&h.onDateSelected(h.picker.getDate())})}};_.isUndefined(e.dwPickerDateDisabled)||(k.disableDayFn=j.inject("$parse",function(a,c){var d=a(e.dwPickerDateDisabled)(b);return _.isFunction(d)?d(c):c}));this.picker=new f(k);this.setPickerVisible(!1);d.addClass("dw-date-field");d.addClass("dw-validate-input")},linkFormat:function(a,c){this.callParent([a,c]);_.isUndefined(this.attrs[a]&&_.isUndefined(this.attrs[c]))&&(this.format=b.get("date"))},link:function(a){this.callParent([a]);angular.element(this.element.children()[2]).append(this.picker.el)},onTriggerClick:function(){this.setPickerVisible(!this.pickerVisible)},setPickerVisible:j.inject("$timeout",function(b,c){a.checkBoolean(c,"pickerVisible");if(!this.picker||this.pickerVisible===c)return;this.pickerVisible=c;var f=angular.element(this.element.children()[2]);f.toggleClass("ng-hide",!c);if(c){f.css("z-index",e.tooltip());this.value?this.picker.gotoDate(this.value):this.picker.gotoToday();var g=this;b(function(){d.on(g.autoHideHandler)})}else d.off(this.autoHideHandler)}),onDateSelected:j.inject("$timeout",function(a,b){var c=this;var d=c.format.parse(c.format(b,!0),!0);this.onModelChange(d);this.updateModel();this.setPickerVisible(!1);this.ngModelCtrl.$setDirty();this.ngModelCtrl.$setTouched();a(function(){c.ngModelCtrl.$setViewValue(c.format(d))})}),updateView:function(){this.callParent();this.picker&&this.picker.setDate(this.value,!0)},destroy:function(){this.autoHideHandler&&d.off(this.autoHideHandler);this.autoHideHandler=null;this.picker&&this.picker.destroy&&this.picker.destroy();this.picker=null;this.pickerVisible=!1;this.callParent()}});i.buist.directive("dwDateField",function(){return{restrict:"E",template:h,scope:!0,require:"dwDateField",controller:["$scope","$element","$attrs",j.internal.directives.DateField],link:function(a,b,c,d){d.link(angular.element(b.children()[0]).controller("ngModel"))}}})});j.invoke("Preconditions","Keys",function(a,b){j.define(i.type("directives.DefaultAction"),{extend:i.type("directives.Directive"),constructor:function(b,c,d){a.checkString(d.dwDefaultAction,d.$attr.dwDefaultAction,1);this.getHandler=j.invoke("$parse",function(a){return a(d.dwDefaultAction)});a.checkFunction(this.getHandler(b),d.$attr.dwDefaultAction);this.callParent([b,c,d])},link:function(){var a=this;var c=new j.KeyBinding(j.KeyBinding.ENTER,function(b){if("textarea"===b.target.localName||a.element.prop("disabled")||a.element.attr("disabled")||a.isForbidden())return!1;a.scope.$apply(_.bind(a.onAction,a))});b.add(c,this.element[0]);this.deregisterEnter=function(){b.remove(c,a.element[0])}},onAction:function(){var b=this.getHandler(this.scope);a.checkFunction(b,this.attrs.$attr.dwDefaultAction);b()},destroy:function(){this.deregisterEnter&&this.deregisterEnter();this.deregisterEnter=null;this.getHandler=null;this.callParent()}});i.buist.directive("dwDefaultAction",function(){return{restrict:"A",replace:!1,scope:!1,controller:["$scope","$element","$attrs",j.internal.directives.DefaultAction],link:function(a,b,c,d){d.link()}}})});!function(){function a(){return!0}function b(a){if(i.focusableElement(a))return a;a=a.firstChild;var c;for(;a;){c=b(a);if(c)return c;a=a.nextSibling}}var c=["INPUT","BUTTON","A","TEXTAREA","SELECT"];i.focusableElement=function(a){function b(){return e.hasClass("is-forbidden")||_.isElement(i.element.parent(e,"is-forbidden"))}function d(){return e.hasClass("ng-hide")||_.isElement(i.element.parent(e,"ng-hide"))}if(!_.isElement(a)||1!==a.nodeType)return!1;var e=angular.element(a);if(e.prop("disabled")||e.attr("disabled")||b())return!1;var f=a.nodeName.toUpperCase();if(_.includes(c,f))return!("A"===f&&!a.href||d());var g=a.getAttributeNode("tabIndex");return g&&g.specified&&parseFloat(g.value)>=-1&&!d()};j.define(i.type("directives.DefaultFocus"),{extend:i.type("directives.Directive"),constructor:function(a,b,c){this.callParent([a,b,c]);this.linkExpression();this.element.addClass("dw-default-focus")},linkExpression:j.inject("$parse",function(b){if(_.isBlank(this.attrs.dwDefaultFocus)){this.deregFn&&this.deregFn();this.deregFn=null;this.expression=a}else{this.deregFn=this.scope.$watch(this.attrs.dwDefaultFocus,_.bind(this.apply,this));this.expression=b(this.attrs.dwDefaultFocus)}}),apply:j.inject("$timeout",function(a){var b=this;this.destroySchedule();this.scheduledFocus=a(function(){b.focus()},0,!1)}),focus:function(){if(!this.element)return;if(!this.expression(this.scope))return;var a=b(this.element[0]);_.isElement(a)&&a.focus()},destroySchedule:j.inject("$timeout",function(a){this.scheduledFocus&&a.cancel(this.scheduledFocus);this.scheduledFocus=null}),destroy:function(){this.destroySchedule();this.expression=null;this.deregFn&&this.deregFn();this.deregFn=null;this.callParent()}});i.buist.directive("dwDefaultFocus",["$timeout",function(a){return{restrict:"A",replace:!1,scope:!1,controller:["$scope","$element","$attrs",j.internal.directives.DefaultFocus],link:function(b,c,d,e){a(function(){e.apply()},0,!1)}}}])}();j.invoke("Preconditions","Package",function(a,b){j.define(i.type("directives.Defer"),{extend:i.type("directives.Directive"),constructor:function(a,b,c){this.callParent([a,b,c]);this.transcludeScope=a.$new();this.setEvent(i.events.disclose);this.ensureId("dw-deferred-content-");this.linkUntil();this.linkPackages();b.addClass("dw-deferred-content")},setEvent:function(b){a.checkString(b,"event",1);this.event=b},setPackages:function(b){a.optional.checkArray(b,"packages",1);this.packages=b},linkUntil:function(){if(!_.isUndefined(this.attrs.dwUntil)){a.checkString(this.attrs.dwUntil,this.attrs.$attr.dwUntil,1);this.setEvent(this.attrs.dwUntil)}},linkPackages:function(){_.isUndefinedOrNull(this.attrs.dwPackages)||this.setPackages(_.invokeMap(this.attrs.dwPackages.split(","),"trim"))},link:function(a){var b=this;b.scope.$on(b.event,_.once(function(){b.onLoad(a)}))},onLoad:function(a){var c=this,d=j.inject("$compile",function(b){c.element.html(a);b(c.element.contents())(c.transcludeScope)});this.packages?b.resolve(this.packages).then(d):d()},destroy:function(){this.event=null;this.transcludeScope=null;this.packages=null;this.callParent()}});i.buist.directive("dwDefer",function(){return{restrict:"E",replace:!1,scope:!0,controller:["$scope","$element","$attrs",j.internal.directives.Defer],compile:function(a){var b=a.html();a.html("");return function(a,c,d,e){e.link(b)}}}})});j.invoke("Preconditions",function(a){j.define(i.type("directives.Disclosure"),{extend:i.type("directives.ExpanderDirective"),constructor:function(a,b,c,d){this.callParent([a,b,c,d,function(a){angular.element(b.children()[1]).append(a)}]);this.ensureId("dw-disclosure-");this.linkText("dwTitle","dwTitleText","dwTitleFunction");this.linkEventHandler("onClick","dw$onClick");b.addClass("dw-disclosure")},setText:function(b){a.optional.checkHtml(b,"text");this.scope.dw$title=b},onClick:function(){this.toggleExpanded()},updateView:function(){this.callParent();angular.element(this.element.children()[1]).toggleClass("ng-hide",!this.expanded)}});i.buist.directive("dwDisclosure",function(){return{restrict:"E",replace:!1,template:function(a,b){var c='<div class="dw-header" ng-click="dw$onClick()"';_.isUndefined(b.dwKeyStroke)||(c+=' dw-key="dw$onKey($event)" dw-key-stroke="'+b.dwKeyStroke+'"');return c+'>  <span class="dw-trigger dw-glyph" role="button"></span>  <span class="dw-title" ng-bind-html="dw$title | SafeHtml"></span></div><div class="dw-body ng-hide"></div>'},scope:!0,transclude:!0,controller:["$scope","$element","$attrs","$transclude",j.internal.directives.Disclosure]}})});j.invoke("Preconditions",function(a){function b(a,b,c,d,e){a.filterSelector=d;var f=a.proxy;a.proxy=function(a,d){_.extend(c,d);var e,g=angular.element("<div></div>");b(c,function(a){e=a});if(_.isUndefined(e[0]))return f(a,d);g.append(e);c.$digest();return g[0]};e&&(a.dragType=e)}j.define(i.type("directives.Drag"),{extend:i.type("directives.Directive"),constructor:function(a,b,c,d){this.callParent([a,b,c]);this.transcludeFn=d;this.linkSelector();this.linkTarget()},linkSelector:function(){if(_.isUndefined(this.attrs.dwElement)){if(_.isUndefined(this.attrs.dwSelector))throw new Error("Required either dw-element or dw-selector: dw-drag");a.checkString(this.attrs.dwSelector,this.attrs.$attr.dwSelector,1);this.selector=this.attrs.dwSelector}else{a.checkString(this.attrs.dwElement,this.attrs.$attr.dwElement,1);var b=i.dwId(this.scope,this.attrs.dwElement);a.checkArgument(!_.isUndefinedOrNull(b),"Not a <dw:id> in scope: "+this.attrs.dwElement);this.selector="."+this.createIdClass(b)}},linkTarget:function(){if(!_.isUndefined(this.attrs.dwTarget)){a.checkString(this.attrs.dwTarget,this.attrs.$attr.dwTarget,1);this.target=this.attrs.dwTarget}},link:function(){if(!this.selector)return;var c=this;_.each(j.element(this.selector),function(d){var e=angular.element(d).controller("dwDragSource");a.checkArgument(!_.isUndefinedOrNull(e),"Required dw-drag-source attribute on elements: "+c.selector);a.optional.checkString(c.attrs.dwDragType,"dw-draggit s-type");_.isUndefined(c.attrs.class)||e.setTipClass(c.attrs.class);b(e.getDelegate(),c.transcludeFn,e.scope.$new(),c.target,c.attrs.dwDragType)})},destroy:function(){this.transcludeFn=null;this.selector=null;this.target=null;this.callParent()}});i.buist.directive("dwDrag",["$timeout",function(a){return{restrict:"E",replace:!1,scope:!0,transclude:!0,controller:["$scope","$element","$attrs","$transclude",j.internal.directives.Drag],link:function(b,c,d,e){c.remove();a(function(){e.link()},0,!1)}}}])});j.invoke("Preconditions","ZIndex","interact",function(a,b,c){var d=10;var e=10;c.dynamicDrop(!0);i.BaseDragDelegate=function(){this.filterSelector="";this.targetSelectors=[""];this.dragType="copy";this.elementOrParent=function(b,c){if(_.isBlank(c))return b;a.checkArgument(_.isString(c)&&"."===c.charAt(0),"Not a class name: drag selector "+c);var d=c.substring(1);if(angular.element(b).hasClass(d))return angular.element(b);b=i.element.parent(b,d);return b?angular.element(b):null};this.target=function(a){if(!_.isBlank(this.filterSelector)){a=this.elementOrParent(a,this.filterSelector);if(!a)return null}var b;for(var c=0;!b&&c<this.targetSelectors.length;c++)b=this.elementOrParent(a,this.targetSelectors[c]);return b};this.context=function(a){var b=_.clone(a.data());_.each(a[0].attributes,function(a){0===a.nodeName.indexOf("data-")&&(b[a.nodeName.substring(5)]=a.nodeValue)});return b};this.proxy=function(a){return angular.element(a).clone()};this.onDragStart=function(a){a.addClass("dw-source-dragged");a.toggleClass("dw-dragtype-move","move"===this.dragType)};this.onDragEnd=function(a){a.removeClass("dw-source-dragged");a.removeClass("dw-dragtype-move")}};j.define(i.type("directives.DragSource"),{extend:i.type("directives.Directive"),constructor:function(a,b,c){this.callParent([a,b,c]);this.setDelegate(new i.BaseDragDelegate)},setTipClass:function(b){a.optional.checkString(b,"className",1);this.tipClass=b},setDelegate:function(b){a.checkObject(b,"delegate");this.delegate=b},getDelegate:function(){return this.delegate},obtainDraggableOptions:j.inject("$parse",function(a,b){var c=b||i.element.parent(this.element,"dw-scroller");return{manualStart:!0,autoScroll:!!c&&{container:c},onstart:function(a){this.onDragStart(a)}.bind(this),onmove:function(a){this.onDragMove(a)}.bind(this),onend:function(a){this.onDragEnd(a)}.bind(this)}}),link:j.inject("$parse",function(b){a.checkString(this.attrs.dwDragSource,this.attrs.$attr.dwDragSource,1);var d=this;this.source=b(this.attrs.dwDragSource)(this.scope);a.checkArgument(this.source instanceof j.DragSource,"Not a DragSource: "+this.attrs.$attr.dwDragSource);var e=this.scope.dw$dragElementProducer;(_.isUndefinedOrNull(e)||(this.attrs.ngRepeat?this.scope.$parent.$parent.$id!==e.$id:this.scope.$id!==e.$id))&&(e={setConsumer:function(a){a.setElement(d.element)}});e.setConsumer({setElement:function(a){a.on("dragstart",function(a){a.preventDefault()});var e=b(d.attrs.dwScrollParent)(d.scope);d.draggable=c(a[0]).draggable(d.obtainDraggableOptions(e)).on("move",function(a){d.onMove(a)});_.isUndefined(d.attrs.dwScrollParent)||d.scope.$watch(d.attrs.dwScrollParent,function(a,b){if(d.draggable&&!_.isEqual(a,b)){var c=d.obtainDraggableOptions(a);d.draggable.draggable(c)}})},getController:function(){return d}});this.element.addClass("dw-drag")}),onMove:function(c){var d=c.interaction;if(!d.pointerIsDown||d.interacting())return;if(!_.get(d,"prepared.name"))return;if("INPUT"===c.target.nodeName)return;this.dragSourceElem=this.delegate.target(angular.element(c.target));if(_.isUndefinedOrNull(this.dragSourceElem))return;a.checkElement(this.dragSourceElem[0],"Drag target");var e=this.delegate.context(this.dragSourceElem);if(_.isUndefinedOrNull(e))return;a.checkObject(e,"Drag context");if(!this.source.allowed(e))return;this.proxy=angular.element('<div class="dw-drag-tip dw-drop-no"><div class="dw-icon"></div></div>');this.tipClass&&this.proxy.addClass(this.tipClass);this.proxy.css("z-index",b.tooltip());this.proxy.data("dw$ddGroup",this.source.group());this.proxy.data("dw$dragSourceData",this.source.data(e));var f=angular.element('<div class="dw-body"></div>');f.append(this.delegate.proxy(this.dragSourceElem,e));this.proxy.prepend(f);angular.element(document.body).append(this.proxy);this.updateProxyPosition(c);d.start({name:"drag"},c.interactable,this.proxy[0])},onDragStart:j.inject("$rootScope",function(a){this.dragSourceElem&&this.delegate.onDragStart(this.dragSourceElem);a.$broadcast(i.events.drag.start)}),onDragMove:function(a){this.updateProxyPosition(a);window.getSelection&&window.getSelection().removeAllRanges()},onDragEnd:j.inject("$rootScope",function(a){this.destroyProxy();this.dragSourceElem&&this.delegate.onDragEnd(this.dragSourceElem);this.draggable||(this.delegate=null);a.$broadcast(i.events.drag.end)}),updateProxyPosition:function(a){if(!this.proxy)return;this.proxy.css({left:Math.floor(d+a.clientX)+"px",top:Math.floor(e+a.clientY)+"px"})},destroyDraggable:function(){this.draggable&&c.isSet(this.draggable._element)&&this.draggable.unset();this.draggable=null},destroyProxy:function(){this.proxy&&this.proxy.remove();this.proxy=null},destroy:function(){this.destroyDraggable();this.tipClass=null;this.source=null;this.callParent()}});i.buist.directive("dwDragSource",function(){return{restrict:"A",scope:!0,priority:100,controller:["$scope","$element","$attrs",j.internal.directives.DragSource],link:function(a,b,c,d){d.link()}}})});j.invoke("Preconditions",function(a){function b(a,b){a.filterSelector=b}j.define(i.type("directives.Drop"),{extend:i.type("directives.Directive"),constructor:function(a,b,c){this.callParent([a,b,c]);this.linkSelector();this.linkTarget()},linkSelector:function(){if(_.isUndefined(this.attrs.dwElement)){if(_.isUndefined(this.attrs.dwSelector))throw new Error("Required either dw-element or dw-selector: dw-drop");a.checkString(this.attrs.dwSelector,this.attrs.$attr.dwSelector,1);this.selector=this.attrs.dwSelector}else{a.checkString(this.attrs.dwElement,this.attrs.$attr.dwElement,1);var b=i.dwId(this.scope,this.attrs.dwElement);a.checkArgument(!_.isUndefinedOrNull(b),"Not a <dw:id> in scope: "+this.attrs.dwElement);this.selector="."+this.createIdClass(b)}},linkTarget:function(){a.checkString(this.attrs.dwTarget,this.attrs.$attr.dwTarget,1);this.target=this.attrs.dwTarget},link:function(){if(!this.selector)return;var c=this;_.each(j.element(this.selector),function(d){var e=angular.element(d).controller("dwDropTarget");a.checkArgument(!_.isUndefinedOrNull(e),"Required dw-drop-target: element matched by "+c.selector);b(e.getDelegate(),c.target)})},destroy:function(){this.transcludeFn=null;this.selector=null;this.target=null;this.callParent()}});i.buist.directive("dwDrop",["$timeout",function(a){return{restrict:"E",replace:!1,scope:!0,transclude:!0,controller:["$scope","$element","$attrs",j.internal.directives.Drop],link:function(b,c,d,e){c.remove();a(function(){e.link()},0,!1)}}}])});j.invoke("Preconditions","interact",function(a,b){i.BaseDropDelegate=function(){this.filterSelector="";this.targetSelectors=[""];this.elementOrParent=function(b,c){if(_.isBlank(c))return b;a.checkArgument(_.isString(c)&&"."===c.charAt(0),"Not a class name: drop selector "+c);var d=c.substring(1);if(angular.element(b).hasClass(d))return angular.element(b);b=i.element.parent(b,d);return b?angular.element(b):null};this.target=function(a){if(!_.isBlank(this.filterSelector)){a=this.elementOrParent(a,this.filterSelector);if(!a)return null}var b;for(var c=0;!b&&c<this.targetSelectors.length;c++)b=this.elementOrParent(a,this.targetSelectors[c]);return b};this.context=function(a){var b=_.clone(a.data());_.each(a[0].attributes,function(a){0===a.nodeName.indexOf("data-")&&(b[a.nodeName.substring(5)]=a.nodeValue)});return b}};j.define(i.type("directives.DropTarget"),{extend:i.type("directives.Directive"),constructor:function(a,b,c){this.callParent([a,b,c]);this.setDelegate(new i.BaseDropDelegate)},setDelegate:function(b){a.checkObject(b,"delegate");this.delegate=b},getDelegate:function(){return this.delegate},link:j.inject("$parse",function(c){if(!this.element)return;a.checkString(this.attrs.dwDropTarget,this.attrs.$attr.dwDropTarget,1);var d=this;this.target=c(this.attrs.dwDropTarget)(this.scope);a.checkArgument(this.target instanceof j.DropTarget,"Not a DropTarget: "+this.attrs.$attr.dwDropTarget);var e=this.scope.dw$dropElementProducer;(_.isUndefinedOrNull(e)||(this.attrs.ngRepeat?this.scope.$parent.$parent.$id!==e.$id:this.scope.$id!==e.$id))&&(e={setConsumer:function(a){a.setElement(d.element)}});e.setConsumer({setElement:function(a){d.dropElement=a;d.dropzone=b(a[0]).dropzone({accept:d.delegate.filterSelector||null,ondropmove:function(a){d.onDropMove(a)},ondragleave:function(a){d.onDragLeave(a)},ondrop:function(a){d.onDrop(a)}})},getController:function(){return d}});this.element.addClass("dw-drop")}),getDropInfo:function(b){var c={proxy:angular.element(b.relatedTarget),eventTarget:angular.element(document.elementFromPoint(b.interaction.curCoords.client.x,b.interaction.curCoords.client.y)),allowed:!1};if(c.proxy.data("dw$ddGroup")!==(this.target&&this.target.group()))return c;c.target=this.delegate.target(c.eventTarget);if(_.isUndefinedOrNull(c.target))return c;a.checkElement(c.target[0],"Drop target");c.context=this.delegate.context(c.target);if(_.isUndefinedOrNull(c.context))return c;a.checkObject(c.context,"Drop context");if(!this.target.allowed(c.proxy.data("dw$dragSourceData")||{},c.context,b))return c;c.allowed=!0;return c},onDropMove:function(a){var b=this.getDropInfo(a);if(this.lastOverTarget){this.lastOverTarget.removeClass("dw-target-over");var c=this.lastOverTarget.hasClass("dw-drop-over")?this.lastOverTarget:this.lastOverTarget.parent();do{var d=c.hasClass("dw-drop");c.removeClass("dw-drop-over");c=c.parent()}while(_.isBoolean(d)&&!d)}b.proxy.data("dw$dropTargetData",b.allowed?b.context:null);b.proxy.toggleClass("dw-drop-yes",b.allowed);b.proxy.toggleClass("dw-drop-no",!b.allowed);this.dropElement.addClass("dw-drop-over");if(b.target){b.target.toggleClass("dw-target-over",b.allowed);var e=b.target.hasClass("dw-drop-over")?b.target:b.target.parent();do{var f=e.hasClass("dw-drop");e.toggleClass("dw-drop-over",b.allowed);e=e.parent()}while(_.isBoolean(f)&&!f)}this.lastOverTarget=b.allowed?b.target:null},onDragLeave:function(a){var b=this.getDropInfo(a);b.proxy.data("dw$dropTargetData",null);this.onDropTargetEnd(b)},onDrop:j.inject("$rootScope",function(a,b){var c=this,d=this.getDropInfo(b);this.onDropTargetEnd(d);d.allowed&&a.$apply(function(){return c.target.drop(d.proxy.data("dw$dragSourceData")||{},d.proxy.data("dw$dropTargetData")||{},b)})}),onDropTargetEnd:function(a){a.proxy.removeClass("dw-drop-yes");a.proxy.addClass("dw-drop-no");this.dropElement&&this.dropElement.removeClass("dw-drop-over");a.target&&a.target.removeClass("dw-target-over");this.lastOverTarget&&this.lastOverTarget.removeClass("dw-target-over");this.lastOverTarget=null},destroyDropzone:function(){this.dropzone&&b.isSet(this.dropzone._element)&&this.dropzone.unset();this.dropzone=null},destroy:function(){this.destroyDropzone();this.delegate=null;this.target=null;this.dropElement=null;this.lastOverTarget=null;this.callParent()}});i.buist.directive("dwDropTarget",["$timeout",function(a){return{restrict:"A",scope:!0,priority:100,controller:["$scope","$element","$attrs",j.internal.directives.DropTarget],link:function(b,c,d,e){a(function(){e.link()},0,!1)}}}])});j.invoke("Preconditions","Configuration","Keys",function(a,b,c){function d(a,b){var c=_.uniqueId("dwCollection"),d=_.isUndefined(b.name)?c:i.encodeAttr(b.name);return'\t\t\t<div id="'+c+'" class="dw-collection">\t\t\t\t<span ng-if="!dw$collection || dw$collection.length === 0" class="dw-placeholder" ng-click="dw$Edit()">{{ dwPlaceholder }}</span>\t\t\t\t<ul class="dw-collection-list">\t\t\t\t\t<li class="dw-collection-item dw-collection-drag dw-collection-drop" dw-drag-source="collectionDrag" dw-drop-target="collectionDrop" data-index="{{$index}}" ng-controller="dwCollectionItemCtrl" ng-repeat="value in dw$collection | limitTo : dwMaxDisplay track by $index">\t\t\t\t\t\t<span data-index="{{$index}}" ng-if="dwSortable && dwEditable && dwEnabled && dw$collection.length > 1" class="dw-collection-item-order dw-glyph-th dw-glyph-rotate-90"></span>\t\t\t\t\t\t<span class="dw-collection-item-value" ng-bind-html="dw$format(value) | SafeHtml" dw-tooltip></span>\t\t\t\t\t\t<button ng-if="dwEditable" ng-click="dw$onDelete($index)" ng-disabled="!dwEnabled" class="dw-collection-item-close dw-button dw-button-clear dw-icon-close"></button>\t\t\t\t\t\t<dw:drag dw-selector=".dw-collection-drag" dw-target=".dw-collection-drag" dw-drag-type="move" >\t\t\t\t\t\t\t<span class="dw-collection-item-value" ng-bind-html="dw$format(value) | SafeHtml"></span>\t\t\t\t\t\t</dw:drag>\t\t\t\t\t</li>\t\t\t\t\t<button ng-if="dw$collection.length > dwMaxDisplay" class="dw-button dw-button-link dw-button-more" ng-click="dw$Edit()"><span class="dw-icon dw-glyph-ellipsis" role="img">...</span></button>\t\t\t\t\t<button ng-if="dwEditable" ng-disabled="!dwEnabled" class="dw-button dw-button-primary dw-button-edit" ng-click="dw$Edit()">{{ dwLabelEdit }}</button>\t\t\t\t</ul>\t\t\t\t<input type="hidden" ng-model="'+i.encodeAttr(b.dwModel)+'" name="'+d+'" />\t\t\t</div>'}function e(a){function b(){var b=[];return _.transform(a.$attr,function(c,d,e){if(!_.includes(b,e)||/^dwEditor/.test(e)){b.push(e);c.push(d.replace(/-editor/,"")+'="'+i.encodeAttr(a[e])+'"')}},[]).join(" ")}return'\t\t\t<div class="dw-collection-editor-modal">\t\t\t\t<div class="dw-modal" role="dialog" dw-key="dw$onBlur($event)" dw-blur="dw$onBlur($event)">\t\t\t\t\t<div class="dw-modal-header">\t\t\t\t\t\t<span class="dw-modal-close dw-glyph-close" ng-click="dw$onCancel()"></span>\t\t\t\t\t\t<h3 class="dw-text-heading-medium">{{ dwLabelTitle }}</h3>\t\t\t\t\t</div>\t\t\t\t\t<div class="dw-modal-body">\t\t\t\t\t\t<form name="dwCollectionEditorForm" dw-validate="dw$collectionEditorValidator" novalidate dw-default-focus>\t\t\t\t\t\t\t<dw:collection-editor '+b()+'></dw:collection-editor>\t\t\t\t\t\t</form>\t\t\t\t\t</div>\t\t\t\t\t<div class="dw-modal-footer">\t\t\t\t\t\t<button class="dw-button dw-button-cancel" ng-click="dw$onCancel()">{{ dwLabelCancel }}</button>\t\t\t\t\t\t<button ng-if="dwEditable" ng-disabled="!dw$canSave()" class="dw-button dw-button-primary dw-button-save" ng-click="dw$onSave()">{{ dwLabelSave }}</button>\t\t\t\t\t</div>\t\t\t\t</div>\t\t\t\t<div class="dw-collection-editor-mask"></div>\t\t\t</div>'}function f(a){if(!_.isUndefined(this.attrs.dwSaytSource))return a[0].querySelector('.dw-collection-editor-new-value .dw-typeahead .dw-search > input[type="text"]');return a[0].querySelector(".dw-collection-editor-new-value input.dw-text-field")}function g(a){return a[0].querySelector('.dw-collection > input[type="hidden"]')}function h(a){return a[0].querySelector(".dw-collection-editor-new-value .dw-typeahead .dw-search-suggest")}function k(){var a=j.invoke("$timeout",_.identity);this.invalidateEventTimeout&&a.cancel(this.invalidateEventTimeout);this.invalidateEventTimeout=a(function(){this.scope&&this.scope.$emit(i.events.invalidate)}.bind(this),0,!1)}function l(a,b,c){this.scope=a;this.element=b;this.attrs=c;var d=b.inheritedData("dw$collectionId");a.collectionDrag=new j.internal.dwCollectionDragSource(d,this);a.collectionDrop=new j.internal.dwCollectionDropTarget(d,this)}var m=function(a){return i.toStringFormat(a)};m.parse=i.identityFormat.parse;j.define(i.type("directives.dwCollection"),{extend:i.type("directives.Directive"),constructor:function(d,g,h){a.checkString(h.dwModel,"dw-model",1);this.callParent([d,g,h]);this.accessor=j.invoke("$parse",function(a){return a(h.dwModel)});a.checkArgument(_.isFunction(this.accessor.assign),"Not an assignable expression: "+h.dwModel);this.ensureId("dw-collection-");this.setFormat(m);this.linkBooleanExpression("dwEnabled",!0);this.linkBooleanExpression("dwEditable",!0);this.linkBooleanExpression("dwVisible",!0);this.linkBooleanExpression("dwSortable",!0);this.linkNumberExpression("dwMaxDisplay",25,function(a){return!_.isNumber(a)||a<=0?25:a});this.linkFormatExpression("dwFormat");this.linkStringExpression("dwLabelEdit",b["i18n.collection.label.edit"]);this.linkStringExpression("dwLabelTitle",b["i18n.collection.label.title"]);this.linkStringExpression("dwLabelAdd",b["i18n.collection.label.add"]);this.linkStringExpression("dwLabelSave",b["i18n.collection.label.save"]);this.linkStringExpression("dwLabelCancel",b["i18n.collection.label.cancel"]);this.linkStringExpression("dwPlaceholder");this.linkModelProcessor("dwModelProcessor");this.linkEventHandler("onDelete","dw$onDelete");this.linkEventHandler("edit","dw$Edit");this.linkEventHandler("onSave","dw$onSave");this.linkEventHandler("onCancel","dw$onCancel");this.enclosingScope.$watch(h.dwModel,this.onModelChange.bind(this));d.$watchCollection("dw$collection",function(a,b){_.isEqual(a,b)||this.onModelUpdate(a)}.bind(this));g.data("dw$collection",this);g.data("dw$collectionId",g.attr("id"));g.addClass("dw-validate-input");var i=this;this.collectionEditor=j.interaction({scope:d.$new(),controller:["$scope","$element","$timeout",function(a,b,d){function e(a){function b(){return angular.element(a.target).hasClass("dw-collection-item-close")}function c(){return angular.element(a.target).parent().hasClass("dw-result")}if(!i.scope||"click"===a.type&&(b()||c()))return;i.onCancel()}i.editorInteractionScope=a;i.editorInteractionEl=b;i.accessor.assign(a,_.cloneDeep(i.accessor(i.enclosingScope)));d(function(){a.dw$onBlur=e.bind(i);var d=f.call(i,b),g=function(){i.scope&&i.scope.$apply(i.onSave.bind(i))},h=new j.KeyBinding(j.KeyBinding.ENTER,g),k=new j.KeyBinding(j.KeyBinding.ENTER,g);c.add(h,d);c.add(h,b[0]);i.deregisterEnter=function(){c.remove(h,d);c.remove(k,b[0])}},0,!1)}.bind(i)],defaults:{template:e(h)}});d.dw$canSave=this.canSave.bind(this)},link:function(a){a&&(this.scope.dw$collectionEditorValidator=a.get());var b=g(this.element),c=angular.element(b);this.ngModelCtrl=c.controller("ngModel");this.linkInputStateHandler(this.ngModelCtrl)},edit:function(){this.collectionEditor()},onCancel:function(){this.deregisterEnter&&this.deregisterEnter();this.deregisterEnter=null;this.editorInteractionScope&&this.editorInteractionScope.$destroy();this.editorInteractionScope=null;this.editorInteractionEl=null},canSave:function(){var a=this.editorInteractionScope,b=_.get(a,"$$childHead"),c=this.editorInteractionEl,d=!!c&&h(c),e=!!_.isElement(d)&&!angular.element(d).hasClass("ng-hide");return a&&!e&&_.get(a,"dwEnabled")&&_.get(a,"dwCollectionEditorForm.$valid")&&_.get(b,"dw$addEnabled")&&_.isUndefinedOrNull(_.get(b,"dw$newvalue"))},onSave:function(){if(!this.scope||!this.canSave())return;var a=this.accessor(this.editorInteractionScope);this.accessor.assign(this.enclosingScope,a);k.call(this);this.onCancel()},setFormat:function(b){a.checkFunction(b,"format");this.scope.dw$format=b},getCollection:function(){return this.scope.dw$collection||[]},onModelChange:function(a){this.runModelProcessor(a,"pre","dw$change").then(function(a){if(!this.scope)return;this.scope.dw$collection=a}.bind(this))},onModelUpdate:function(a){this.runModelProcessor(a,"post","dw$change").then(function(b){if(!this.scope)return;this.scope.dw$collection=a;this.accessor.assign(this.enclosingScope,b);k.call(this)}.bind(this))},onDelete:function(a){if(!this.scope.dwEnabled)return;this.ngModelCtrl.$setDirty();this.ngModelCtrl.$setTouched();var b=this.getCollection().slice(),c=b.splice(a,1);this.runModelProcessor(b,"post","dw$remove",_.first(c)).then(function(a){this.scope.dw$collection=b;this.accessor.assign(this.enclosingScope,a);k.call(this)}.bind(this))},destroy:function(){this.deregisterEnter&&this.deregisterEnter();this.deregisterEnter=null;this.editorInteractionScope&&this.editorInteractionScope.$destroy();this.editorInteractionScope=null;this.editorInteractionEl=null;this.accessor=null;this.collectionEditor=null;this.ngModelCtrl=null;this.callParent()}});i.buist.directive("dwCollection",function(){return{restrict:"E",replace:!1,require:["dwCollection","^?dwValidate"],transclude:!1,scope:!0,controller:["$scope","$element","$attrs",j.internal.directives.dwCollection],template:d,link:function(a,b,c,d){d[0].link(d[1])}}});l.$inject=["$scope","$element","$attrs"]
;i.buist.controller("dwCollectionItemCtrl",l);j.define(i.type("dwCollectionDragSource"),{extend:"dw$.DragSource",constructor:function(a,b){this.callParent([a]);this.collectionCtrl=b.element.inheritedData("dw$collection")},member:{allowed:function(){var a=_.get(this,"collectionCtrl.scope",{}),b=this.collectionCtrl.getCollection.call(this.collectionCtrl);return a.dwSortable&&a.dwEditable&&a.dwEnabled&&_.size(b)>1}}});j.define(i.type("dwCollectionDropTarget"),{extend:"dw$.DropTarget",constructor:function(a,b){this.callParent([a]);this.collectionCtrl=b.element.inheritedData("dw$collection")},member:{allowed:function(a,b,c){var d=_.get(this,"collectionCtrl.scope",{});if(!d.dwSortable||!d.dwEditable||!d.dwEnabled)return!1;if(c.target){var e=angular.element(c.target),f=this.getDropLocation(e,c);e.removeClass("after");e.removeClass("before");e.addClass(f)}return!0},getDropLocation:function(a,b){var c=b.interaction.curCoords.client,d=a[0].getBoundingClientRect(),e=(d.left+d.right)/2;if(c.x>e)return"after";return"before"},drop:function(a,b,c){var d=angular.element(c.target),e=this.getDropLocation(d,c),f=parseInt(a.index,10),g=parseInt(d.attr("data-index"),10),h="after"===e?++g:g,i=this.collectionCtrl.getCollection.call(this.collectionCtrl);if(f>h){var j=i.splice(f,1);i.splice(h,0,j[0])}else if(f<h){i.splice(h,0,i[f]);i.splice(f,1)}}}})});j.invoke("Preconditions","Configuration","Keys","ObjectUtils",function(a,b,c,d){function e(a,b){function c(){var a=' name="'+f+'" dw-model="dw$newvalue" dw-enabled="dwEnabled && dw$addEnabled" dw-placeholder-text="dwPlaceholder"';if(!_.isUndefined(b.dwSaytSource))return'<dw:typeahead dw-source="'+i.encodeAttr(b.dwSaytSource)+'"'+d(a)+"></dw:typeahead>";return'<dw:text-field dw-format-function="dw$collectionEditorFormat"'+a+"></dw:text-field>"}function d(a){var c=[];return _.transform(b.$attr,function(a,d,e){if(!_.includes(c,e)&&!_.includes(["dwSaytSource","dwSaytModel","dwSaytEnabled","dwSaytPlaceholder","dwSaytPlaceholderText"],e)&&/^dwSayt/.test(e)){c.push(e);a.push(d.replace(/-sayt/,"")+'="'+i.encodeAttr(b[e])+'"')}},[a]).join(" ")}var e=_.uniqueId("dwCollectionEditor"),f=_.uniqueId("dwCollectionEditorNewValueField"),g=_.isUndefined(b.name)?e:i.encodeAttr(b.name);return'\t\t\t<div id="'+e+'" class="dw-collection-editor" ng-class="{\'dw-disabled\': !dwEnabled}">\t\t\t\t<div ng-show="dwEditable" class="dw-collection-editor-new-value">\t\t\t\t\t'+c()+'\t\t\t\t\t<button class="dw-button" ng-disabled="!dwEnabled || !dw$addValid || !dw$addEnabled" ng-click="dw$onAdd()">{{dwLabelAdd}}</button>\t\t\t\t\t<dw:valid-indicator name="'+f+'" dw-count="1"></dw:valid-indicator>\t\t\t\t</div>\t\t\t\t<div class="dw-collection-editor-values">\t\t\t\t\t<ul class="dw-collection-list is-stacked">\t\t\t\t\t\t<li class="dw-collection-item dw-collection-drag dw-collection-drop" dw-drag-source="collectionDrag" dw-drop-target="collectionDrop" data-index="{{$index}}" ng-controller="dwCollectionEditorItemCtrl" ng-repeat="value in dw$collection track by $index">\t\t\t\t\t\t\t<span data-index="{{$index}}" ng-if="dwSortable && dwEditable && dwEnabled && dw$collection.length > 1" class="dw-collection-item-order dw-glyph-th dw-glyph-rotate-90"></span>\t\t\t\t\t\t\t<dw:text-field ng-attr-name="{{\''+e+'\' + $index}}" dw-enabled="dwEnabled && dwEditable" dw-format-function="dw$collectionEditorFormat" dw-model="dw$collection[$index]"></dw:text-field>\t\t\t\t\t\t\t<button class="dw-button dw-button-clear dw-collection-item-close dw-icon-close" ng-if="dwEditable" ng-click="dw$onDelete($index)" ng-disabled="!dwEnabled"></button>\t\t\t\t\t\t\t<dw:valid-indicator ng-attr-name="{{\''+e+'\' + $index}}" dw-count="1"></dw:valid-indicator>\t\t\t\t\t\t\t<dw:drag dw-selector=".dw-collection-drag" dw-target=".dw-collection-drag" dw-drag-type="move">\t\t\t\t\t\t\t\t<span class="dw-collection-item-value" ng-bind-html="dw$collectionEditorFormat(value) | SafeHtml"></span>\t\t\t\t\t\t\t</dw:drag>\t\t\t\t\t\t</li>\t\t\t\t\t</ul>\t\t\t\t</div>\t\t\t\t<input type="hidden" ng-model="'+i.encodeAttr(b.dwModel)+'" name="'+g+'" />\t\t\t</div>'}function f(){if(!_.isUndefined(this.attrs.dwSaytSource))return this.element[0].querySelector('.dw-collection-editor-new-value .dw-typeahead .dw-search > input[type="text"]');return g.call(this)}function g(){if(!_.isUndefined(this.attrs.dwSaytSource))return this.element[0].querySelector('.dw-collection-editor-new-value .dw-typeahead > input[type="hidden"]');return this.element[0].querySelector(".dw-collection-editor-new-value input.dw-text-field")}function h(){return this.element[0].querySelector('.dw-collection-editor > input[type="hidden"]')}function k(a,b){return a[0].querySelector(".dw-collection-editor-values li.dw-collection-item:nth-of-type("+(b+1)+") input.dw-text-field")}function l(a){var b=j.invoke("$timeout",_.identity);this.invalidateEventTimeout&&b.cancel(this.invalidateEventTimeout);this.invalidateEventTimeout=b(function(){this.scope&&this.scope.$emit(i.events.invalidate);this.element&&!0===a&&f.call(this).focus()}.bind(this),0,!1)}function m(){if(_.isUndefined(this.scope.dw$newvalue))return;if(!_.isUndefined(this.attrs.dwSaytSource)){var a=angular.element(this.element[0].querySelector(".dw-collection-editor-new-value .dw-typeahead")),b=a.controller("dwTypeahead");return this.scope.dw$collectionEditorFormat(b.format(this.scope.dw$newvalue))}return this.scope.dw$newvalue}function n(a,b,c){this.scope=a;this.element=b;this.attrs=c;var d=b.inheritedData("dw$collectionEditorId");a.collectionDrag=new j.internal.dwCollectionEditorDragSource(d,this);a.collectionDrop=new j.internal.dwCollectionEditorDropTarget(d,this)}var o=function(a){return i.toStringFormat(a)};o.parse=i.identityFormat.parse;j.define(i.type("directives.dwCollectionEditor"),{extend:i.type("directives.ElementDirective"),constructor:function(c,d,e){a.checkString(e.dwModel,"dw-model",1);this.callParent([c,d,e]);this.accessor=j.invoke("$parse",function(a){return a(e.dwModel)});a.checkArgument(_.isFunction(this.accessor.assign),"Not an assignable expression: "+e.dwModel);this.ensureId("dw-collection-editor-");this.setFormat(o);this.linkBooleanExpression("dwEnabled",!0);this.linkBooleanExpression("dwEditable",!0);this.linkBooleanExpression("dwSortable",!0);this.linkFormatExpression("dwFormat");this.linkStringExpression("dwLabelAdd",b["i18n.collection.label.add"]);this.linkStringExpression("dwPlaceholder"," ");this.linkModelProcessor("dwModelProcessor");this.linkEventHandler("onDelete","dw$onDelete");this.linkEventHandler("onAdd","dw$onAdd");c.dw$addEnabled=!0;c.dw$addValid=!1;c.$watch("dw$newvalue",this.onNewValueChange.bind(this));this.enclosingScope.$watch(e.dwModel,this.onModelChange.bind(this));c.$watchCollection("dw$collection",function(a,b){_.isEqual(a,b)||this.onModelUpdate(a)}.bind(this));d.addClass("dw-validate-input");d.data("dw$collectionEditor",this);d.data("dw$collectionEditorId",d.attr("id"))},link:function(a,b){this.formCtrl=a;this.validateCtrl=b;var d=f.call(this),e=g.call(this),i=h.call(this),k=angular.element(e),l=angular.element(i),m=k.controller("ngModel"),n=l.controller("ngModel");d.focus();this.newValueNgModelCtrl=m;this.ngModelCtrl=n;this.scope.modelCtrl=this.ngModelCtrl;var o=new j.KeyBinding(j.KeyBinding.ENTER,j.inject("$timeout",function(a){a(this.onEnter.bind(this))}).bind(this));c.add(o,d);this.deregisterEnter=function(){c.remove(o,d)};this.linkInputStateHandler(this.ngModelCtrl);this.scope.$watch(function(){return m.$touched},function(a){a?n.$setTouched():n.$setUntouched()});this.scope.$watch(function(){return m.$viewValue},function(){n.$setValidity("parse",!m.$error||!m.$error.parse)});this.scope.$watch(function(){return _.get(this,'formCtrl["'+n.$name+'"].dw$error')}.bind(this),this.reflectValidationErrors.bind(this),!0)},setFormat:function(b){a.checkFunction(b,"format");this.scope.dw$collectionEditorFormat=b},getCollection:function(){return this.scope.dw$collection||[]},validateNewValue:function(){function a(){return!_.isUndefinedOrNull(_.get(b,"dw$newvalue"))}var b=this.scope,c=m.call(this),d=this.getCollection(),e=_.isUndefined(c)?_.cloneDeep(d):d.concat(c);b.dw$addValid=!1;this.runModelProcessor(e,"post","dw$validate",c).then(function(c){function d(a){if(1!==_.size(a)||"dw$array"!==a[0].type||!_.includes(["dw$array.min","dw$array.range","dw$array.length"],a[0].reason))return!1;var b=_.get(a[0],"args.max",i.MAX_INT);return _.size(e)<=b}var f=this.validateCtrl?this.validateCtrl.get(this.attrs.dwModel):null;if(!f){b.dw$addValid=a();this.clearValidationErrors();return}f.validate(c).then(function(){b.dw$addValid=a();this.clearValidationErrors()}.bind(this)).catch(function(c){if(d(c)){b.dw$addValid=a();this.clearValidationErrors()}else{b.dw$addValid=!1;this.createValidationErrors(c)}}.bind(this))}.bind(this),function(){b.dw$addValid=a();b.dw$addEnabled=!0})},onNewValueChange:function(){this.validateNewValue()},onModelChange:function(a){this.runModelProcessor(a,"pre","dw$change").then(function(a){if(!this.scope)return;this.scope.dw$collection=a}.bind(this))},onModelUpdate:function(a){this.runModelProcessor(a,"post","dw$change").then(function(b){if(!this.scope)return;var c=this.validateCtrl?this.validateCtrl.get(this.attrs.dwModel):null;if(!c){this.clearValidationErrors();this.scope.dw$collection=a;this.accessor.assign(this.enclosingScope,b);l.call(this);return}c.validate(b).then(function(){this.clearValidationErrors();this.scope.dw$collection=a;this.accessor.assign(this.enclosingScope,b);l.call(this)}.bind(this)).catch(this.createValidationErrors.bind(this))}.bind(this))},onAdd:function(){if(!(this.scope&&this.scope.dwEnabled&&this.scope.dw$addValid&&this.scope.dw$addEnabled))return;var a=m.call(this),b=this.getCollection().concat([a]);this.setEnabled(!1);this.runModelProcessor(b,"post","dw$add",a).then(function(a){if(!this.scope)return;this.scope.dw$collection=b;this.accessor.assign(this.enclosingScope,a);this.ngModelCtrl.$setDirty();this.ngModelCtrl.$setTouched();delete this.scope.dw$newvalue;l.call(this,!0)}.bind(this)).finally(function(){this.setEnabled(!0)}.bind(this))},onEnter:function(){this.onAdd()},onDelete:function(a){if(!this.scope.dwEnabled)return;this.ngModelCtrl.$setDirty();this.ngModelCtrl.$setTouched();var b=this.getCollection().slice(),c=b.splice(a,1);this.runModelProcessor(b,"post","dw$remove",_.first(c)).then(function(a){if(!this.scope)return;this.scope.dw$collection=b;this.accessor.assign(this.enclosingScope,a);this.validateNewValue();l.call(this,!0)}.bind(this))},createValidationErrors:function(a){this.clearValidationErrors();var b=angular.element(h.call(this)),c=b.controller("ngModel");c.$setDirty();c.$setTouched();this.scope.dw$validatorerrors=_.map(a,function(a){c.$setValidity(a.type,!1);d.set(c,'dw$error["'+a.type+'"]',a);return a})},clearValidationErrors:function(){this.scope.dw$addEnabled=!0;var a=angular.element(h.call(this)),b=a.controller("ngModel");_.forEach(this.scope.dw$validatorerrors,function(a){b.dw$error&&delete b.dw$error[a.type];b.$setValidity(a.type,!0)});this.scope.dw$validatorerrors=null},reflectValidationErrors:function(a,b){function c(a){var b=a.property||"";var c=b.match(g);c&&(b=c[1]);if(/^\d+$/.test(b)){var d=parseInt(b,10),h=k(e,d);if(h)return angular.element(h).controller("ngModel")}return f}var e=this.element,f=this.newValueNgModelCtrl,g=/\[(\d+)]$/,h=!1;_.forEach(b,function(a){var b=c(a);b.dw$error&&delete b.dw$error[a.type];b.$setValidity(a.type,!0)});_.forEach(a,function(a){var b=c(a);b.$setDirty();b.$setTouched();b.$setValidity(a.type,!1);d.set(b,'dw$error["'+a.type+'"]',a);b!==f&&(h=!0)});h&&(this.scope.dw$addValid=this.scope.dw$addEnabled=!1)},destroy:function(){this.deregisterEnter&&this.deregisterEnter();this.deregisterEnter=null;this.accessor=null;this.newValueNgModelCtrl=null;this.ngModelCtrl=null;this.formCtrl=null;this.validateCtrl=null;this.callParent()}});i.buist.directive("dwCollectionEditor",function(){return{restrict:"E",replace:!1,require:["dwCollectionEditor","^form","?^dwValidate"],transclude:!1,scope:!0,controller:["$scope","$element","$attrs",j.internal.directives.dwCollectionEditor],template:e,link:function(a,b,c,d){d[0].link(d[1],d[2])}}});n.$inject=["$scope","$element","$attrs"];i.buist.controller("dwCollectionEditorItemCtrl",n);j.define(i.type("dwCollectionEditorDragSource"),{extend:"dw$.DragSource",constructor:function(a,b){this.callParent([a]);this.editorCtrl=b.element.inheritedData("dw$collectionEditor")},member:{allowed:function(){var a=_.get(this,"editorCtrl.scope",{}),b=this.editorCtrl.getCollection.call(this.editorCtrl);return a.dwSortable&&a.dwEditable&&a.dwEnabled&&_.size(b)>1}}});j.define(i.type("dwCollectionEditorDropTarget"),{extend:"dw$.DropTarget",constructor:function(a,b){this.callParent([a]);this.editorCtrl=b.element.inheritedData("dw$collectionEditor")},member:{getDropLocation:function(a,b){var c=_.get(b,"interaction.curCoords.client"),d=a[0].getBoundingClientRect(),e=(d.top+d.bottom)/2;if(c.y>e)return"after";return"before"},allowed:function(a,b,c){var d=_.get(this,"editorCtrl.scope",{});if(!d.dwSortable||!d.dwEditable||!d.dwEnabled)return!1;if(c.target){var e=angular.element(c.target),f=this.getDropLocation(e,c);e.removeClass("after");e.removeClass("before");e.addClass(f)}return!0},drop:function(a,b,c){var d=angular.element(c.target),e=this.getDropLocation(d,c),f=parseInt(a.index,10),g=parseInt(d.attr("data-index"),10),h="after"===e?++g:g,i=this.editorCtrl.getCollection.call(this.editorCtrl);if(f>h){var j=i.splice(f,1);i.splice(h,0,j[0])}else if(f<h){i.splice(h,0,i[f]);i.splice(f,1)}}}})});j.invoke("Preconditions","Configuration",function(a,b){function c(a){function b(a,b){for(;a&&a.nodeName.toLowerCase()!==b;)a=a.parentNode;return a}var c=b(a.target,"tr");if(!c)return-1;var d=b(a.target,"td");return _.findIndex(c.children,function(a){return a===d})}function d(a,b,c){if(!c.element)return{};var d={},e=_.findIndex(b.children(),function(b){return i.element.contains(b,a)});-1!==e&&(d.column=e);var f=b.attr("data-dw-row");if(f){d.row=parseFloat(f);d.model=c.store.data[d.row];d.model&&_.isNumber(d.column)&&c.columns[d.column].data.model&&j.invoke("$parse",function(a){d.value=a(c.columns[d.column].data.model)(d.model)})}return d}function e(a){this.$id=a.scope.$id;this.setConsumer=function(b){b.setElement(angular.element(a.element[0].querySelector("table")));b.getController().setDelegate(new i.GridDragDelegate(a))}}function f(a){this.$id=a.scope.$id;this.setConsumer=function(b){b.setElement(angular.element(a.element[0].querySelector("table")));b.getController().setDelegate(new i.GridDropDelegate(a))}}i.config["i18n.placeholder.loading"]="Loading...";var g="dwUndefGridColumnGroup",h=i.config["grid.config.default.page.size"]||25;i.GridDragDelegate=function(a){function b(a){var b,c=a.parent().parent(),d=c[0].getBoundingClientRect().width,e=c[0].querySelector("colgroup"),f=angular.element('<div class="dw-grid" style="width:'+d+'px"></div>'),g=angular.element("<table></table>");f.append(g);b=angular.element("<tbody></tbody>");g.append(angular.element(e).clone());g.append(b);b.append(angular.element(a).clone());return f}function c(a){var b=a[0].getBoundingClientRect().width,c=a[0].getBoundingClientRect().height,d=angular.element('<div class="dw-grid dw-col-drag" style="width:'+b+'px"><table><thead><tr class="dw-header-row"></tr></thead><tbody><tr><td style="height='+c+'px" ></td></tr><tr><td  style="height='+c+'px" ></td></tr></tbody></table></div>');angular.element(d[0].querySelector("thead tr")).append(angular.element(a).clone());return d}this.ghostType=a.attrs.dwGhostType;this.context=function(b){var c=b.hasClass("dw-row")?b:i.element.parent(b,"dw-row");return c?d(b,angular.element(c),a):{}};switch(this.ghostType){case"column":this.proxy=c;this.targetSelectors=[".dw-grid-header"];break;case"target":this.targetSelectors=[".dw-grid-column"];break;default:this.proxy=b;this.targetSelectors=[".dw-row"]}};i.GridDragDelegate.prototype=new i.BaseDragDelegate;i.GridDropDelegate=function(a){this.ghostType=a.attrs.dwGhostType;switch(this.ghostType){case"column":this.targetSelectors=[".dw-grid-header",".dw-header-row"];break;case"target":this.targetSelectors=[".dw-grid-column",".dw-row"];break;default:this.targetSelectors=[".dw-row",".dw-header-row"]}this.context=function(b){var c=(b.hasClass("dw-row")?b:i.element.parent(b,"dw-row"))||(b.hasClass("dw-header-row")?b:i.element.parent(b,"dw-header-row"));return c?d(b,angular.element(c),a):{}}};i.GridDropDelegate.prototype=new i.BaseDropDelegate;j.define(i.type("directives.Grid"),{extend:i.type("directives.ElementDirective"),constructor:function(a,b,c){this.callParent([a,b,c]);var d='<tr ng-repeat="dw$row in dw$data" class="dw-row" dw-grid-row-first-class ng-class-odd="\'dw-odd\'"';_.isUndefinedOrNull(c.dwClickHandler)||(d+=' ng-click="dw$click($event, dw$row, $index)"');_.isUndefinedOrNull(c.dwDoubleClickHandler)||(d+=' ng-dblclick="dw$dblclick($event, dw$row, $index)"');d+=' ng-attr-data-dw-row="{{$index}}"></tr>';this.ensureId("dw-grid-");this.scope.dw$data=[];this.scope.dw$selection={};this.scope.dw$recountSelection=angular.noop;this.scope.dw$render={};this.scope.dw$visible={};this.scope.hiddenColumnCount=0;this.scope.hiddenGroupColumnCount={};this.scope.dw$hash=function(a){return this.hash(a)}.bind(this);this.columns=[];this.searchModel=null;this.pageSize=h;this.template=angular.element(d);this.columnGroups=[];this.groups={};this.changes=[];this.extraFields=[];this.extraAsyncFields=[];this.wrappers=[];this.headerInteractables=[];this.setEditable(!1);this.linkReadyCallback("dwReady");this.linkVisible("dwVisible");this.linkPagingOptions();this.linkEditable();this.element.addClass("dw-grid dw-pinnable-container")},setSource:function(a){this.dataSource=a},getSource:function(){return this.dataSource},setSearchModel:function(a){this.searchModel=a},setEditable:function(b){a.checkBoolean(b,"editable");this.editable=b;this.element.toggleClass("dw-editable",b)},linkEditable:function(){_.isUndefined(this.attrs.dwEditable)||this.setEditable(this.parseBooleanAttribute("dwEditable"))},linkPagingOptions:function(){_.isUndefined(this.attrs.dwPagingOptions)||this.setPagingOptions(JSON.parse(this.attrs.dwPagingOptions))},setPagingOptions:function(b){a.checkArray(b,"options");this.pagingOptions=b},setExtraFields:function(b){a.checkArray(b,"extraFields");this.extraFields=b.slice()},setExtraAsyncFields:function(b){a.checkArray(b,"extraAsyncFields");this.extraAsyncFields=b.slice()},addColumnGroup:function(a){this.groups[a.name]=a;this.scope.hiddenGroupColumnCount[a.name]=0},addColumn:function(a){var b=this,c=angular.element('<td class="dw-grid-column"></td>');a.compile(c);var d=function(a){var c=_.last(b.columnGroups),d=c&&c.name;void 0===a.group&&(d&&0===d.indexOf(g)?a.group=d:a.group=_.uniqueId(g));c&&d===a.group?c.count++:b.columnGroups.push({name:a.group,count:1})};switch(a.type){case"action":a.controller&&c.attr("ng-controller",a.controller);d(a);this.columns.push({data:a});break;case"selection":if(_.isEmpty(this.dataSource.idFields()))throw new Error("Can't enable selection column because no datasource idField is provided.");d(a);this.columns.push({data:a});var e=_.map(this.dataSource.idFields(),function(a){return"dw$row."+a});angular.element(c.children()[0]).attr("dw-model","dw$selection["+e.join("+")+"].selected");break;case"rowTemplate":if(a.template){this.rowExpander=a;this.columns.unshift({data:a});var f=_.first(this.columnGroups);f&&f.name===a.group?f.count++:this.columnGroups.unshift({name:a.group,count:1})}a.class&&this.template.attr("ng-class",a.class);break;case"column":d(a);this.columns.push({data:a})}"rowTemplate"!==a.type?this.template.append(c):a.template&&this.template.prepend(c)},addRowWatchers:function(){if(!this.scope||!this.editable)return;this.rowUnwatchers=[];_.each(this.store.data,function(a){this.rowUnwatchers.push(this.scope.$watchCollection(function(){return a},function(b,c){b!==c&&(this.changes=_.union(this.changes,[a]))}.bind(this)))}.bind(this))},hash:function(a){var b="";_.each(this.dataSource.idFields(),function(c){b+=a[c]});return b},highlightSearchText:function(){function a(a,b){var c=a.nodeValue.replace(b,'<span class="dw-highlight">$1</span>');angular.element(a).replaceWith(c)}if(this.searchModel){var b=this.element[0].querySelectorAll(".dw-search-highlight .dw-grid-column-inner");_.each(b,function(a){_.each(a.querySelectorAll(".dw-highlight"),function(a){a.nextSibling&&3===a.nextSibling.nodeType?a.nextSibling.nodeValue=a.innerHTML+a.nextSibling.nodeValue:a.parentNode.insertBefore(document.createTextNode(a.innerHTML),a);a.parentNode.removeChild(a)})});if(!_.isBlank(this.searchModel.text)){var c=new RegExp("^("+_.escapeRegExp(this.searchModel.text)+")","i");_.each(b,function(b){1===b.childNodes.length&&3===b.childNodes[0].nodeType?a(b.childNodes[0],c):_.each(b.querySelectorAll(".dw-searched"),function(b){1===b.childNodes.length&&3===b.childNodes[0].nodeType&&a(b.childNodes[0],c)})})}}},addDragAndDrop:function(){_.isUndefined(this.attrs.dwDragSource)||(this.scope.dw$dragElementProducer=new e(this));_.isUndefined(this.attrs.dwDropTarget)||(this.scope.dw$dropElementProducer=new f(this))},addHeaderInteractions:function(){var a=this,b=angular.element(this.element[0].querySelector(".dw-header-row")),c=b.children();var d,e,f,g;_.each(_.initial(c),function(h,i){a.headerInteractables.push(interact(h).resizable({edges:{left:!1,right:!0,bottom:!1,top:!1},restrict:{restriction:a.element[0]}}).on("resizestart",function(b){d=Math.floor(h.getBoundingClientRect().width);e=Math.floor(c[i+1].getBoundingClientRect().width);f=b.clientX;g=angular.element('<div class="dw-resize-bar"></div>');angular.element(a.element[0].querySelector("th")).append(g);_.each(a.element[0].querySelectorAll("colgroup"),function(a){var b=angular.element(a.childNodes[i]),c=angular.element(a.childNodes[i+1]);b.css("width",d+"px");c.css("width",e+"px")})}).on("resizemove",function(c){var j=Math.floor(c.clientX-f),k=Math.floor(d+j),l=Math.floor(e-j);g.css("left",Math.floor(h.getBoundingClientRect().right-b[0].getBoundingClientRect().left)+"px");_.each(a.element[0].querySelectorAll("colgroup"),function(a){var b=angular.element(a.childNodes[i]),c=angular.element(a.childNodes[i+1]);b.css("width",k+"px");c.css("width",l+"px")})}).on("resizeend",function(){g.remove()}))})},onReady:function(){if(!_.isFunction(this.readyCallback))return;this.readyCallback({controller:j.create(i.apiType("Grid"),this)})},createStore:function(){var a=this;this.store=function(){var b=[],c=[];_.each(a.columns,function(a){a.data.addFields(b,c)});b=_.union(b,a.extraFields);c=_.union(c,a.extraAsyncFields);return j.create(i.type("widget.GridStore"),a.getSource(),a.scope,a.searchModel,parseInt(a.pageSize,10),b,c)}();this.store.on({beforeLoad:function(){a.onBeforeLoad()},load:function(){a.onLoad()},loadError:function(b){a.onLoadError(b)}})},onBeforeLoad:function(){this.toggleMask(!0);this.toggleLoading(!0);if(this.element){this.element.removeClass("dw-empty dw-error");var a=document.activeElement;a&&i.element.contains(this.element[0].querySelector("table"),a)&&a.blur()}this.pager&&this.pager.onBeforeLoad();this.transcludeScope&&this.updateTranscludeScope({loading:!0,count:null,total:null});this.destroyRowWatchers()},toggleLoading:j.inject("$timeout",function(a,b){function c(b){return a(function(){d.element&&d.element.addClass("dw-loading-"+b.toString())},b,0)}var d=this;this.destroyLoadingPromises();if(b){this.element&&this.element.addClass("dw-loading");this.loadingPromises=[];for(var e=250;e<=1e3;e+=250)this.loadingPromises.push(c(e))}else this.element&&this.element.removeClass("dw-loading dw-loading-250 dw-loading-500 dw-loading-750 dw-loading-1000")}),toggleMask:function(a){if(!this.element)return;a&&!this.maskInteraction?this.maskInteraction=this.mask():a||this.destroyMask()},onLoad:j.inject("$timeout",function(a){var b=this;_.isEmpty(this.onLoadCallbacks)||_.each(this.onLoadCallbacks,function(a){a(b.store.data)});this.toggleLoading(!1);this.toggleMask(!1);if(this.scope){this.scope.dw$data=this.store.data;_.each(this.store.data,function(a){var b=this.hash(a);this.scope.dw$selection[b]||(this.scope.dw$selection[b]={selected:!1});this.scope.dw$selection[b].item=a}.bind(this))}this.pager&&this.pager.onLoad({pageSize:this.pageSize,page:this.store.currentPage,pagingOptions:this.pagingOptions,pageCount:Math.ceil(this.store.getOverallCount()/this.store.pageSize),first:this.store.index+1,last:Math.min(this.store.index+this.store.pageSize,this.store.getOverallCount()),total:this.store.getOverallCount()});this.element&&this.element.toggleClass("dw-empty",0===this.store.getOverallCount());this.transcludeScope&&this.updateTranscludeScope({loading:!1,count:_.size(this.store.data),total:this.store.getOverallCount()});this.addRowWatchers();a(function(){b.highlightSearchText();if(b.scope){b.scope.dw$recountSelection();b.scope.$emit(i.events.invalidate)}})}),onLoadError:function(){this.onLoad();this.element&&this.element.addClass("dw-error")},updateTranscludeScope:function(a){this.transcludeScope&&_.assign(this.transcludeScope.dw$grid,a)},add:function(b){a.checkObject(b,"wrapper");this.wrappers.push(b)},load:function(){this.store.load()},setPager:function(a){this.pager=a},nextPage:function(){this.store.setCurrentPage(this.store.currentPage+1);this.store.load()},previousPage:function(){this.store.setCurrentPage(this.store.currentPage-1);this.store.load()},setPage:function(b){a.checkNumber(b,"page",1);this.store.setCurrentPage(b);this.store.load()},setPageSize:function(b){a.checkNumber(b,"pageSize",1,1e3);this.pageSize=b;this.store&&(this.store.pageSize=b)},setAutoLoad:function(a){this.autoLoad=a},setSort:function(a,b){this.scope.dw$sortModel=a;this.scope.dw$sortAsc=b;this.store.sort={field:a,asc:b};this.reset({})},setTranscludeScope:function(a){this.transcludeScope=a;this.transcludeScope&&(this.transcludeScope.dw$grid={loading:!1,count:0,totalCount:0})},updateColumnVisibility:function(a,b){var c=this.scope,d=angular.element(this.element[0].querySelector("col#"+a)),e=_.find(this.columns,function(b){return b.data.id===a});b?d.removeClass("ng-hide"):d.addClass("ng-hide");c.hiddenColumnCount=0;_.each(c.dw$visible,function(a){!a&&c.hiddenColumnCount++});var f=_.get(e,"data.group");if(f){c.hiddenGroupColumnCount[f]=0;_.each(this.columns,function(a){a.data.group!==f||c.dw$visible[a.data.id]||c.hiddenGroupColumnCount[f]++})}},reset:function(a){a.page&&this.store.setCurrentPage(1);a.pageSize&&this.setPageSize(h);a.selection&&this.scope.dw$resetSelection&&this.scope.dw$resetSelection();a.sort&&(this.store.sort=null);a.rows&&this.store.clear(!1===a.load);!1!==a.load&&this.store.load()},getColgroupTemplate:function(){var a=angular.element("<colgroup></colgroup>");_.each(this.columns,function(b){var c=_.get(b,"data.id"),d=_.get(b,"data.width"),e='<col id="'+c+'"',f=_.isFunction(b.data.isVisible)&&!b.data.isVisible();d&&(e+=' style="width:'+d+'"');f&&(e+='class="ng-hide" ');e+="></col>";a.append(e)});return a},getGroupedHeadersTemplate:function(){if(!_.isEmpty(this.groups)){var b=angular.element("<tr></tr>");_.each(this.columnGroups,function(c){a.checkArgument(0===c.name.indexOf(g)||_.isObject(this.groups[c.name]),"Unknown column group: "+c.name);var d=angular.element('<th ng-attr-colspan="{{ '+c.count+" - hiddenGroupColumnCount['"+c.name+"'] }}\"></th>");this.groups[c.name]&&this.groups[c.name].compile?this.groups[c.name].compile(d):d.addClass("dw-empty-group");b.append(d)}.bind(this));return b}return null},getBodyTemplate:function(){if(this.attrs.dwId)return angular.element('<tr class="dw-body-row"><td class="dw-body dw-transclude-position" ng-attr-colspan="{{ '+this.columns.length+' - hiddenColumnCount }}"></td></tr>');return null},getRowTemplate:function(a){var b=angular.element('<td class="dw-row-view" ng-attr-colspan="{{ '+this.columns.length+' - hiddenColumnCount }}"></td>');this.rowExpander.compileRow(b);var c=angular.element('<tr class="dw-expandedrow'+(a.hasClass("dw-odd")?" dw-odd":"")+'"></tr>');c.append(b);return c},destroyRowWatchers:function(){this.rowUnwatchers&&_.each(this.rowUnwatchers,function(a){a()});this.rowUnwatchers=null},destroyLoadingPromises:j.inject("$timeout",function(a){this.loadingPromises&&_.each(this.loadingPromises,function(b){a.cancel(b)});this.loadingPromises=null}),destroyMask:function(){this.maskInteraction&&this.maskInteraction.cancel();this.maskInteraction=null},destroyHeaderInteractables:function(){this.headerInteractables&&_.each(this.headerInteractables,function(a){a.unset()});this.headerInteractables=null},destroy:function(){this.destroyRowWatchers();this.destroyLoadingPromises();this.destroyMask();this.destroyHeaderInteractables();_.each(this.wrappers,function(a){a.destroy()});this.columns=null;this.searchModel=null;this.pageSize=null;this.template=null;this.columnGroups=null;this.groups=null;this.changes=null;this.extraFields=null;this.extraAsyncFields=null;this.rowExpander=null;this.wrappers=null;this.transcludeScope=null;this.onLoadCallbacks=null;this.callParent()}});i.buist.directive("dwGridRowFirstClass",function(){return{restrict:"A",require:"?^dwGrid",scope:!1,link:function(a,b,c,d){d&&0===a.$index&&b.addClass("dw-first")}}});i.buist.directive("dwGrid",["$compile","$parse",function(d,e){return{restrict:"E",replace:!1,transclude:!0,template:function(a,c){var d='<div class="dw-above dw-transclude-position dw-pinnable"></div>\t\t\t\t\t<div class="dw-grid-container">\t\t\t\t\t\t<div class="dw-head dw-pinnable">\t\t\t\t\t\t\t<div class="dw-grid-toolbar dw-tools dw-transclude-position left"></div>\t\t\t\t\t\t\t<div class="dw-grid-toolbar right">';d+='<div class="dw-grid-pager-left dw-transclude-position"></div>';"false"!==c.dwPaging&&(d+="<dw:pager></dw:pager>");d+='<div class="dw-grid-pager-right dw-transclude-position right"></div></div>';d+='<div class="dw-selection-count" ng-show="dwSelectionCountMessage"><span >{{ dwSelectionCountMessage }}</span></div>';d+='<div class="dw-grid-modifiers dw-transclude-position"></div>';return a.hasClass("slds-refresh-table")?d+'<div style="clear:both"></div></div>\t\t\t\t<table class="slds-table slds-table_bordered slds-table_cell-buffer">\t\t\t\t\t<thead class="dw-pinnable">\t\t\t\t\t\t<tr class="dw-header-row" ng-transclude></tr>\t\t\t\t\t</thead>\t\t\t\t\t<tbody></tbody>\t\t\t\t</table>\t\t\t\t<div class="dw-loading-message"><div class="dw-msg">'+j.safe(b["i18n.placeholder.loading"]||"")+'</div></div>\t\t\t\t<div class="dw-progress"><div class="dw-bar"></div></div>\t\t\t\t</div>':d+'<div style="clear:both"></div></div>\t\t\t\t\t<table>\t\t\t\t\t\t<thead class="dw-pinnable">\t\t\t\t\t\t\t<tr class="dw-header-row" ng-transclude></tr>\t\t\t\t\t\t</thead>\t\t\t\t\t\t<tbody></tbody>\t\t\t\t\t</table>\t\t\t\t\t<div class="dw-loading-message"><div class="dw-msg">'+j.safe(b["i18n.placeholder.loading"]||"")+'</div></div>\t\t\t\t\t<div class="dw-progress"><div class="dw-bar"></div></div>\t\t\t\t\t</div>'},controller:["$scope","$element","$attrs",j.internal.directives.Grid],scope:!0,link:function(b,f,g,h){a.checkArgument(_.isObject(h.dataSource),"Required: <dw:grid-data>");a.checkArgument(_.size(h.columns)>0,"Required: <dw:grid-column>");a.optional.checkString(g.dwGhostType,"dw-ghost-type");if(g.dwId){var i=new j.internal.directives.Transclude(b,f,g);f.data("$dwTranscludeController",i)}var k=f.controller("dwTransclude");k&&h.setTranscludeScope(k.transcludeScope);b.dw$toggleRow=function(a,b,c){b.preventDefault();var e=b.target||b.srcElement;for(;"td"!==e.tagName.toLowerCase();)e=angular.element(e).parent()[0];e=angular.element(e).parent();if(e.hasClass("dw-open")){e.next().remove();e.removeClass("dw-open")}else{e.addClass("dw-open");var f=d(h.getRowTemplate(e))(c);e.after(f[0])}};b.dw$sort=function(a){h.setSort(a,b.dw$sortModel!==a||!b.dw$sortAsc)};if(!_.isUndefinedOrNull(g.dwClickHandler)){var l=e(g.dwClickHandler);b.dw$click=function(b,d,e){var f=l(h.scope);a.checkFunction(f,g.$attr.dwClickHandler);f(d,e,c(b))}}if(!_.isUndefinedOrNull(g.dwDoubleClickHandler)){
var m=e(g.dwDoubleClickHandler);b.dw$dblclick=function(b,d,e){var f=m(h.scope);a.checkFunction(f,g.$attr.dwDoubleClickHandler);f(d,e,c(b))}}f.find("table").prepend(h.getColgroupTemplate());var n=h.getGroupedHeadersTemplate();n&&f.find("thead").prepend(d(n)(b));var o=f.find("tbody"),p=h.getBodyTemplate();p&&o.append(d(p)(b));o.append(d(h.template)(b));h.createStore();h.autoLoad&&h.load();h.addDragAndDrop();h.addHeaderInteractions();h.onReady()}}}]);var k=j.hide("Grid.gridCtrl");j.define(i.apiType("Grid"),{constructor:function(b){a.checkArgument(j.Class.getClassOf(b)===j.Class.getClass(i.type("directives.Grid")),"Not a grid controller: "+b);k.set(this,b);b.add(this);this.widget=b;this.callParent()},load:function(){var b=k.get(this);a.checkArgument(!!b,"Grid is destroyed");b.load()},onLoad:function(b){var c=k.get(this);a.checkArgument(!!c,"Grid is destroyed");_.isArray(c.onLoadCallbacks)||(c.onLoadCallbacks=[]);c.onLoadCallbacks.push(b)},reset:function(b){a.optional.checkObject(b,"config");b||(b={});a.optional.checkBoolean(b.page,"config.page");a.optional.checkBoolean(b.selection,"config.selection");a.optional.checkBoolean(b.sort,"config.sort");var c=k.get(this);a.checkArgument(!!c,"Grid is destroyed");_.defaults(b,{page:!0,pageSize:!0,selection:!0,sort:!0,rows:!1,load:!0});c.reset(b)},sort:function(b,c){a.checkString(b,"column",1);a.optional.checkBoolean(c,"ascending");var d=k.get(this);a.checkArgument(!!d,"Grid is destroyed");d.setSort(b,_.isBoolean(c)?c:!_.isBoolean(d.scope.dw$sortAsc)||d.scope.dw$sortAsc)},getSelection:function(){var b=k.get(this);a.checkArgument(!!b,"Grid is destroyed");return _.map(_.filter(b.scope.dw$selection,function(a){return a.selected}),"item")},getChanges:function(){var b=k.get(this);a.checkArgument(!!b,"Grid is destroyed");return b.changes.slice()},clearChanges:function(){var b=k.get(this);a.checkArgument(!!b,"Grid is destroyed");b.changes=[]},columnVisible:function(b,c){a.checkString(b,"column",1);var d=k.get(this);a.checkArgument(!!d,"Grid is destroyed");var e=_.find(d.columns,function(a){return a.data&&a.data.model===b});a.checkArgument(!_.isUndefinedOrNull(e),"Undefined: column for property "+b);if(1===arguments.length)return e.data.isVisible();e.data.setVisible(c)},destroy:function(){k.set(this,null)}})});j.invoke("Preconditions",function(){i.buist.directive("dwGridActions",["$compile",function(a){return{restrict:"E",replace:!1,require:["^dwGrid"],scope:!1,compile:function(b){var c=b.html();b.html("");return function(b,d,e,f){function g(){h.scope.dw$visible[j]=i;h.updateColumnVisibility(j,i)}var h=f[0],i=!0,j="dwGridAction";g();d.replaceWith(a('<th class="dw-grid-actions" ng-show="dw$visible[\''+j+'\']"><div class="dw-header-actions dw-transclude-position"></div></th>')(h.scope));var k=d.data("dw$permission"),l=function(a){i=a;g()};if(k)k.push(l);else{k=[l];d.data("dw$permission",k)}h.addColumn({controller:e.dwController,addFields:angular.noop,id:j,compile:function(a){a.attr("ng-show","dw$visible['"+j+"']");a.addClass("dw-grid-actions");a.append('<dw:menu-bar class="dw-single"><dw:menu class="dw-grid-actions-menu dw-glyphicon">'+c+"</dw:menu></dw:menu-bar>")},type:"action",width:"45px",isVisible:function(){return i}});c=null}}}}])});j.invoke("Preconditions",function(a){i.buist.directive("dwGridData",["$parse",function(b){return{restrict:"E",replace:!1,require:["^dwGrid"],scope:!1,link:function(c,d,e,f){a.checkArgument(b(e.dwSource)(c)instanceof j.DataSource,"Not a DataSource: "+(e.$attr.dwSource||"dw-source"));d.replaceWith("\x3c!-- dwGridData --\x3e");var g=f[0];g.setSource(b(e.dwSource)(c));g.setAutoLoad("false"!==e.dwAutoLoad);if(!_.isUndefinedOrNull(e.dwPageSize)){a.checkArgument(/^-?[0-9]+$/.test(e.dwPageSize),"Not a number: "+e.$attr.dwPageSize);a.checkNumber(parseFloat(e.dwPageSize),e.$attr.dwPageSize,1,1e3);g.setPageSize(parseFloat(e.dwPageSize))}if(!_.isUndefinedOrNull(e.dwExtraFields)){a.checkString(e.dwExtraFields,e.$attr.dwExtraFields,1);var h=_.invokeMap(e.dwExtraFields.split(","),function(){return this.trim()});g.setExtraFields(_.uniq(_.filter(h,function(a){return!!a})))}if(!_.isUndefinedOrNull(e.dwExtraAsyncFields)){a.checkString(e.dwExtraAsyncFields,e.$attr.dwExtraAsyncFields,1);var i=_.invokeMap(e.dwExtraAsyncFields.split(","),function(){return this.trim()});g.setExtraAsyncFields(_.uniq(_.filter(i,function(a){return!!a})))}if(!_.isUndefinedOrNull(e.dwSearchModel)){a.checkString(e.dwSearchModel,e.$attr.dwSearchModel,1);a.checkArgument(b(e.dwSearchModel)(c)instanceof j.SearchModel,"Not a SearchModel: "+e.$attr.dwSearchModel);g.setSearchModel(b(e.dwSearchModel)(c))}}}}])});j.invoke("Preconditions","Messages","Formats",function(a,b,c){i.buist.directive("dwGridColumn",["$compile","$parse","$sce",function(d,e,f){return{restrict:"E",require:["^dwGrid"],scope:!1,compile:function(g){var h=g.html();return{post:function(g,k,l,m){function n(){var a=u&&v;q.scope.dw$visible[r]=a;q.updateColumnVisibility(r,a)}var o,p,q=m[0],r=_.uniqueId("dw-gridcolumn-"),s=l.class,t=null,u=!0,v=!0,w=[];if(_.isUndefinedOrNull(l.dwVisibleExpression)){u="false"!==l.dwVisible;n()}else{o=e(l.dwVisibleExpression);u=o(q.enclosingScope);w.push(q.enclosingScope.$watch(l.dwVisibleExpression,function(a){u=a;n()}))}if(!_.isUndefinedOrNull(l.dwEnabled)){p=e(l.dwEnabled);v=p(q.enclosingScope);w.push(q.enclosingScope.$watch(l.dwEnabled,function(a){v=a;n()}))}var x="<th ng-show=\"dw$visible['"+r+"']\"";"false"!==l.dwSortable&&(x+=" ng-click=\"dw$sort('"+l.dwModel+"')\" ng-class=\"{'dw-sorted-asc': dw$sortModel == '"+l.dwModel+"' && dw$sortAsc, 'dw-sorted-desc': dw$sortModel == '"+l.dwModel+"' && !dw$sortAsc}\"");x+=' class="dw-grid-header';if("true"===l.dwEditable){a.checkArgument(q.editable,"Editable column requires editable grid");x+=" dw-editable"}s&&(x+=" "+s);x+='"><div><div class="dw-grid-column-inner"';_.isUndefinedOrNull(l.dwTooltip)&&(x+=" dw-tooltip ");if(_.isUndefinedOrNull(l.dwHeader)){a.checkArgument(!_.isUndefinedOrNull(l.dwHeaderText),"Undefined: dw-header or dw-header-text");x+='ng-bind-html="'+l.dwHeaderText+' | SafeHtml">'}else x+=">"+b.getSafeHtml(l.dwHeader);x+="</div>";_.isUndefinedOrNull(l.dwTooltip)||(b.has(l.dwTooltip)?x+="<dw:tooltip><div>"+b.getSafeHtml(l.dwTooltip)+"</div></dw:tooltip>":x+='<dw:tooltip dw-enabled="!!'+l.dwTooltip+'"><div><div ng-bind-html="'+l.dwTooltip+' | SafeHtml"></div></div>');x+="</div></th>";k.replaceWith(d(x)(q.scope)[0]);var y=k.data("dw$permission"),z=function(a){u=a;n()};if(y)y.push(z);else{y=[z];k.data("dw$permission",y)}if(l.dwWidthPercent){a.checkArgument(/^-?[0-9.]+$/.test(l.dwWidthPercent),"Not a number: "+l.$attr.dwWidthPercent);a.checkNumber(parseFloat(l.dwWidthPercent),l.$attr.dwWidthPercent,0,100);t=l.dwWidthPercent+"%"}if(l.dwWidthPixels){a.checkArgument(/^-?[0-9]+$/.test(l.dwWidthPixels),"Not a number: "+l.$attr.dwWidthPixels);a.checkNumber(parseFloat(l.dwWidthPixels),l.$attr.dwWidthPixels,0);t=l.dwWidthPixels+"px"}var A,B;if(!h||h.length<=0){if(_.isUndefinedOrNull(l.dwFormat))A=_.isUndefinedOrNull(l.dwFormatFunction)?_.constant(i.toStringFormat):e(l.dwFormatFunction);else{a.checkString(l.dwFormat,l.$attr.dwFormat,1);a.checkArgument(_.isFunction(c.get(l.dwFormat)),"Unknown format: "+l.dwFormat);A=_.constant(c.get(l.dwFormat))}if(_.isUndefinedOrNull(l.dwModel))B=_.constant("");else{a.checkString(l.dwModel,l.$attr.dwModel,1);B=e(l.dwModel)}q.scope.dw$render[r]=function(a,b){return f.trustAsHtml(j.safe(A(q.enclosingScope)(B(a),a,b)||"").toSafeString())}}q.addColumn({compile:function(a){"true"===l.dwSearchHighlight&&a.addClass("dw-search-highlight");"true"===l.dwEditable&&a.addClass("dw-editable");s&&a.addClass(s);a.attr("ng-show","dw$visible['"+r+"']");var b=angular.element("<div></div>");l.style&&b.attr("style",l.style);l.dwAsyncData&&b.attr("ng-class","{'dw-loading-indicator': dw$row."+l.dwModel+" === undefined }");A?b.append('<div class="dw-grid-column-inner" dw-tooltip ng-bind-html="dw$render[\''+r+"'](dw$row, $index)\"></div>"):b.append('<div class="dw-grid-column-inner">'+h+"</div>");a.append(b)},type:"column",id:r,group:l.dwGroup,addFields:function(a,b){l.dwModel&&(l.dwAsyncData?b.push(l.dwModel):a.push(l.dwModel))},model:l.dwModel,width:t,setVisible:function(a){u=a;o&&o.assign(q.enclosingScope,u);n()},isVisible:function(){return u&&v}});g.$on("$destroy",function(){_.each(w,function(a){a()});w=null;q=null;o=null;p=null})}}}}}])});j.invoke("Preconditions","Messages",function(a,b){i.buist.directive("dwGridColumnGroup",function(){return{restrict:"E",replace:!1,scope:!1,require:["^dwGrid"],link:function(c,d,e,f){a.checkString(e.dwName,e.$attr.dwName||"dw-name",1);d.replaceWith(angular.element("\x3c!-- dwGridColumnGroup --\x3e"));f[0].addColumnGroup({name:e.dwName,compile:function(a){var c='<div class="dw-column-group"';_.isUndefinedOrNull(e.dwHeader)?_.isUndefinedOrNull(e.dwHeaderText)||(c+=' ng-bind-html="'+e.dwHeaderText+' | SafeHtml">'):c+=">"+b.getSafeHtml(e.dwHeader);a.append(c+"</div>")}})}}})});j.invoke("Preconditions",function(){i.buist.directive("dwGridRows",function(){return{restrict:"E",scope:!1,require:["^dwGrid"],compile:function(a){var b=a.html();a.html("");return function(a,c,d,e){b.trim()&&angular.element(c.parent()).prepend("<th></th>");c.replaceWith("\x3c!-- dwGridRows --\x3e");e[0].addColumn({compile:function(a){a.addClass("dw-toggle-column");a.append('<a class="dw-row-toggle" href="#" ng-click="dw$toggleRow(dw$row, $event, this)"><i></i></div></a>')},compileRow:function(a){return function(b){b.append(a)}}(b),class:d.dwClass,template:b.trim(),type:"rowTemplate",addFields:angular.noop,width:"20px"});b=null}}}})});j.invoke("Preconditions","Configuration",function(a,b){i.config["i18n.selection.count"]="{0:integer} of {1:integer} Selected.";i.buist.directive("dwGridSelection",["$parse","$compile","$timeout",function(c,d,e){return{restrict:"E",replace:!1,scope:!1,require:["^dwGrid"],link:function(f,g,h,i){function k(a){return p.element[0].querySelector('.dw-grid-selection > [data-dw-hash="'+j.CSS.escape(p.hash(a))+'"]')}function l(){o=null;var a=b["i18n.selection.count"];var c=p.store.getOverallCount();var d=_.filter(p.scope.dw$selection,function(a){return!0===a.selected}).length;n&&n.assign(p.enclosingScope,d);if(0===d){p.scope.dw$selectAll=!1;p.scope.dwSelectionCountMessage=null}else{p.scope.dw$selectAll=_.every(p.store.data,function(a){var b=p.hash(a);if(p.scope.dw$selection[b]&&p.scope.dw$selection[b].selected)return!0;var c=k(a);return angular.element(c).hasClass("ng-hide")});p.scope.dwSelectionCountMessage=j.format(a,d,c)}}function m(){p.scope.dw$visible[r]=s;p.updateColumnVisibility(r,s)}var n,o,p=i[0],q="true"===h.dwSingle,r="dwSelection",s=!0;if(!_.isUndefinedOrNull(h.dwCount)){a.checkString(h.dwCount,h.$attr.dwCount,1);a.checkArgument(_.isFunction(c(h.dwCount).assign),"Not an assignable expression: "+h.dwCount);n=c(h.dwCount);n.assign(p.enclosingScope,0)}m();p.scope.dw$selectAll=!1;p.scope.dw$select=function(a,b){if("input"===a.target.tagName.toLowerCase()){var c=angular.element(a.target);if(q&&(c.prop("checked")||c.attr("checked"))){var d=p.hash(b);_.each(p.scope.dw$selection,function(a,b){a.selected=d===b})}o&&e.cancel(o);o=e(l)}};q||(p.scope.dw$selectAllChecked=function(a){var b,c,d=angular.element(a.currentTarget);_.each(p.store.data,function(a){b=d.prop("checked");if(b){c=k(a);b=b&&!angular.element(c).hasClass("ng-hide")}p.scope.dw$selection[p.hash(a)]={selected:b,item:a}});l()});p.scope.dw$resetSelection=function(){p.scope.dw$selection={};l()};p.scope.dw$recountSelection=function(){l()};var t;t=q?"<th></th>":d('<th class="dw-grid-selection" ng-show="dw$visible[\''+r+'\']"><input type="checkbox" ng-click="dw$selectAllChecked($event)" ng-model="dw$selectAll"></th>')(p.scope);g.replaceWith(t);var u=g.data("dw$permission"),v=function(a){s=a;m()};if(u)u.push(v);else{u=[v];g.data("dw$permission",u)}p.addColumn({compile:function(b){b.attr("ng-show","dw$visible['"+r+"']");b.addClass("dw-grid-selection");var c='<dw:checkbox ng-click="dw$select($event, dw$row)" data-dw-hash="{{ dw$hash(dw$row) }}"';if(!_.isUndefinedOrNull(h.dwCheckVisible)){a.checkString(h.dwCheckVisible,h.$attr.dwCheckVisible,1);c+=' ng-show="'+h.dwCheckVisible+'"'}c+="></dw:checkbox>";b.append(c)},id:r,type:"selection",width:"25px",addFields:function(a){_.each(p.dataSource.idFields(),function(b){a.push(b)})},model:p.dataSource.idFields(),isVisible:function(){return s}})}}}])});j.invoke("Preconditions",function(a){j.define(i.type("directives.IdAttribute"),{extend:i.type("directives.Directive"),constructor:function(b,c,d){a.checkString(d.dwId,d.$attr.dwId,1);this.callParent([b,c,d])},link:function(){var b=i.dwId(this.scope,this.attrs.dwId);a.checkArgument(!_.isUndefinedOrNull(b),"Not a <dw:id> in scope: "+this.attrs.dwId);this.element.addClass(this.createIdClass(b))}});i.buist.directive("dwId",function(){return{restrict:"A",replace:!1,scope:!0,controller:["$scope","$element","$attrs",j.internal.directives.IdAttribute],link:function(a,b,c,d){d.link()}}})});j.invoke("Preconditions",function(a){i.dwId=function(b,c,d){a.checkObject(b,"scope");a.checkString(c,"name",1);a.checkArgument(/^[A-Za-z][A-Za-z0-9-_:\.]*$/.test(c),"Invalid id characters: "+c);if(2===arguments.length)return b["dw$id_"+c];a.checkString(d,"value",1);b["dw$id_"+c]=d};j.define(i.type("directives.Id"),{extend:i.type("directives.Directive"),constructor:function(b,c,d){a.checkString(c.html(),"<dw:id> content",1);a.checkArgument(0===c.children().length,"<dw:id> has child elements");this.callParent([b,c,d]);i.dwId(this.enclosingScope,this.element.html(),_.uniqueId())}});i.buist.directive("dwId",function(){return{restrict:"E",replace:!1,scope:!0,controller:["$scope","$element","$attrs",j.internal.directives.Id],link:function(a,b){b.remove()}}})});j.invoke("Preconditions","Messages",function(a,b){j.define(i.type("directives.Img"),{extend:i.type("directives.ElementDirective"),constructor:function(a,b,c){this.callParent([a,b,c]);this.rule={};this.srcRules={0:this.rule};this.linked=!1;this.linkSrc("dwSrc","dwSrcValue");this.linkAlt("dwAlt","dwAltText");this.linkVisible("dwVisible");var d=this;this.windowHandler=function(){d.updateImg(d.element)};angular.element(window).on("resize",this.windowHandler)},setRule:function(b,c){a.checkString(b,"id",1);a.checkObject(c,"rule");a.checkString(c.src,"rule.src",1);this.srcRules[b]=c;this.linked&&this.updateImg(this.element)},setSrc:function(b){a.checkString(b,"src",1);this.rule.src=b;this.linked&&this.updateImg(this.element)},setAlt:function(b){a.optional.checkString(b,"alt");this.rule.alt=b;this.linked&&this.updateImg(this.element)},linkSrc:function(b,c){a.checkString(b,"staticName",1);a.checkString(c,"valueName",1);if(_.isUndefined(this.attrs[b])){if(_.isUndefined(this.attrs[c]))throw new Error("Undefined: dw-src or dw-src-value");var d=this;this.scope.$watch(this.attrs[c],function(b){a.optional.checkString(b,d.attrs.$attr[c],1);d.setSrc(b)})}else{a.optional.checkString(this.attrs[b],this.attrs.$attr[b],1);this.setSrc(this.attrs[b])}},linkAlt:function(c,d){a.checkString(c,"keyName",1);a.checkString(d,"textName",1);if(_.isUndefined(this.attrs[c])){if(!_.isUndefined(this.attrs[d])){var e=this;this.scope.$watch(e.attrs[d],function(b){a.optional.checkString(b,e.attrs.$attr[d]);e.setAlt(b)})}}else{a.checkString(this.attrs[c],this.attrs.$attr[c]);this.setAlt(b.get(this.attrs[c]))}},link:j.inject("$compile",function(a){this.element.html('<img class="dw-img" />');var b=a(this.element.contents())(this.scope);this.updateImg(b);this.replaceElementWith(b);this.linked=!0}),replaceElementWith:function(a){this.callParent([a]);this.element.addClass("dw-img");this.ensureId("dw-img-")},updateImg:function(a){function b(a,b,c,d){var e=i.element.getViewSize();if(e.width<a||e.height<b||e.width>c||e.height>d)return i.MAX_INT;return e.width-a}var c,d,e=i.MAX_INT;_.each(this.srcRules,function(a){c=b(a.minWidth||0,a.minHeight||0,a.maxWidth||i.MAX_INT,a.maxHeight||i.MAX_INT);if(c<e){d=a;e=c}});a.attr("src")!==d.src&&a.attr("src",-1===d.src.indexOf("://")?encodeURIComponent(d.src):encodeURI(d.src));d.alt?a.attr("alt",d.alt):a.removeAttr("alt")},destroy:function(){angular.element(window).off("resize",this.windowHandler);this.windowHandler=null;this.srcRules=null;this.callParent()}});i.buist.directive("dwImg",function(){return{restrict:"E",replace:!1,scope:!0,require:"dwImg",controller:["$scope","$element","$attrs",j.internal.directives.Img],link:function(a,b,c,d){d.link()}}})});j.invoke("Preconditions","Messages",function(a,b){j.define(i.type("directives.ImgRule"),{extend:i.type("directives.ElementDirective"),constructor:function(a,b,c){this.callParent([a,b,c]);this.id=_.uniqueId("dw-img-rule-");this.rule={};this.linkSrc("dwSrc","dwSrcValue");this.linkAlt("dwAlt","dwAltText");this.linkRange()},setSrc:function(b){a.checkString(b,"src",1);this.rule.src=b;this.updateRule()},setAlt:function(b){a.optional.checkString(b,"alt");this.rule.alt=b;this.updateRule()},setMinWidth:function(b){a.optional.checkNumber(b,"minWidth",0,this.rule.maxWidth||i.MAX_INT);this.rule.minWidth=b},setMinHeight:function(b){a.optional.checkNumber(b,"minHeight",0,this.rule.maxHeight||i.MAX_INT);this.rule.minHeight=b},setMaxWidth:function(b){a.optional.checkNumber(b,"maxWidth",this.rule.minWidth||0,i.MAX_INT);this.rule.maxWidth=b},setMaxHeight:function(b){a.optional.checkNumber(b,"maxHeight",this.rule.minHeight||0,i.MAX_INT);this.rule.maxHeight=b},linkSrc:j.inject("$parse",function(b,c,d){a.checkString(c,"staticName",1);a.checkString(d,"valueName",1);if(_.isUndefined(this.attrs[c])){if(_.isUndefined(this.attrs[d]))throw new Error("Undefined: dw-src or dw-src-value");var e=this;this.scope.$watch(this.attrs[d],function(b){a.optional.checkString(b,e.attrs.$attr[d],1);e.setSrc(b)});var f=b(this.attrs[d])(this.scope);a.optional.checkString(f,this.attrs.$attr[d],1);this.setSrc(f)}else{a.optional.checkString(this.attrs[c],this.attrs.$attr[c],1);this.setSrc(this.attrs[c])}}),linkAlt:function(c,d){a.checkString(c,"keyName",1);a.checkString(d,"textName",1);if(_.isUndefined(this.attrs[c])){if(!_.isUndefined(this.attrs[d])){var e=this;this.scope.$watch(e.attrs[d],function(b){a.optional.checkString(b,e.attrs.$attr[d]);e.setAlt(b)})}}else{a.checkString(this.attrs[c],this.attrs.$attr[c]);this.setAlt(b.get(this.attrs[c]))}},linkRange:function(){var b;if(!_.isUndefined(this.attrs.dwMinWidth)){b=this.parseIntegerAttribute("dwMinWidth");a.checkNumber(b,this.attrs.$attr.dwMinWidth,0);this.setMinWidth(b)}if(!_.isUndefined(this.attrs.dwMinHeight)){b=this.parseIntegerAttribute("dwMinHeight");a.checkNumber(b,this.attrs.$attr.dwMinHeight,0);this.setMinHeight(b)}if(!_.isUndefined(this.attrs.dwMaxWidth)){b=this.parseIntegerAttribute("dwMaxWidth");a.checkNumber(b,this.attrs.$attr.dwMaxWidth,0);this.setMaxWidth(b)}if(!_.isUndefined(this.attrs.dwMaxHeight)){b=this.parseIntegerAttribute("dwMaxHeight");a.checkNumber(b,this.attrs.$attr.dwMaxHeight,0);this.setMaxHeight(b)}},link:function(a){this.img=a;this.updateRule()},updateRule:function(){this.img&&this.img.setRule(this.id,this.rule)},destroy:function(){this.img=null;this.rule=null;this.callParent()}});i.buist.directive("dwImgRule",function(){return{restrict:"E",replace:!1,scope:!0,require:["dwImgRule","^?dwImg"],controller:["$scope","$element","$attrs",j.internal.directives.ImgRule],link:function(b,c,d,e){var f=e[0];var g=e[1];a.checkArgument(_.isObject(g),"Required enclosing <dw:img>: <dw:img>");f.link(g)}}})});j.invoke("Preconditions",function(a){function b(a,b){var c=a.html(),d='<label class="dw-text" ng-bind-html="dw$text | SafeHtml"></label>';if(c.trim().length>0){d+='<dw:tooltip class="dw-input-label-tooltip"';_.isUndefined(b.dwTooltipEnabled)||(d+='dw-enabled="'+i.encodeAttr(b.dwTooltipEnabled)+'"');d+=">";d+=c;d+="</dw:tooltip>"}return d+'<span class="dw-required">*</span><div class="dw-after-label dw-transclude-position"></div>'}j.define(i.type("directives.InputLabel"),{extend:i.type("directives.ElementDirective"),constructor:function(b,c,d){a.checkString(d.name,"name",1);this.callParent([b,c,d]);this.ensureId("dw-input-label-");this.linkText("dwLabel","dwLabelText","dwLabelFunction");this.linkFormInput();c.addClass("dw-input-label dw-valid is-valid dw-pristine is-unchanged is-untouched")},setText:function(b){a.checkHtml(b,"text");this.scope.dw$text=b},linkFormInput:j.inject("ObjectPath","$timeout",function(b,c){var d=this,e=d.attrs.name;this.element.removeAttr("name");var f=b.parse(e);if(1===_.size(f)){d.inputName=e;d.formCtrl=d.element.inheritedData("$formController");a.checkArgument(_.isObject(d.formCtrl),"Required enclosing <form>: <dw:input-label>")}else{var g=_.first(f);d.inputName=f.slice(1).join("");a.checkString(d.inputName,"Form input name",1);var h=j.CSS.escape(g),i='[name="'+h+'"]',k=document.querySelector("form"+i+", ng-form"+i+', [ng-form="'+h+'"]');if(_.isUndefinedOrNull(k))throw new Error('Undefined: Form with name "'+g+'"');c(function(){d.formCtrl=angular.element(k).controller("form")},0,!1)}d.scope.$watch(function(){var a=d.inputName?_.get(d.formCtrl,d.inputName):null;return!a||!1!==a.$valid},function(a,b){a!==b&&d.updateValidStyle(d.element,a)});d.scope.$watch(function(){var a=d.inputName?_.get(d.formCtrl,d.inputName):null;return!a||!1!==a.$pristine},function(a,b){a!==b&&d.updatePristineStyle(d.element,a)});d.scope.$watch(function(){var a=d.inputName?_.get(d.formCtrl,d.inputName):null;return!a||!1!==a.$untouched},function(a,b){a!==b&&d.updateUntouchedStyle(d.element,a)})}),destroy:function(){this.callParent();this.inputName=null;this.formCtrl=null}});i.buist.directive("dwInputLabel",function(){return{restrict:"E",replace:!1,template:b,scope:!0,controller:["$scope","$element","$attrs",j.internal.directives.InputLabel]}})});i.buist.directive("dwKey",["Keys","$parse","$rootScope","$timeout",function(a,b,c,d){return{restrict:"A",link:function(e,f,g){function h(){return f.hasClass("is-forbidden")||_.isElement(i.element.parent(f,"is-forbidden"))}function k(a){try{return a.prop("disabled")||a.attr("disabled")||a.hasClass("dw-disabled")}catch(b){return!1}}function l(){return k(f)||_.isElement(i.element.parent(f,k))}function m(a){if(l()||h())return;var d=b(g.dwKey,null,!0),f=c.$$phase?"$evalAsync":"$apply";e[f](function(){d(e,{$event:a})})}function n(){o();a.add(q);r=e.$on("$destroy",o);f.on("$destroy",o)}function o(){a.remove(q);r&&r();r=null}var p=g.dwKeyStroke||j.KeyBinding.ESC,q=new j.KeyBinding(p,m),r=null;g.dwKeyEnabled?e.$watch(g.dwKeyEnabled,function(a){a?d(n,0,!1):o()}):n()}}}]);j.invoke("Preconditions",function(a){function b(a,b){var c='<a href="'+b.dwHref+'" ng-click="dw$onClick($event)" class="dw-link"';_.isUndefined(b.target)||(c+=' target="'+i.encodeAttr(b.target)+'"');_.isUndefined(b.rel)||(c+=' rel="'+i.encodeAttr(b.rel)+'"');_.isUndefined(b.dwKeyStroke)||(c+=' dw-key="dw$onKey($event)" dw-key-stroke="'+b.dwKeyStroke+'"');c+=">";c+='<span class="dw-icon" role="img"></span>';c+='<span class="dw-label" ng-bind-html="dw$label | SafeHtml"></span>';return c+"</a>"}j.define(i.type("directives.Link"),{extend:i.type("directives.ElementDirective"),constructor:function(b,c,d){a.checkString(d.dwHref,"dw-href",1);this.callParent([b,c,d]);this.ensureId("dw-link-");this.setEnabled(!0);this.linkText("dwLabel","dwLabelText","dwLabelFunction");this.linkEnabled("dwEnabled");this.linkVisible("dwVisible");this.linkEventHandler("onClick","dw$onClick");this.linkEventHandler("onKey","dw$onKey")},setEnabled:function(b){a.checkBoolean(b,"enabled");this.enabled=b;this.element.toggleClass("dw-disabled",!b)},setText:function(b){a.optional.checkHtml(b,"text");this.scope.dw$label=b},onClick:function(a){var b=!1===this.enabled||this.isForbidden();a.returnValue=!b;if(b){a.preventDefault();return!1}},onKey:j.inject("$timeout","$rootScope",function(a,b,c){c.preventDefault();c.stopPropagation();var d=this.element.children()[0];_.isFunction(d.click)?b.$$phase?a(_.bind(d.click,d)):d.click():this.assign(angular.element(d).attr("href"))}),assign:j.inject("$location",function(a,b){a.assign(b)})});i.buist.directive("dwLink",function(){return{restrict:"E",replace:!1,template:b,scope:!0,controller:["$scope","$element","$attrs",j.internal.directives.Link]}})});i.buist.directive("dwTooltip",["Messages","$parse",function(a,b){var c="dw$tooltipVisible",d="dw$tooltipEnabled";return{restrict:"A",scope:!0,link:{pre:function(e,f,g){function h(a){e[d]=!t||!1!==t.enabled;e[c]=!!t&&!0===t.visible;q();r(a)}function k(){q();s()}function l(a){t&&t.setVisible(a)}function m(a){t&&t.setEnabled(a)}function n(a,b){var c=e.$root.$$phase?"$evalAsync":"$apply";e[c](function(){o();p(a,b)})}function o(){y&&y();y=e.$watch(x,m)}function p(a,b){!a&&(a=_.constant(!0));!b&&(b=l);w&&w();w=e.$watch(function(){return v(e)&&a()},function(a){b(a)})}function q(){t&&t.destroy();t=null;w&&w();w=null;y&&y();y=null;z&&f.off("mouseover");z=!1}function r(a,b,c){if(_.isString(a)||a instanceof i.SafeHtml){t=j.create(i.type("widget.StickyTooltip"),{target:f,template:j.safe(a).toString(),scope:e});t.setEnabled(!1);t.setVisible(!1);n(b,c)}}function s(){function a(){return f[0].offsetWidth<f[0].scrollWidth||f[0].clientHeight>f[0].parentElement.clientHeight}function b(a){l(a);!g.dwTooltipEnabled&&m(a)}e[c]=!0;e[d]=!0;f.on("mouseover",function(){a()&&(t?n(a,b):r(f.text(),a,b))});z=!0}var t,u,v,w,x,y,z=!1;if(g.dwTooltipVisible)u=g.dwTooltipVisible;else{u=c;e[u]=!1}v=b(u);if(g.dwTooltipEnabled)x=g.dwTooltipEnabled;else{x=d;e[x]=!0}_.isNotBlank(g.dwTooltip)?a.has(g.dwTooltip)?r(a.getSafeHtml(g.dwTooltip)):e.$watch(g.dwTooltip,function(a){_.isFunction(a)&&(a=a());_.isString(a)||a instanceof i.SafeHtml?h(a):k()}):s();e.$on("$destroy",q)}}}}]);j.invoke("Preconditions",function(a){j.define(i.type("directives.MenuBar"),{extend:i.type("directives.ElementDirective"),constructor:function(a,b,c){this.callParent([a,b,c]);this.ensureId("dw-menu-bar-");this.menus=[];this.linkVisible("dwVisible");b.addClass("dw-menu-bar")},setVisible:function(a){this.callParent([a]);a||_.each(this.menus,function(a){a.setMenuVisible(!1)})},setEnabled:function(a){this.callParent(arguments);_.each(this.menus,function(b){b.setEnabled(a)})},addMenu:function(b){a.checkArgument(b instanceof j.internal.directives.Menu,"Not a dwMenu: menu");this.menus.push(b)},destroy:function(){this.menus=null;this.callParent()}});i.buist.directive("dwMenuBar",function(){return{restrict:"E",replace:!1,controller:["$scope","$element","$attrs",j.internal.directives.MenuBar]}})});j.invoke("Preconditions","ZIndex","AutoHide",function(a,c,d){function e(){_.each(_.clone(k),function(a){a.setMenuVisible(!1)})}function f(){function a(a){_.some(k,function(b){return i.element.contains(b.element[0],a)})||e()}if(0===k.length){l&&d.off(a);l=!1}else if(!l){d.on(a);l=!0}}function g(a){var b=window.getComputedStyle(a[0]);var c="hidden"===b.getPropertyValue("overflow-x")||"hidden"===b.getPropertyValue("overflow");if("body"===a[0].nodeName.toLowerCase()||c)return a[0].getBoundingClientRect();return g(a.parent())}function h(a,b){var c='<dw:button dw-handler="dw$click"';_.each(["dwLabel","dwLabelText","dwLabelFunction","dwEnabled","dwTooltip","dwTooltipText"],function(a){_.isUndefinedOrNull(b[a])||(c+=b.$attr[a]+'="'+b[a]+'"')});c+=' class="dw-menu-button';var d=a.attr("class"),e=_.isNotBlank(d)?d.split(/\s+/):[];_.each(e,function(b){if(_.startsWith(b,"dw-icon")||_.startsWith(b,"dw-glyph-")){c+=" "+b;a.removeClass(b)}});return c+'"></dw:button><div class="dw-menu ng-hide"></div>'}var k=[];i.buist.run(_.once(function(){document.documentElement.addEventListener("mousewheel",e);document.documentElement.addEventListener("DOMMouseScroll",e);b.addEventListener("resize",e)}));var l=!1;j.define(i.type("directives.Menu"),{extend:i.type("directives.ElementDirective"),constructor:function(a,b,c){this.callParent([a,b,c]);this.ensureId("dw-menu-");this.setEnabled(!0);this.setVisible(!0);this.items=[];this.linkEnabled("dwEnabled");this.linkVisible("dwVisible");this.linkJustify();this.linkEventHandler("onButtonClick","dw$click");this.scope.dw$menuVisible=!1;var d=this;this.element.on("mouseover",function(a){d.onMouseover(a)})},setEnabled:function(b){a.checkBoolean(b,"enabled");this.enabled=b;if(!b){this.setMenuVisible(!1);this.cancelShowTimer()}},setVisible:function(a){this.callParent([a]);a||this.setMenuVisible(!1)},setJustify:function(b){a.optional.checkString(b,"justify",1);this.justify=b},setParent:function(b){a.checkArgument(b instanceof j.internal.directives.Menu,"Not a dwMenu: parent");this.parent=b;this.element.addClass("dw-menu-item");angular.element(this.element.children()[0]).addClass("dw-submenu-item")},setMenuVisible:function(b){a.checkBoolean(b,"visible");if(!this.element)return;var d=angular.element(this.element.children()[1]),g=this.menuVisible;this.menuVisible=b;this.scope.dw$menuVisible=b;d.toggleClass("ng-hide",!b);this.element.toggleClass("dw-open",b);if(!g&&b){d.css("z-index",c.tooltip().toString());this.updateMenuPosition();this.parent?this.parent.setVisibleMenu(this):e();k.push(this)}else if(g&&!b){_.each(this.items,function(a){a.setMenuVisible(!1)});this.parent&&this.parent.setVisibleMenu(null);_.remove(k,this)}f()},setVisibleMenu:function(b){a.checkArgument(_.isUndefinedOrNull(b)||b instanceof j.internal.directives.Menu,"Not a dwMenu: visibleMenu");this.visibleMenu&&this.visibleMenu.setMenuVisible(!1);this.visibleMenu=b},addItem:function(b){a.checkObject(b,"item");this.items.push(b);b.setParent(this)},addMenu:function(b){a.checkObject(b,"menu");this.items.push(b);b.setParent(this)},linkJustify:function(){if(!_.isUndefined(this.attrs.dwJustify)){a.checkString(this.attrs.dwJustify,this.attrs.$attr.dwJustify,1);this.setJustify(this.attrs.dwJustify)}},link:function(a){a.addMenu(this);this.copyHTMLDataAttributes(this.element[0],this.element.children()[0])},onButtonClick:function(){if(this.parent||!this.enabled)return;this.setMenuVisible(!0)},onMouseover:function(a){var b=this;_.each(this.items,function(c){if(i.element.contains(c.element,a.target))c.scheduleShow&&c.scheduleShow();else{c.cancelShowTimer&&c.cancelShowTimer();b.visibleMenu===c&&c.setMenuVisible(!1)}})},onItemActivated:function(){this.setMenuVisible(!1);this.parent&&this.parent.onItemActivated()},updateMenuPosition:function(){var a,b,c=angular.element(this.element.children()[0]),d=angular.element(this.element.children()[1]),e=c[0].getBoundingClientRect(),f=d[0].getBoundingClientRect(),h=g(this.element);if(this.parent){b=e.top+f.height<=h.height?0:e.height-f.height;a=e.right+f.width<=h.width?e.width:-f.width}else{var i=0,j=e.width-f.width;switch(this.justify){case"right":a=e.left+j>=0?j:i;break;default:a=e.left+f.width<=h.width?i:j}b=e.bottom+f.height<=h.height?e.height:-f.height}d.css({left:a+"px",top:Math.max(b,-e.top)+"px"})},scheduleShow:j.inject("$timeout",function(a){if(this.menuVisible||this.showTimer||!this.enabled)return;var b=this;this.showTimer=a(function(){b.scope.$evalAsync(function(){b.setMenuVisible(!0)})},300,!1)}),cancelShowTimer:j.inject("$timeout",function(a){this.showTimer&&a.cancel(this.showTimer);this.showTimer=null}),destroy:function(){this.setMenuVisible(!1);this.cancelShowTimer();this.items=null;this.parent=null;this.menuVisible=null;this.visibleMenu=null;this.callParent()}});i.buist.directive("dwMenu",function(){return{restrict:"E",replace:!1,template:h,scope:!0,controller:["$scope","$element","$attrs",j.internal.directives.Menu],transclude:!0,require:["dwMenu","?^dwMenuBar"],link:function(b,c,d,e,f){var g=e[0],h=e[1],i=c.parent().inheritedData("$dwMenuController");var j=b.$watch("dw$menuVisible",function(a){if(a){f(b.$parent.$new(),function(a,b){b.$$transcluded=!0;angular.element(c.children()[1]).append(a)});j()}});if(_.isObject(i))g.link(i);else{a.checkArgument(_.isObject(h),"Required enclosing <dw:menu-bar> or <dw:menu>: <dw:menu>");g.link(h)}}}})});!function(){function a(a,b,c){_.each(c,function(c){_.isUndefined(b[c])||(a+=" "+b.$attr[c]+'="'+i.encodeAttr(b[c])+'"')});return a}function b(b,c){var d="<dw:button";d=a(d,c,["dwHandler","dwLabel","dwLabelText","dwLabelFunction","dwEnabled","dwKeyStroke"])
;d+="></dw:button>";d+='<dw:menu-bar><dw:menu class="dw-glyphicon" dw-justify="right"';d=a(d,c,["dwEnabled"]);d+=">";d+=b.html();return d+"</dw:menu></dw:menu-bar>"}j.define(i.type("directives.MenuButton"),{extend:i.type("directives.ElementDirective"),constructor:function(a,b,c){this.callParent([a,b,c]);this.ensureId("dw-menubutton-");this.linkVisible("dwVisible");b.addClass("dw-menubutton")}});i.buist.directive("dwMenuButton",function(){return{restrict:"E",replace:!1,template:b,controller:["$scope","$element","$attrs",j.internal.directives.MenuButton],scope:!0}})}();j.invoke("Preconditions",function(a){function b(a,b){function c(){var b=a.attr("class"),c=_.isNotBlank(b)?b.split(/\s+/):[];return _.transform(c,function(b,c){if(_.startsWith(c,"dw-icon")||_.startsWith(c,"dw-glyph-")){b.push(c);a.removeClass(c)}},[]).join(" ")}var d='<dw:button dw-handler="dw$click"';_.each(["dwLabel","dwLabelText","dwLabelFunction","dwEnabled","dwKeyStroke"],function(a){_.isUndefinedOrNull(b[a])||(d+=b.$attr[a]+'="'+b[a]+'"')});var e=c();_.isNotBlank(e)&&(d+='class="'+e+'"');if(b.dwModel){d+=" ng-class=\"{'is-selected':"+b.dwModel;b.dwValue&&(d+=" === '"+b.dwValue+"'");d+='}"'}return d+"></dw:button>"}j.define(i.type("directives.MenuItem"),{extend:i.type("directives.ElementDirective"),constructor:function(b,c,d,e){var f=d.dwHandler,g=d.dwModel;a.checkArgument(!!f||!!g,"dw-handler or dw-model is required");f?a.checkFunction(e(d.dwHandler)(b),d.$attr.dwHandler||"dw-handler"):a.checkString(d.dwModel,"dw-model",1);this.callParent([b,c,d]);g&&this.bind("model",this.enclosingScope,g);this.ensureId("dw-menu-item-");this.linkVisible("dwVisible");this.linkEventHandler("onClick","dw$click");c.addClass("dw-menu-item")},setEnabled:function(a){this.callParent(arguments);this.element.children().controller("dwButton").setEnabled(a)},setParent:function(b){a.checkArgument(b instanceof j.internal.directives.Menu,"Not a dwMenu: parent");this.parent=b},setMenuVisible:function(a){a||this.tooltip&&this.tooltip.setVisible(!1)},onClick:j.inject("$parse",function(b){this.attrs.dwModel&&(this.attrs.dwValue?this.scope.model=this.scope.model===this.attrs.dwValue?null:this.attrs.dwValue:this.scope.model=!this.scope.model);this.parent&&this.parent.onItemActivated();if(this.attrs.dwHandler){var c=b(this.attrs.dwHandler)(this.scope);a.checkFunction(c,this.attrs.$attr.dwHandler);c.call(c)}}),link:function(a){a.addItem(this)},destroy:function(){this.parent=null;this.callParent()}});i.buist.directive("dwMenuItem",function(){return{restrict:"E",replace:!1,template:b,scope:!0,controller:["$scope","$element","$attrs","$parse",j.internal.directives.MenuItem],require:["dwMenuItem","?^dwMenu"],link:function(b,c,d,e){var f=e[0];var g=e[1];a.checkArgument(_.isObject(g),"Required enclosing <dw:menu>: <dw:menu-item>");f.link(g)}}})});j.invoke("Preconditions",function(a){j.define(i.type("directives.MenuSeparator"),{extend:i.type("directives.ElementDirective"),constructor:function(a,b,c){this.callParent([a,b,c]);this.ensureId("dw-menu-separator-");b.addClass("dw-menu-separator")}});i.buist.directive("dwMenuSeparator",function(){return{restrict:"E",replace:!1,scope:!1,controller:["$scope","$element","$attrs",j.internal.directives.MenuSeparator],require:["dwMenuSeparator","^dwMenu"],link:function(b,c,d,e){var f=e[1];a.checkArgument(_.isObject(f),"Required enclosing <dw:menu>: <dw:menu-separator>")}}})});j.invoke("Preconditions",function(a){j.define(i.type("directives.Option"),{extend:i.type("directives.ElementDirective"),constructor:function(a,b,c){this.callParent([a,b,c]);this.linkValues()},linkValues:j.inject("$parse",function(b){if(_.isUndefined(this.attrs.dwValues)){if(_.isUndefined(this.attrs.dwValuesFunction))throw new Error("Undefined: dw:values or dw:values-function");var c=b(this.attrs.dwValuesFunction)(this.scope);a.checkFunction(c,this.attrs.$attr.dwValuesFunction);this.matcher=c}else{var d=b(this.attrs.dwValues)(this.scope);_.isArray(d)||(d=[d]);this.matcher=function(a){return _.includes(d,a)}}}),link:function(a){a.addMatcher(this.matcher,this.attrs)}});i.buist.directive("dwOption",function(){return{restrict:"E",replace:!1,scope:!1,require:["dwOption","?^dwSelect"],controller:["$scope","$element","$attrs",j.internal.directives.Option],link:function(b,c,d,e){var f=e[0];var g=e[1];a.checkArgument(_.isObject(g),"Required enclosing <dw:select>: <dw:option>");f.link(g)}}})});j.invoke("Preconditions","Configuration","Formats","Keys",function(a,b,c,d){i.config["i18n.pager.message.empty"]="No data to display";i.config["i18n.pager.message.range"]="{0}-{1}";i.config["i18n.pager.message.data"]="{0} of {1}";i.config["i18n.pager.tooltip.next"]="Go to next page.";i.config["i18n.pager.tooltip.previous"]="Go to previous page.";var e='<form><span class="dw-beforerange" ng-show="last - first > 0">{{ beforeRange }}</span><dw:quick-list class="dw-range" dw-model="pageSizeInput" dw-source="pageSizes" dw-placeholder-text="range" dw-visible="total > 0" dw-enabled="!loading && (total > 0)">{{ dw$row }}</dw:quick-list><span class="dw-afterrange">{{ afterRange }}</span><dw:button class="dw-previous dw-icononly dw-glyphicon dw-glyph-angle-left" dw-handler="dw$onPrevious" dw-tooltip-text="previousTooltip" dw-visible="total > pageSize" dw-enabled="!loading && (page > 1)"></dw:button><dw:text-field class="dw-page" dw-model="pageInput" dw-visible="total > pageSize" dw-enabled="!loading" dw-format="integer"></dw:text-field><dw:button class="dw-next dw-icononly dw-glyphicon dw-glyph-angle-right" dw-handler="dw$onNext" dw-tooltip-text="nextTooltip" dw-visible="total > pageSize" dw-enabled="!loading && (page < pageCount)"></dw:button></form>';j.define(i.type("directives.Pager"),{extend:i.type("directives.ElementDirective"),constructor:function(c,d,e){this.callParent([c,d,e]);var f=b["i18n.pager.message.data"],g=f.indexOf("{0}");a.checkArgument(-1!==g,"Missing {0} placeholder: i18n.pager.message.data");this.beforeMsg=f.substring(0,g);this.afterMsg=f.substring(g+3);this.rangeMsg=b["i18n.pager.message.range"];this.ensureId("dw-pager-");this.linkEventHandler("onPrevious","dw$onPrevious");this.linkEventHandler("onNext","dw$onNext");c.pageSizes=new j.ArrayDataSource([10,25,50,100,200]);c.first=0;c.last=0;c.total=0;c.previousTooltip=b["i18n.pager.tooltip.previous"];c.nextTooltip=b["i18n.pager.tooltip.next"];c.loading=!1;c.afterRange=" ";d.addClass("dw-pager")},link:function(a){this.grid=a;a.setPager(this);var b=this,c=this.element[0].querySelector(".dw-page"),e=new j.KeyBinding(j.KeyBinding.ENTER,function(){b.scope.$apply(function(){b.onEnter()})});d.add(e,c);b.deregisterEnter=function(){d.remove(e,c)};this.scope.$watch("pageSizeInput",function(c){if(_.isNumber(c)){a.setPageSize(c);b.scope.pageSize=c;delete b.scope.pageSizeInput;a.reset({group:!1,sort:!1,page:!0,selection:!1})}});c.querySelector("input").addEventListener("blur",function(){b.onEnter()})},onBeforeLoad:function(){if(!this.scope)return;this.scope.loading=!0},onLoad:function(a){if(!this.scope)return;var b=c.get("integer");_.assign(this.scope,{loading:!1,pageSize:a.pageSize,page:a.page,pageInput:a.page,pageCount:a.pageCount,first:a.first,last:a.last,total:a.total,beforeRange:j.format(this.beforeMsg,"",b(a.total)),range:j.format(this.rangeMsg,b(a.first),b(a.last)),afterRange:a.total>0?j.format(this.afterMsg,"",b(a.total)):""});a.pagingOptions&&this.scope.pageSizes.data(a.pagingOptions)},onPrevious:function(){a.checkArgument(_.isObject(this.grid),"Grid not set");this.grid.previousPage()},onNext:function(){a.checkArgument(_.isObject(this.grid),"Grid not set");this.grid.nextPage()},onEnter:function(){a.checkArgument(_.isObject(this.grid),"Grid not set");if(_.isNumber(this.scope.pageInput)){var b=Math.max(1,Math.min(this.scope.pageInput,this.scope.pageCount));b!==this.scope.page?this.grid.setPage(b):this.scope.pageInput=b}},destroy:function(){this.deregisterEnter&&this.deregisterEnter();this.deregisterEnter=null;this.beforeMsg=null;this.rangeMsg=null;this.afterMsg=null;this.grid=null;this.callParent()}});i.buist.directive("dwPager",function(){return{restrict:"E",replace:!1,template:e,scope:!0,require:["dwPager","?^dwGrid"],controller:["$scope","$element","$attrs",j.internal.directives.Pager],link:function(b,c,d,e){var f=e[0];var g=e[1];a.checkArgument(_.isObject(g),"Required enclosing <dw:grid>: <dw:pager>");f.link(g)}}})});j.invoke("Preconditions",function(a){j.define(i.type("directives.Param"),{extend:i.type("directives.Directive"),constructor:function(a,b,c){this.callParent([a,b,c]);this.linkName();this.linkValue()},setValue:function(b){a.checkString(b,"value");this.value=b},linkName:function(){a.checkString(this.attrs.dwName,this.attrs.$attr.dwName||"dw-name",1);this.name=this.attrs.dwName},linkValue:function(){_.isUndefined(this.attrs.dwValue)||(this.value=this.attrs.dwValue)},link:function(a){a.put(this.name,this.value)},destroy:function(){this.name=null;this.value=null;this.callParent()}});i.buist.directive("dwParam",function(){return{restrict:"E",replace:!1,scope:!0,controller:["$scope","$element","$attrs",j.internal.directives.Param],compile:function(b){var c=b.html();b.html("");return{post:function(b,d,e,f){var g=d.inheritedData("$dwConfigureController");a.checkArgument(_.isObject(g),"Required enclosing <dw:configure>: <dw:param>");_.isUndefined(e.dwValue)&&f.setValue(c);f.link(g);d.remove()}}}}})});j.invoke("Tether",function(a){function b(a,b){return _.some(b,function(b){return a.hasClass(r+b)})}function c(a,b,c,d){a.toggleClass(g+"top-left",c.t);a.toggleClass(g+"bottom-left",c.b);return{top:b.top+(d||0),left:b.left+b.elementPos.width-b.targetPos.width}}function d(a,b,c,d){a.toggleClass(g+"top-right",c.t);a.toggleClass(g+"bottom-right",c.b);return{top:b.top+(d||0),left:b.left-b.elementPos.width+b.targetPos.width}}function e(a,b,c,d){a.toggleClass(g+"left-top",c.t);a.toggleClass(g+"left-bottom",c.b);a.toggleClass(g+"left-center",c.m);return{top:b.top,left:b.left+b.elementPos.width+b.targetPos.width+(d||0)}}function f(a,b,c,d){a.toggleClass(g+"right-top",c.t);a.toggleClass(g+"right-bottom",c.b);a.toggleClass(g+"right-center",c.m);return{top:b.top,left:b.left-b.elementPos.width-b.targetPos.width+(d||0)}}var g="dw-arrow-",h=11,j=2*h,k=["top-left","top-center","top-right"],l=["bottom-left","bottom-center","bottom-right"],m=["top-left","bottom-left"],n=["top-right","bottom-right"],o=["left-top","left-center","left-bottom"],p=["right-top","right-center","right-bottom"],q=k.concat(l).concat(o).concat(p),r="dw-popover-attachment-",s="dw-popover-tether",t=s+"-element-attached-",u=s+"-out-of-bounds-";a.modules.push({position:function(h){if(!this.options.dw$popover)return;a.Utils.flush();var i=angular.element(this.element),r=i.hasClass(t+"top"),s=i.hasClass(t+"bottom"),v=i.hasClass(t+"left"),w=i.hasClass(t+"right"),x=i.hasClass(t+"center"),y=i.hasClass(t+"middle"),z=i.hasClass(u+"left"),A=i.hasClass(u+"right"),B={t:r,b:s,l:v,r:w,c:x,m:y},C=b(i,k),D=b(i,l);_.forEach(q,function(a){i.toggleClass(g+a,!1)});if(C||D){var E=b(i,m),F=b(i,n),G=E&&w||F&&z,H=F&&v||E&&A;switch(!0){case r&&v:i.toggleClass(g+"top-left",E&&!A);break;case r&&x:i.toggleClass(g+"top-center",!0);break;case r&&w:i.toggleClass(g+"top-right",F&&!z);break;case s&&v:i.toggleClass(g+"bottom-left",E&&!A);break;case s&&x:i.toggleClass(g+"bottom-center",!0);break;case s&&w:i.toggleClass(g+"bottom-right",F&&!z)}if(C&&s){if(G)return c(i,h,B,-j);if(H)return d(i,h,B,-j);return{top:h.top-j,left:h.left}}if(D&&r){if(G)return c(i,h,B,j);if(H)return d(i,h,B,j);return{top:h.top+j,left:h.left}}if(G)return c(i,h,B);if(H)return d(i,h,B)}else{var I=b(i,o),J=b(i,p);switch(!0){case r&&v:i.toggleClass(g+"left-top",I&&!A);break;case y&&v:i.toggleClass(g+"left-center",!0);break;case s&&v:i.toggleClass(g+"left-bottom",I&&!A);break;case r&&w:i.toggleClass(g+"right-top",J&&!z);break;case y&&w:i.toggleClass(g+"right-center",!0);break;case s&&w:i.toggleClass(g+"right-bottom",J&&!z)}if(J&&z)return e(i,h,B,j);if(J&&v)return e(i,h,B,-(h.elementPos.width+h.targetPos.width-j));if(I&&A)return f(i,h,B,-j);if(I&&w)return f(i,h,B,h.elementPos.width+h.targetPos.width-j)}return h}});i.buist.directive("dwPopover",["$parse","$log","$interval",function(b,c,d){return{restrict:"C",link:function(e,f,j){function k(){if(_.isUndefined(j.dwPopoverVisible)){p="dwPopoverVisibility";e[p]=!0}else p=j.dwPopoverVisible;q=b(p);t=q.assign}function l(){var a=e.$root.$$phase?"$evalAsync":"$apply";e[a](function(){t(e,!1)})}function m(){x&&x.destroy();x=null;y&&d.cancel(y);y=null;_.forEach(z,function(a){a()});z=[];w.off("click",l);o&&o.removeData("dw$popover");o=null;if(u){try{v[0].removeChild(f[0])}catch(a){}u=!1}else f.toggleClass("ng-hide",!q(e))}function n(k){m();_.isElement(k)||(k=document.querySelector(k));o=angular.element(k);if(_.isElement(o[0])){v.append(f);u=!0;o.data("dw$popover",f);w.on("click",l);var n,q,t=0,A=0;switch(!0){case f.hasClass(g+"top-right"):f.toggleClass(r+"top-right",!0);n="top right";q="bottom right";A=-h;break;case f.hasClass(g+"top-center"):f.toggleClass(r+"top-center",!0);n="top center";q="bottom center";A=-h;break;case f.hasClass(g+"bottom-left"):f.toggleClass(r+"bottom-left",!0);n="bottom left";q="top left";A=h;break;case f.hasClass(g+"bottom-right"):f.toggleClass(r+"bottom-right",!0);n="bottom right";q="top right";A=h;break;case f.hasClass(g+"bottom-center"):f.toggleClass(r+"bottom-center",!0);n="bottom center";q="top center";A=h;break;case f.hasClass(g+"right-top"):f.toggleClass(r+"right-top",!0);n="top right";q="left top";t=h;break;case f.hasClass(g+"right-center"):f.toggleClass(r+"right-center",!0);n="middle right";q="middle left";t=h;break;case f.hasClass(g+"right-bottom"):f.toggleClass(r+"right-bottom",!0);n="bottom right";q="bottom left";t=h;break;case f.hasClass(g+"left-top"):f.toggleClass(r+"left-top",!0);n="left top";q="left bottom";t=-h;break;case f.hasClass(g+"left-center"):f.toggleClass(r+"left-center",!0);n="middle left";q="middle right";t=-h;break;case f.hasClass(g+"left-bottom"):f.toggleClass(r+"left-bottom",!0);n="bottom left";q="right bottom";t=-h;break;default:f.toggleClass(r+"top-left",!0);n="top left";q="bottom left";A=-h}var B,C=_.isUndefined(j.dwPopoverConstraints)?[{to:"scrollParent",attachment:"together",pin:["top"]}]:b(j.dwPopoverConstraints)(e);switch(!0){case _.isNotBlank(C)||_.isElement(C):B=[{to:C,attachment:"together",pin:["top"]}];break;case _.isPlainObject(C):B=[_.cloneDeep(C)];break;case _.isArray(C):B=_.cloneDeep(C);break;default:B=C}x=new a({element:f[0],target:o[0],enabled:!1,attachment:n,targetAttachment:q,classPrefix:s,dw$popover:!0,constraints:B,offset:A+"px "+t+"px"});z.push(e.$watch(p,function(a){f.toggleClass("ng-hide",!a);if(a){y&&d.cancel(y);y=d(x.position.bind(x),250,0,!1);x.enable();x.position()}else{y&&d.cancel(y);y=null;x.disable()}}));var D=x.position.bind(x);z.push(e.$on(i.events.invalidate,D));z.push(e.$on(i.events.resize,D));e.$on("$destroy",m)}else c.warn("<dw:popover>: Couldn't find a matching anchor element '"+k+"'.")}if(_.isUndefined(j.dwPopoverAnchor)){!_.isUndefined(j.dwPopoverVisible)&&f.toggleClass("ng-hide",!b(j.dwPopoverVisible)(e));return}var o,p,q,t,u=!1,v=angular.element(document.body),w=angular.element(f[0].querySelector(".dw-popover-close")),x=null,y=null,z=[];k();e.$watch(j.dwPopoverAnchor,function(a){a?n(a):m()})}}}])});j.invoke("Preconditions",function(a){i.buist.directive("dwPermission",function(){return{priority:Number.MAX_VALUE,restrict:"A",replace:!1,scope:!1,link:function(b,c,d){function e(b){var c=_.isUndefinedOrNull(b),d=_.isBoolean(b),g=_.isFunction(b);a.checkArgument(c||d||g||_.isPromise(b),"Not a boolean, function or promise: allowed");c?f(!0):d?f(b):g?e(b()):b.then(e)}function f(a){_.each(c.data("dw$permission"),function(b){_.isFunction(b)&&b(a)});c.toggleClass("is-forbidden",!a);d.dwPermissionClass&&c.toggleClass(d.dwPermissionClass,!a)}b.$watch(d.dwPermission,e)}}})});j.invoke("Preconditions","Messages","Configuration",function(a,b,c){function d(a,b){var c='<dw:quickview class="dw-iconright" dw-trigger="click" dw-anchor="bottom" dw-tip-class="dw-quick-list-window';_.isUndefined(b.dwTipClass)||(c+=" "+b.dwTipClass);c+='"';_.isUndefined(b.dwEnabled)||(c+=' dw-enabled="'+i.encodeAttr(b.dwEnabled)+'"');_.isUndefined(b.dwTooltip)||(c+=' dw-tooltip="'+i.encodeAttr(b.dwTooltip)+'"');c+="></dw:quickview>";c+='<input type="hidden" ng-model="'+i.encodeAttr(b.dwModel)+'"';_.isUndefined(b.name)||(c+=' name="'+i.encodeAttr(b.name)+'"');return c+" />"}function e(a){var b='<div class="dw-quick-list-content"';_.isUndefined(a.dwTipId)||(b+=' dw-id="'+i.encodeAttr(a.dwTipId)+'" dw-transclude');b+=">";if(!_.isUndefined(a.dwSearchModel)){b+='<dw:search dw-model="'+i.encodeAttr(a.dwSearchModel)+'" dw-handler="load" dw-visible="!allTotal || (allTotal > 10)"';_.isUndefined(a.dwSayt)||(b+=" "+a.$attr.dwSayt+'="'+i.encodeAttr(a.dwSayt)+'"');b+="></dw:search>"}b+='<div class="dw-options"></div>';b+='<div class="dw-paging" ng-show="!loading && (total > 0) && (options.length < total)">';b+='<dw:button class="dw-linkbutton dw-next" dw-label-text="moreLabel" dw-handler="next"></dw:button>';b+="</div>";b+='<div class="dw-empty" ng-show="!loading && (options.length === 0) && emptyText" ng-bind-html="emptyText | SafeHtml"></div>';b+='<div class="dw-loader" ng-show="loading && loader" ng-bind-html="loader | SafeHtml"></div>';b+='<div class="dw-footer dw-transclude-position"></div>';return b+"</div>"}function f(a){return'<div class="dw-option dw-'+(a%2==0?"even":"odd")+'" ng-click="onClick('+a+')"></div>'}function g(a){var b=angular.element(a.children()[0]),c=b.children();for(var d=0;d<c.length;d++){a=angular.element(c[d]);if(a.hasClass("dw-options"))return a}}function h(a){var b=angular.element(a.children()[0]),c=b.children();for(var d=0;d<c.length;d++){a=angular.element(c[d]);if(a.hasClass("dw-empty"))return a}}function k(a){var b=angular.element(a.children()[0]),c=b.children();for(var d=0;d<c.length;d++){a=angular.element(c[d]);if(a.hasClass("dw-loader"))return a}}i.config["i18n.quicklist.link.more"]="Show more...";j.define(i.type("directives.QuickList"),{extend:i.type("directives.ElementDirective"),constructor:function(a,b,d,e){this.callParent([a,b,d]);this.labelTranscludeFn=e;this.optionTranscludeFn=e;this.setPageSize(100);this.setMoreLabel(c["i18n.quicklist.link.more"]);this.setLoading(!1);this.ensureId("dw-quicklist-");this.linkVisible("dwVisible");this.linkModel();this.linkSource();this.linkSearchModel();this.linkPageSize();this.linkPlaceholder("dwPlaceholder","dwPlaceholderText");this.linkMore();this.linkEmpty();this.linkLoader();this.onWindowClose();b.addClass("dw-quick-list");b.addClass("dw-validate-input")},setVisible:function(a){this.callParent(arguments);this.quickviewCtrl&&this.quickviewCtrl.setVisible(a)},setEnabled:function(a){this.callParent(arguments);this.quickviewCtrl&&this.quickviewCtrl.setEnabled(a)},setOptions:function(b){a.checkArray(b,"options");this.options=b;this.windowScope&&(this.windowScope.options=this.options)},setTotal:function(b){a.checkNumber(b,"total",0);this.total=b;this.windowScope&&(this.windowScope.total=this.total)},setAllTotal:function(b){a.optional.checkNumber(b,"total",0);this.allTotal=b;this.windowScope&&(this.windowScope.allTotal=this.allTotal)},setSource:function(b){a.checkArgument(b instanceof j.DataSource,"Not a DataSource: source");this.source=b},setSearchModel:function(b){a.checkArgument(b instanceof j.SearchModel,"Not a SearchModel: "+b);this.searchModel=b},setPageSize:function(b){a.checkNumber(b,"pageSize",1,100);this.pageSize=b},setPlaceholder:function(b){a.optional.checkHtml(b,"placeholder");this.placeholder=b?j.safe(b):null;this.updateQuickview()},setMoreLabel:function(b){a.checkHtml(b,"moreLabel",1);this.moreLabel=j.safe(b);this.windowScope&&(this.windowScope.moreLabel=this.moreLabel)},setEmptyText:function(b){a.optional.checkHtml(b,"emptyText",1);this.emptyText=b;if(this.windowElement){var c=h(this.windowElement);c&&c.html(j.safe(b||"").toSafeString())}},setLoader:function(b){a.optional.checkHtml(b,"loader",1);this.loader=b;if(this.windowElement){var c=k(this.windowElement);c&&c.html(j.safe(b||"").toSafeString())}},setLoading:function(b){a.checkBoolean(b,"loading");this.loading=b;this.windowScope&&(this.windowScope.loading=b)},setOptionTemplate:function(b){a.checkString(b,"template");this.optionTranscludeFn=j.inject("$compile",function(a,c,d){a(i.elementTemplate(b))(c,d)})},linkModel:function(){var b=this;a.checkString(this.attrs.dwModel,this.attrs.$attr.dwModel||"dw-model",1);this.accessor=j.invoke("$parse",function(a){return a(b.attrs.dwModel)});a.checkArgument(_.isFunction(this.accessor.assign),"Not an assignable expression: "+this.attrs.dwModel);this.enclosingScope.$watch(this.attrs.dwModel,function(){b.updateView()})},linkSource:j.inject("$parse",function(b){a.checkString(this.attrs.dwSource,this.attrs.$attr.dwSource||"dw-source",1);var c=b(this.attrs.dwSource)(this.scope);a.checkArgument(c instanceof j.DataSource,"Not a DataSource: "+this.attrs.$attr.dwSource);this.setSource(c)}),linkSearchModel:j.inject("$parse",function(b){if(!_.isUndefined(this.attrs.dwSearchModel)){a.checkString(this.attrs.dwSearchModel,this.attrs.$attr.dwSearchModel,1);var c=b(this.attrs.dwSearchModel)(this.scope);a.checkArgument(c instanceof j.SearchModel,"Not a SearchModel: "+this.attrs.$attr.dwSearchModel);this.setSearchModel(c)}}),linkPageSize:function(){_.isUndefined(this.attrs.dwPageSize)||this.setPageSize(this.parseIntegerAttribute("dwPageSize"))},linkMore:function(){if(_.isUndefined(this.attrs.dwMore)){if(!_.isUndefined(this.attrs.dwMoreText)){var c=this;this.scope.$watch(c.attrs.dwMoreText,function(b){a.optional.checkHtml(b,c.attrs.$attr.dwMoreText);c.setMoreLabel(j.safe(b||""))})}}else{a.checkString(this.attrs.dwMore,this.attrs.$attr.dwMore,1);this.setMoreLabel(b.getSafeHtml(this.attrs.dwMore))}},linkEmpty:function(){if(_.isUndefined(this.attrs.dwEmpty)){if(!_.isUndefined(this.attrs.dwEmptyText)){var c=this;this.scope.$watch(c.attrs.dwEmptyText,function(b){a.optional.checkHtml(b,c.attrs.$attr.dwEmptyText);c.setEmptyText(j.safe(b||""))})}}else{a.checkString(this.attrs.dwEmpty,this.attrs.$attr.dwEmpty,1);this.setEmptyText(b.getSafeHtml(this.attrs.dwEmpty))}},linkLoader:function(){if(_.isUndefined(this.attrs.dwLoader)){if(!_.isUndefined(this.attrs.dwLoaderText)){var c=this;this.scope.$watch(c.attrs.dwLoaderText,function(b){a.optional.checkHtml(b,c.attrs.$attr.dwLoaderText);c.setLoader(j.safe(b||""))})}}else{a.checkString(this.attrs.dwLoader,this.attrs.$attr.dwLoader,1);this.setLoader(b.getSafeHtml(this.attrs.dwLoader).toString())}},link:j.inject("$compile",function(a){var b=this;this.quickviewCtrl=angular.element(this.element.children()[0]).controller("dwQuickview");this.quickviewCtrl.setVisible(this.visible);this.quickviewCtrl.setWindowRenderDelegate(function(c,d){b.windowScope=c;b.windowElement=d;_.assign(b.windowScope,{load:function(){b.load(!0).then(function(){b.renderOptions()})},next:function(){b.load().then(function(){b.renderOptions()})},onClick:function(a){b.onOptionClick(a)},moreLabel:b.moreLabel,emptyText:b.emptyText,options:b.options,total:b.total,loader:b.loader,loading:b.loading});b.windowScope.$on("$destroy",function(){b.onWindowClose()});b.windowElement.html(e(b.attrs));a(b.windowElement.contents())(b.windowScope);b.searchModel&&(b.searchModel.text=null);b.windowScope.load()});this.ngModelCtrl=angular.element(_.last(this.element.children())).controller("ngModel");this.linkInputStateHandler(this.ngModelCtrl)}),load:function(a){if(a){g(this.windowElement).html("");this.destroyRowScopes();this.rowScopes=[];this.setOptions([]);this.setTotal(0);this.setAllTotal(null)}var b=this,c=this.options.slice(0),d=(new j.SearchRequest).index(c.length).count(this.pageSize);this.searchModel&&d.searchModel(this.searchModel);this.setLoading(!0);return this.source.search(d).then(function(a){b.setOptions(c.concat(a.data()));b.setTotal(a.total());d.searchModel()&&!_.isBlank(d.searchModel().text)||b.setAllTotal(a.total());b.setLoading(!1)})},showWindow:function(){this.quickviewCtrl&&this.quickviewCtrl.setWindowVisible(!0)},hideWindow:function(){this.quickviewCtrl&&this.quickviewCtrl.setWindowVisible(!1)},renderOptions:j.inject("$compile",function(a){var b=this;if(!b.windowScope)return;var c=g(b.windowElement);c.html("");_.each(b.options,function(d,e){var g=b.windowScope.$new();b.rowScopes.push(g);g.dw$row=d;var h=a(angular.element(f(e)))(g);h.data("option",d);b.optionTranscludeFn(g,function(a){h.append(a)});c.append(h)});b.updateSelectedOption();b.windowScope.$emit(i.events.invalidate)}),onOptionClick:function(a){var b=this.options[a];this.accessor.assign(this.enclosingScope,b);this.ngModelCtrl.$setViewValue(b);this.quickviewCtrl.setWindowVisible(!1)},onWindowClose:function(){this.windowScope=null;this.windowElement=null;this.destroyRowScopes();this.rowScopes=[];this.setOptions([]);this.setTotal(0);this.setAllTotal(null)},updateView:function(){this.updateQuickview();this.updateSelectedOption()},updateQuickview:function(){if(!this.quickviewCtrl)return;this.destroyValueScope();var a=this.accessor(this.enclosingScope);var b=angular.element('<div class="dw-label"></div>');if(_.isUndefinedOrNull(a))b.html(j.safe(this.placeholder||"").toSafeString());else{this.valueScope=this.enclosingScope.$new();this.valueScope.dw$row=a;this.labelTranscludeFn(this.valueScope,function(a){b.append(a)})}this.quickviewCtrl.setLabelElement(b)},updateSelectedOption:function(){var a=this;if(!a.windowElement)return;var b=a.accessor(a.enclosingScope),c=g(a.windowElement);_.each(c.children(),function(a){a=angular.element(a);a.toggleClass("dw-selected",_.isEqual(a.data("option"),b))})},destroyValueScope:function(){this.valueScope&&this.valueScope.$destroy();this.valueScope=null},destroyRowScopes:function(){this.rowScopes&&_.each(this.rowScopes,function(a){a.$destroy()});this.rowScopes=null},destroy:function(){this.destroyValueScope();this.destroyRowScopes();this.labelTranscludeFn=null;this.optionTranscludeFn=null;this.accessor=null;this.source=null;this.searchModel=null;this.pageSize=null;this.placeholder=null;this.moreLabel=null;this.emptyText=null;this.loader=null;this.loading=null;this.quickviewCtrl=null;this.ngModelCtrl=null;this.options=null;this.total=null;this.allTotal=null;this.windowScope=null;this.windowElement=null;this.callParent()}});i.buist.directive("dwQuickList",function(){return{restrict:"E",replace:!1,template:d,scope:!0,transclude:!0,controller:["$scope","$element","$attrs","$transclude",j.internal.directives.QuickList],link:function(a,b,c,d){d.link()}}})});j.invoke("Preconditions",function(a){j.define(i.type("directives.QuickListOption"),{extend:i.type("directives.Directive"),link:function(b){a.checkString(this.attrs.dwQuickList,this.attrs.$attr.dwQuickList||"dw-quick-list",1);var c=i.dwId(this.scope,this.attrs.dwQuickList);a.checkArgument(!_.isUndefinedOrNull(c),"Not a <dw:id> in scope: "+this.attrs.dwQuickList);var d=j.element("."+this.createIdClass(c),!1);if(_.isUndefinedOrNull(d))throw new Error('Undefined: element with <dw:id> "'+this.attrs.dwQuickList+'"');var e=d.controller("dwQuickList");if(_.isUndefinedOrNull(e))throw new Error('Not a quick list: element with <dw:id> "'+this.attrs.dwQuickList+'"');e.setOptionTemplate(b)}});i.buist.directive("dwQuickListOption",function(){return{restrict:"E",replace:!1,scope:!0,controller:["$scope","$element","$attrs","$transclude",j.internal.directives.QuickListOption],compile:function(a){var b=a.html();a.html("");return function(a,c,d,e){e.link(b);c.remove()}}}})});j.invoke("Preconditions","AutoHide","ZIndex",function(a,b,c){function d(a){var b=i.element.parent(a,"dw-scroller");return b?angular.element(b):angular.element(window)}var e='<div class="dw-quickview" ng-mouseenter="dw$onMouseEnter()" ng-mouseleave="dw$onMouseLeave()" ng-click="dw$onClick()"><span class="dw-icon dw-glyph-caret-down" role="img"></span><span class="dw-label" ng-bind-html="dw$text | SafeHtml"></span></div>';var f=500;var g=["hover","click"];var h=["right","bottom"];var k='<div class="dw-quickview-window ng-hide">  <div class="dw-body"></div></div>';var l=j.inject("$timeout",function(a,d){var e,f,g=this,h=d.target,j=d.anchor,l=d.scope,m=angular.element(k);l.$on(i.events.resize,function(){g.updatePosition()});m[0].id=h[0].id+"-window";m.addClass("dw-anchor-"+d.anchor);d.tipClass&&m.addClass(d.tipClass);m.css("z-index",c.tooltip().toString());d.delegate(l,angular.element(m.children()[0]));angular.element(document.body).append(m);f=a(function(){g.updatePosition();if(d.autoHide){e=function(a){i.element.contains(m[0],a)||d.autoHide()};b.on(e)}f=null},0,!1);this.updatePosition=function(){var a,b,c=i.element.getViewSize(),d=h[0].getBoundingClientRect(),e=m[0].getBoundingClientRect(),f=window.pageXOffset,g=window.pageYOffset;switch(j){case"right":a=d.left+d.width+f;if(d.top+e.height+g<=c.height){b=d.top;m.removeClass("dw-bottom-justified")}else{b=d.bottom-e.height+g;m.addClass("dw-bottom-justified")}break;case"bottom":b=d.top+d.height+g;if(d.left+e.width+f<=c.width){a=d.left;m.removeClass("dw-right-justified")}else{a=d.right-e.width+f;m.addClass("dw-right-justified")}}m.removeClass("ng-hide");m.css({left:Math.floor(a)+"px",top:Math.floor(b)+"px"})};this.destroy=function(){f&&a.cancel(f);e&&b.off(e);m.remove();l.$destroy()}});j.define(i.type("directives.Quickview"),{extend:i.type("directives.ElementDirective"),constructor:function(a,b,c,e){this.callParent([a,b,c]);this.setEnabled(!0);this.setTrigger("hover");this.setAnchor("right");this.setWindowRenderDelegate(function(a,b){e(a,function(a){b.append(a)})});this.ensureId("dw-quickview-");this.linkText("dwLabel","dwLabelText","dwLabelFunction");this.linkEnabled("dwEnabled");this.linkVisible("dwVisible");this.linkWindowVisible();this.linkTrigger();this.linkAnchor();this.linkEventHandler("onMouseEnter","dw$onMouseEnter");this.linkEventHandler("onMouseLeave","dw$onMouseLeave");this.linkEventHandler("onClick","dw$onClick");var f=this;a.$on(i.events.invalidate,function(a){f.queueResizeWindow();a&&a.stopPropagation&&a.stopPropagation()});var g=d(this.element),h=function(){f.updatePosition()};g.on("scroll",h);this.removeScrollHandler=function(){g.off("scroll",h)}},queueResizeWindow:j.inject("$timeout",function(a){if(this.resizeWindowTimer)return;var b=this;this.resizeWindowTimer=a(function(){b.resizeWindow()},0,!1)}),resizeWindow:j.inject("$timeout",function(a){this.destroyResizeTimer();var b=this;a(function(){b.scope&&b.scope.$broadcast(i.events.resize)},0,!1)}),setText:function(b){a.optional.checkHtml(b,"text");this.scope.dw$text=b},setLabelElement:function(b){a.checkNotNull(b,"element");var c=angular.element(this.element.children()[0]);angular.element(c.children()[1]).replaceWith(b)},setEnabled:function(b){a.optional.checkBoolean(b,"enabled");this.enabled=!_.isBoolean(b)||b;this.element.toggleClass("dw-disabled",!this.enabled);!this.enabled&&this.setWindowVisible(!1)},setVisible:function(a){this.callParent(arguments);a||this.setWindowVisible(!1)},setTrigger:function(b){a.optional.checkString(b,"trigger");a.checkArgument(_.includes(g,b),"Unknown trigger: "+b);this.trigger=b;var c=this;_.each(g,function(a){c.element.toggleClass("dw-quickview-trigger-"+a,b===a)})},setAnchor:function(b){a.optional.checkString(b,"anchor");a.checkArgument(_.includes(h,b),"Unknown anchor: "+b);this.anchor=b;var c=this;_.each(h,function(a){c.element.toggleClass("dw-quickview-anchor-"+a,b===a)})},setWindowRenderDelegate:function(b){a.checkFunction(b,"windowRenderDelegate");this.windowRenderDelegate=b},setWindowVisible:function(b){a.checkBoolean(b,"windowVisible");if(this.windowParser){var c=this;c.windowParser.assign(c.enclosingScope,b)}else this.showOrHideWindow(b)},showOrHideWindow:function(b){a.checkBoolean(b,"display");b?this.showWindow():this.hideWindow()},linkTrigger:function(){if(!_.isUndefined(this.attrs.dwTrigger)){a.checkString(this.attrs.dwTrigger,this.attrs.$attr.dwTrigger,1);this.setTrigger(this.attrs.dwTrigger)}},linkAnchor:function(){if(!_.isUndefined(this.attrs.dwAnchor)){
a.checkString(this.attrs.dwAnchor,this.attrs.$attr.dwAnchor,1);this.setAnchor(this.attrs.dwAnchor)}},linkWindowVisible:j.inject("$parse","$timeout",function(b,c){var d="dwWindowVisible";if(!_.isUndefined(this.attrs[d])){var e=this;a.checkString(this.attrs[d],this.attrs.$attr[d],1);e.windowParser=b(this.attrs[d]);a.checkArgument(_.isFunction(e.windowParser.assign),"Not an assignable expression: "+this.attrs[d]);this.scope.$watch(this.attrs[d],function(b){a.optional.checkBoolean(b,e.attrs.$attr[d]);c(function(){e.showOrHideWindow(!0===b)})})}}),scheduleShowWindow:j.inject("$timeout",function(a){if(this.showTimeout)return;var b=this;this.showTimeout=a(function(){b.scope.$apply(function(){b.setWindowVisible(!0)})},f)}),showWindow:function(){this.destroyShowTimeout();var a,b=this;"click"===this.trigger&&(a=function(){b.setWindowVisible(!1)});this.window=new l({target:this.element,scope:this.scope.$new(),tipClass:this.attrs.dwTipClass,anchor:this.anchor,delegate:this.windowRenderDelegate,autoHide:a})},hideWindow:function(){this.destroyWindow();this.destroyShowTimeout()},onMouseEnter:function(){this.enabled&&"hover"===this.trigger&&this.scheduleShowWindow()},onMouseLeave:function(){"hover"===this.trigger&&this.setWindowVisible(!1)},onClick:function(){this.enabled&&"click"===this.trigger&&!this.window&&this.setWindowVisible(!0)},updatePosition:function(){this.window&&this.window.updatePosition()},destroyWindow:function(){this.window&&this.window.destroy();this.window=null},destroyShowTimeout:j.inject("$timeout",function(a){this.showTimeout&&a.cancel(this.showTimeout);this.showTimeout=null}),destroyResizeTimer:j.inject("$timeout",function(a){this.resizeWindowTimer&&a.cancel(this.resizeWindowTimer);this.resizeWindowTimer=null}),destroy:function(){this.destroyWindow();this.destroyShowTimeout();this.destroyResizeTimer();this.removeScrollHandler&&this.removeScrollHandler();this.removeScrollHandler=null;this.enabled=null;this.trigger=null;this.windowRenderDelegate=null;this.windowParser=null;this.callParent()}});i.buist.directive("dwQuickview",function(){return{restrict:"E",replace:!1,template:e,scope:!0,transclude:!0,controller:["$scope","$element","$attrs","$transclude",j.internal.directives.Quickview]}})});j.invoke("Preconditions",function(a){j.define(i.type("directives.Radio"),{extend:i.type("directives.ElementDirective"),constructor:function(a,b,c){this.callParent([a,b,c]);this.linkValues()},linkValues:j.inject("$parse",function(b){if(_.isUndefined(this.attrs.dwValues)){if(_.isUndefined(this.attrs.dwValuesFunction))throw new Error("Undefined: dw:values or dw:values-function");var c=b(this.attrs.dwValuesFunction)(this.scope);a.checkFunction(c,this.attrs.$attr.dwValuesFunction);this.matcher=c}else{var d=b(this.attrs.dwValues)(this.scope);_.isArray(d)||(d=[d]);this.matcher=function(a){return _.includes(d,a)}}}),link:function(a){a.addMatcher(this.matcher,this.attrs)},destroy:function(){this.matcher=null;this.callParent()}});i.buist.directive("dwRadio",function(){return{restrict:"E",replace:!1,scope:!0,require:["dwRadio","?^dwRadioGroup"],controller:["$scope","$element","$attrs",j.internal.directives.Radio],link:function(b,c,d,e){var f=e[0];var g=e[1];a.checkArgument(_.isObject(g),"Required enclosing <dw:radio-group>: <dw:radio>");f.link(g)}}})});j.invoke("Preconditions",function(a){function b(a){return i.dataAttributeRegexp.test(a)}function c(a){return f.test(a)}function d(a,b,c,d,e,f){var g='<div class="dw-radio'+e+'"'+d+">";g+='<input type="radio" ng-model="dw$index" class="dw-validate-ignore" name="'+i.encodeAttr(b)+'"'+f;_.isUndefined(a.dwEnabled)||(g+=' ng-disabled="disabled"');g+=">";g+='<span class="dw-label" ng-bind-html="'+c+' | SafeHtml"></span>';return g+"</div>"}function e(a){return function(b,c){var e=a+"-mutex",f=d(c,e,"dw$placeholder",' ng-hide="dw$hidePlaceholder"'," dw-placeholder",' value=""');f+=d(c,e,"dw$labelOf(dw$option)",' ng-repeat="dw$option in dw$options"',"",' ng-value="$index + 1" ng-click="dw$onSelect($index)"');return f+'<input type="hidden" ng-model="'+c.dwModel+'" name="'+a+'" />'}}var f=/^(checked|disabled)$/i;var g={attrs:{$attr:{}}};j.define(i.type("directives.RadioGroup"),{extend:i.type("directives.ElementDirective"),constructor:function(b,c,d){a.checkString(d.dwModel,"dw-model",1);this.getOptions=j.invoke("$parse",function(a){return a(d.dwOptions)});a.checkArray(this.getOptions(b),"dw-options");this.callParent([b,c,d]);this.ensureId("dw-radio-group-");var f=d.name||_.uniqueId("dw-radio-group-");this.template=e(f);this.matchers=[];this.childClassName="dw-radio";this.linkValue("dwValueProperty");this.linkLabel("dwFormat","dwFormatFunction","dwLabelProperty");this.linkPlaceholder("dwPlaceholder","dwPlaceholderText");this.linkEnabled("dwEnabled");this.linkVisible("dwVisible");var g=this;b.dw$valueOf=function(a){return g.valueOf(a)};b.dw$labelOf=function(a){return g.labelOf(a)};this.bind("dw$model",this.enclosingScope,d.dwModel);this.bind("dw$options",this.enclosingScope,d.dwOptions);this.linkEventHandler("onSelect","dw$onSelect");c.addClass("dw-radio-group");c.addClass("dw-validate-input")},setFormat:function(b){a.checkFunction(b,"format");this.format=b},setPlaceholder:function(b){a.optional.checkHtml(b,"text");b instanceof i.SafeHtml&&(b=_.unescape(b.toString()));this.scope.dw$placeholder=b?b.toString():""},linkValue:function(b){if(!_.isUndefined(this.attrs[b])){a.checkString(this.attrs[b],this.attrs.$attr[b],1);a.checkArgument(_.isEmpty(this.getOptions(this.scope))||_.isObject(this.getOptions(this.scope)[0]),"Not an array of objects: "+this.attrs.$attr.dwOptions);this.valueProperty=this.attrs[b]}},linkLabel:function(b,c,d){this.linkFormat(b,c);if(!this.format&&!_.isUndefined(this.attrs[d])){a.checkString(this.attrs[d],this.attrs.$attr[d],1);a.checkArgument(_.isEmpty(this.getOptions(this.scope))||_.isObject(this.getOptions(this.scope)[0]),"Not an array of objects: "+this.attrs.$attr.dwOptions);this.labelProperty=this.attrs[d]}},addMatcher:function(b,c){a.checkFunction(b,"matcher");a.checkDefined(c,"attrs");this.matchers.push({fn:b,attrs:c})},link:j.inject("$compile",function(a){function b(){var a=_.findIndex(c.getOptions(c.scope),function(a){return c.valueOf(a)===c.scope.dw$model});c.scope.dw$index=-1===a?"":a+1;c.scope.dw$hidePlaceholder=-1!==a}var c=this;c.element.html(c.template(c.element,c.attrs));a(c.element.contents())(c.scope);c.ngModelCtrl=this.getNgModelController();c.linkInputStateHandler(c.ngModelCtrl);c.scope.$watch(function(){c.linkChildren()});c.scope.$watch("dw$model",b);c.scope.$watchCollection("dw$options",b)}),getNgModelController:function(){return angular.element(_.last(this.element.children())).controller("ngModel")},getChildren:function(){return this.element.children()},linkChildren:function(){var a,b,c=this.getChildren(),d=this.getOptions(this.scope),e=0;for(var f=0;f<c.length;f++){a=angular.element(c[f]);if(!this.isPlaceholder(a)){b=g;for(var h=0;h<this.matchers.length;h++)if(!0===this.matchers[h].fn(d[e])){b=this.matchers[h];break}this.linkChild(a,b);e++}a.addClass(this.childClassName)}},isPlaceholder:function(a){return""===a.find("input").attr("value")},linkChild:function(a,d){(a[0].className||d.attrs.class)&&(a[0].className=d.attrs.class||"");(a[0].style.cssText||d.attrs.style)&&(a[0].style.cssText=d.attrs.style||"");for(var e=0;e<a[0].attributes.length;e++){var f=a[0].attributes.item(e);b(f.nodeName)&&a.removeAttr(f.nodeName);c(f.nodeName)&&a.removeProp(f.nodeName)}var g=_.invert(d.attrs.$attr);_.each(_.keys(g),function(e){b(e)&&a.attr(e,d.attrs[g[e]]);c(e)&&a.prop(e,!!d.attrs[g[e]])})},valueOf:function(a){if(this.valueProperty)return a?a[this.valueProperty]:null;return a},labelOf:function(a){var b;b=this.format?this.format(a):this.labelProperty?a?a[this.labelProperty]:null:a;return _.isUndefinedOrNull(b)?"":b.toString()},onSelect:function(a){var b=this.getOptions(this.scope),c=parseInt(a,10);!_.isNaN(c)&&c>=0&&c<b.length&&(this.scope.dw$model=this.valueOf(b[c]));this.ngModelCtrl.$setDirty()},destroy:function(){this.template=null;this.matchers=null;this.childClassName=null;this.valueProperty=null;this.labelProperty=null;this.ngModelCtrl=null;this.callParent()}});i.buist.directive("dwRadioGroup",function(){return{restrict:"E",replace:!1,scope:!0,require:"dwRadioGroup",controller:["$scope","$element","$attrs",j.internal.directives.RadioGroup],link:function(a,b,c,d){d.link()}}})});j.invoke("ZIndex",function(a){function c(a){var b=[];_.each(a,function(a){b.push(angular.element(a))});return b}function d(a){return angular.element(i.element.parent(a,l))}function e(a){var c,d=a.parent();for(;d[0];){c=b.getComputedStyle(d[0]);if(_.includes(["absolute","relative"],c.getPropertyValue("position")))return d;d=d.parent()}return angular.element(document.body)}function f(a,b,c){var d;switch(a[0].nodeName.toLowerCase()){case"thead":d=a.clone();d.removeClass(k);break;default:d=angular.element("<div></div>")}d[0].id=_.uniqueId("dw-placeholder-");d.addClass(n);d.css({display:b.getPropertyValue("display"),position:b.getPropertyValue("position"),top:b.getPropertyValue("top"),left:b.getPropertyValue("left"),width:c.width+"px",height:c.height+"px"});return d}function g(a){switch(a[0].nodeName.toLowerCase()){case"thead":var b=a[0].parentNode,c=b.querySelector("colgroup"),d=i.element.parent(a,"dw-pinnable-container"),e=angular.element('<table class="dw-pinnable" data-dw-for="thead"></table>');a.removeClass(k);b.removeChild(a[0]);e.append(angular.element(c).clone());e.append(a);angular.element(d).append(e);return e}return a}function h(a){switch(a.attr("data-dw-for")){case"thead":var b=i.element.parent(a,"dw-pinnable-container"),c=angular.element(b).find("table"),d=a.find("thead");a[0].removeChild(d[0]);a.remove();c[0].insertBefore(d[0],c.find("tbody")[0]);d.addClass(k)}}var k="dw-pinnable";var l="dw-pinnable-container";var m="dw-pinned";var n="dw-pinnable-placeholder";j.define(i.type("directives.Scroller"),{extend:i.type("directives.Directive"),constructor:function(a,b,c){this.callParent([a,b,c]);this.ensureId("dw-scroller-");var d=this;b.on("scroll",function(){d.onScroll()});a.$on(i.events.invalidate,function(){d.onInvalidate()});a.$on(i.events.workspaces.transitionend,function(){d.onTransition()});a.$on(i.events.resize,function(){d.onResize()});b.addClass("dw-scroller "+l)},onScroll:function(){this.updatePinnedElements()},onInvalidate:function(){this.queueUpdatePinnedElements()},onTransition:function(){this.element[0].scrollTop=0;this.queueUpdatePinnedElements()},onResize:j.inject("$timeout",function(a){var b=this,c=b.getPinnables();_.each(c,function(a){b.unpin(a)});a(function(){if(!b.scope)return;b.updatePinnedElements()},100,!1)}),getPinnables:function(){if(!this.element)return[];return c(this.element[0].querySelectorAll("."+k))},queueUpdatePinnedElements:j.inject("$timeout",function(a){if(this.updateTimer)return;var b=this;this.updateTimer=a(function(){b.updatePinnedElements()},0,!1)}),updatePinnedElements:function(){this.destroyUpdateTimer();var a=this,b=a.getPinnables(),c=[],e=[];_.each(b,function(a){var b=d(a),f=_.findIndex(c,b);if(-1===f){c.push(b);e.push([a])}else e[f].push(a)});_.each(c,function(b,c){a.updatePinnedContainerElements(b,e[c])})},updatePinnedContainerElements:function(c,d){function f(a){var b=k[a.id];if(!b){b=a.getBoundingClientRect();k[a.id]=b}return b}var g=this,h=this.element[0].scrollTop,i=this.element[0].getBoundingClientRect(),j=h,k={};_.each(d,function(a){""===a[0].id&&(a[0].id=_.uniqueId("dw-pinnable-"))});d.sort(function(a,b){var c=a.hasClass(m)?a.data("dw$placeholder"):a[0],d=b.hasClass(m)?b.data("dw$placeholder"):b[0],e=f(c),g=f(d);return e.top-g.top});_.each(d,function(d,k){function l(){var a=e(d),b=0;a[0]!==g.element[0]&&(b=h-i.top+Math.floor(a[0].getBoundingClientRect().top));return j-b-Math.max(0,j-t+Math.floor(n.height))}var n,o,p=b.getComputedStyle(d[0]),q="none"!==p.getPropertyValue("display"),r=d.hasClass(m),s=f(c[0]),t=s.top+s.height-i.top+h,u=(a.pinned()+k).toString();if(r){n=f(d.data("dw$placeholder"));o=n.top-i.top+h;if(!q||(h<=o||t<=h)&&(j<=o||t<=j))g.unpin(d);else{g.updatePinned(d,l());j+=Math.floor(n.height);g.pinnedHeight+=Math.floor(n.height)}}else{n=f(d[0]);o=n.top-i.top+h;if(q&&(h>o&&t>h||j>o&&t>j)){g.pin(d,l(),u,p,n);j+=Math.floor(n.height);g.pinnedHeight+=Math.floor(n.height)}}})},pin:function(a,b,c,d,e){var h=f(a,d,e);a[0].parentNode.insertBefore(h[0],a[0].nextSibling);a=g(a);a.addClass(m);a.data({dw$top:a.css("top"),dw$width:a.css("width"),dw$height:a.css("height"),dw$zIndex:a.css("zIndex"),dw$placeholder:h[0]});a.css({top:Math.floor(b)+"px",width:e.width+"px",height:Math.ceil(e.height)+"px",zIndex:c})},updatePinned:function(a,b){a.css({top:Math.floor(b)+"px"})},unpin:function(a){if(!a.hasClass(m))return;var b=a.data("dw$placeholder");a.css({top:a.data("dw$top")||"",width:a.data("dw$width")||"",height:a.data("dw$height")||"",zIndex:a.data("dw$zIndex")||""});a.data("dw$top",null);a.data("dw$width",null);a.data("dw$height",null);a.data("dw$zIndex",null);a.data("dw$placeholder",null);a.removeClass(m);h(a);angular.element(b).remove()},destroyUpdateTimer:j.inject("$timeout",function(a){this.updateTimer&&a.cancel(this.updateTimer);this.updateTimer=null}),destroy:function(){this.destroyUpdateTimer();this.callParent()}});i.buist.directive("dwScroller",function(){return{restrict:"E",replace:!1,scope:!1,controller:["$scope","$element","$attrs",j.internal.directives.Scroller]}})});j.invoke("Preconditions","Configuration","SearchFilters","AutoHide","Keys",function(a,b,c,d,e){function f(a,b){var c='<input type="text" class="dw-text" ng-change="dw$onChange()" ng-model="model" ng-focus="dw$onFocus()" ng-blur="dw$onBlur()"';_.isUndefined(b.autocomplete)||(c+=' autocomplete="'+i.encodeAttr(b.autocomplete)+'"');if(!_.isUndefined(b.dwTooltip)){c+=' dw-tooltip="'+i.encodeAttr(b.dwTooltip)+'"';a.removeAttr("dw-tooltip")}_.isUndefined(b.dwPlaceholder)&&_.isUndefined(b.dwPlaceholderText)||(c+=' ng-attr-placeholder="{{placeholder}}"');_.isUndefined(b.dwEnabled)||(c+=' ng-disabled="disabled"');c+=" />";a.hasClass("slds-glyph-search")?c+='<dw:button class="slds-primary" dw-handler="dw$onTriggerClick" dw-label-text="dw$triggerLabelText"':c+='<dw:button class="dw-trigger dw-glyphicon dw-glyph-search" dw-handler="dw$onTriggerClick" dw-label-text="dw$triggerLabelText"';_.isUndefined(b.dwEnabled)?c+=' dw-enabled="dw$valid"':c+=' dw-enabled="!$parent.disabled && dw$valid"';c+="></dw:button>";if(!_.isUndefined(b.dwFilterSource)){c+='<dw:quick-list class="dw-add-filter" dw-model="dw$attribute" dw-source="'+b.dwFilterSource+'" dw-search-model="dw$attributeSearchModel" dw-tip-class="dw-add-filter-window"';_.isUndefined(b.dwEnabled)||(c+=' dw-enabled="!$parent.disabled"');_.isUndefined(b.dwFilterSayt)||(c+=' dw-sayt="'+i.encodeAttr(b.dwFilterSayt)+'"');c+=">{{ dw$row.label().toString() }}</dw:quick-list>"}c+='<div dw-model="'+i.encodeAttr(b.dwModel)+'.text" class="ng-hide"><input type="hidden" ng-model="value"';_.isUndefined(b.name)||(c+=' name="'+i.encodeAttr(b.name)+'"');c+=" /></div>";return c}function g(a){var b,c=a.children();for(var d=0;d<c.length;d++){b=angular.element(c[d]);if(b.hasClass("dw-add-filter"))return b}return null}function h(a,b){var c=_.uniqueId("searchfilter");var d='<div class="dw-search-filter-editor '+(b?"dw-adding":"dw-editing")+'">';d+='<form name="'+c+'"';a.editor.validator&&(d+=' dw-validate="'+a.editor.validator+'"');d+=">";d+='<dw:button class="dw-back dw-size-mini dw-icononly dw-glyphicon dw-glyph-angle-double-left" dw-handler="dw$back"></dw:button>';d+='<div class="dw-close dw-glyph-times-circle dw-glyph-sm" role="img" ng-click="dw$close()"></div>';d+='<div class="dw-label" ng-bind-html="dw$filter.attribute().label() | SafeHtml"></div>';d+='<div class="dw-editor">';d+=a.editor.template;d+="</div>";if(!1!==a.editor.showSave){d+='<div class="dw-buttons">';d+='<dw:button dw-label-text="dw$saveLabel" dw-handler="dw$save" dw-enabled="'+c+'.$valid"></dw:button>';d+="</div>"}d+="</form>";return d+"</div>"}function k(a,b){var c='<div class="dw-filter" data-id="'+b.attribute().id()+'">';c+="<div>";c+='<div class="dw-label" ng-bind-html="dw$filter.attribute().label() | SafeHtml"></div>';c+='<div class="dw-value" ng-click="dw$edit()">';c+=a.value.template;c+="</div>";c+='<div class="dw-remove dw-glyph-times-circle dw-glyph-sm" role="img" ng-click="dw$remove()" ng-show="dw$enabled"></div>';c+="</div>";return c+"</div>"}function l(a){return function(){a.scope.dw$valid=!1;a.validateCtrl.validate(a.attrs.dwModel+".text",a.value).then(function(){a.scope.dw$valid=!0})}}var m=200;var n=[13,8,46];var o=[8,46];i.config["i18n.search.button.addFilter"]="Add Filter";j.define(i.type("directives.Search"),{extend:i.type("directives.TextDirective"),constructor:function(b,d,e){a.checkString(e.dwModel,e.$attr.dwModel||"dw-model",1);var f=j.invoke("$parse",_.identity);a.checkArgument(_.isFunction(f(e.dwModel).assign),"Not an assignable expression: "+e.dwModel);a.checkArgument(f(e.dwModel)(b)instanceof j.SearchModel,"Not a SearchModel: "+e.$attr.dwModel);this.callParent([b,d,e,e.dwModel+".text","dw-search-",!1]);this.setSearchFilters(c);this.filtersScope=this.enclosingScope.$new();this.filterScopes={};this.setEnabled(!0);this.linkText("dwLabel","dwLabelText","dwLabelFunction");this.linkHandler("dwHandler","dwGrid");this.linkSearchFilters();this.linkFilterSource();this.linkSayT();this.linkEventHandler("onTriggerClick","dw$onTriggerClick");var g=this;this.autoHideHandler=function(a){g.onAutoHide(a)};d.addClass("dw-search");d.addClass("dw-validate-input")},setText:function(b){a.optional.checkHtml(b,"safeHtml");this.scope.dw$triggerLabelText=b},setEnabled:function(a){this.callParent([a]);this.filtersScope.dw$enabled=a;this.element.toggleClass("dw-disabled",!a);if(!a){this.destroySchedule();this.destroyFilterEditor()}},createTooltip:function(b){a.checkHtml(b,"safeHtml");return j.create(i.type("widget.StickyTooltip"),{target:angular.element(this.element.children()[0]),template:j.safe(b).toString(),scope:this.scope})},setSearchFilters:function(a){this.searchFilters=a},setSayt:function(b){a.checkBoolean(b,"sayt");this.sayt=b},setSuggestion:function(b){a.optional.checkObject(b,"suggestion");this.suggestion=b||null},getSuggestion:function(){return this.suggestion},linkHandler:j.inject("$parse",function(b,c,d){a.checkString(c,"handlerName",1);a.checkString(d,"gridName",1);var e,f,g=this;if(_.isUndefined(this.attrs[c])){if(_.isUndefined(this.attrs[d]))throw new Error("Undefined: dw-handler or dw-grid");a.checkString(this.attrs[d],this.attrs.$attr[d],1);this.handler=function(){e=i.dwId(g.scope,g.attrs[d]);a.checkArgument(!_.isUndefinedOrNull(e),"Not a <dw:id> in scope: "+this.attrs[d]);f=j.element("."+g.createIdClass(e),!1);if(_.isUndefinedOrNull(f))throw new Error('Undefined: element with <dw:id> "'+this.attrs[d]+'"');var b=f.controller("dwGrid");if(_.isUndefinedOrNull(b))throw new Error('Not a grid: element with <dw:id> "'+this.attrs[d]+'"');b.reset({group:!1,page:!0,selection:!1,sort:!1})}}else{var h=b(this.attrs[c])(this.scope);a.checkFunction(h,this.attrs.$attr[c]);this.handler=h}}),linkSearchFilters:j.inject("$parse",function(b){if(!_.isUndefined(this.attrs.dwSearchFilters)){var c=b(this.attrs.dwSearchFilters)(this.scope);a.checkArgument(c instanceof i.SearchFilters,"Not a SearchFilters: "+this.attrs.$attr.dwSearchFilters);this.setSearchFilters(c)}}),linkFilterSource:function(){if(_.isUndefined(this.attrs.dwFilterSource))return;_.assign(this.scope,{dw$attributeSearchModel:new j.SearchModel});var b=this;this.scope.$watch("dw$attribute",function(c){a.checkArgument(_.isUndefinedOrNull(c)||c instanceof j.SearchAttribute,"Not a SearchAttribute: filter attribute");if(c instanceof j.SearchAttribute){delete b.scope.dw$attribute;b.onFilterSelect(c)}});this.enclosingScope.$watchCollection(this.attrs.dwModel+".filters()",function(){b.updateFiltersView()})},linkSayT:function(){_.isUndefined(this.attrs.dwSayt)||this.setSayt(this.parseBooleanAttribute("dwSayt"))},link:function(a,b){this.callParent([a]);this.validateCtrl=b;this.scope.dw$valid=!0;this.validateCtrl&&this.scope.$watch(this.attrs.dwModel+".text",l(this));var c=angular.element(this.element.children()[0]),d=new j.KeyBinding(j.KeyBinding.ENTER,function(){this.scope&&this.scope.$apply(this.scheduleSearch.bind(this))}.bind(this));e.add(d,c[0]);this.deregisterEnter=function(){e.remove(d,c[0])};if(this.sayt){c.on("keypress",function(a){_.includes(n,a.keyCode)||this.scheduleSearch()}.bind(this));c.on("keydown",function(a){_.includes(o,a.keyCode)&&this.scheduleSearch()}.bind(this));_.forEach(["cut","paste"],function(a){c.on(a,function(){this.scheduleSearch()}.bind(this))}.bind(this))}var f=g(this.element);f&&(this.quickListCtrl=f.controller("dwQuickList"))},updateModelText:j.inject("$parse",function(a){a(this.attrs.dwModel+".text").assign(this.enclosingScope,this.value)}),addModelFilter:j.inject("$parse",function(a,b){a(this.attrs.dwModel+".filters()")(this.enclosingScope).push(b)}),removeModelFilter:j.inject("$parse",function(a,b){var c=a(this.attrs.dwModel+".filters()")(this.enclosingScope);_.remove(c,b)}),scheduleSearch:j.inject("$timeout",function(a){this.destroySchedule();var b=this;this.scheduledSearch=a(function(){b.search()},m)}),search:function(){this.destroySchedule();this.scope&&this.scope.dw$valid&&this.handler()},acceptSuggestion:function(a){this.element[0].blur();this.value=a;this.scope.model=a;this.updateModelText();this.search()},showFilterEditor:j.inject("$compile","$controller","$timeout","ZIndex",function(c,f,i,k,l,m){function n(){m.css("width",m.children()[0].clientWidth+"px")}function o(){r?p.addModelFilter(l):n();p.search();p.destroyFilterEditor()}var p=this,q=this.searchFilters.get(l.attribute()),r=!m;a.checkNotNull(q,"No registered search filter for attribute type: "+l.attribute().type()+" and id: "+l.attribute().id());r&&(m=g(this.element));this.destroyFilterEditor();this.filterEditorScope=this.enclosingScope.$new();_.assign(this.filterEditorScope,{dw$filter:l,dw$back:function(){p.destroyFilterEditor();p.quickListCtrl.showWindow()},dw$close:function(){p.destroyFilterEditor()},dw$save:o,dw$update:function(){if(r){o();i(function(){p.onFilterSelect(l.attribute())})}else{n();p.search()}},dw$saveLabel:j.safe(b["i18n.search.button.addFilter"])});this.filterEditor=angular.element(h(q,r));q.editor.controller&&f(q.editor.controller,{$scope:this.filterEditorScope,$config:q.defaults||{}});c(this.filterEditor.contents())(this.filterEditorScope);if(!1!==q.editor.saveOnEnter){var s=this.filterEditor.children()[0],t=s.getAttribute("name"),u=new j.KeyBinding(j.KeyBinding.ENTER,function(){_.get(p.filterEditorScope,t+".$valid")&&p.filterEditorScope.$apply(function(){p.filterEditorScope.dw$save()})});e.add(u,s).preventDefault(!1);p.deregisterFilterEditorEnter=function(){e.remove(u,s)}}i(function(){d.on(p.autoHideHandler)},0,!1);this.filterEditorAutoHideIgnore=q.editor.autoHideIgnore;var v=m[0].getBoundingClientRect();this.filterEditor.css({top:v.top+v.height+"px",left:v.left+"px","z-index":k.tooltip().toString()});angular.element(document.body).append(this.filterEditor)}),hasFocus:function(){return document.activeElement===this.element.find("input")[0]},updateFiltersView:j.inject("$parse","$compile","$timeout","$controller",function(b,c,d,e){var f,g,h=this,i=b(this.attrs.dwModel+".filters()")(this.enclosingScope),j=_.keyBy(i,function(a){return a.attribute().id()});_.each(this.element.children(),function(a){a=angular.element(a);if(a.hasClass("dw-filter")){f=a.attr("data-id");g=j[f];if(g)delete j[f];else{h.filterScopes[f]&&h.filterScopes[f].$destroy();delete h.filterScopes[f];a.addClass("dw-removing");d(function(){a.remove()},!1)}}});var l,m,n;_.each(j,function(b){l=h.searchFilters.get(b.attribute());a.checkNotNull(l,"No registered search filter for attribute type: "+b.attribute().type()+" and id: "+b.attribute().id());n=angular.element(k(l,b));m=h.filtersScope.$new();_.assign(m,{dw$filter:b,dw$remove:function(){h.removeModelFilter(b);h.search()},dw$edit:function(){m.dw$enabled&&h.showFilterEditor(b,n)}});h.filterScopes[b.id()]=m;l.value.controller&&e(l.value.controller,{$scope:m,$config:l.defaults||{}});c(n.contents())(m);h.element.append(n);n.addClass("dw-adding");d(function(){n.removeClass("dw-adding")},0,!1)})}),onTriggerClick:function(){this.search()},onFilterSelect:j.inject("$parse",function(a,b){var c,d=a(this.attrs.dwModel+".filters()")(this.enclosingScope),e=_.find(d,function(a){return a.attribute().id()===b.id()});if(e)c=angular.element(_.find(this.element.children(),function(a){a=angular.element(a);return a.hasClass("dw-filter")&&a.attr("data-id")===b.id()}));else{e=new j.SearchFilter(b);c=null}this.showFilterEditor(e,c)}),onAutoHide:function(a){if(this.filterEditor&&this.filterEditor[0]&&i.element.contains(this.filterEditor[0],a))return;if(this.filterEditorAutoHideIgnore&&(angular.element(a).hasClass(this.filterEditorAutoHideIgnore)||i.element.parent(a,this.filterEditorAutoHideIgnore)))return;this.destroyFilterEditor()},destroySchedule:j.inject("$timeout",function(a){this.scheduledSearch&&a.cancel(this.scheduledSearch);this.scheduledSearch=null}),destroyFilterEditor:j.inject("$parse",function(a){this.deregisterFilterEditorEnter&&this.deregisterFilterEditorEnter();this.deregisterFilterEditorEnter=null;this.autoHideHandler&&d.off(this.autoHideHandler);if(this.filterEditor){var b=this.filterEditor.children()[0],c=b.getAttribute("name"),e=this.filterEditorScope;if(a(c+".$invalid")(e)){var f=e.dw$filter.id(),g=this.filterScopes[f];g&&g.dw$remove()}this.filterEditor.remove()}this.filterEditor=null;this.filterEditorScope=null;this.filterEditorAutoHideIgnore=null}),destroyFilterScopes:function(){_.each(_.values(this.filterScopes),function(a){a.$destroy()});this.filterScopes=null},destroy:function(){this.deregisterEnter&&this.deregisterEnter();this.deregisterEnter=null;this.destroySchedule();this.destroyFilterEditor();this.destroyFilterScopes();this.filtersScope=null;this.searchFilters=null;this.sayt=null;this.suggestion=null;this.autoHideHandler=null;this.validateCtrl=null;this.quickListCtrl=null;this.callParent()}});i.buist.directive("dwSearch",function(){return{restrict:"E",replace:!1,template:f,scope:!0,require:["dwSearch","?^dwValidate"],controller:["$scope","$element","$attrs",j.internal.directives.Search],link:function(a,b,c,d){var e=angular.element(b.children()[0]);d[0].link(e.controller("ngModel"),d[1])}}})});j.invoke("Preconditions","Configuration","SearchFilters","Validator",function(a,b,c,d){function e(c,e,g,h){var i=j.safe(e.trueText||b["i18n.searchfilter.boolean.true"]),k=j.safe(e.falseText||b["i18n.searchfilter.boolean.false"]);a.checkHtml(i,"Boolean search filter config.trueText",1);a.checkHtml(k,"Boolean search filter config.falseText",1);c.dw$trueText=g.trustAsHtml(i.toSafeString());c.dw$falseText=g.trustAsHtml(k.toSafeString());c.dw$click=function(){h(c.dw$update)};c.dw$validator=d.of(f)}var f=d.rule({dw$filter:{value:d.rule().required().boolean()}});i.config["i18n.searchfilter.boolean.true"]="Yes";i.config["i18n.searchfilter.boolean.false"]="No";c.type("boolean",{editor:{showSave:!1,saveOnEnter:!1,controller:["$scope","$config","$sce","$timeout",e],validator:"dw$validator",template:'<div class="dw-boolean"><div class="dw-value dw-true"><input type="radio" ng-model="dw$filter.value" ng-value="{{ true }}" ng-click="dw$click()" dw-default-focus><span class="dw-label" ng-bind-html="dw$trueText"></span></div><div class="dw-value dw-false"><input type="radio" ng-model="dw$filter.value" ng-value="{{ false }}" ng-click="dw$click()"><span class="dw-label" ng-bind-html="dw$falseText"></span></div>'},value:{controller:["$scope","$config","$sce",e],template:'<div class="dw-boolean" ng-bind-html="dw$filter.value ? dw$trueText : dw$falseText"></div>'}})});j.invoke("SearchFilters","Preconditions","Validator","Configuration",function(a,b,c,d){function e(a){a.dw$validator=c.of({dw$filter:{value:c.rule().required().date()}})}function f(a,e){var f=j.safe(e.labelFrom||d["i18n.searchfilter.dateRange.from"]),g=j.safe(e.labelTo||d["i18n.searchfilter.dateRange.to"]),h=j.safe(e.separatorText||d["i18n.searchfilter.dateRange.separator"]);b.checkHtml(f,"Date range search filter config.labelFrom",1);b.checkHtml(g,"Date range search filter config.labelTo",1);b.checkHtml(h,"Date range search filter config.separatorText",1);a.dw$labelFrom=f;a.dw$labelTo=g;a.dw$separatorText=h;a.dw$validator=c.of({dw$filter:{value:{from:c.rule().required().date(),to:c.rule().date()}}})}function g(b){a.type(b,{editor:{controller:["$scope",e],validator:"dw$validator",template:'<div class="dw-date"><dw:date-field name="input" dw-model="'+k+'" dw-format="'+b+'" dw-default-focus></dw:date-field></div>',autoHideIgnore:"dw-calendar-popup"},value:{template:'<div class="dw-date">{{'+k+" | Formats:'"+b+"' }}</div>"}})}function h(b){a.type(b+"-range",{editor:{controller:["$scope","$config",f],validator:"dw$validator",template:'<div class="dw-date dw-date-range">  <div class="dw-date-range-from">    <div class="dw-label" ng-bind-html="dw$labelFrom | SafeHtml"></div>    <dw:date-field name="from" dw-model="'+k+'.from" dw-format="'+b+'" dw-default-focus></dw:date-field>  </div>  <div class="dw-date-range-to">    <div class="dw-label" ng-bind-html="dw$labelTo | SafeHtml"></div>    <dw:date-field name="to" dw-model="'+k+'.to" dw-format="'+b+'"></dw:date-field>  </div></div>',autoHideIgnore:"dw-calendar-popup"},value:{controller:["$scope","$config",f],template:'<div class="dw-date"><span>{{'+k+".from | Formats:'"+b+'\'}}</span><span ng-bind-html="dw$separatorText | SafeHtml"></span><span>{{'+k+".to | Formats:'"+b+"'}}</span></div>"}})}var k="dw$filter.value";i.config["i18n.searchfilter.dateRange.from"]="From";i.config["i18n.searchfilter.dateRange.to"]="To";i.config["i18n.searchfilter.dateRange.separator"]=" - ";g("date");g("datetime");h("date");h("datetime")});j.invoke("Preconditions","Configuration","SearchFilters","Validator","Formats",function(a,b,c,d,e){function f(c,e,f){a.checkArray(e.options,"Enum search filter config.options",1);a.optional.checkNumber(e.count,"Enum search filter config.count",1);var g=new j.SearchModel,h=new j.SearchRequest;h.searchModel(g);h.sort("label");h.ascending(!0);e.count&&h.count(e.count);var i=new j.ArrayDataSource(e.options);i.addPropertySearcher("label");c.dw$placeholder=j.safe(e.searchPlaceholder||b["i18n.searchfilter.enum.search.placeholder"]);c.dw$searchModel=g;c.dw$options=e.options;c.dw$search=function(){i.search(h).then(function(a){c.dw$filtered=a.data()})};c.dw$isSelected=function(a){return!!c.dw$selected[a.value]};c.dw$validator=d.of(d.rule({dw$filter:{value:d.rule().required().array({min:1})}}));c.$watchCollection("dw$filter.value",function(a){c.dw$selected={};_.each(a,function(a){c.dw$selected[a]=!0})});f(function(){c.$watchCollection("dw$selected",function(a){c.dw$filter.value=[];_.each(a,function(a,b){a&&c.dw$filter.value.push(b)})})});c.dw$click=function(a){"INPUT"===a.target.nodeName.toUpperCase()&&f(c.dw$update)};c.dw$search()}function g(c,d){a.checkArray(d.options,"Enum search filter config.options",1);c.$watchCollection("dw$filter.value",function(a){var f=[];_.each(d.options,function(b){_.includes(a,b.value)&&f.push(b.label)});0===f.length?c.dw$formattedValues=b["i18n.searchfilter.enum.value.all"]:c.dw$formattedValues=e.get("array")(f)})}i.config["i18n.searchfilter.enum.search.placeholder"]="Find Value";i.config["i18n.searchfilter.enum.value.all"]="All";c.type("enum",{editor:{showSave:!1,saveOnEnter:!1,controller:["$scope","$config","$timeout",f],validator:"dw$validator",
template:'<div class="dw-enum"><dw:search dw-model="dw$searchModel" dw-handler="dw$search" dw-placeholder-text="dw$placeholder" dw-sayt="true" dw-visible="dw$options.length > 10"></dw:search><input type="hidden" name="dw$filterValue" ng-model="dw$filter.value" /><div class="dw-options"><div class="dw-option" ng-repeat="dw$option in dw$filtered"><input type="checkbox" ng-model="dw$selected[dw$option.value]" ng-click="dw$click($event)" /><label class="dw-label">{{ dw$option.label }}</label></div></div></div>'},value:{controller:["$scope","$config",g],template:'<div class="dw-enum"><span class="dw-options" ng-bind-html="dw$formattedValues | SafeHtml"></span></div>'}})});j.invoke("SearchFilters","Validator",function(a,b){function c(a){a.dw$validator=b.of(d)}var d=b.rule({dw$filter:{value:b.rule().required().integer()}});a.type("integer",{editor:{controller:["$scope",c],validator:"dw$validator",template:'<div class="dw-integer"><dw:text-field name="input" dw-model="dw$filter.value" dw-format="integer" dw-default-focus></dw:text-field></div>'},value:{template:"<div class=\"dw-integer\">{{ dw$filter.value | Formats:'integer' }}</div>"}})});j.invoke("SearchFilters","Validator",function(a,b){function c(a){a.dw$validator=b.of(d)}var d=b.rule({dw$filter:{value:b.rule().required().string()}});a.type("string",{editor:{controller:["$scope",c],validator:"dw$validator",template:'<div class="dw-string"><dw:text-field name="input" dw-model="dw$filter.value" dw-default-focus></dw:text-field></div>'},value:{template:'<div class="dw-string">{{ dw$filter.value }}</div>'}})});j.invoke("Preconditions","AutoHide",function(a,b){function c(a){var b=j.element("."+a.searchIdClass,!1);if(_.isUndefinedOrNull(b))throw new Error('Undefined: element with <dw:id> class "'+a.searchIdClass+'"');return b}function d(a){var b=c(a).controller("dwSearch");if(_.isUndefinedOrNull(b))throw new Error('Not a search: element with <dw:id> class "'+a.searchIdClass+'"');return b}j.define(i.type("directives.SearchSuggest"),{extend:i.type("directives.ElementDirective"),constructor:function(c,d,e){a.checkString(e.dwModel,e.$attr.dwModel||"dw-model",1);this.getModel=j.invoke("$parse",function(a){return a(e.dwModel)});a.checkArgument(this.getModel(c)instanceof j.SearchModel,"Not a SearchModel: "+e.$attr.dwModel);this.callParent([c,d,e]);this.sources=[];this.dismissed=!1;this.setVisible(!1);c.loading=!1;this.ensureId("dw-search-suggest-");this.linkSearch();var f=this;c.$watch(e.dwModel+".text",function(){f.onSearchTextChange()});this.windowHandler=function(){f.alignPopup()};angular.element(window).on("scroll",this.windowHandler);this.autoHideHandler=function(a){i.element.contains(f.element[0],a)||f.scope.$apply(function(){f.dismissed=!0;f.updateVisible()})};b.on(f.autoHideHandler);d.addClass("dw-search-suggest")},addSource:function(a){this.sources.push(a)},linkSearch:function(){a.checkString(this.attrs.dwSearch,this.attrs.$attr.dwSearch||"dw-search",1);var b=i.dwId(this.scope,this.attrs.dwSearch);a.checkArgument(!_.isUndefinedOrNull(b),"Not a <dw:id> in scope: "+this.attrs.dwSearch);this.searchIdClass=this.createIdClass(b)},link:function(){a.checkArgument(0!==this.sources.length,"Required: <dw:search-suggest-source>");a.checkNotNull(d(this))},acceptSuggestion:j.inject("$timeout",function(a,b,c){var e=d(this);e.setSuggestion(c);e.acceptSuggestion(b);a(function(){if(!this.scope)return;this.dismissed=!0;this.updateVisible()}.bind(this),0,!1)}),scheduleLoad:j.inject("$timeout",function(a){this.cancel();this.dismissed=!1;var b=this.getModel(this.scope);_.each(this.sources,function(a){a.onScheduleLoad(b)});var c=this;this.schedulePromise=a(function(){c.load();c.schedulePromise=null},100)}),load:function(){this.cancel();var a=this.getModel(this.scope);_.each(this.sources,function(b){b.load(a)})},cancel:j.inject("$timeout",function(a){a.cancel(this.schedulePromise)}),alignPopup:function(){var a=c(this);this.element.css({top:a[0].offsetTop+a[0].offsetHeight+"px",left:a[0].offsetLeft+"px",width:a.find("input")[0].offsetWidth+"px"})},updateVisible:function(){this.setVisible(!this.dismissed&&!_.isBlank(this.getModel(this.scope).text)&&d(this).hasFocus());this.alignPopup()},onSearchTextChange:function(){this.scheduleLoad();this.updateVisible()},destroy:function(){this.cancel();this.autoHideHandler&&b.off(this.autoHideHandler);angular.element(window).off("scroll",this.windowHandler);this.windowHandler=null;this.sources=null;this.searchIdClass=null;this.callParent()}});i.buist.directive("dwSearchSuggest",function(){return{restrict:"E",replace:!1,template:function(a){return a.html()},scope:!0,require:"dwSearchSuggest",controller:["$scope","$element","$attrs",j.internal.directives.SearchSuggest],link:function(a,b,c,d){d.link()}}})});j.invoke("Preconditions","Messages","ObjectUtils",function(a,b,c){function d(a,b){var c='<div class="dw-results" ng-hide="dw$loading">';c+='<div class="dw-result" ng-repeat="dw$result in dw$results" ng-click="dw$onClick(dw$result)">';c+="<div>"+a.html()+"</div>";c+="</div>";c+="</div>";_.isUndefined(b.dwLoader)&&_.isUndefined(b.dwLoaderText)||(c+='<div class="dw-loader" ng-hide="!dw$loading" ng-bind-html="dw$loader | SafeHtml"></div>');_.isUndefined(b.dwPlaceholder)&&_.isUndefined(b.dwPlaceholderText)||(c+='<div class="dw-placeholder" ng-hide="dw$loading || dw$results.length > 0" ng-bind-html="dw$placeholder | SafeHtml"></div>');return c}function e(){_.forEach(this.element[0].querySelectorAll(".dw-results .dw-result"),function(a){angular.element(a).toggleClass("is-selected",!1)})}function f(a){-1!==a&&angular.element(this.element[0].querySelector(".dw-results .dw-result:nth-of-type("+(a+1)+")")).toggleClass("is-selected",!0)}j.define(i.type("directives.SearchSuggestSource"),{extend:i.type("directives.ElementDirective"),constructor:function(b,c,d){a.checkString(d.dwSource,d.$attr.dwSource||"dw-source",1);var e=j.invoke("$parse",function(a){return a(d.dwSource)(b)});a.checkArgument(e instanceof j.DataSource,"Not a DataSource: "+d.$attr.dwSource);this.callParent([b,c,d]);this.source=e;this.setFormat(i.toStringFormat);this.ensureId("dw-search-suggest-source-");this.linkFormat();this.linkCount("dwCount");this.linkLoader("dwLoader","dwLoaderText");this.linkPlaceholder("dwPlaceholder","dwPlaceholderText");this.linkEventHandler("onClick","dw$onClick");c.addClass("dw-source")},setLoader:j.inject("$sce",function(b,c){a.optional.checkHtml(c,"text");this.scope.dw$loader=c}),setPlaceholder:j.inject("$sce",function(b,c){a.optional.checkHtml(c,"text");this.scope.dw$placeholder=c}),setFormat:function(b){a.checkFunction(b,"format");this.format=b},linkFormat:function(){if(!_.isUndefined(this.attrs.dwFormat)||!_.isUndefined(this.attrs.dwFormatFunction))return this.callParent(["dwFormat","dwFormatFunction"]);if(_.isUndefined(this.attrs.dwTextProperty))throw new Error("Required: either dw-format, dw-format-function, or dw-text-property");a.checkString(this.attrs.dwTextProperty,this.attrs.$attr.dwTextProperty,1);this.setFormat(function(a){return function(b){return b[a]}}(this.attrs.dwTextProperty))},linkCount:function(b){if(_.isUndefined(this.attrs[b]))this.count=5;else{var c=this.parseIntegerAttribute(b);a.checkNumber(c,this.attrs.$attr[b],1);this.count=c}},linkLoader:function(c,d){a.checkString(c,"keyName",1);a.checkString(d,"textName",1);if(_.isUndefined(this.attrs[c])){if(!_.isUndefined(this.attrs[d])){var e=this;this.scope.$watch(e.attrs[d],function(b){a.optional.checkHtml(b,e.attrs.$attr[d]);e.setLoader(j.safe(b||""))})}}else{a.checkString(this.attrs[c],this.attrs.$attr[c],1);this.setLoader(b.getSafeHtml(this.attrs[c]).toString())}},link:function(a){this.searchSuggest=a;a.addSource(this)},onScheduleLoad:function(a){this.cancel();this.scope.dw$results=[];if(!a.text)return;this.scope.dw$loading=!0;this.element.addClass("dw-loading")},load:j.inject("$timeout",function(a,b){this.cancel();if(!b.text)return;var c=new j.SearchRequest;c.count(this.count);c.searchModel(b);this.loadPromise=this.source.search(c);this.loadPromise.then(function(b){return a(function(){if(!this.scope)return;var a=this.scope;a.dw$loading=!1;delete a.dw$resultSelected;this.element.removeClass("dw-loading");var c=_.take(b.data(),this.count);a.dw$results=c;this.loadPromise=null;return c}.bind(this))}.bind(this))}),cancel:function(){this.loadPromise&&_.isFunction(this.loadPromise.cancel)&&this.loadPromise.cancel();this.loadPromise=null},onClick:function(a){delete this.scope.dw$resultSelected;this.searchSuggest.acceptSuggestion(this.format(a),a)},onKey:function(a){if(!this.scope)return;switch(a.keyCode){case i.keyCodes[j.KeyBinding.DOWN]:return this.onKeyArrowDown(a);case i.keyCodes[j.KeyBinding.UP]:return this.onKeyArrowUp(a);case i.keyCodes[j.KeyBinding.ENTER]:return this.onKeyEnter(a)}},onKeyArrowDown:function(a){a.preventDefault();a.stopPropagation();if(this.scope){e.call(this);var b=_.get(this.scope,"dw$results.length",0),d=_.get(this.scope,"dw$resultSelected",-1);d=b<=0?0:_.min([b-1,d+1]);f.call(this,d);c.set(this.scope,"dw$resultSelected",d)}},onKeyArrowUp:function(a){a.preventDefault();a.stopPropagation();if(this.scope){e.call(this);var b=_.get(this.scope,"dw$results.length",0),d=_.get(this.scope,"dw$resultSelected",-1);d=b<=0?-1:_.max([-1,d-1]);f.call(this,d);c.set(this.scope,"dw$resultSelected",d)}},onKeyEnter:function(a){a.preventDefault();a.stopPropagation();if(!this.scope)return;var b=_.get(this.scope,"dw$resultSelected",-1),c=_.get(this.scope,"dw$results["+b+"]");c&&this.onClick(c)},destroy:function(){this.cancel();this.source=null;this.format=null;this.searchSuggest=null;this.callParent()}});i.buist.directive("dwSearchSuggestSource",function(){return{restrict:"E",replace:!1,template:d,scope:!0,require:["dwSearchSuggestSource","^?dwSearchSuggest"],controller:["$scope","$element","$attrs",j.internal.directives.SearchSuggestSource],link:function(b,c,d,e){var f=e[0],g=e[1];a.checkArgument(_.isObject(g),"Required enclosing <dw:search-suggest>: <dw:search-suggest-source>");f.link(g)}}})});j.invoke("Preconditions",function(a){function b(a){return i.dataAttributeRegexp.test(a)||f.test(a)}function c(a){return _.isUndefinedOrNull(a)||_.isArray(a)&&0===a.length}function d(a,b){var c='<select class="dw-select"';_.isUndefined(b.multiple)||(c+=" multiple");_.isUndefined(b.size)||(c+=' size="'+i.encodeAttr(b.size)+'"');_.isUndefined(b.dwEnabled)||(c+=' ng-disabled="!('+i.encodeAttr(b.dwEnabled)+')"');c+=" ng-transclude></select>";c+='<input type="hidden" ng-model="'+i.encodeAttr(b.dwModel)+'"';_.isUndefined(b.name)||(c+=' name="'+i.encodeAttr(b.name)+'"');return c+" />"}function e(a){var b=_.isUndefinedOrNull(a),c=this.selectElement[0].multiple;c&&(b=b||_.isArray(a)&&0===a.length);var d=this.selectElement.children();for(var e=0;e<d.length;e++){var f=angular.element(d[e]),g=this.options[parseFloat(f.val())];g=this.valueOf(g);0===e&&b||c&&_.includes(a,g)||!c&&a===g?f.prop("selected",!0):f.prop("selected",!1)}}var f=/^(checked|disabled)$/i;j.define(i.type("directives.Select"),{extend:i.type("directives.ElementDirective"),constructor:function(a,b,c){this.callParent([a,b,c]);this.ensureId("dw-select-");this.matchers=[];this.linkModel();this.linkOptions();this.linkValue("dwValueProperty");this.linkLabel("dwFormat","dwFormatFunction","dwLabelProperty");this.linkPlaceholder("dwPlaceholder","dwPlaceholderText");this.linkEnabled("dwEnabled");this.linkVisible("dwVisible");this.linkModelProcessor("dwModelProcessor");var d=this;a.dw$labelOf=function(a){return d.labelOf(a)};a[c.multiple?"$watchCollection":"$watch"](c.dwModel,function(a,b){a!==b&&d.onModelChange()});this.enclosingScope.$on(i.events.invalidate,function(a){d.updateOptionsView();a&&a.stopPropagation&&a.stopPropagation()});b.addClass("dw-validate-input")},setOptions:function(b){a.checkArray(b,"options");this.options=b;this.updateOptionsView()},setFormat:function(b){a.checkFunction(b,"format");this.format=b},setPlaceholder:j.inject("$sce",function(b,c){a.optional.checkHtml(c,"text");this.scope.dw$placeholder=b.trustAsHtml(j.safe(c||"").toSafeString())}),linkModel:j.inject("$parse",function(b){a.checkString(this.attrs.dwModel,"dw-model",1);this.accessor=b(this.attrs.dwModel);a.checkArgument(_.isFunction(this.accessor.assign),"Not an assignable expression: "+this.attrs.$attr.dwModel+'="'+this.attrs.dwModel+'"')}),linkOptions:function(){a.checkArgument(_.isString(this.attrs.dwOptions)&&this.attrs.dwOptions.length>0,"Not an array: "+(this.attrs.$attr.dwOptions||"dw-options"));var b=this;this.scope.$watchCollection(this.attrs.dwOptions,function(c){a.checkArray(c,b.attrs.$attr.dwOptions);b.setOptions(c)})},linkValue:function(b){if(!_.isUndefined(this.attrs[b])){a.checkString(this.attrs[b],this.attrs.$attr[b],1);this.valueProperty=this.attrs[b]}},linkLabel:function(b,c,d){this.linkFormat(b,c);if(!this.format&&!_.isUndefined(this.attrs[d])){a.checkString(this.attrs[d],this.attrs.$attr[d],1);this.labelProperty=this.attrs[d]}},addMatcher:function(b,c){a.checkFunction(b,"matcher");a.checkDefined(c,"attrs");this.matchers.push({fn:b,attrs:c})},link:function(){this.selectElement=angular.element(_.first(this.element.children()));this.ngModelCtrl=angular.element(_.last(this.element.children())).controller("ngModel");this.linkInputStateHandler(this.ngModelCtrl);var a=this;this.selectElement.on("change",function(){a.scope.$apply(function(){a.onViewChange()})})},updateOptionsView:j.inject("$compile",function(a){if(!this.options)return;var c,d,f,g=this,h=this.accessor(this.enclosingScope);this.destroyOptionsScope();this.optionsScope=this.scope.$new();this.selectElement.html("");this.placeholderElement=null;f='<option class="dw-option" value="" ng-bind-html="dw$placeholder"';this.selectElement.append(f+"></option>");this.placeholderElement=angular.element(_.first(this.selectElement.children()));_.each(this.options,function(a,e){f='<option value="'+e+'" ng-bind-html="dw$labelOf(('+g.attrs.dwOptions+")["+e+'])"';c=angular.element(f+"></option>");d=_.find(g.matchers,function(b){return!0===b.fn(a)});if(d){(c[0].className||d.attrs.class)&&(c[0].className=d.attrs.class||"");(c[0].style.cssText||d.attrs.style)&&(c[0].style.cssText=d.attrs.style||"");for(var h=0;h<c[0].attributes.length;h++){var i=c[0].attributes.item(h);b(i.nodeName)&&c.removeAttr(i.nodeName)}var j=_.invert(d.attrs.$attr);_.each(_.keys(j),function(a){b(a)&&c.attr(a,d.attrs[j[a]])})}c.addClass("dw-option");g.selectElement.append(c)});a(this.selectElement.contents())(this.optionsScope);this.runModelProcessor(h,"pre").then(function(a){if(!g.scope)return;e.call(g,a);g.updatePlaceholderVisible(a)})}),updatePlaceholderVisible:function(a){if(this.attrs.dwPlaceholder||this.attrs.dwPlaceholderText)return;var b=this,c=this.placeholderElement[0]===_.first(this.selectElement.children()),d=_.isUndefinedOrNull(a)||-1===_.findIndex(this.options,function(c){return b.selectElement[0].multiple?_.includes(a,b.valueOf(c)):a===b.valueOf(c)});if(d&&!c){this.selectElement.prepend(this.placeholderElement[0]);_.each(this.selectElement.children(),function(a,b){a.selected=0===b})}else!d&&c&&this.placeholderElement.remove()},valueOf:function(b){if(this.valueProperty){a.checkArgument(_.isUndefinedOrNull(b)||_.isObject(b),"Not an array of objects: "+this.attrs.$attr.dwOptions);return b?b[this.valueProperty]:null}return b},labelOf:j.inject("$sce",function(b,c){var d;if(this.format)d=this.format(c);else if(this.labelProperty){a.checkArgument(_.isUndefinedOrNull(c)||_.isObject(c),"Not an array of objects: "+this.attrs.$attr.dwOptions);d=c?c[this.labelProperty]:null}else d=c?c.toString():null;return b.trustAsHtml(j.safe(d||"").toSafeString())}),onViewChange:function(){var a=null,b=this;if(this.selectElement[0].multiple&&!c(this.selectElement[0].value)){a=[];_.each(this.selectElement.val(),function(b){var c=this.valueOf(this.options[parseFloat(b)]);_.isUndefinedOrNull(c)||a.push(c)}.bind(this))}else!this.selectElement[0].multiple&&this.selectElement[0].value&&(a=this.valueOf(this.options[parseFloat(this.selectElement[0].value)]));this.runModelProcessor(a,"post").then(function(a){if(!b.scope)return;b.accessor.assign(b.enclosingScope,a);b.ngModelCtrl.$setDirty()})},onModelChange:function(){if(!this.options)return;var a,b=this,c=this.accessor(this.enclosingScope);this.selectElement[0].multiple?this.runModelProcessor(c,"pre").then(function(c){if(!b.scope)return;a=[];_.each(b.options,function(d,e){_.includes(c,b.valueOf(d))&&a.push(e.toString())});if(!_.isEqual(b.selectElement.val(),a)){b.selectElement.val(a);e.call(b,c)}b.updatePlaceholderVisible(c)}):this.runModelProcessor(c,"pre").then(function(c){if(!b.scope)return;a=_.findIndex(b.options,function(a){return b.valueOf(a)===c});var d=-1===a?"":a.toString();b.selectElement[0].value=d;b.updatePlaceholderVisible(c)})},destroyOptionsScope:function(){this.optionsScope&&this.optionsScope.$destroy();this.optionsScope=null},destroy:function(){this.destroyOptionsScope();this.accessor=null;this.matchers=null;this.options=null;this.valueProperty=null;this.labelProperty=null;this.selectElement=null;this.ngModelCtrl=null;this.placeholderElement=null;this.callParent()}});i.buist.directive("dwSelect",function(){return{restrict:"E",replace:!1,template:d,scope:!0,require:"dwSelect",transclude:!0,controller:["$scope","$element","$attrs",j.internal.directives.Select],link:function(a,b,c,d){d.link()}}})});!function(){j.define(i.type("directives.Sidebar"),{extend:i.type("directives.ExpanderDirective"),constructor:function(a,b,c,d){this.callParent([a,b,c,d,function(a){var c=angular.element(b.children()[0]);angular.element(c.children()[0]).append(a)}]);this.ensureId("dw-sidebar-");var e=this;this.transcludeScope.$on(i.events.invalidate,function(){e.onInvalidate()});b.addClass("dw-sidebar")},onInvalidate:function(){this.queueUpdateView()},queueUpdateView:j.inject("$timeout",function(a){if(this.updateViewTimer)return;var b=this;this.updateViewTimer=a(function(){b.updateView()},0,!1)}),updateView:function(){this.destroyUpdateTimer();this.callParent();if(this.expanded){var a=angular.element(this.element.children()[0]),b=angular.element(a.children()[0]);this.element.css("width",b[0].getBoundingClientRect().width+"px")}else this.element.css("width","0px")},destroyUpdateTimer:j.inject("$timeout",function(a){this.updateViewTimer&&a.cancel(this.updateViewTimer);this.updateViewTimer=null}),destroy:function(){this.destroyUpdateTimer();this.callParent()}});i.buist.directive("dwSidebar",function(){return{restrict:"E",replace:!1,template:function(a,b){var c='<div class="dw-panel"';_.isUndefined(b.dwKeyStroke)||(c+=' dw-key="dw$onKey($event)" dw-key-stroke="'+b.dwKeyStroke+'"');return c+'><div class="dw-body"></div></div>'},scope:!0,transclude:!0,controller:["$scope","$element","$attrs","$transclude",j.internal.directives.Sidebar]}})}();j.invoke("Preconditions",function(a){var b='<dw:button class="dw-icononly dw-glyphicon dw-glyph-caret-up dw-increment" dw-handler="dw$onIncrement" dw-enabled="!$parent.disabled && !dw$incrementInvalid"></dw:button><dw:button class="dw-icononly dw-glyphicon dw-glyph-caret-down dw-decrement" dw-handler="dw$onDecrement" dw-enabled="!$parent.disabled && !dw$decrementInvalid"></dw:button>';j.define(i.type("directives.Spinner"),{extend:i.type("directives.ElementDirective"),constructor:function(b,c,d){a.checkString(d.dwModel,d.$attr.dwModel||"dw-model",1);this.callParent([b,c,d]);this.accessor=j.invoke("$parse",function(a){return a(d.dwModel)});a.checkArgument(_.isFunction(this.accessor.assign),"Not an assignable expression: "+d.dwModel);this.ensureId("dw-spinner-");this.setStep(1);this.setEnabled(!0);this.linkStep();this.linkVisible("dwVisible");this.linkEnabled("dwEnabled");this.linkFormInput();this.linkEventHandler("onIncrement","dw$onIncrement");this.linkEventHandler("onDecrement","dw$onDecrement");b.invalid=!0;var e=this;b.$watch(d.dwModel,function(a){e.onModelChange(a)});c.addClass("dw-spinner dw-valid is-valid dw-pristine is-unchanged is-untouched")},setStep:function(b){a.checkNumber(b,"step",1e-6);this.step=b},linkStep:function(){if(!_.isUndefined(this.attrs.dwStep)){var b=this.parseDecimalAttribute("dwStep");a.checkNumber(b,this.attrs.$attr.dwStep,1e-6);this.setStep(b)}},linkFormInput:j.inject("ObjectPath","$timeout",function(b,c){var d=this,e=d.attrs.name;if(!e)return;this.element.removeAttr("name");var f=b.parse(e);if(1===_.size(f)){d.inputName=e;d.formCtrl=d.element.inheritedData("$formController");a.checkArgument(_.isObject(d.formCtrl),"Required enclosing <form>: <dw:spinner>")}else{var g=_.first(f);d.inputName=f.slice(1).join("");a.checkString(d.inputName,"Form input name",1);var h=j.CSS.escape(g),i='[name="'+h+'"]',k=document.querySelector("form"+i+", ng-form"+i+', [ng-form="'+h+'"]');if(_.isUndefinedOrNull(k))throw new Error('Undefined: Form with name "'+g+'"');c(function(){d.formCtrl=angular.element(k).controller("form");a.checkNotNull(d.formCtrl,'Form with name "'+g+'"')},0,!1)}d.scope.$watch(function(){var a=d.inputName?_.get(d.formCtrl,d.inputName):null;return!a||!1!==a.$valid},function(a,b){a!==b&&d.updateValidStyle(d.element,a)});d.scope.$watch(function(){var a=d.inputName?_.get(d.formCtrl,d.inputName):null;return!a||!1!==a.$pristine},function(a,b){a!==b&&d.updatePristineStyle(d.element,a)});d.scope.$watch(function(){var a=d.inputName?_.get(d.formCtrl,d.inputName):null;return!a||!1!==a.$untouched},function(a,b){a!==b&&d.updateUntouchedStyle(d.element,a)})}),link:function(a){this.validateCtrl=a},onModelChange:j.inject("$timeout",function(a,b){this.scope.dw$incrementInvalid=!0;this.scope.dw$decrementInvalid=!0;var c=this;a(function(){if(!c.scope)return;var a=c.validateCtrl&&c.validateCtrl.get(c.attrs.dwModel);if(a){a.validate(b+c.step).then(function(){c.scope&&(c.scope.dw$incrementInvalid=!1)},function(){c.scope&&(c.scope.dw$incrementInvalid=!0)});a.validate(b-c.step).then(function(){c.scope&&(c.scope.dw$decrementInvalid=!1)},function(){c.scope&&(c.scope.dw$decrementInvalid=!0)})}else{c.scope.dw$incrementInvalid=!_.isNumber(b);c.scope.dw$decrementInvalid=c.scope.dw$incrementInvalid}})}),onIncrement:function(){var b=this.accessor(this.scope);a.checkNumber(b,"Spinner value");b+=this.step;this.accessor.assign(this.enclosingScope,b);this.updateViewValue(b)},onDecrement:function(){var b=this.accessor(this.scope);a.checkNumber(b,"Spinner value");b-=this.step;this.accessor.assign(this.enclosingScope,b);this.updateViewValue(b)},updateViewValue:j.inject("$parse",function(b,c){if(!this.formCtrl)return;var d=b(this.inputName)(this.formCtrl);a.checkDefined(d,"Spinner linked ngModel controller");var e=d.$formatters,f=e.length;for(;f--;)c=e[f](c);d.$setViewValue(c)}),destroy:function(){this.accessor=null;this.step=null;this.validateCtrl=null;this.formCtrl=null;this.inputName=null;this.callParent()}});i.buist.directive("dwSpinner",function(){return{restrict:"E",replace:!1,template:b,scope:!0,controller:["$scope","$element","$attrs",j.internal.directives.Spinner],link:function(a,b,c,d){var e=b.parent("ng-form")||b.parent("form");e&&d.link(e.controller("dwValidate"))}}})});!function(){j.define(i.type("directives.Summary"),{extend:i.type("directives.ElementDirective"),constructor:function(a,b,c){this.callParent([a,b,c]);this.ensureId("dw-summary-");b.addClass("dw-summary")}});i.buist.directive("dwSummary",function(){return{restrict:"E",replace:!1,template:function(a){return a.html()},scope:!0,controller:["$scope","$element","$attrs",j.internal.directives.Summary]}})}();j.invoke("Preconditions",function(a){var b='<div class="dw-label" ng-bind-html="dw$label | SafeHtml"></div><div class="dw-value" ng-transclude></div>';j.define(i.type("directives.SummaryValue"),{extend:i.type("directives.ElementDirective"),constructor:function(a,b,c){this.callParent([a,b,c]);this.format=i.toStringFormat;this.ensureId("dw-summary-value-");this.linkText("dwLabel","dwLabelText","dwLabelFunction");this.linkModel();this.linkFormat("dwFormat","dwFormatFunction");b.addClass("dw-summary-value")},setText:function(b){a.optional.checkHtml(b,"text");this.scope.dw$label=b},setFormat:function(b){a.checkFunction(b,"format");this.format=b;_.isUndefined(this.getValue)||this.updateView()},linkModel:j.inject("$parse",function(b){if(!_.isUndefined(this.attrs.dwModel)){a.checkString(this.attrs.dwModel,this.attrs.$attr.dwModel,1);this.getValue=b(this.attrs.dwModel);var c=this;this.scope.$watch(this.attrs.dwModel,function(){c.updateView()})}}),updateView:function(){var b=this.format(this.getValue(this.scope));a.optional.checkHtml(b,"formatted summary value");var c=this.element.children()[1];angular.element(c).html(j.safe(b||"").toSafeString())},destroy:function(){this.format=null;this.getValue=null;this.callParent()}});i.buist.directive("dwSummaryValue",function(){return{restrict:"E",replace:!1,template:b,scope:!0,transclude:!0,controller:["$scope","$element","$attrs",j.internal.directives.SummaryValue]}})});j.invoke("Preconditions",function(a){j.define(i.type("directives.Tab"),{extend:i.type("directives.ElementDirective"),constructor:function(a,b,c,d){this.callParent([a,b,c]);this.transcludeScope=a.$new();this.setInitial(!1);this.setEnabled(!0);this.setVisible(!0);this.linkName();this.linkText("dwTitle","dwTitleText","dwTitleFunction");this.linkInitial();this.linkEnabled("dwEnabled");this.linkVisible("dwVisible");var e=this;d(this.transcludeScope,function(a){e.element.append(a)});b.addClass("dw-tab")},setName:function(b){a.checkString(b,"name",1);this.name=b},setText:function(b){a.optional.checkHtml(b,"title");this.title=b},setInitial:function(b){a.checkBoolean(b,"initial");this.initial=b},setEnabled:function(b){a.checkBoolean(b,"enabled");this.enabled=b;this.tabs&&this.tabs.onTabChange()},setVisible:function(b){a.checkBoolean(b,"visible");this.visible=b;this.tabs&&this.tabs.onTabChange()},linkName:function(){a.checkString(this.attrs.dwName,this.attrs.$attr.dwName||"dw-name",1);this.setName(this.attrs.dwName)},linkInitial:function(){_.isUndefined(this.attrs.dwInitial)||this.setInitial(this.parseBooleanAttribute("dwInitial"))},link:function(a){this.element.data("name",this.name);this.className=this.attrs.class;this.tabs=a;a.add(this);this.initial&&a.setActive(this.name)},onActivate:function(){this.transcludeScope.$broadcast(i.events.disclose)},destroy:function(){this.transcludeScope=null;this.name=null;this.title=null;this.initial=null;this.tabs=null;this.className=null;this.callParent()}});i.buist.directive("dwTab",function(){return{restrict:"E",replace:!1,template:"",scope:!0,transclude:!0,require:["dwTab","?^dwTabs"],controller:["$scope","$element","$attrs","$transclude",j.internal.directives.Tab],link:function(b,c,d,e){var f=e[0];var g=e[1];a.checkArgument(_.isObject(g),"Required enclosing <dw:tabs>: <dw:tab>");a.checkArgument(_.isUndefinedOrNull(d.ngShow),"Incompatible: ngShow on dwTab");f.link(g)}}})});j.invoke("Preconditions",function(a){function b(b){a.checkArgument(!/<[^>]*dw(:|-|_)tab[^>]*ng(:|-|_)if=[^>]*>/g.test(b.html()),"Incompatible: ngIf on dwTab");var c=b.hasClass(e),d='<div class="dw-tabs"';c&&(d+=' dw-layout="border"');d+=">";d+='<div class="dw-header"';c&&(d+=' dw-layout-border-position="north"');d+="></div>";d+='<div class="dw-body"';c&&(d+=' dw-layout-border-position="center"');d+=">"+b.html()+"</div>";return d+"</div>"}function c(a){var b='<div class="dw-tab';a.className&&(b+=" "+a.className);b+='" ng-click="dw$onHeaderClick(\''+a.name+'\')" data-name="'+i.encodeAttr(a.name)+'">';b+='<span class="dw-icon" role="img"></span>';b+='<span class="dw-label"></span>';return b+"</div>"}function d(a){return a.enabled&&a.visible}var e="dw-fit";j.define(i.type("directives.Tabs"),{extend:i.type("directives.ElementDirective"),constructor:function(a,b,c){this.callParent([a,b,c]);this.tabs={};this.setFit(!1);this.ensureId("dw-tabs-");this.linkVisible("dwVisible");this.linkActive();this.linkFit();this.linkEventHandler("onHeaderClick","dw$onHeaderClick")},add:function(b){a.checkDefined(b,"tab");a.checkArgument(_.isUndefined(this.tabs[b.name]),"Duplicate tab name: "+b.name);this.tabs[b.name]=b},setActive:function(b){a.optional.checkString(b,"active",1);if(b===this.active||_.isUndefinedOrNull(this.active)&&_.isUndefinedOrNull(b)||!this.tabs[b]||!d(this.tabs[b]))return;var c=this.active;this.active=b;this.activeAccessor&&this.activeAccessor.assign(this.enclosingScope,this.active);this.updateView();!this.fit&&_.isString(c)&&this.scope.$emit(i.events.invalidate)},setFit:function(b){a.checkBoolean(b,"fit");this.fit=b},linkActive:j.inject("$parse",function(b){if(!_.isUndefined(this.attrs.dwActive)){this.activeAccessor=b(this.attrs.dwActive);a.checkArgument(_.isFunction(this.activeAccessor.assign),"Not an assignable expression: "+this.attrs.dwActive);var c=this;this.scope.$watch(this.attrs.dwActive,function(a){c.setActive(a)})}}),linkFit:function(){this.setFit(this.element.hasClass(e))},link:j.inject("$compile",function(b){a.checkArgument(_.keys(this.tabs).length>0,"Required: one or more <dw:tab>");var d=this;this.activeAccessor&&d.setActive(this.activeAccessor(this.scope));d.updateActive();var e=angular.element(d.element.children()[0]),f=angular.element(e.children()[0]),g="";_.each(_.values(d.tabs),function(a){g+=c(a)});f.html(g);b(f.children())(d.scope);_.each(_.values(d.tabs),function(a){d.scope.$watch(function(){return a.title},function(){d.updateTitle(a.name)})});d.updateView()}),onHeaderClick:function(a){this.tabs[a]&&d(this.tabs[a])&&this.setActive(a)},onTabChange:function(){this.updateActive();this.updateView()},updateActive:function(){if(_.isUndefined(this.active)||!d(this.tabs[this.active])){var b=_.find(_.values(this.tabs),d);a.checkArgument(!_.isUndefinedOrNull(b),"No tab that can be activated");this.setActive(b.name)}},updateView:function(){if(!this.element)return;var a=this,b=angular.element(this.element.children()[0]),c=b.children(),d=angular.element(c[0]),e=angular.element(c[1]);_.each(_.values(this.tabs),function(b){b.active=b.name===a.active;var c=_.find(d.children(),function(a){return angular.element(a).attr("data-name")===b.name});if(c){c=angular.element(c);c.toggleClass("dw-active",!0===b.active);c.toggleClass("dw-disabled",!1===b.enabled);c.toggleClass("ng-hide",!1===b.visible)}var f=_.find(e.children(),function(a){return angular.element(a).data("name")===b.name});f&&angular.element(f).toggleClass("ng-hide",!1===b.active);b.active&&b.onActivate()})},updateTitle:function(b){var c=this.tabs[b];if(_.isUndefinedOrNull(c))return;var d=j.safe(c.title||""),e=angular.element(this.element.children()[0]),f=angular.element(e.children()[0]),g=_.find(f.children(),function(a){return angular.element(a).attr("data-name")===b});a.checkNotNull(g,'Missing dw:tab header element for tab "'+b+'"');var h=angular.element(g).children()[1];angular.element(h).html(d.length>0?d.toSafeString():"&nbsp;")},destroy:function(){this.tabs=null;this.active=null;this.fit=null;this.activeAccessor=null;this.callParent()}});i.buist.directive("dwTabs",function(){return{restrict:"E",replace:!1,template:b,scope:!0,controller:["$scope","$element","$attrs",j.internal.directives.Tabs],link:function(a,b,c,d){d.link()}}})});j.invoke("Preconditions",function(a){function b(a,b){var c='<input type="'+(b.dwType||"text")+'" class="dw-text-field" ng-change="dw$onChange()" ng-model="model" ng-focus="dw$onFocus()" ng-blur="dw$onBlur()"';_.isUndefined(b.name)||(c+=' name="'+i.encodeAttr(b.name)+'"');_.isUndefined(b.autocomplete)||(c+=' autocomplete="'+i.encodeAttr(b.autocomplete)+'"');_.isUndefined(b.dwPlaceholder)&&_.isUndefined(b.dwPlaceholderText)||(c+=' ng-attr-placeholder="{{placeholder}}"');_.isUndefined(b.dwEnabled)||(c+=' ng-disabled="disabled"');return c+" />"}j.define(i.type("directives.TextField"),{extend:i.type("directives.TextDirective"),constructor:function(b,c,d){a.checkString(d.dwModel,"dw-model",1);a.checkArgument(_.isUndefined(d.dwType)||_.includes(["text","password"],d.dwType),'Unsupported: dw:text-field type "'+d.dwType+'"');this.callParent([b,c,d,d.dwModel,"dw-text-field-",!0]);c.addClass("dw-validate-input")}})
;i.buist.directive("dwTextField",function(){return{restrict:"E",replace:!1,template:b,scope:!0,require:"dwTextField",controller:["$scope","$element","$attrs",j.internal.directives.TextField],compile:function(a){a.removeAttr("name");return function(a,b,c,d){var e=angular.element(b.children()[0]).controller("ngModel");d.link(e)}}}})});j.invoke("Preconditions",function(a){function b(a,b){var c='<textarea class="dw-text-area" ng-change="dw$onChange()" ng-model="model" ng-focus="dw$onFocus()" ng-blur="dw$onBlur()"';_.isUndefined(b.name)||(c+=' name="'+i.encodeAttr(b.name)+'"');_.isUndefined(b.dwPlaceholder)&&_.isUndefined(b.dwPlaceholderText)||(c+=' ng-attr-placeholder="{{placeholder}}"');_.isUndefined(b.dwEnabled)||(c+=' ng-disabled="disabled"');return c+"></textarea>"}j.define(i.type("directives.TextArea"),{extend:i.type("directives.TextDirective"),constructor:function(b,c,d){a.checkString(d.dwModel,"dw-model",1);this.callParent([b,c,d,d.dwModel,"dw-text-area-",!0]);c.addClass("dw-validate-input")}});i.buist.directive("dwTextArea",function(){return{restrict:"E",replace:!1,template:b,scope:!0,require:"dwTextArea",controller:["$scope","$element","$attrs",j.internal.directives.TextArea],compile:function(a){a.removeAttr("name");return function(a,b,c,d){var e=angular.element(b.children()[0]).controller("ngModel");d.link(e)}}}})});j.invoke("Preconditions",function(a){function b(a){var b=a.previousSibling;for(;b;){if(1===b.nodeType)return angular.element(b);b=b.previousSibling}return null}j.define(i.type("directives.Tooltip"),{extend:i.type("directives.Directive"),constructor:function(a,b,c){this.callParent([a,b,c]);this.setEnabled(!0);this.linkEnabled("dwEnabled")},setEnabled:function(b){a.checkBoolean(b,"enabled");this.enabled=b;this.tooltip&&this.tooltip.setEnabled(b)},link:function(a,b){this.tooltip=j.create(i.type("widget.StickyTooltip"),{template:a,target:b,className:this.element.attr("class"),scope:this.scope})},destroy:function(){this.callParent();this.destroyMember("tooltip")}});i.buist.directive("dwTooltip",function(){return{restrict:"E",replace:!1,scope:!0,controller:["$scope","$element","$attrs",j.internal.directives.Tooltip],compile:function(c){var d=c.html();c.html("");return function(c,e,f,g){var h=b(e[0]);a.checkArgument(null!==h,"Required: previous element sibling of <dw:tooltip>");g.link(d,h);e.remove()}}}})});j.invoke("Preconditions",function(a){j.define(i.type("directives.Transclude"),{extend:i.type("directives.Directive"),constructor:function(a,b,c){this.callParent([a,b,c]);this.transcludeScope=this.enclosingScope.$new();this.linkId()},linkId:function(){a.checkString(this.attrs.dwId,this.attrs.$attr.dwId||"dw-id",1);var b=i.dwId(this.scope,this.attrs.dwId);a.checkArgument(!_.isUndefinedOrNull(b),"Not a <dw:id> in scope: "+this.attrs.dwId);this.idClass=this.createIdClass(b)},transclude:function(b,c){a.checkFunction(b,"transcludeFn");a.optional.checkString(c,"target",1);var d=this.element;if(c){d=j.element("."+this.idClass+" "+c,!1);if(_.isUndefinedOrNull(d))throw new Error('Undefined: element with <dw:id> class "'+this.idClass+'" and target "'+c+'"')}if(!0===d.data("dw$transclude.done"))return;b(this.transcludeScope,function(a){d.html("");d.append(a)});d.data("dw$transclude.done",!0);d.removeClass("dw-transclude-position")},destroy:function(){this.transcludeScope&&this.transcludeScope.$destroy();this.transcludeScope=null;this.idClass=null;this.callParent()}});i.buist.directive("dwTransclude",function(){return{restrict:"A",scope:!0,controller:["$scope","$element","$attrs",j.internal.directives.Transclude]}})});j.invoke("Preconditions",function(a){j.define(i.type("directives.TranscludeContent"),{extend:i.type("directives.Directive"),constructor:function(a,b,c,d){this.callParent([a,b,c]);this.transcludeFn=d;this.linkElementClass();this.linkTarget()},setElementClass:function(b){a.checkString(b,"elementClass",1);this.elementClass=b},setTarget:function(b){a.optional.checkString(b,"target",1);this.target=b},linkElementClass:function(){a.checkString(this.attrs.dwElement,this.attrs.$attr.dwElement||"dw-element",1);var b=i.dwId(this.scope,this.attrs.dwElement);a.checkArgument(!_.isUndefinedOrNull(b),"Not a <dw:id> in scope: "+this.attrs.dwElement);this.setElementClass(this.createIdClass(b))},linkTarget:function(){if(!_.isUndefined(this.attrs.dwTarget)){a.checkString(this.attrs.dwTarget,this.attrs.$attr.dwTarget,1);this.setTarget(this.attrs.dwTarget)}},link:function(){var a=this;this.unwatch=this.enclosingScope.$watch(function(){var b=j.element("."+a.elementClass,!1);if(!_.isUndefinedOrNull(b)){var c=b.controller("dwTransclude");if(_.isUndefinedOrNull(c))throw new Error('Required dw-transclude: element with <dw:id> class "'+a.elementClass+'"');c.transclude(a.transcludeFn,a.target)}})},destroy:function(){this.unwatch&&this.unwatch();this.unwatch=null;this.transcludeFn=null;this.elementClass=null;this.target=null;this.callParent()}});i.buist.directive("dwTranscludeContent",function(){return{restrict:"E",replace:!1,scope:!0,controller:["$scope","$element","$attrs","$transclude",j.internal.directives.TranscludeContent],transclude:!0,link:function(a,b,c,d){d.link();b.remove()}}})});j.invoke("Preconditions","Keys",function(a,b){function c(a,b){var c=_.uniqueId("dw-typeahead-"),d="<dw:id>"+c+"</dw:id>";d+='<dw:search dw-handler="dw$handler" dw-model="dw$model" dw-id="'+c+'"';_.isUndefined(b.autocomplete)||(d+=' autocomplete="'+i.encodeAttr(b.autocomplete)+'"');_.isUndefined(b.dwEnabled)||(d+=' dw-enabled="'+i.encodeAttr(b.dwEnabled)+'"');_.isUndefined(b.dwPlaceholder)||(d+=' dw-placeholder="'+i.encodeAttr(b.dwPlaceholder)+'"');_.isUndefined(b.dwPlaceholderText)||(d+=' dw-placeholder-text="'+i.encodeAttr(b.dwPlaceholderText)+'"');d+="></dw:search>";d+='<dw:search-suggest dw-model="dw$model" dw-search="'+c+'">';d+='<dw:search-suggest-source dw-format-function="dw$format" dw-source="'+i.encodeAttr(b.dwSource)+'"';_.isUndefined(b.dwSuggestLoader)?_.isUndefined(b.dwSuggestLoaderText)||(d+='dw-loader-text="'+i.encodeAttr(b.dwSuggestLoaderText)+'"'):d+='dw-loader="'+i.encodeAttr(b.dwSuggestLoader)+'"';_.isUndefined(b.dwSuggestPlaceholder)?_.isUndefined(b.dwSuggestPlaceholderText)||(d+='dw-placeholder-text="'+i.encodeAttr(b.dwSuggestPlaceholderText)+'"'):d+='dw-placeholder="'+b.dwSuggestPlaceholder+'"';d+=">";d+="{{ dw$format(dw$result) }}";d+="</dw:search-suggest-source>";d+="</dw:search-suggest>";d+='<input type="hidden" ng-model="'+i.encodeAttr(b.dwModel)+'"';_.isUndefined(b.name)||(d+='name="'+i.encodeAttr(b.name)+'"');return d+"/>"}function d(a){this.accessor.assign(this.enclosingScope,a);this.ngModelCtrl.$setViewValue(a);this.searchCtrl.setSuggestion(_.isUndefined(a)?a:null)}j.define(i.type("directives.Typeahead"),{extend:i.type("directives.ElementDirective"),constructor:function(b,c,d,e){this.callParent([b,c,d]);a.checkArgument(e(d.dwSource)(this.enclosingScope)instanceof j.DataSource,"Not a DataSource: "+(d.$attr.dwSource||"dw-source"));this.ensureId("dw-typeahead-");this.setFormat(i.toStringFormat);this.linkModel();this.linkVisible("dwVisible");this.linkFormat();this.linkSearchModel();b.dw$handler=this.onSearch.bind(this);b.dw$format=function(a){return i.toStringFormat(this.format(a))}.bind(this);b.$watch("dw$model.text",this.onSearchTextChange.bind(this));this.enclosingScope.$watch(d.dwModel,this.updateView.bind(this));b.$watch(d.dwModel,this.updateView.bind(this));c.addClass("dw-typeahead");c.addClass("dw-validate-input")},setFormat:function(b){a.checkFunction(b,"format");this.format=b},setSearchModel:function(b){a.checkArgument(b instanceof j.SearchModel,"Not a SearchModel: searchModel");this.searchModel=b;this.scope.dw$model=b},linkModel:j.inject("$parse",function(b){a.checkString(this.attrs.dwModel,this.attrs.$attr.dwModel||"dw-model",1);this.accessor=b(this.attrs.dwModel);a.checkArgument(_.isFunction(this.accessor.assign),"Not an assignable expression: "+this.attrs.dwModel)}),linkFormat:function(){if(!_.isUndefined(this.attrs.dwFormat)||!_.isUndefined(this.attrs.dwFormatFunction))return this.callParent(["dwFormat","dwFormatFunction"]);if(_.isUndefined(this.attrs.dwTextProperty))throw new Error("Required: either dw-format, dw-format-function, or dw-text-property");a.checkString(this.attrs.dwTextProperty,this.attrs.$attr.dwTextProperty,1);this.setFormat(function(a){return function(b){return b[a]}}(this.attrs.dwTextProperty))},linkSearchModel:j.inject("$parse",function(b){var c;if(_.isUndefined(this.attrs.dwSearchModel))c=new j.SearchModel;else{c=b(this.attrs.dwSearchModel)(this.enclosingScope);a.checkArgument(c instanceof j.SearchModel,"Not a SearchModel: "+this.attrs.$attr.dwSearchModel)}this.setSearchModel(c)}),link:function(){var a=angular.element(this.element.children()[0]),c=angular.element(this.element[0].querySelector(".dw-source")),d=angular.element(_.last(this.element.children()));this.searchCtrl=a.controller("dwSearch");this.searchSuggestSourceCtrl=c.controller("dwSearchSuggestSource");var e=this.ngModelCtrl=d.controller("ngModel");this.linkInputStateHandler(e);var f=a[0].querySelector('input[type="hidden"]'),g=angular.element(f).controller("ngModel");this.scope.$watch(function(){return(!1!==g.$pristine?2:0)+(!1!==g.$untouched?1:0)},function(){g.$pristine?e.$setPristine():e.$setDirty();g.$touched?e.$setTouched():e.$setUntouched()});var h=a[0].querySelector("input.dw-text"),i=function(a){this.searchSuggestSourceCtrl&&this.searchSuggestSourceCtrl.onKey(a)}.bind(this),k=new j.KeyBinding(j.KeyBinding.DOWN,i),l=new j.KeyBinding(j.KeyBinding.UP,i),m=new j.KeyBinding(j.KeyBinding.ENTER,i);b.add(k,h);b.add(l,h);b.add(m,h);this.deregisterDown=function(){b.remove(k,this.element[0])};this.deregisterUp=function(){b.remove(l,this.element[0])};this.deregisterEnter=function(){b.remove(m,this.element[0])}},onSearchTextChange:j.inject("$timeout",function(a){a(function(){if(!this.element)return;angular.element(this.element[0].querySelector(".dw-search-suggest")).hasClass("ng-hide")&&_.isUndefined(_.get(this,"searchModel.text"))&&d.call(this);this.searchCtrl&&this.searchCtrl.setSuggestion(null)}.bind(this),0,!1)}),onSearch:function(){if(!this.searchCtrl)return;var a=this.searchCtrl.getSuggestion();d.call(this,_.isNull(a)?void 0:a)},updateView:function(){this.searchModel.text=this.scope.dw$format(this.accessor(this.enclosingScope)||"")},destroy:function(){this.deregisterDown&&this.deregisterDown();this.deregisterDown=null;this.deregisterUp&&this.deregisterUp();this.deregisterUp=null;this.deregisterEnter&&this.deregisterEnter();this.deregisterEnter=null;this.accessor=null;this.format=null;this.searchModel=null;this.searchCtrl=null;this.searchSuggestSourceCtrl=null;this.ngModelCtrl=null;this.callParent()}});i.buist.directive("dwTypeahead",function(){return{restrict:"E",replace:!1,template:c,controller:["$scope","$element","$attrs","$parse",j.internal.directives.Typeahead],scope:!0,compile:function(a){a.removeAttr("name");return function(a,b,c,d){d.link()}}}})});j.invoke("Preconditions","Layouts",function(a,b){j.define(i.type("directives.Layout"),{extend:i.type("directives.Directive"),constructor:function(c,d,e){this.callParent([c,d,e]);var f=b.get(e.dwLayout);a.checkArgument(_.isFunction(f),"Unknown layout: "+e.dwLayout);this.ensureId("dw-layout-");this.delegate=f();var g=this;c.$on(i.events.invalidate,function(){g.onInvalidate()});c.$on(i.events.resize,function(){g.onResize()})},queueLayout:j.inject("$timeout",function(a){if(this.layoutTimer)return;var b=this;this.layoutTimer=a(function(){b.layout()},0,!1)}),layout:function(){this.destroyLayoutTimer();this.element&&this.delegate.layout(this.element)},link:function(){this.queueLayout()},onInvalidate:function(){this.queueLayout()},onResize:function(){this.queueLayout()},destroyLayoutTimer:j.inject("$timeout",function(a){this.layoutTimer&&a.cancel(this.layoutTimer);this.layoutTimer=null}),destroy:function(){this.destroyLayoutTimer();this.destroyMember("delegate");this.callParent()}});i.buist.directive("dwLayout",function(){return{restrict:"A",controller:["$scope","$element","$attrs",j.internal.directives.Layout],link:function(a,b,c,d){d.link()}}})});j.invoke("Preconditions","EventBus","ObjectPath","ObjectUtils",function(a,b,c,d){function e(a){return _.isObjectMap(a)&&_.isFunction(a.$addControl)&&_.isFunction(a.$removeControl)}function f(a){return _.isObjectMap(a)&&_.isFunction(a.$render)&&_.isFunction(a.$setValidity)}function g(){var b=_.toArray(arguments);a.checkArray(b,"arguments",1);return c.format(b)}function h(b,h,n){function o(){var a=b.$on("$destroy",function(){a();_.each(T,function(a){a()});T=null;U=null;O=null;P=null;Q=null;R=null;S=null})}function p(a){T[a]&&T[a]()}function q(a){var b;_.each(P[a],function(c){b=c.controller("ngModel");_.each(Q[a],function(a){b.$setValidity(a,!0)})});delete Q[a]}function r(){_.each(M.$error,function(a,b){_.each(a,function(a){M.$setValidity(b,!0,a)})});M.$valid=!0;M.$invalid=!1}function s(a){if(!R)return c.parse(a);var b=R[a];b||(R[a]=b=c.parse(a));return b}function t(a){if(!S)return c.format(s(a));var b=S[a];_.isUndefined(b)&&(S[a]=b=c.format(s(a)));return b}function u(a){return a&&_(a.rules()).transform(function(a,b){Array.prototype.push.apply(a,_.keys(b.$sequence()))}).uniq().value()}function v(a,c,d,e){if(!f(a))return;var h={};a[l]=h;var i=a.$setValidity;a.$setValidity=function(b,c){i.call(a,b,c);c&&delete h[b]};var j=g("$watch",d);p(j);T[j]=b.$watch(d,function(){q(d)});var k=I(d);k&&w(a,c,d,k,e)}function w(c,e,m,o,q){j.invoke("$rootScope","$q",function(j,r){function s(a){return _(a).map("property").transform(function(a,b){if(b===m)Array.prototype.push.apply(a,D);else{var c=I(b),d=c&&c.rules();_.each(d,function(b){Array.prototype.push.apply(a,_.keys(b.$sequence()))})}}).uniq().value()}function v(){function a(){delete B.dw$promise}function f(e){return function(f){if(e.id!==B.dw$id)return;var g=s(f),h=_(f).map("type").concat(g).uniq().value();d.set(b,m,c.$modelValue);A(c,m,h);a()}}function g(b){return function(d){if(b.id!==B.dw$id)return;var e=_.map(d,"type"),f=s(d),g=_.xor(f,e);A(c,m,g);if(_.isEmpty(P[m]))return;_.each(d,function(a){var b=a.type;c.$setValidity(b,!1);C[b]=a});a()}}var h=n.config.call(i.marker).context({scope:b,formName:y,formCtrl:M,formElement:N,fieldName:x,fieldModelCtrl:c,fieldElement:e}).property(m);return function(a){if(_.isEmpty(P[m]))return B.dw$promise||r.when(a);var b={};B.dw$id=b.id=_.uniqueId(k);var c=o.validate(a,h).then(f(b),g(b));B.dw$promise=B.dw$promise?B.dw$promise.then(c):c;return B.dw$promise}}function w(a){function d(){E(c.$modelValue)}var e=U[m];if(_.isEmpty(e))return;j.$evalAsync(function(){_.each(e,function(a){a=t(a);_.each(P[a],function(a){var c=a.controller("ngModel").$name,e=g("$dep",y,x,c);p(e);T[e]=b.$watch(g(y,c,"$modelValue"),function(a,b){if(a===b||_.isNaN(b))return;d()},!0)})});!0===a&&d()})}a.checkArgument(f(c),"No model controller: ngModelCtrl");var x=c.$name;a.checkArgument(_.isNotBlank(x),'Required `name="x"` attribute: field "'+m+'"');var y=_.isNotBlank(M.$name)?M.$name:_.uniqueId(k),B={},C=c[l],D=u(o);c[k]=B;var E=v();var F=g(y,x);c.$asyncValidators[F]&&c.$asyncValidators[F].dw$fn();delete c.$asyncValidators[F];var G=function(a){return E(a)};G.dw$fn=function(){A(c,m,D,!0)};c.$asyncValidators[F]=G;w(!1);var H=g("$dep",y,x);p(H);h.dwValidateDependent&&(T[H]=b.$watch(h.dwValidateDependent,function(a,b){if(a===b)return;var c=U[x];_.isArray(c)&&!_.isEmpty(c)&&_.each(c,function(a){p(g("$dep",y,x,a))});z();w(!0)}));q&&E(c.$modelValue)})}function x(){function b(a){return a.replace(i.dataAttributeRegexp,"").replace(m,"").toLowerCase()}function c(a,c){return function(d){var e=d.nodeName;if(b(e)===c)return a.attr(e)}}function d(b,d){if(!f(b)||_.isBlank(b.$name))return angular.noop;var e=b.$name;a.checkFunction(d,"callback");var g,h='[name="'+j.CSS.escape(e)+'"]:not(.dwx-replace)',i=_.map(N[0].querySelectorAll('[class~="dw-validate-input"] '+h),angular.element),k=_.isEmpty(i)?null:_.find(i,function(a){return a.controller("ngModel")===b}),l=k&&k[0]?k[0]:null;if(_.isElement(l)){if(k.hasClass("dw-validate-ignore"))return;var m,n=document.getElementsByTagName("body")[0],o=k;for(;!m&&o&&o[0]&&o[0]!==n;){m=_.find(o[0].attributes,c(o,"dwmodel"));m?g=o.attr(m.nodeName):o=o.parent()}}else{i=_.map(N[0].querySelectorAll(h),angular.element);k=_.isEmpty(i)?null:_.find(i,function(a){return a.controller("ngModel")===b});l=k&&k[0]?k[0]:null;if(!_.isElement(l))return;var p=_.find(l.attributes,c(k,"ngmodel"));a.checkArgument(p&&_.isNotBlank(p.nodeName),'Not a node: Attribute ngModel for field "'+e+" ("+p+')"');g=k.attr(p.nodeName)}_.isNotBlank(g)&&d.call(d,b,k,t(g))}function e(a,b,c){P[c]=P[c]||[];P[c].push(b);b.on("$destroy",function(){M.$removeControl(a);A(a,c,_.keys(a.$error),!0);a.$asyncValidators={};a[k]={}});v(a,b,c,!1)}function g(a,b,c){if(_.isObjectMap(P)){if(_.isArray(P[c])){_.remove(P[c],function(b){return b.controller("ngModel")===a});if(_.isEmpty(P[c])){delete P[c];delete R[c];delete S[c]}}M&&_.isEmpty(P)&&r()}Q&&delete Q[c]}var h=M.$addControl,l=M.$removeControl;M.$addControl=function(a){d(a,e);h.call(M,a)};M.$removeControl=function(a){d(a,g);l.call(M,a)}}function y(){L=b.$eval(h.dwValidate);if(_.isUndefinedOrNull(L))return;a.checkArgument(L instanceof n,"No Validator instance: <dw:validate> expression")}function z(){var a=b.$eval(h.dwValidateDependent);U=_.isArray(a)&&!_.isEmpty(a)?_.matrix(a,t):{}}function A(b,c,d,e){if(!f(b))return;a.checkArray(d,"types");a.optional.checkBoolean(e,"remove flag");var g=b.$error;_.each(d,function(a){b.$setValidity(a,!0);e&&delete g[a]});var h=b[l];_.each(h,function(a,d){var f=a.property;if(!f||0!==f.indexOf(c))return;var h=s(f),i=parseInt(_.last(h),10);if(_.isNumber(i)&&i%1==0){b.$setValidity(d,!0);e&&delete g[d]}})}function B(){_.each(P,function(a,b){var c=I(b),d=u(c);d&&_.each(a,function(a){A(a.controller("ngModel"),b,d,!0)})})}function C(a){var c=b;for(;c;){if(c.$id===a.$id)return!0;c=c.$parent}return!1}function D(a,b){function d(b){var c=s(b);if(_.last(e)!==_.last(c))return!1;var d=b.length,f=a.length;return d===f||d-f>0}var e=s(a);a=c.format(e);var f,g;_.each(P,function(a,b){if(d(b)){if(f){f=g=void 0;return!1}f=a;g=b}});f&&_.each(f,function(a){b.push(a)});return g}function E(a,b){if(!C(b.scope()))return;var c,d,e;_.each(_.groupBy(b.validatorErrors(),"property"),function(a){d=[];c=D(a[0].property,d);if(0===d.length)return;_.each(d,function(b){e=b.controller("ngModel");e[l]||(e[l]={});_.each(a,function(a){e.$setValidity(a.type,!1);e[l][a.type]=a})});Q[c]=_.union(_.map(a,"type"),Q[c])})}function F(){T&&(T[i.events.error.http]=b.$on(i.events.error.http,E))}function G(b,c){a.checkArgument(e(b),"Required enclosing <form>: <dw:validate>");a.checkObject(c,"form element");a.checkElement(c[0],"form element");M=b;N=c;o();y();O={};z();F();x()}function H(){r();B();y();O={};_.each(P,function(a,b){_.each(a,function(a){v(a.controller("ngModel"),a,b,!0)})});F()}function I(a){if(!O)return null;var b=O[a];if(_.isUndefined(b)){var c=L&&L.get(a);_.isEmpty(c)?O[a]=b=null:O[a]=b=n.of.apply(n,c)}return b}function J(a){if(_.isBlank(a))return L;return I(t(a))||void 0}function K(b,d,e){a.checkString(d,"property",1);d=t(d);var f=I(d),g=b.defer();f?f.validate(e).then(function(){_.each(P[d],function(a){var b=a.controller("ngModel");b&&A(b,d,_.keys(b.$error))});g.resolve()},function(a){var b=[],e=s(d);_.each(a,function(a){var f;if(_.isNotBlank(a.property)){var g=s(a.property);f=c.format(e.concat(g))}else f=d;var h=new j.ValidatorStatus(!1,a.type,a.args,a.value,f,a.reason);b.push(h);_.each(P[d],function(b){var c=b.controller("ngModel");if(c){c.$setValidity(a.type,!1);c[l][a.type]=h}})});g.reject(b)}):g.resolve();return g.promise}var L,M,N;var O={};var P={};var Q={};var R={};var S={};var T={};var U={};this.init=G;this.reinit=H;this.get=J;this.validate=j.inject("$q",K)}var k="dw$validate",l="dw$error",m=/[^a-z]/gi;i.buist.directive("dwValidate",function(){return{restrict:"A",require:["dwValidate","?form"],controller:["$scope","$attrs","Validator",h],link:{pre:j.inject("$timeout",function(a,c,d,f,g){if(!e(g[1]))return;g[0].init(g[1],d);var h;c.$watchCollection(f.dwValidate,function(c,d){h&&h();h=b.on(i.events.invalidate,g[0].reinit,c);_.isEqual(c,d)||a(g[0].reinit)})})}}})});j.invoke("Preconditions","Messages","ErrorMessages","Formats",function(a,b,c,d){var e='<span class="dw-icon dw-glyph-exclamation-circle" role="img"></span><div class="dw-messages"></div>',f=d.get("abbrev40");j.define(i.type("directives.ValidIndicator"),{extend:i.type("directives.ElementDirective"),constructor:function(b,c,d){a.checkString(d.name,d.$attr.name||"name",1);this.callParent([b,c,d]);this.setCount(i.MAX_INT);this.setTooltipVisible(!1);this.ensureId("dw-valid-indicator-");c.addClass("dw-valid-indicator dw-valid is-valid dw-pristine is-unchanged is-untouched")},setErrorMessages:function(b){a.checkArgument(b instanceof i.ErrorMessages,"Not a ErrorMessages: errorMessages");this.errorMessages=b},setText:function(b){a.optional.checkHtml(b,"safeHtml");angular.element(this.element.children()[1]).html(j.safe(b||"").toSafeString())},setTooltipVisible:function(b){a.checkBoolean(b,"tooltipVisible",1);this.tooltipVisible=b},setCount:function(b){a.checkNumber(b,"count",1);this.count=b},isValid:function(){return!this.formCtrl||!this.inputName||!this.formCtrl[this.inputName]||!1!==this.formCtrl[this.inputName].$valid},getErrorTypes:function(){var a=_.get(this,'formCtrl["'+this.inputName+'"].$error',null);return a?_.reduce(a,function(a,b,c){b&&a.push(c);return a},[]):[]},getErrorMessage:function(){function a(a){var b=d.formCtrl&&d.inputName&&d.formCtrl[d.inputName]?d.formCtrl[d.inputName].dw$error:null;return(b?b[a]:null)||{}}function c(a,b){var c=d.errorMessages.validation(a)||{key:a};if(_.isNotBlank(b)){var e=d.errorMessages.validation(b);if(e)return e;var f;for(;(f=b.lastIndexOf("."))>=0&&!e;){b=b.substr(0,f);e=d.errorMessages.validation(b)}return e||c}return c}if(this.isValid())return null;var d=this;var e=this.getErrorTypes();var g=this.errorMessages.types();g=g.concat(_.difference(e,g));g=_.intersection(g,e);var h=j.safe("");for(var i=0,k=0;i<g.length&&k<this.count;i++,k++){var l,m=g[i],n=a(m),o=c(m,n.reason),p=n.args||{},q=o.formatter;_.isUndefined(p.value)&&(p.value=n.value);_.isString(p.value)&&(p.value=f(p.value));l=q?q(o.key,p):j.formatNamedSafe(b.getSafeHtml(o.key),p);h=h.concatSafe(j.safe("").concatSafeHTML('<div class="dw-msg">'));h=h.concatSafe(l);h=h.concatSafe(j.safe("").concatSafeHTML("</div>"))}return h},link:function(){this.linkErrorMessages();this.linkFormInput();this.linkTooltipVisible();this.linkCount()},linkFormInput:j.inject("ObjectPath","$timeout",function(b,c){var d=this,e=this.attrs.name;this.element.removeAttr("name");var f=b.parse(e);if(1===_.size(f)){this.inputName=e;this.formCtrl=this.element.inheritedData("$formController");a.checkArgument(_.isObject(this.formCtrl),"Required enclosing <form>: <dw:valid-indicator>")}else{var g=_.first(f);this.inputName=f.slice(1).join("");a.checkString(this.inputName,"Form input name",1);var h=j.CSS.escape(g),i='[name="'+h+'"]',k=document.querySelector("form"+i+", ng-form"+i+', [ng-form="'+h+'"]');if(_.isUndefinedOrNull(k))throw new Error('Undefined: Form with name "'+g+'"');c(function(){d.formCtrl=angular.element(k).controller("form")},0,!1)}this.scope.$watch(function(){var a=d.getErrorTypes();if(0===a.length)return null;a.sort();return a.join(" ")},function(a,b){_.isEqual(a,b)||c(d.updateErrorMessages.bind(d),0,!1)});this.scope.$watch(this.isValid.bind(this),function(a,b){if(a!==b){d.updateValidStyle(d.element,a);d.scheduleInvalidate();a?d.destroyValueWatcher():d.createValueWatcher()}});this.scope.$watch(function(){var a=d.inputName?_.get(d.formCtrl,d.inputName):null;return!a||!1!==a.$pristine},function(a,b){a!==b&&d.updatePristineStyle(d.element,a)});this.scope.$watch(function(){var a=d.inputName?_.get(d.formCtrl,d.inputName):null;return!a||!1!==a.$untouched},function(a,b){a!==b&&d.updateUntouchedStyle(d.element,a)})}),linkErrorMessages:j.inject("$parse",function(b){var d;if(_.isUndefined(this.attrs.dwErrorMessages))d=this.scope.dw$errors||c;else{a.checkString(this.attrs.dwErrorMessages,this.attrs.$attr.dwErrorMessages,1);d=b(this.attrs.dwErrorMessages)(this.scope);a.checkArgument(d instanceof i.ErrorMessages,"Not a ErrorMessages: "+this.attrs.$attr.dwErrorMessages)}this.setErrorMessages(d)}),linkCount:function(){if(!_.isUndefined(this.attrs.dwCount)){var b=this.parseIntegerAttribute("dwCount");a.checkNumber(b,this.attrs.$attr.dwCount,1);this.setCount(b)}},linkTooltipVisible:function(){if(!_.isUndefined(this.attrs.dwTooltipVisible)){var b=this.parseBooleanAttribute("dwTooltipVisible");a.checkBoolean(b,this.attrs.$attr.dwTooltipVisible);this.setTooltipVisible(b)}},createTooltip:function(){var a=this.callParent(arguments);a.setClassName("dw-error");return a},updateErrorMessages:function(){if(!this.scope)return;var a=this.getErrorMessage();this.setText(a);this.setTooltip(this.tooltipVisible?a:null);this.scheduleInvalidate()},scheduleInvalidate:j.inject("$timeout",function(a){if(this.invalidateTimer)return;var b=this;this.invalidateTimer=a(function(){if(!b.scope)return;b.scope.$emit(i.events.invalidate);b.destroyInvalidateTimer()},0,!1)}),createValueWatcher:j.inject("$timeout",function(a){if(!this.scope||this.valueUnwatcher)return;var b,c,d=_.get(this.formCtrl,"$name");if(_.isNotBlank(d)){b="$watchCollection";c=d+'["'+this.inputName+'"].$modelValue'}else{b="$watch";c=function(){return _.get(this,'formCtrl["'+this.inputName+'"].$modelValue',null)}.bind(this)}this.valueUnwatcher=this.scope[b](c,function(b,c){_.isEqual(b,c)||a(this.updateErrorMessages.bind(this),0,!1)}.bind(this))}),destroyInvalidateTimer:j.inject("$timeout",function(a){this.invalidateTimer&&a.cancel(this.invalidateTimer);this.invalidateTimer=null}),destroyValueWatcher:function(){this.valueUnwatcher&&this.valueUnwatcher();this.valueUnwatcher=null},destroy:function(){this.destroyInvalidateTimer();this.destroyValueWatcher();this.tooltipVisible=null;this.count=null;this.errorMessages=null;this.formCtrl=null;this.inputName=null;this.callParent()}});i.buist.directive("dwValidIndicator",function(){return{restrict:"E",replace:!1,require:"dwValidIndicator",template:e,scope:!0,controller:["$scope","$element","$attrs",j.internal.directives.ValidIndicator],link:function(a,b,c,d){d.link()}}})});j.invoke("Preconditions","Messages","Keys","ZIndex","Interactions","interact",function(a,b,c,d,e,f){function g(a){p.push(a);k()}function h(a){_.remove(p,function(b){return b===a});k()}function k(){_.each(p,function(a,b){a.modalMask&&a.modalMask.dw$element&&a.modalMask.dw$element.toggleClass("ng-hide",b<p.length-1)})}function l(a){if(i.focusableElement(a))return a;var b=a,c=a.firstChild;for(;c;){if(i.focusableElement(c))return c;if(c.firstChild){b=c;c=c.firstChild}else if(c.nextSibling)c=c.nextSibling;else if(b===a)c=null;else{c=b.nextSibling;b=b.parentNode;for(;!c&&b!==a;){c=b.nextSibling;b=b.parentNode}}}return null}var m=50;var n=50;var o='<div class="dw-window"><div class="dw-header"><div class="dw-title"></div><span class="dw-close dw-glyph dw-glyph-times-circle" role="img" ng-click="dw$close()"></span></div><div class="dw-body"></div></div>';var p=[];var q=j.inject("$timeout",function(a){var b=document.activeElement;if(!b)return;if(0===p.length)return;var c=_.last(p);if(i.element.contains(c.window,b))return;var d=l(c.window[0]);if(d){d.focus();a(function(){var a=document.activeElement;a&&!i.element.contains(c.window,a)&&a.blur()},0,!1)}else b.blur()});angular.element(document).on("keydown",function(a){if(27===a.keyCode){var b=_.last(p);b&&b.setVisible(!1)}});c.add(new j.KeyBinding(j.KeyBinding.TAB,j.inject("$timeout",function(a){a(q,0,!1)}))).preventDefault(!1).stopPropagation(!1);j.define(i.type("directives.Window"),{extend:i.type("directives.ElementDirective"),constructor:function(a,b,c){this.callParent([a,b,c]);this.ensureId("dw-window-");this.wrappers=[];this.setModal(!0);this.setDraggable(!0);this.setVisible(!1);this.linkModal("dwModal");this.linkTitle("dwTitle","dwTitleText");this.linkRectangle("dwX","dwY","dwWidth","dwHeight");this.linkResizable("dwResizable");this.linkDraggable("dwDraggable");this.linkVisible("dwVisible");this.linkReadyCallback("dwReady");this.linkZIndex("dwZIndexType");var d=this;this.enclosingScope.$on(i.events.invalidate,function(a){d.queueUpdateSizeAndPosition();a&&a.stopPropagation&&a.stopPropagation()});this.windowResizeHandler=function(){d.queueUpdateSizeAndPosition()};angular.element(window).on("resize",this.windowResizeHandler);a.dw$close=function(){_.forEach(d.onCloseCallbacks,function(a){a()});d.setVisible(!1)}},setModal:function(b){a.checkBoolean(b,"modal");a.checkArgument(!this.widget,"Window already created");this.modal=b},setZIndexType:function(b){a.checkString(b,"zIndexType");this.zIndexType=b},setTitle:function(b){a.optional.checkHtml(b,"title");this.title=b;this.updateTitle()},setX:function(b){a.checkNumber(b,"x");this.x=b;this.window&&this.updateSizeAndPosition()},setY:function(b){a.checkNumber(b,"y");this.y=b;this.window&&this.updateSizeAndPosition()},setWidth:function(b){a.checkNumber(b,"width");this.width=b;if(this.window){this.updateSizeAndPosition();this.contentScope&&this.contentScope.$broadcast(i.events.resize)}},setHeight:function(b){a.checkNumber(b,"height");this.height=b;if(this.window){this.updateSizeAndPosition();this.contentScope&&this.contentScope.$broadcast(i.events.resize)}},setResizable:function(b){a.checkBoolean(b,"resizable");a.checkArgument(!this.widget,"Window already created");this.resizable=b;this.updateWindowResizable()},setDraggable:function(b){a.checkBoolean(b,"draggable");a.checkArgument(!this.widget,"Window already created");this.draggable=b;this.updateWindowDraggable()},setVisible:j.inject("$timeout",function(b,c){a.checkBoolean(c,"visible");this.visible=c;this.visibleAccessor&&this.visibleAccessor.assign(this.enclosingScope,c);if(this.window){var d=this;b(function(){d.setWindowVisible(c)})}}),setContent:function(a){this.content=a},add:function(b){a.checkObject(b,"wrapper");this.wrappers.push(b)},linkModal:function(b){a.checkString(b,"name",1);_.isUndefined(this.attrs[b])||this.setModal(this.parseBooleanAttribute(b))},linkTitle:j.inject("$parse",function(c,d,e){a.checkString(d,"keyName",1);a.checkString(e,"textName",1);if(_.isUndefined(this.attrs[d])){if(!_.isUndefined(this.attrs[e])){var f=this;this.scope.$watch(this.attrs[e],function(b){a.optional.checkHtml(b,f.attrs.$attr[e]);f.setTitle(b?j.safe(b):null)})}}else this.setTitle(b.getSafeHtml(this.attrs[d]))}),linkZIndex:function(b){a.checkString(b,"xName",1);_.isUndefined(this.attrs[b])||this.setZIndexType(this.attrs[b])},linkRectangle:function(b,c,d,e){a.checkString(b,"xName",1);a.checkString(c,"yName",1);a.checkString(d,"widthName",1);a.checkString(e,"heightName",1);a.checkArgument(_.isUndefined(this.attrs[b])===_.isUndefined(this.attrs[c]),"dw-x and dw-y must both be defined");a.checkArgument(_.isUndefined(this.attrs[d])===_.isUndefined(this.attrs[e]),"dw-width and dw-height must both be defined");var f;_.isUndefined(this.attrs[b])||this.setX(this.parseIntegerAttribute(b));_.isUndefined(this.attrs[c])||this.setY(this.parseIntegerAttribute(c));if(!_.isUndefined(this.attrs[d])){f=this.parseIntegerAttribute(d);a.checkNumber(f,this.attrs.$attr[d],0);this.setWidth(f)}if(!_.isUndefined(this.attrs[e])){f=this.parseIntegerAttribute(e);a.checkNumber(f,this.attrs.$attr[e],0);this.setHeight(f)}this.center=_.isUndefined(this.attrs[b])&&_.isUndefined(this.attrs[c]);this.fit=_.isUndefined(this.attrs[d])&&_.isUndefined(this.attrs[e])},linkResizable:function(b){a.checkString(b,"name",1);if(_.isUndefined(this.attrs[b]))this.setResizable(!this.fit);else{a.checkArgument(!this.fit,"dw-resizable must not be specified if dw-width and dw-height not specified");this.setResizable(this.parseBooleanAttribute(b))}},linkDraggable:function(b){a.checkString(b,"name",1);_.isUndefined(this.attrs[b])||this.setDraggable(this.parseBooleanAttribute(b))},linkVisible:j.inject("$parse",function(b,c){
a.checkString(c,"name",1);if(!_.isUndefined(this.attrs[c])){a.checkString(this.attrs[c],this.attrs.$attr[c],1);this.visibleAccessor=b(this.attrs[c]);a.checkArgument(_.isFunction(this.visibleAccessor.assign),"Not an assignable expression: "+this.attrs[c]);var d=this;this.enclosingScope.$watch(this.attrs[c],function(b){a.optional.checkBoolean(b,d.attrs.$attr[c]);d.setVisible(b)})}}),link:function(){this.createWindow();this.element.addClass("ng-hide");this.onReady()},createWindow:j.inject("$compile",function(a){var b=this;this.window=angular.element(o);this.window[0].id=this.element[0].id+"-window";this.attrs.class&&this.window.addClass(this.attrs.class);this.attrs.style&&this.window.attr("style",this.attrs.style);this.window.css("display",this.visible?"":"none");this.updateTitle();angular.element(document.body).append(this.window);a(this.window)(this.scope);this.contentScope=this.enclosingScope.$new();var c,d=angular.element(this.window.children()[1]);_.each(this.content,function(a,e){b.fit||angular.element(a).addClass("dw-heightmanaged");c=angular.element("<div></div>");c.addClass("dw-window-content");e>0&&c.addClass("ng-hide");c.append(a);d.append(c)});a(d.contents())(this.contentScope);this.content=null;this.updateWindowResizable();this.updateWindowDraggable()}),showContent:j.inject("$timeout",function(b,c){a.checkString(c,"id");if(!this.window)return;var d=this,e=angular.element(this.window.children()[1]);_.each(e.children(),function(a){a=angular.element(a);a.toggleClass("ng-hide",c!==a.children()[0].id)});b(function(){d.applyDefaultFocus();q();d.updateSizeAndPosition()},0,!1)}),applyDefaultFocus:function(){function a(a){_.each(a[0].querySelectorAll(".dw-default-focus"),function(a){b=angular.element(a).controller("dwDefaultFocus");b&&b.apply()})}if(!this.window)return;var b;var c=angular.element(this.window.children()[1]);_.each(c.children(),function(b){b=angular.element(b);b.hasClass("ng-hide")||a(b)})},setWindowVisible:function(a){if(!this.window)return;var b="none"!==this.window.css("display");this.window.css("display",a?"":"none");if(!b&&a){this.onShow();this.contentScope&&this.contentScope.$broadcast(i.events.disclose)}else b&&!a&&this.onHide()},onReady:function(){if(!_.isFunction(this.readyCallback))return;this.readyCallback({controller:j.create(i.apiType("Window"),this)})},onResizeStart:function(){if(!this.window)return;this.fit=!1;this.center=!1;var a=this.window[0].getBoundingClientRect();this.x=a.left;this.y=a.top;this.width=a.width;this.height=a.height},onResize:function(a){if(!this.window)return;this.x=a.rect.left;this.y=a.rect.top;this.width=a.rect.width;this.height=a.rect.height;this.updateSizeAndPosition();this.contentScope&&this.contentScope.$broadcast(i.events.resize)},onShow:j.inject("$timeout",function(a){var b=this;if(this.modal){this.modalMask=e.mask({defaults:{type:"modal",target:document.body,timeoutMillis:"Infinity"}});this.modalMask();d.push();g(this);1===p.length&&(this.restoreFocus=document.activeElement);this.window.css("z-index",d.base())}else this.zIndexType?this.window.css("z-index",d[this.zIndexType]()):this.window.css("z-index",d.palette());this.contentScope&&this.contentScope.$broadcast(i.events.resize);a(function(){if(!b.window)return;b.applyDefaultFocus();b.modal&&q();b.updateSizeAndPosition()},0,!1)}),onHide:j.inject("$timeout",function(a){var b=this;if(this.modal){d.pop();this.destroyModalMask();h(this)}a(function(){b.modal&&b.restoreFocus&&b.restoreFocus.focus&&b.restoreFocus.focus();b.restoreFocus=null;q()},0,!1)}),onDragStart:function(){if(!this.window)return;if(this.center){this.center=!1;var a=this.window[0].getBoundingClientRect();this.x=a.left;this.y=a.top}},onDragMove:function(a){this.x+=a.dx;this.y+=a.dy;this.updateSizeAndPosition()},queueUpdateSizeAndPosition:j.inject("$timeout",function(a){if(this.updateTimer)return;var b=this;this.updateTimer=a(function(){b.updateSizeAndPosition()},0,!1)}),updateSizeAndPosition:function(){if(!this.window)return;this.destroyUpdateTimer();var a,b,c,d=angular.element(this.window.children()[1]),e=i.element.getViewSize(),f="",g="";if(this.fit){this.window.css({width:"",height:""});a=d[0].getBoundingClientRect();a.width+this.window[0].offsetWidth-this.window[0].clientWidth>e.width?f=e.width+"px":a.width+this.window[0].offsetWidth-this.window[0].clientWidth<m&&(f=m+"px");a.height+this.window[0].offsetHeight-this.window[0].clientHeight>e.height?g=e.height+"px":a.height+this.window[0].offsetHeight-this.window[0].clientHeight<n&&(g=n+"px")}else{f=Math.min(Math.max(this.width,m),e.width)+"px";g=Math.min(Math.max(this.height,n),e.height)+"px"}this.window.css({width:f,height:g});this.fit||_.each(d.children(),function(a){angular.element(angular.element(a).children()[0]).css({width:d[0].clientWidth+"px",height:d[0].clientHeight+"px"})});a=this.window[0].getBoundingClientRect();if(this.center){b=Math.floor((e.width-a.width)/2);c=Math.floor((e.height-a.height)/2)}else{b=Math.max(Math.min(this.x,e.width-a.width),0);c=Math.max(Math.min(this.y,e.height-a.height),0)}this.window.css({left:b+"px",top:c+"px"})},updateTitle:function(){if(!this.window)return;this.window.toggleClass("dw-noheader",!this.title);angular.element(this.window[0].querySelector(".dw-title")).html(j.safe(this.title||"").toSafeString())},updateWindowDraggable:function(){if(!this.window)return;this.window.toggleClass("dw-draggable",this.draggable);if(this.draggable){var a=this;this.dragger=f(this.window.children()[0]).draggable({onstart:function(b){a.onDragStart(b)},onmove:function(b){a.onDragMove(b)}})}else this.destroyDragger()},updateWindowResizable:function(){if(!this.window)return;this.window.toggleClass("dw-resizable",this.resizable);if(this.resizable){this.resizer=f(this.window[0]).resizable({edges:{left:!0,right:!0,bottom:!0,top:!0}});var a=this;this.resizer.on("resizestart",function(b){a.onResizeStart(b)});this.resizer.on("resizemove",function(b){a.onResize(b)})}else this.destroyResizer()},destroyModalMask:function(){this.modalMask&&this.modalMask.cancel();this.modalMask=null},destroyContentScope:function(){this.contentScope&&this.contentScope.$destroy();this.contentScope=null},destroyDragger:function(){this.dragger&&this.dragger.unset();this.dragger=null},destroyResizer:function(){this.resizer&&this.resizer.unset();this.resizer=null},destroyUpdateTimer:j.inject("$timeout",function(a){this.updateTimer&&a.cancel(this.updateTimer);this.updateTimer=null}),destroyWindow:function(){this.window&&this.window.remove();this.window=null},destroy:function(){this.destroyModalMask();h(this);this.destroyDragger();this.destroyResizer();this.destroyContentScope();this.destroyUpdateTimer();this.destroyWindow();angular.element(window).off("resize",this.windowResizeHandler);this.windowResizeHandler=null;_.each(this.wrappers,function(a){a.destroy()});this.wrappers=null;this.title=null;this.restoreFocus=null;this.fit=null;this.center=null;this.visibleAccessor=null;this.callParent()}});i.buist.directive("dwWindow",function(){return{restrict:"E",replace:!1,controller:["$scope","$element","$attrs",j.internal.directives.Window],scope:!0,compile:function(a){var b=a.children();a.children().remove();return{post:function(a,c,d,e){e.setContent(b);e.link()}}}}});var r=j.hide("Window.windowCtrl");j.define(i.apiType("Window"),{constructor:function(b){a.checkArgument(j.Class.getClassOf(b)===j.Class.getClass(i.type("directives.Window")),"Not a window controller: "+b);r.set(this,b);b.add(this);this.callParent()},scope:function(){var b=r.get(this);a.checkArgument(!!b,"Window is destroyed");return b.contentScope},visible:function(b){var c=r.get(this);a.checkArgument(!!c,"Window is destroyed");if(0===arguments.length)return c.visible;a.checkBoolean(b,"visible");c.setVisible(b)},show:function(){this.visible(!0)},hide:function(){this.visible(!1)},x:function(b){a.checkNumber(b,"x");var c=r.get(this);a.checkArgument(!!c,"Window is destroyed");c.setX(b)},y:function(b){a.checkNumber(b,"y");var c=r.get(this);a.checkArgument(!!c,"Window is destroyed");c.setY(b)},width:function(b){a.checkNumber(b,"width");var c=r.get(this);a.checkArgument(!!c,"Window is destroyed");c.setWidth(b)},height:function(b){a.checkNumber(b,"height");var c=r.get(this);a.checkArgument(!!c,"Window is destroyed");c.setHeight(b)},showContent:function(b){a.checkString(b,"id",1);var c=r.get(this);a.checkArgument(!!c,"Window is destroyed");c.showContent(b)},mask:function(b){a.optional.checkHtml(b,"message");var c=r.get(this);a.checkArgument(!!c,"Window is destroyed");return c.mask(b)},destroy:function(){r.get(this).onCloseCallbacks=null;r.set(this,null)},onClose:function(b){var c=r.get(this);a.checkArgument(!!c,"Window is destroyed");c.onCloseCallbacks||(c.onCloseCallbacks=[]);_.isFunction(b)&&c.onCloseCallbacks.push(b)}})});j.invoke("Preconditions",function(a){function b(a,b,c,d,e,f){var g,h=a.length,i=b.length,j=d-f["padding-left"]-f["padding-right"]-f["spacing-horizontal"]*(i-1),k=e-f["padding-top"]-f["padding-bottom"]-f["spacing-vertical"]*(h-1),l=c&&c.columns?c.columns[0]:b[0],m={left:[f["padding-left"]],top:[f["padding-top"]],width:[j*(l/100)],height:[]};for(g=1;g<i;g++){l=c&&c.columns?c.columns[g]:b[g];m.left[g]=m.left[g-1]+m.width[g-1]+f["spacing-horizontal"];m.width[g]=j*(l/100)}l=c&&c.rows?c.rows[0]:a[0];m.height[0]=k*(l/100);for(g=1;g<h;g++){l=c&&c.rows?c.rows[g]:a[g];m.top[g]=m.top[g-1]+m.height[g-1]+f["spacing-vertical"];m.height[g]=k*(l/100)}return m}function c(c,d){var e=c.length,f=d.length,g=e*f;return function(h,i,j,k,l,m){a.checkArray(h,"apps",g,g);a.checkObject(l,"style");var n=b(c,d,i,j,k,l);for(var o=0,p=0;o<e;o++)for(var q=0;q<f;q++)m(h[p++]).css({top:Math.round(n.top[o])+"px",left:Math.round(n.left[q])+"px",width:Math.round(n.width[q])+"px",height:Math.round(n.height[o])+"px"})}}function d(c,d,e,f){var g=1+(c?1:0)+(f?1:0),h=1+(d?1:0)+(e?1:0),i=g-1+1+(h-1);return function(j,k,l,m,n,o){a.checkArray(j,"apps",i,i);a.checkObject(k,"data");a.checkArray(k.rows,"data.rows",g,g);a.checkArray(k.columns,"data.columns",h,h);a.checkObject(n,"style");var p=b(k.rows,k.columns,k,l,m,n),q=0;c&&o(j[q++]).css({top:Math.round(p.top[0])+"px",left:Math.round(p.left[0])+"px",width:l-n["padding-left"]-n["padding-right"]+"px",height:Math.round(p.height[0])+"px"});d&&o(j[q++]).css({top:Math.round(p.top[c?1:0])+"px",left:Math.round(p.left[0])+"px",width:Math.round(p.width[0])+"px",height:Math.round(p.height[c?1:0])+"px"});o(j[q++]).css({top:Math.round(p.top[c?1:0])+"px",left:Math.round(p.left[d?1:0])+"px",width:Math.round(p.width[d?1:0])+"px",height:Math.round(p.height[c?1:0])+"px"});e&&o(j[q++]).css({top:Math.round(p.top[c?1:0])+"px",left:Math.round(p.left[d?2:1])+"px",width:Math.round(p.width[d?2:1])+"px",height:Math.round(p.height[c?1:0])+"px"});f&&o(j[q++]).css({top:Math.round(p.top[c?2:1])+"px",left:Math.round(p.left[0])+"px",width:l-n["padding-left"]-n["padding-right"]+"px",height:Math.round(p.height[c?2:1])+"px"})}}function e(a){return'<div class="dw-tab dw-space-'+a.type()+'" data-id="'+i.encodeAttr(a.id())+'" ng-click="activate(\''+a.id()+"')\" ng-class=\"{'dw-active': workspaces.active() == '"+a.id()+"', 'dw-dirty': workspaces.spaces('"+a.id()+"').dirty(), 'dw-invalid': workspaces.spaces('"+a.id()+'\').invalid() }">    <div class="dw-icon" role="img"></div>    <div class="dw-title">{{ workspaces.spaces(\''+a.id()+'\').title().toString() }}</div>    <div class="dw-close dw-glyph-times-circle dw-glyph-sm" role="img" ng-click="close(\''+a.id()+"', $event)\"></div></div>"}function f(a,b){return'<dw:app data-id="'+b.id()+'" space="workspaces.spaces(\''+a.id()+"')\" space-scope=\"spaceScopes['"+a.id()+"']\" app=\"workspaces.spaces('"+a.id()+"').apps()['"+b.id()+"']\"></dw:app>"}function g(a){return'<div class="dw-space dw-space-'+i.encodeAttr(a.type())+'" data-id="'+i.encodeAttr(a.id())+'" data-type="'+i.encodeAttr(a.type())+"\" ng-class=\"{'dw-active': workspaces.active() == '"+a.id()+"'}\" ng-show=\"workspaces.active() == '"+a.id()+"'\"></div>"}function h(b,c,d,h,j,m,n){function o(b,c){if(!_.isUndefined(d[b])){try{J[c]=i.intFormat.parse(d[b])}catch(e){throw new Error("Not a number: "+d.$attr[b])}a.checkNumber(J[c],d.$attr[b],0)}}function p(a,b,c){0===b?a():m(a,b,!1!==c)}function q(a,b,c){var d=a.attr("class");d=d?d.split(" "):[];b&&_.remove(d,function(a){var c=!1;_.each(b,function(b){c=c||0===a.indexOf(b)});return c});c&&d.push.apply(d,c);0===d.length?a.removeAttr("class"):a.attr("class",_.uniq(d).join(" "))}function r(){var a=H.transcludeEl||c;return angular.element(a.children()[0])}function s(){return angular.element(c[0].querySelector(".dw-body"))}function t(a){var b=_.find(r().children(),function(b){return angular.element(b).attr("data-id")===a});return b?angular.element(b):null}function u(a){var b=_.find(s().children(),function(b){return angular.element(b).attr("data-id")===a});return b?angular.element(b):null}function v(a,b){var c=u(a);if(!c)return null;c=_.find(c.children(),function(a){return angular.element(a).attr("data-id")===b});return c?angular.element(c):null}function w(a){_.isElement(a)||(a=document.querySelector(a));var b=angular.element(a);if(_.isElement(b[0])){b.append(r()[0]);H.transcludeEl=b}else{if(H.transcludeEl){c.prepend(r()[0]);H.transcludeEl=null}n.warn("<dw:workspaces>: Couldn't find a matching target element for header transclusion '"+a+"'.")}}function x(){_.each(h.spaces(),function(a){var c=a.id();I[c]||(I[c]=[b.$watch(function(){return a.type()},function(){C(c)}),b.$watch(function(){return encodeURIComponent(a.type())+"/"+encodeURIComponent(a.route())},function(){m(function(){D(c)},0)})])})}function y(a){var c=b.$new();c.dw$space=a;i.setScope(a,c);b.spaceScopes[a.id()]=c;return c}function z(a){b.spaceScopes[a]&&b.spaceScopes[a].$destroy();delete b.spaceScopes[a]}function A(a){var c=r(),d=s(),f=j(e(a))(b),h=c.children();h.length<2?c.prepend(f):angular.element(h[h.length-2]).after(j(e(a))(b));y(a);d.append(j(g(a))(b));x()}function B(a){var b=t(a);b&&b.remove();b=u(a);b&&b.remove();_.each(I[a],function(a){a()});delete I[a];z(a)}function C(b){if(!h.spaces(b))return;var c=t(b),d=u(b);a.checkArgument(!_.isUndefinedOrNull(c),"Missing header element for space "+b);a.checkArgument(!_.isUndefinedOrNull(d),"Missing content element for space "+b);var e=h.spaces(b);if(d.attr("data-type")===e.type())return;d.children().remove();z(b);y(e);q(c,["dw-space-"],["dw-space-"+e.type()]);q(d,["dw-space-"],["dw-space-"+e.type()]);d.attr("data-type",e.type())}function D(a){if(!h.spaces(a))return;a===h.active()&&F(a,l,l)}function E(){var a=h.spaces();_.each(s().children(),function(b){b=angular.element(b);0===_.remove(a,function(a){return a.id()===b.attr("data-id")}).length&&B(b.attr("data-id"))});_.each(a,function(a){A(a)});0===h.spaces().length&&H.open();h.active()&&H.activate(h.active())}function F(c,d,e){if(_.isBlank(c)||!h.spaces(c))return;var g=t(c),i=u(c);a.checkArgument(!_.isUndefinedOrNull(g),"Missing header element for space "+c);a.checkArgument(!_.isUndefinedOrNull(i),"Missing content element for space "+c);var k=h.spaces(c),l=k.type()+"#"+k.route();if(i.data("path")===l)return;var n=b.spaceScopes[k.id()];a.checkArgument(!_.isUndefinedOrNull(n),"Missing scope for space "+c);var o=_.values(k.apps());_.each(i.children(),function(a){a=angular.element(a);if(0===_.remove(o,function(b){return b.id()===a.attr("data-id")}).length){a.css("opacity","0.0");m(function(){a.addClass("ng-hide")},e,!1)}else{if(a.hasClass("ng-hide")){a.removeClass("ng-hide");a.css("opacity","0.0")}m(function(){a.css("opacity","1.0")},e+d,!1)}});_.each(o,function(a){var b=angular.element(f(k,a));b.css("opacity","0.0");m(function(){b.css("opacity","1.0")},e+d,!1);i.append(b);j(b)(n)});p(function(){H.layout(c)},e);p(function(){var a=_.isBlank(k.route())?[]:["dw-route-"+k.route()];q(g,["dw-route-"],a);q(i,["dw-route-"],a)},e+d,!1);if(e+d!==0){var r=["dw-route-exit-"+i.data("route"),"dw-route-enter-"+k.route()];q(g,[],r);q(i,[],r);m(function(){q(g,["dw-route-exit-","dw-route-enter-"]);q(i,["dw-route-exit-","dw-route-enter-"])},e+d,!1)}i.data("route",k.route());i.data("path",l)}function G(){I=null;angular.element(window).off("resize",H.resizeHandler);this.transcludeEl=null}var H=this,I={},J=_.clone(k);o("dwPaddingTop","padding-top");o("dwPaddingRight","padding-right");o("dwPaddingBottom","padding-bottom");o("dwPaddingLeft","padding-left");o("dwSpacingHorizontal","spacing-horizontal");o("dwSpacingVertical","spacing-vertical");b.open=function(){H.open()};b.activate=function(a){H.activate(a)};b.close=function(a,b){H.close(a);b.stopPropagation&&b.stopPropagation();b.preventDefault&&b.preventDefault();b.cancelBubble=!0;b.returnValue=!1};H.layout=function(b){var c=h.spaces(b);if(!c)return;var d=_.values(c.orderedApps()),e=u(b);a.checkArgument(!_.isUndefinedOrNull(e),"Missing content element for space "+b);var f=e[0].offsetWidth,g=e[0].offsetHeight,j=[],k=c.layout(),n=i.spaceLayoutFunctions[k.type];a.checkArgument(_.isFunction(n),"Unknown layout: "+c.layout().type);n(d,k.data,f,g,J,function(b){a.checkObject(b,"app");var d=v(c.id(),b.id());j.push(b);return d});q(e,["dw-layout-"],["dw-layout-"+c.layout().type]);m(function(a){return function(){_.each(a,function(a){var b=a.scope();b&&b.$broadcast(i.events.resize)})}}(j),l)};H.resizeHandler=function(){H.layout(h.active())};H.link=function(){b.workspaces=h;b.spaceScopes={};b.$watch("workspaces.routeCounter()",function(){h.initialized().then(E)});x();angular.element(window).on("resize",H.resizeHandler);b.$on("$destroy",G);_.isUndefined(d.dwWorkspacesHeaderTarget)||b.$watch(d.dwWorkspacesHeaderTarget,w)};H.open=function(){h.open()};H.activate=function(a){h.activate(a);m(function(){F(a,0,0)},0,!1)};H.close=function(a){var b=a===h.active();h.close(a).then(function(){B(a);0===h.spaces().length&&H.open();b&&m(function(){F(h.active(),0,0)},0,!1)})};c.addClass("dw-workspaces")}var j='<div class="dw-header dw-workspaces-header"><div class="dw-tab dw-new" ng-click="open()"><div class="dw-title">+</div></div></div><div class="dw-body"></div>';var k={"padding-top":15,"padding-right":10,"padding-bottom":15,"padding-left":10,"spacing-horizontal":10,"spacing-vertical":10};var l=100;i.spaceLayoutFunctions["1x1"]=c([100],[100]);i.spaceLayoutFunctions["1x2"]=c([100],[50,50]);i.spaceLayoutFunctions["2x1"]=c([50,50],[100]);i.spaceLayoutFunctions["1x3"]=c([100],[100/3,100/3,100/3]);i.spaceLayoutFunctions["3x1"]=c([100/3,100/3,100/3],[100]);i.spaceLayoutFunctions["2x2"]=c([50,50],[50,50]);i.spaceLayoutFunctions["1x4"]=c([100],[25,25,25,25]);i.spaceLayoutFunctions["4x1"]=c([25,25,25,25],[100]);i.spaceLayoutFunctions["2x3"]=c([50,50],[100/3,100/3,100/3]);i.spaceLayoutFunctions["3x2"]=c([100/3,100/3,100/3],[50,50]);i.spaceLayoutFunctions["2x4"]=c([50,50],[25,25,25,25]);i.spaceLayoutFunctions["4x2"]=c([25,25,25,25],[50,50]);i.spaceLayoutFunctions["3x3"]=c([100/3,100/3,100/3],[100/3,100/3,100/3]);i.spaceLayoutFunctions.border=d(!0,!0,!0,!0);i.spaceLayoutFunctions["1+2"]=d(!0,!0,!1,!1);i.spaceLayoutFunctions["1+3"]=d(!0,!0,!0,!1);i.spaceLayoutFunctions["2+1"]=d(!1,!1,!0,!0);i.spaceLayoutFunctions["3+1"]=d(!1,!0,!0,!0);i.buist.directive("dwWorkspaces",function(){return{restrict:"E",replace:!1,template:j,scope:!0,controller:["$scope","$element","$attrs","Workspaces","$compile","$timeout","$log",h],link:function(a,b,c,d){d.link(b)}}})});j.invoke("Preconditions",function(a){function b(a){if(!a)return;for(;a.$$childHead;){var b=a.$$childHead;for(;b;){b.$destroy();b=b.$$nextSibling}}}i.component=function(c){return function(){function d(a){a.addClass("dw-component")}function e(b,c,d){d=!0===d;var e,f="definition.";if(_.isArray(b)){a.checkArray(b,f+c,1);e=_.last(b)}else e=!_.isUndefinedOrNull(b)&&_.isString(b)?b=_.constant(b):b;!e&&d||a.checkFunction(e,f+c);if(e){g[c]=b;g[c+"Fn"]=e}}function f(c,f,i,j,k,l,m,n,o){function p(){return r||k.$$destroyed||_.get(q,"$$destroyed")}var q,r=!1;l=angular.element(l);l.on("$destroy",function(){r=!0});!function r(){function s(a){var b=_.clone(D);a&&a(b);return b}function t(a){a.$template=C}function u(a,b){var d=g[a+"Fn"];return c.invoke(g[a],d,s(b))}function v(a){l.removeClass("dw-loading");if(p())return;l.html(_.isBlank(a)?"":a);i(l.contents(),o)(q);g.preLink&&u("preLink",t);g.link&&u("link",t)}function w(){v(u("template",t))}function x(b){if(p())return;a.checkObject(b,"cfg");C=b;g.controller&&u("controller",function(a){a.$template=C});w()}if(p())return;l.addClass("dw-loading");b(q);var y;if(h){y=q;q=k.$new();y&&y.$destroy()}else{y=k;q=k}var z,A=g.controllerFn?[g.controllerFn]:[];z=_.isArray(n)?A.concat(_.reject(n,function(a){return a instanceof d})):A;var B={refresh:w,reload:function(){q.$applyAsync(r)}};var C,D={$scope:q,$element:l,$attrs:m,$ctrl:_.size(z)>1?z:z[0],$component:B,$transclude:o};if(y&&g.reload){u("reload",function(a){a.$oldScope=y});y=null}if(m.dwController){e(f(m.dwController)(k),"initializer");u("initializer")}var E=u("load");_.isPromise(E)?E.then(x,function(a){j("Loading component failed",a)}):x(E)}()}if(_.isArray(c)){a.checkArray(c,"definition",2);c=j.invoke.apply(null,c)}a.checkObject(c,"definition");a.optional.checkBoolean(c.scope,"definition.scope");_.each(["compile","restrict","replace","templateUrl"],function(b){a.checkArgument(!_.has(c,b),"Not supported: definition."+b)});var g={};var h=c.scope=!1!==c.scope;e(c.load,"load");e(c.reload,"reload",!0);e(c.template,"template");e(c.controller,"controller",!0);if(_.isObjectMap(c.link)){e(c.link.pre,"preLink",!0);e(c.link.post,"link",!0)}else e(c.link,"link",!0);e(c.directivePreLink,"directivePreLink",!0);return _.defaults({restrict:"E",replace:!1,template:"",controller:["$element",d],link:{pre:g.directivePreLink,post:j.inject("$injector","$parse","$compile","$exceptionHandler",f)}},_.omit(c,"load"))}}});!function(){i.CUSTOM_TEMPLATES_KEY="dw$templates";i.buist.directive("dwxCustomizable",function(){return{restrict:"E",replace:!1,scope:!1,link:{pre:function(a,b){b.addClass("dwx-customizable");b.data(i.CUSTOM_TEMPLATES_KEY,{})}}}})}();j.invoke("Validator",function(a){function b(a,b,c){var d=_.isPlainObject(c),e=_.isArray(c);if(!d&&!e)return;if(e){if(!_.isEmpty(b[k]))return v(a);c=_.transform(c,function(a,b,c){a[c]=b},{});c.length=_.size(c)}q[a]=c;_.assign(b[k],c)}function c(b,c,d){_.forEach(d,function(d,e){try{var f=a.rule(d),g=a.of(f);r[b][e]=g;c[l][e]=g}catch(h){}})}function d(a,b,c){if(!_.isArray(c))return;s[a]=c;_.assign(b[m],c)}function e(a,b,c){if(!_.isPlainObject(c))return;t[a]=c;_.assign(b[n],c)}function f(a,b,c){if(!_.isArray(c))return;u[a]=c;_.assign(b[o],c)}function g(a,b){_.forEach(q[a],function(a,c){delete b[k][c]});q[a]={};_.has(b[k],"length")&&delete b[k].length;_.forEach(r[a],function(a,c){delete b[l][c]});r[a]={};_.forEach(s[a],function(a){b[m]=_.without(b[m],a)});s[a]=[];_.forEach(t[a],function(a,c){delete b[n][c]});t[a]={};_.forEach(u[a],function(a,c){delete b[o][c]});u[a]=[]}var h="dwx$include.load",k="dwx$data",l="dwx$validators",m="dwx$observables",n="dwx$widgets",o="dwx$actions",p={restricted:!0,template:""},q={},r={},s={},t={},u=[],v=j.inject("$log",function(a,b){a.warn("<dwx:include>: Skip adding template data for include with ID '"+b+"'.")});i.buist.directive("dwxInclude",i.component({scope:!1,require:["dwxInclude"],load:["$scope","$element","$attrs","$q","$http","$sce","$templateCache","$timeout",function(a,h,j,q,r,s,t,u){function v(){g(h.id,a);h.data(i.RESTRICTED_KEY,!0);x.resolve(_.clone(p));!a.$$destroyed&&u(w,0,!1)}function w(){u(function(){!a.$$destroyed&&a.$emit(i.events.invalidate)},0,!1)}if(!_.isString(j.href))throw new Error("Expected href");h.id||(h.id=_.uniqueId("dwx-include-"));!a[k]&&(a[k]={});!a[l]&&(a[l]={});!a[m]&&(a[m]=[]);!a[n]&&(a[n]={});!a[o]&&(a[o]=[]);var x=q.defer();u(function(){if(a.$$destroyed)return;if(_.isBlank(j.href))v();else{var k={cache:t,responseType:"json"};if(!_.isBlank(j.dwConfig)){var l=_.get(a,j.dwConfig);_.isPlainObject(l)&&_.assign(k,l)}r.get(s.getTrustedResourceUrl(j.href),k).then(function(j){if(a.$$destroyed)return;var k=_.get(j,"data");_.isPlainObject(k)||(k=_.clone(p));h.data(i.RESTRICTED_KEY,!1!==k.restricted);g(h.id,a);b(h.id,a,k.data);c(h.id,a,k.validators);d(h.id,a,k.observables);e(h.id,a,k.widgets);f(h.id,a,k.actions);a.$broadcast(i.events.generate);x.resolve(_.pick(k,"restricted","template"));u(w,0,!1)},v)}});return x.promise}],template:["$template",function(a){return a.template}],controller:["$scope","$element","$attrs","$component",function(a,b,c,d){var e=a.$watch(function(){return c.href},function(b,c){if(b!==c){a.$broadcast(h);d.reload()}});a.$on(h,function(){e&&e();e=null});b.addClass("dwx-include")}],directivePreLink:function(a,b){b.data(i.CUSTOM_TEMPLATES_KEY,{})}}));i.unrestrictedDirectives.push("dwxInclude")});!function(){i.buist.directive("dwxReplace",i.component({scope:!1,load:["$element","$attrs","$timeout",function(a,b,c){function d(){var c,d=a.parent();for(;d[0];){c=d.data(i.CUSTOM_TEMPLATES_KEY);if(c&&!_.isUndefined(c[b.name]))return c[b.name];d=d.parent()}}function e(b){a.data(i.RESTRICTED_KEY,!1!==b.restricted);return b}var f=d();if(f)return e(f);return c(function(){return e(d()||{template:_.constant(""),restricted:!0})})}],template:["$template",function(a){return a.template()}],controller:["$element",function(a){a.addClass("dwx-replace")}]}));i.unrestrictedDirectives.push("dwxReplace")}();!function(){i.buist.directive("dwxTemplate",function(){return{restrict:"E",replace:!1,scope:!1,compile:function(a){var b=a.html();a.html("");return{pre:function(a,c,d){var e=c.inheritedData(i.CUSTOM_TEMPLATES_KEY);e&&(e[d.name]={template:_.constant(b),restricted:!0===c.inheritedData(i.RESTRICTED_KEY)})},post:function(a,b){b.remove()}}}}});i.unrestrictedDirectives.push("dwxTemplate")}();i.buist.directive("dwxIf",function(){return{restrict:"A",replace:!1,scope:!1,link:function(a,b,c){a.$watch(c.dwxIf,function(a){a?b.removeClass("ng-hide"):b.addClass("ng-hide")})}}});i.unrestrictedDirectives.push("dwxIf");i.buist.directive("dwTooltipText",["$compile",function(a){function b(b,c){var d=angular.noop;if(_.isUndefined(c.dwTooltip)){b.attr("dw-tooltip",c.dwTooltipText);b.removeAttr(c.$attr.dwTooltipText);d=a(b)}return function(a,b){d(a,function(a){b.replaceWith(a)})}}return{restrict:"A",scope:!1,terminal:!0,priority:i.MAX_INT,compile:b}}]);j.invoke("Configuration","Browser",function(a,c){function d(a){return _.some(a,function(a,b){return c["is"+b]()&&c.version()>=a})}i.config["i18n.incompatibleBrowser.title"]="Sorry, your browser is not supported";i.config["i18n.incompatibleBrowser.message"]="To use the application with all its features, you must use one of the supported browser versions.";var e={Chrome:28,FF:19,IE:9,Edge:12,Safari:6};var f={Chrome:4,FF:6,IE:8,Edge:12,Safari:4};i.isCompatibleBrowser=function(){return d(e)};i.isAlertableBrowser=function(){return d(f)};var g=_.once(function(){if(!i.isCompatibleBrowser())if(i.isAlertableBrowser()){var c=j.alert();c.type("warning");c.title(j.safe(a["i18n.incompatibleBrowser.title"]));c.message(j.safe(a["i18n.incompatibleBrowser.message"]));c()}else b.alert(j.safe(a["i18n.incompatibleBrowser.message"]).toString())});i.buist.run(function(){_.each(i.module.apps,function(a){a.ready(g)})})})}("dw$",function(){return this}());
//# sourceMappingURL=dw.ui.core-main.min.js.map